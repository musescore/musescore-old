<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>MuseScore: edit.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>edit.cpp</h1><a href="edit_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">//=========================================================</span>
00002 <span class="comment">//  MuseScore</span>
00003 <span class="comment">//  Linux Music Score Editor</span>
00004 <span class="comment">//  $Id: edit.cpp,v 1.51 2005/06/19 17:01:35 wschweer Exp $</span>
00005 <span class="comment">//</span>
00006 <span class="comment">//  (C) Copyright 2002-2004 Werner Schweer (ws@seh.de)</span>
00007 <span class="comment">//=========================================================</span>
00008 
00009 <span class="preprocessor">#include "<a class="code" href="canvas_8h.html">canvas.h</a>"</span>
00010 <span class="preprocessor">#include "<a class="code" href="undo_8h.html">undo.h</a>"</span>
00011 <span class="preprocessor">#include "<a class="code" href="note_8h.html">note.h</a>"</span>
00012 <span class="preprocessor">#include "<a class="code" href="utils_8h.html">utils.h</a>"</span>
00013 <span class="preprocessor">#include "<a class="code" href="key_8h.html">key.h</a>"</span>
00014 <span class="preprocessor">#include "<a class="code" href="sig_8h.html">sig.h</a>"</span>
00015 <span class="preprocessor">#include "<a class="code" href="clef_8h.html">clef.h</a>"</span>
00016 <span class="preprocessor">#include "<a class="code" href="padstate_8h.html">padstate.h</a>"</span>
00017 <span class="preprocessor">#include "<a class="code" href="project_8h.html">project.h</a>"</span>
00018 <span class="preprocessor">#include "<a class="code" href="dynamics_8h.html">dynamics.h</a>"</span>
00019 <span class="preprocessor">#include "<a class="code" href="slur_8h.html">slur.h</a>"</span>
00020 <span class="preprocessor">#include "<a class="code" href="navigate_8h.html">navigate.h</a>"</span>
00021 <span class="preprocessor">#include "<a class="code" href="system_8h.html">system.h</a>"</span>
00022 <span class="preprocessor">#include "<a class="code" href="hairpin_8h.html">hairpin.h</a>"</span>
00023 <span class="preprocessor">#include "<a class="code" href="select_8h.html">select.h</a>"</span>
00024 <span class="preprocessor">#include "<a class="code" href="beam_8h.html">beam.h</a>"</span>
00025 <span class="preprocessor">#include "<a class="code" href="segment_8h.html">segment.h</a>"</span>
00026 <span class="preprocessor">#include "<a class="code" href="input_8h.html">input.h</a>"</span>
00027 <span class="preprocessor">#include "<a class="code" href="staff_8h.html">staff.h</a>"</span>
00028 
00029 <span class="comment">//---------------------------------------------------------</span>
00030 <span class="comment">//   selectNoteMessage</span>
00031 <span class="comment">//---------------------------------------------------------</span>
00032 
<a name="l00033"></a><a class="code" href="edit_8cpp.html#a0">00033</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="edit_8cpp.html#a0">selectNoteMessage</a>(QWidget* parent)
00034       {
00035       QMessageBox::critical(parent,
00036                QMessageBox::tr(<span class="stringliteral">"MuseScore:"</span>),
00037                QMessageBox::tr(<span class="stringliteral">"please select a single note and retry operation\n"</span>),
00038                QMessageBox::Ok, QMessageBox::NoButton);
00039       }
00040 
<a name="l00041"></a><a class="code" href="edit_8cpp.html#a1">00041</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="edit_8cpp.html#a1">selectNoteRestMessage</a>(QWidget* parent)
00042       {
00043       QMessageBox::critical(parent,
00044                QMessageBox::tr(<span class="stringliteral">"MuseScore:"</span>),
00045                QMessageBox::tr(<span class="stringliteral">"please select a single note or rest and retry operation\n"</span>),
00046                QMessageBox::Ok, QMessageBox::NoButton);
00047       }
00048 
<a name="l00049"></a><a class="code" href="edit_8cpp.html#a2">00049</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="edit_8cpp.html#a2">selectNoteSlurMessage</a>(QWidget* parent)
00050       {
00051       QMessageBox::critical(parent,
00052                QMessageBox::tr(<span class="stringliteral">"MuseScore:"</span>),
00053                QMessageBox::tr(<span class="stringliteral">"please select a single note or slur and retry operation\n"</span>),
00054                QMessageBox::Ok, QMessageBox::NoButton);
00055       }
00056 <span class="preprocessor">#if 0</span>
00057 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">void</span> clickNoteMessage(QWidget* parent)
00058       {
00059       QMessageBox::critical(parent,
00060                QMessageBox::tr(<span class="stringliteral">"MuseScore:"</span>),
00061                QMessageBox::tr(<span class="stringliteral">"please click a note to add object\n"</span>),
00062                QMessageBox::Ok, Qt::NoButton);
00063       }
00064 <span class="preprocessor">#endif</span>
00065 <span class="preprocessor"></span>
00066 <span class="comment">//---------------------------------------------------------</span>
00067 <span class="comment">//   getSelectedNote</span>
00068 <span class="comment">//---------------------------------------------------------</span>
00069 
<a name="l00070"></a><a class="code" href="classScore.html#d9">00070</a> <a class="code" href="classNote.html">Note</a>* <a class="code" href="classScore.html#d9">Score::getSelectedNote</a>()
00071       {
00072       <a class="code" href="classElement.html">Element</a>* el = <a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#a6">element</a>();
00073       <span class="keywordflow">if</span> (el) {
00074             <span class="keywordflow">if</span> (el-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a12">NOTE</a>)
00075                   <span class="keywordflow">return</span> (<a class="code" href="classNote.html">Note</a>*)el;
00076             }
00077       <a class="code" href="edit_8cpp.html#a0">selectNoteMessage</a>(<a class="code" href="classScore.html#a46">canvas</a>());
00078       <span class="keywordflow">return</span> 0;
00079       }
00080 
00081 <span class="comment">//---------------------------------------------------------</span>
00082 <span class="comment">//   getSelectedChordRest</span>
00083 <span class="comment">//---------------------------------------------------------</span>
00084 
<a name="l00085"></a><a class="code" href="classScore.html#a127">00085</a> <a class="code" href="classChordRest.html">ChordRest</a>* <a class="code" href="classScore.html#a127">Score::getSelectedChordRest</a>(QWidget* parent)
00086       {
00087       <a class="code" href="classElement.html">Element</a>* el = <a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#a6">element</a>();
00088       <span class="keywordflow">if</span> (el) {
00089             <span class="keywordflow">if</span> (el-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a12">NOTE</a>)
00090                   <span class="keywordflow">return</span> ((<a class="code" href="classNote.html">Note</a>*)el)-&gt;chord();
00091             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (el-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a26">REST</a>)
00092                   <span class="keywordflow">return</span> (<a class="code" href="classRest.html">Rest</a>*)el;
00093             }
00094       <a class="code" href="edit_8cpp.html#a1">selectNoteRestMessage</a>(parent);
00095       <span class="keywordflow">return</span> 0;
00096       }
00097 
00098 <span class="comment">//---------------------------------------------------------</span>
00099 <span class="comment">//   changeRest</span>
00100 <span class="comment">//---------------------------------------------------------</span>
00101 
<a name="l00102"></a><a class="code" href="classScore.html#a78">00102</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#a78">Score::changeRest</a>(<a class="code" href="classRest.html">Rest</a>* rest, <span class="keywordtype">int</span> <span class="comment">/*tick*/</span>, <span class="keywordtype">int</span> len)
00103       {
00104       rest-&gt;<a class="code" href="classRest.html#a4">setTickLen</a>(len);
00105       }
00106 
00107 <span class="comment">//---------------------------------------------------------</span>
00108 <span class="comment">//   setRest</span>
00109 <span class="comment">//---------------------------------------------------------</span>
00110 
<a name="l00111"></a><a class="code" href="classScore.html#a44">00111</a> <a class="code" href="classRest.html">Rest</a>* <a class="code" href="classScore.html#a44">Score::setRest</a>(<span class="keywordtype">int</span> tick, <span class="keywordtype">int</span> len, <span class="keywordtype">int</span> staffIdx, <span class="keywordtype">int</span> voice, <a class="code" href="classMeasure.html">Measure</a>* measure)
00112       {
00113       <a class="code" href="classStaff.html">Staff</a>* staffp = <a class="code" href="classScore.html#a7">staff</a>(staffIdx);
00114       <a class="code" href="classRest.html">Rest</a>* rest = 0;
00115       <span class="keywordflow">if</span> (len / (<a class="code" href="mtime_8h.html#a0">division</a>*4)) {
00116             <span class="keywordtype">int</span> nlen =  len % (<a class="code" href="mtime_8h.html#a0">division</a>*4);
00117             <span class="keywordflow">if</span> (nlen) {
00118                   <a class="code" href="classScore.html#a44">setRest</a>(tick, nlen, staffIdx, voice, measure);
00119                   tick += nlen;
00120                   }
00121             rest = <span class="keyword">new</span> <a class="code" href="classRest.html">Rest</a>(<span class="keyword">this</span>, tick, <a class="code" href="mtime_8h.html#a0">division</a>*4);
00122             }
00123       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (len / (<a class="code" href="mtime_8h.html#a0">division</a>*2)) {
00124             <span class="keywordtype">int</span> nlen =  len % (<a class="code" href="mtime_8h.html#a0">division</a>*2);
00125             <span class="keywordflow">if</span> (nlen) {
00126                   <a class="code" href="classScore.html#a44">setRest</a>(tick, nlen, staffIdx, voice, measure);
00127                   tick += nlen;
00128                   }
00129             rest = <span class="keyword">new</span> <a class="code" href="classRest.html">Rest</a>(<span class="keyword">this</span>, tick, <a class="code" href="mtime_8h.html#a0">division</a>*2);
00130             }
00131       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (len / <a class="code" href="mtime_8h.html#a0">division</a>) {
00132             <span class="keywordtype">int</span> nlen =  len % (<a class="code" href="mtime_8h.html#a0">division</a>);
00133             <span class="keywordflow">if</span> (nlen) {
00134                   <a class="code" href="classScore.html#a44">setRest</a>(tick, nlen, staffIdx, voice, measure);
00135                   tick += nlen;
00136                   }
00137             rest = <span class="keyword">new</span> <a class="code" href="classRest.html">Rest</a>(<span class="keyword">this</span>, tick, <a class="code" href="mtime_8h.html#a0">division</a>);
00138             }
00139       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (len / (<a class="code" href="mtime_8h.html#a0">division</a>/2)) {
00140             <span class="keywordtype">int</span> nlen = len % (<a class="code" href="mtime_8h.html#a0">division</a>/2);
00141             <span class="keywordflow">if</span> (nlen) {
00142                   <a class="code" href="classScore.html#a44">setRest</a>(tick, nlen, staffIdx, voice, measure);
00143                   tick += nlen;
00144                   }
00145             rest = <span class="keyword">new</span> <a class="code" href="classRest.html">Rest</a>(<span class="keyword">this</span>, tick, <a class="code" href="mtime_8h.html#a0">division</a>/2);
00146             }
00147       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (len / (<a class="code" href="mtime_8h.html#a0">division</a>/4)) {
00148             <span class="keywordtype">int</span> nlen = len % (<a class="code" href="mtime_8h.html#a0">division</a>/4);
00149             <span class="keywordflow">if</span> (nlen) {
00150                   <a class="code" href="classScore.html#a44">setRest</a>(tick, nlen, staffIdx, voice, measure);
00151                   tick += nlen;
00152                   }
00153             rest = <span class="keyword">new</span> <a class="code" href="classRest.html">Rest</a>(<span class="keyword">this</span>, tick, <a class="code" href="mtime_8h.html#a0">division</a>/4);
00154             }
00155       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (len / (<a class="code" href="mtime_8h.html#a0">division</a>/8)) {
00156             <span class="keywordtype">int</span> nlen = len % (<a class="code" href="mtime_8h.html#a0">division</a>/8);
00157             <span class="keywordflow">if</span> (nlen) {
00158                   <a class="code" href="classScore.html#a44">setRest</a>(tick, nlen, staffIdx, voice, measure);
00159                   tick += nlen;
00160                   }
00161             rest = <span class="keyword">new</span> <a class="code" href="classRest.html">Rest</a>(<span class="keyword">this</span>, tick, <a class="code" href="mtime_8h.html#a0">division</a>/8);
00162             }
00163       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (len / (<a class="code" href="mtime_8h.html#a0">division</a>/16)) {
00164             <span class="keywordtype">int</span> nlen = len % (<a class="code" href="mtime_8h.html#a0">division</a>/16);
00165             <span class="keywordflow">if</span> (nlen) {
00166                   <a class="code" href="classScore.html#a44">setRest</a>(tick, nlen, staffIdx, voice, measure);
00167                   tick += nlen;
00168                   }
00169             rest = <span class="keyword">new</span> <a class="code" href="classRest.html">Rest</a>(<span class="keyword">this</span>, tick, <a class="code" href="mtime_8h.html#a0">division</a>/16);
00170             }
00171       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (len / (<a class="code" href="mtime_8h.html#a0">division</a>/32)) {
00172             <span class="keywordtype">int</span> nlen = len % (<a class="code" href="mtime_8h.html#a0">division</a>/32);
00173             <span class="keywordflow">if</span> (nlen) {
00174                   <a class="code" href="classScore.html#a44">setRest</a>(tick, nlen, staffIdx, voice, measure);
00175                   tick += nlen;
00176                   }
00177             rest = <span class="keyword">new</span> <a class="code" href="classRest.html">Rest</a>(<span class="keyword">this</span>, tick, <a class="code" href="mtime_8h.html#a0">division</a>/32);
00178             }
00179       <span class="keywordflow">if</span> (rest) {
00180             rest-&gt;<a class="code" href="classElement.html#a63">setVoice</a>(voice);
00181             rest-&gt;<a class="code" href="classElement.html#a61">setStaff</a>(staffp);
00182             measure-&gt;<a class="code" href="classMeasure.html#a8">add</a>(rest);
00183             QRegion r;
00184             <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::AddObject, rest);
00185             }
00186       <span class="keywordflow">return</span> rest;
00187       }
00188 
00189 <span class="comment">//---------------------------------------------------------</span>
00190 <span class="comment">//   addNote</span>
00191 <span class="comment">//---------------------------------------------------------</span>
00192 
<a name="l00193"></a><a class="code" href="classScore.html#a68">00193</a> <a class="code" href="classNote.html">Note</a>* <a class="code" href="classScore.html#a68">Score::addNote</a>(<a class="code" href="classChord.html">Chord</a>* chord, <span class="keywordtype">int</span> pitch)
00194       {
00195       <span class="keywordtype">int</span> <a class="code" href="classScore.html#a7">staff</a>  = chord-&gt;<a class="code" href="classElement.html#a60">staffIdx</a>();
00196       <a class="code" href="classNote.html">Note</a>* note = <span class="keyword">new</span> <a class="code" href="classNote.html">Note</a>(<span class="keyword">this</span>, pitch, <span class="keyword">false</span>);
00197       note-&gt;<a class="code" href="classNote.html#a8">setTicks</a>(chord-&gt;<a class="code" href="classElement.html#a76">tickLen</a>());
00198       chord-&gt;<a class="code" href="classChord.html#a28">add</a>(note);
00199       <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::AddObject, note);
00200       chord-&gt;<a class="code" href="classChordRest.html#a11">measure</a>()-&gt;<a class="code" href="classMeasure.html#a59">layoutNoteHeads</a>(staff);
00201       <a class="code" href="classScore.html#a49">layout</a>();
00202       <span class="keywordflow">return</span> note;
00203       }
00204 
00205 <span class="comment">//---------------------------------------------------------</span>
00206 <span class="comment">//   addKeySig</span>
00207 <span class="comment">//---------------------------------------------------------</span>
00208 
<a name="l00209"></a><a class="code" href="classScore.html#a64">00209</a> <a class="code" href="classElement.html">Element</a>* <a class="code" href="classScore.html#a64">Score::addKeySig</a>(<a class="code" href="classKeySig.html">KeySig</a>* sig, <span class="keyword">const</span> QPointF&amp; pos)
00210       {
00211       <span class="keywordtype">int</span> tick;
00212       <span class="keywordflow">if</span> (!<a class="code" href="classScore.html#a21">pos2measure</a>(pos, &amp;tick, 0, 0, 0, 0)) {
00213             <span class="keyword">delete</span> sig;
00214             <span class="keywordflow">return</span> 0;
00215             }
00216       (*keymap)[tick] = sig-&gt;<a class="code" href="classKeySig.html#a5">idx</a>();
00217 
00218       <span class="keywordflow">if</span> (tick != 0) {
00219             sig-&gt;<a class="code" href="classElement.html#a75">setTick</a>(tick);
00220             printf(<span class="stringliteral">"not impl.: keys signature at tick != 0\n"</span>);
00221             <span class="keyword">delete</span> sig;
00222             <span class="keywordflow">return</span> 0;
00223             }
00224       <span class="keywordflow">else</span> {
00225 <span class="preprocessor">#if 0 //TODOx</span>
00226 <span class="preprocessor"></span>            <span class="keyword">delete</span> sig;
00227             <a class="code" href="classPage.html">Page</a>* page = <a class="code" href="classScore.html#o12">pages</a>-&gt;<a class="code" href="classpstl_1_1plist.html#a12">front</a>();
00228             <a class="code" href="classSystem.html">System</a>* system = page-&gt;<a class="code" href="classPage.html#a4">systems</a>()-&gt;<a class="code" href="classpstl_1_1plist.html#a12">front</a>();
00229             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classScore.html#a6">nstaves</a>(); ++i)
00230                   system-&gt;addKeysig(i, 0);
00231 <span class="preprocessor">#endif</span>
00232 <span class="preprocessor"></span>            sig = 0;
00233             }
00234       <a class="code" href="classScore.html#a49">layout</a>();
00235       <span class="keywordflow">return</span> sig;
00236       }
00237 
00238 <span class="comment">//---------------------------------------------------------</span>
00239 <span class="comment">//   removeClef</span>
00240 <span class="comment">//---------------------------------------------------------</span>
00241 
<a name="l00242"></a><a class="code" href="classScore.html#a72">00242</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#a72">Score::removeClef</a>(<a class="code" href="classClef.html">Clef</a>* clef)
00243       {
00244       <span class="keywordtype">int</span> tick = clef-&gt;<a class="code" href="classElement.html#a74">tick</a>();
00245       <span class="keywordflow">if</span> (tick == 0)    <span class="comment">// cannot remove first clef</span>
00246             <span class="keywordflow">return</span>;
00247       <span class="keywordtype">int</span> staffIdx = clef-&gt;<a class="code" href="classElement.html#a60">staffIdx</a>();
00248       <a class="code" href="classClefList.html">ClefList</a>* ct = <a class="code" href="classScore.html#a7">staff</a>(staffIdx)-&gt;clef();
00249       <span class="keywordtype">int</span> oidx  = ct-&gt;<a class="code" href="classClefList.html#a1">clef</a>(tick-1);  <span class="comment">// clef state before clef</span>
00250 
00251       <span class="comment">//---------------------------------------------</span>
00252       <span class="comment">//    remove unnessesary clef symbols</span>
00253       <span class="comment">//---------------------------------------------</span>
00254 
00255       <span class="keywordflow">for</span> (<a class="code" href="classMeasure.html">Measure</a>* m = <a class="code" href="classScore.html#a100">first</a>(); m; m = m-&gt;<a class="code" href="classMeasure.html#a64">next</a>()) {
00256             <span class="keywordflow">if</span> ((m-&gt;<a class="code" href="classElement.html#a74">tick</a>()+m-&gt;<a class="code" href="classMeasure.html#a26">tickLen</a>()) &lt; tick)
00257                   <span class="keywordflow">continue</span>;
00258             <span class="keywordflow">for</span> (<a class="code" href="classSegment.html">Segment</a>* segment = m-&gt;<a class="code" href="classMeasure.html#a28">first</a>(); segment; segment = segment-&gt;<a class="code" href="classSegment.html#a4">next</a>()) {
00259                   <span class="keywordflow">if</span> (segment-&gt;<a class="code" href="classSegment.html#a18">type</a>() != Segment::SegClef)
00260                         <span class="keywordflow">continue</span>;
00261                   <span class="keywordtype">int</span> startTrack = staffIdx * <a class="code" href="globals_8h.html#a3">VOICES</a>;
00262                   <span class="keywordtype">int</span> endTrack   = startTrack + <a class="code" href="globals_8h.html#a3">VOICES</a>;
00263                   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> track = startTrack; track &lt; endTrack; ++track) {
00264                         <a class="code" href="classElement.html">Element</a>* e = segment-&gt;<a class="code" href="classSegment.html#a8">element</a>(track);
00265                         <span class="keywordflow">if</span> (e == 0 || e-&gt;<a class="code" href="classElement.html#a40">type</a>() != <a class="code" href="element_8h.html#a65a22">CLEF</a>)
00266                               <span class="keywordflow">continue</span>;
00267                         <span class="keywordtype">int</span> etick = e-&gt;<a class="code" href="classElement.html#a74">tick</a>();
00268                         <span class="keywordflow">if</span> (etick &lt;= tick)
00269                               <span class="keywordflow">continue</span>;
00270                         <span class="keywordtype">int</span> cidx = ((<a class="code" href="classClef.html">Clef</a>*)e)-&gt;idx();
00271                         <span class="keywordflow">if</span> (cidx == oidx) {
00272                               <span class="comment">// this clef is can be removed:</span>
00273                               <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::RemoveObject, e);
00274                               segment-&gt;<a class="code" href="classSegment.html#a10">setElement</a>(track, 0);
00275                               }
00276                         <span class="keywordflow">break</span>;
00277                         }
00278                   }
00279             }
00280 
00281       <a class="code" href="classScore.html#a61">removeObject</a>(clef);
00282       <a class="code" href="classScore.html#a49">layout</a>();
00283       }
00284 
00285 <span class="comment">//---------------------------------------------------------</span>
00286 <span class="comment">//   addClef</span>
00287 <span class="comment">//---------------------------------------------------------</span>
00288 
<a name="l00289"></a><a class="code" href="classScore.html#a62">00289</a> <a class="code" href="classElement.html">Element</a>* <a class="code" href="classScore.html#a62">Score::addClef</a>(<a class="code" href="classClef.html">Clef</a>* clef)
00290       {
00291       <span class="keywordtype">int</span> tick     = clef-&gt;<a class="code" href="classElement.html#a74">tick</a>();
00292       <span class="keywordtype">int</span> idx      = clef-&gt;<a class="code" href="classClef.html#a5">idx</a>();
00293       <span class="keywordtype">int</span> staffIdx = clef-&gt;<a class="code" href="classElement.html#a60">staffIdx</a>();
00294       <a class="code" href="classClefList.html">ClefList</a>* ct = <a class="code" href="classScore.html#a7">staff</a>(staffIdx)-&gt;clef();
00295       <span class="keywordflow">if</span> (ct-&gt;<a class="code" href="classClefList.html#a1">clef</a>(tick) == idx)    <span class="comment">// no effect</span>
00296             <span class="keywordflow">return</span> 0;
00297 
00298       <span class="comment">//---------------------------------------------</span>
00299       <span class="comment">//    remove unnessesary clef symbols</span>
00300       <span class="comment">//---------------------------------------------</span>
00301 
00302       <span class="keywordflow">for</span> (<a class="code" href="classMeasure.html">Measure</a>* m = <a class="code" href="classScore.html#a100">first</a>(); m; m = m-&gt;<a class="code" href="classMeasure.html#a64">next</a>()) {
00303             <span class="keywordflow">if</span> ((m-&gt;<a class="code" href="classElement.html#a74">tick</a>()+m-&gt;<a class="code" href="classMeasure.html#a26">tickLen</a>()) &lt; tick)
00304                   <span class="keywordflow">continue</span>;
00305             <span class="keywordflow">for</span> (<a class="code" href="classSegment.html">Segment</a>* segment = m-&gt;<a class="code" href="classMeasure.html#a28">first</a>(); segment; segment = segment-&gt;<a class="code" href="classSegment.html#a4">next</a>()) {
00306                   <span class="keywordflow">if</span> (segment-&gt;<a class="code" href="classSegment.html#a18">type</a>() != Segment::SegClef)
00307                         <span class="keywordflow">continue</span>;
00308                   <span class="keywordtype">int</span> startTrack = staffIdx * <a class="code" href="globals_8h.html#a3">VOICES</a>;
00309                   <span class="keywordtype">int</span> endTrack   = startTrack + <a class="code" href="globals_8h.html#a3">VOICES</a>;
00310                   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> track = startTrack; track &lt; endTrack; ++track) {
00311                         <a class="code" href="classElement.html">Element</a>* e = segment-&gt;<a class="code" href="classSegment.html#a8">element</a>(track);
00312                         <span class="keywordflow">if</span> (e == 0 || e-&gt;<a class="code" href="classElement.html#a40">type</a>() != <a class="code" href="element_8h.html#a65a22">CLEF</a>)
00313                               <span class="keywordflow">continue</span>;
00314                         <span class="keywordtype">int</span> etick = e-&gt;<a class="code" href="classElement.html#a74">tick</a>();
00315                         <span class="keywordflow">if</span> (etick &lt; tick)
00316                               <span class="keywordflow">continue</span>;
00317                         <a class="code" href="clef_8h.html#a1">iClefEvent</a> ic = ct-&gt;find(etick);
00318                         <span class="keywordflow">if</span> (ic == ct-&gt;end() || (ic-&gt;first == tick)) {
00319                               <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::RemoveObject, e);
00320                               segment-&gt;<a class="code" href="classSegment.html#a10">setElement</a>(track, 0);
00321                               <span class="comment">// printf("remove Clef at %d\n", tick);</span>
00322                               }
00323                         <span class="keywordtype">int</span> cidx = ((<a class="code" href="classClef.html">Clef</a>*)e)-&gt;idx();
00324                         <span class="keywordflow">if</span> (etick &gt; tick &amp;&amp;  idx == cidx) {
00325                               <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::RemoveObject, e);
00326                               segment-&gt;<a class="code" href="classSegment.html#a10">setElement</a>(track, 0);
00327                               <span class="comment">// printf("remove Clef at %d\n", tick);</span>
00328                               <span class="keywordflow">break</span>;
00329                               }
00330                         }
00331                   }
00332             }
00333       <a class="code" href="classMeasure.html">Measure</a>* measure = <a class="code" href="undo_8cpp.html#a3">tick2measure</a>(tick);
00334       <span class="keywordflow">if</span> (!measure) {
00335             printf(<span class="stringliteral">"measure for tick %d not found!\n"</span>, tick);
00336             <span class="keywordflow">return</span> 0;
00337             }
00338       clef-&gt;<a class="code" href="classElement.html#a11">setParent</a>(measure);
00339       <a class="code" href="classScore.html#a60">addObject</a>(clef);
00340       <a class="code" href="classScore.html#a49">layout</a>();
00341       <span class="keywordflow">return</span> clef;
00342       }
00343 
00344 <span class="comment">//---------------------------------------------------------</span>
00345 <span class="comment">//   addBar</span>
00346 <span class="comment">//---------------------------------------------------------</span>
00347 
<a name="l00348"></a><a class="code" href="classScore.html#a69">00348</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#a69">Score::addBar</a>(<a class="code" href="classBar.html">Bar</a>* bar, <a class="code" href="classMeasure.html">Measure</a>* measure)
00349       {
00350       <span class="keywordflow">if</span> (measure == 0) {
00351             printf(<span class="stringliteral">"can only put bar in measure\n"</span>);
00352             <span class="keyword">delete</span> bar;
00353             <span class="keywordflow">return</span>;
00354             }
00355       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> staffIdx = 0; staffIdx &lt; <a class="code" href="classScore.html#a6">nstaves</a>(); ++staffIdx) {
00356             <a class="code" href="classBar.html">Bar</a>* obar = measure-&gt;<a class="code" href="classMeasure.html#a44">bar</a>(staffIdx);
00357             <span class="keywordflow">if</span> (obar) {
00358                   <a class="code" href="classStaff.html">Staff</a>* staffp = <a class="code" href="classScore.html#a7">staff</a>(staffIdx);
00359                   <a class="code" href="classBar.html">Bar</a>* nbar = <span class="keyword">new</span> <a class="code" href="classBar.html">Bar</a>(*obar);
00360                   nbar-&gt;<a class="code" href="classElement.html#a61">setStaff</a>(staffp);
00361                   nbar-&gt;<a class="code" href="classBar.html#a2">setBarType</a>(bar-&gt;<a class="code" href="classBar.html#a3">barType</a>());
00362                   <a class="code" href="classScore.html#a61">removeObject</a>(obar);
00363                   <a class="code" href="classScore.html#a60">addObject</a>(nbar);
00364                   <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::RemoveObject, obar);
00365                   <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::AddObject, nbar);
00366                   }
00367             }
00368       <a class="code" href="classScore.html#a49">layout</a>();
00369       <span class="keyword">delete</span> bar;
00370       }
00371 
00372 <span class="comment">//---------------------------------------------------------</span>
00373 <span class="comment">//   addTimeSig</span>
00374 <span class="comment">//---------------------------------------------------------</span>
00375 
<a name="l00376"></a><a class="code" href="classScore.html#a63">00376</a> <a class="code" href="classElement.html">Element</a>* <a class="code" href="classScore.html#a63">Score::addTimeSig</a>(<a class="code" href="classTimeSig.html">TimeSig</a>* sig, <span class="keyword">const</span> QPointF&amp; pos)
00377       {
00378       <span class="keywordtype">int</span> tick, pitch;
00379       <a class="code" href="classStaff.html">Staff</a>* staffp = 0;
00380       <a class="code" href="classElement.html">Element</a>* <a class="code" href="classScore.html#a106">dragObject</a> = <a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#a6">element</a>();
00381 
00382       <span class="keywordflow">if</span> (dragObject &amp;&amp; dragObject-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a24">TIMESIG</a>) {
00383             }
00384       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="classScore.html#a21">pos2measure</a>(pos, &amp;tick, &amp;staffp, &amp;pitch, 0, 0)) {
00385             printf(<span class="stringliteral">"TimeSig: no tick position found\n"</span>);
00386             <span class="keywordflow">return</span> 0;
00387             }
00388 
00389       <span class="keywordtype">int</span> z, n;
00390       sig-&gt;<a class="code" href="classTimeSig.html#a8">zn</a>(z, n);
00391       <span class="keywordtype">int</span> oz, on;
00392       <a class="code" href="classScore.html#o9">sigmap</a>-&gt;<a class="code" href="classSigList.html#a6">timesig</a>(tick, oz, on);
00393       <span class="keywordflow">if</span> (oz == z &amp;&amp; on == n) {
00394             <span class="comment">// no change</span>
00395             <span class="keyword">delete</span> sig;
00396             <span class="keywordflow">return</span> 0;
00397             }
00398       <a class="code" href="classScore.html#o9">sigmap</a>-&gt;<a class="code" href="classSigList.html#a1">add</a>(tick, z, n);
00399 
00400 <span class="comment">//      printf("tick %d staff %d  z %d n %d,  idx %d\n",</span>
00401 <span class="comment">//         tick, staff, z, n, sig-&gt;idx());</span>
00402 
00403       <span class="comment">//---------------------------------------------</span>
00404       <span class="comment">// remove unnessesary timesig symbols</span>
00405       <span class="comment">//---------------------------------------------</span>
00406 
00407       <span class="keywordflow">for</span> (<a class="code" href="classMeasure.html">Measure</a>* m = <a class="code" href="classScore.html#a100">first</a>(); m; m = m-&gt;<a class="code" href="classMeasure.html#a64">next</a>()) {
00408 again:
00409             <span class="keywordflow">for</span> (<a class="code" href="classSegment.html">Segment</a>* segment = m-&gt;<a class="code" href="classMeasure.html#a28">first</a>(); segment; segment = segment-&gt;<a class="code" href="classSegment.html#a4">next</a>()) {
00410                   <span class="keywordflow">if</span> (segment-&gt;<a class="code" href="classSegment.html#a18">type</a>() == Segment::SegTimeSig) {
00411                         <span class="keywordtype">int</span> etick = segment-&gt;<a class="code" href="classElement.html#a74">tick</a>();
00412                         <span class="keywordflow">if</span> (etick &gt;= tick) {
00413                               <a class="code" href="sig_8h.html#a0">iSigEvent</a> ic = <a class="code" href="classScore.html#o9">sigmap</a>-&gt;find(etick);
00414                               <span class="keywordflow">if</span> (ic == <a class="code" href="classScore.html#o9">sigmap</a>-&gt;end() || (ic-&gt;first == tick &amp;&amp; ic-&gt;second.z != z &amp;&amp; ic-&gt;second.n == n)) {
00415 printf(<span class="stringliteral">"  remove timesig\n"</span>);
00416                                     <span class="comment">// el-&gt;remove(e);</span>
00417                                     m-&gt;<a class="code" href="classMeasure.html#a9">remove</a>(segment);
00418                                     <span class="keywordflow">goto</span> again;
00419                                     }
00420                               <span class="keywordflow">else</span> <span class="keywordflow">if</span> (etick &gt; tick)
00421                                     <span class="keywordflow">break</span>;
00422                               }
00423                         }
00424                   }
00425             }
00426 
00427       <span class="comment">//---------------------------------------------</span>
00428       <span class="comment">// modify measures</span>
00429       <span class="comment">//---------------------------------------------</span>
00430 
00431       <span class="keywordtype">int</span> mtick = 0;
00432       <span class="keywordtype">int</span> <a class="code" href="classScore.html#a5">staves</a> = <a class="code" href="classScore.html#a6">nstaves</a>();
00433       <span class="keywordflow">for</span> (<a class="code" href="classMeasure.html">Measure</a>* m = <a class="code" href="classScore.html#a100">first</a>(); m; m = m-&gt;<a class="code" href="classMeasure.html#a64">next</a>()) {
00434             <span class="keywordtype">int</span> tickdiff = mtick - m-&gt;<a class="code" href="classElement.html#a74">tick</a>();
00435             <span class="keywordflow">if</span> (tickdiff) {
00436                   m-&gt;<a class="code" href="classMeasure.html#a60">moveTicks</a>(tickdiff);
00437                   }
00438             <span class="keywordtype">int</span> mtickLen = <a class="code" href="classScore.html#o9">sigmap</a>-&gt;<a class="code" href="classSigList.html#a9">ticksMeasure</a>(mtick);
00439             <span class="keywordtype">int</span> lendiff  = mtickLen - m-&gt;<a class="code" href="classMeasure.html#a26">tickLen</a>();
00440             m-&gt;<a class="code" href="classElement.html#a77">setTickLen</a>(mtickLen);
00441 
00442             mtick += mtickLen;
00443             <span class="keywordflow">if</span> (lendiff == 0)
00444                   <span class="keywordflow">continue</span>;
00445 
00446             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> staffIdx = 0; staffIdx &lt; staves; ++staffIdx) {
00447                   <a class="code" href="classStaff.html">Staff</a>* staffp = <a class="code" href="classScore.html#a7">staff</a>(staffIdx);
00448                   <span class="keywordtype">int</span> rests  = 0;
00449                   <a class="code" href="classRest.html">Rest</a>* rest = 0;
00450                   <span class="keywordflow">for</span> (<a class="code" href="classSegment.html">Segment</a>* segment = m-&gt;<a class="code" href="classMeasure.html#a28">first</a>(); segment; segment = segment-&gt;<a class="code" href="classSegment.html#a4">next</a>()) {
00451                         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> rstaff = 0; rstaff &lt; <a class="code" href="globals_8h.html#a3">VOICES</a>; ++rstaff) {
00452                               <a class="code" href="classElement.html">Element</a>* e = segment-&gt;<a class="code" href="classSegment.html#a8">element</a>(staffIdx * <a class="code" href="globals_8h.html#a3">VOICES</a> + rstaff);
00453                               <span class="keywordflow">if</span> (e &amp;&amp; e-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a26">REST</a>) {
00454                                     ++rests;
00455                                     rest = (<a class="code" href="classRest.html">Rest</a>*)e;
00456                                     }
00457                               }
00458                         }
00459                   <span class="keywordflow">if</span> (rests == 1) {
00460                         rest-&gt;<a class="code" href="classRest.html#a4">setTickLen</a>(rest-&gt;<a class="code" href="classElement.html#a76">tickLen</a>() + lendiff);
00461                         }
00462                   <span class="keywordflow">else</span> {
00463                         <span class="keywordflow">if</span> (lendiff &lt; 0) {
00464                               printf(<span class="stringliteral">"shrinking of measure not supported yet\n"</span>);
00465                               <span class="keywordflow">continue</span>;
00466                               }
00467                         <span class="keywordflow">else</span> {
00468                               <span class="comment">// add rest to measure</span>
00469                               <span class="keywordtype">int</span> rtick = mtick - lendiff;
00470                               rest = <span class="keyword">new</span> <a class="code" href="classRest.html">Rest</a>(<span class="keyword">this</span>, rtick, lendiff);
00471                               rest-&gt;<a class="code" href="classElement.html#a61">setStaff</a>(staffp);
00472                               m-&gt;<a class="code" href="classMeasure.html#a8">add</a>(rest);
00473                               }
00474                         }
00475                   }
00476             }
00477 printf(<span class="stringliteral">"  insert tick\n"</span>);
00478 
00479       <span class="keywordflow">if</span> (tick != 0) {
00480             <a class="code" href="classMeasure.html">Measure</a>* measure = <a class="code" href="undo_8cpp.html#a3">tick2measure</a>(tick);
00481             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> staffIdx = 0; staffIdx &lt; staves; ++staffIdx) {
00482                   <a class="code" href="classTimeSig.html">TimeSig</a>* nsig = <span class="keyword">new</span> <a class="code" href="classTimeSig.html">TimeSig</a>(<span class="keyword">this</span>, sig-&gt;<a class="code" href="classTimeSig.html#a5">idx</a>());
00483                   nsig-&gt;<a class="code" href="classElement.html#a61">setStaff</a>(<a class="code" href="classScore.html#a7">staff</a>(staffIdx));
00484                   nsig-&gt;<a class="code" href="classElement.html#a75">setTick</a>(tick);
00485                   measure-&gt;<a class="code" href="classMeasure.html#a8">add</a>(nsig);
00486                   }
00487             }
00488       <a class="code" href="classScore.html#a49">layout</a>();
00489       <span class="keyword">delete</span> sig;
00490       <span class="keywordflow">return</span> 0;
00491       }
00492 
00493 <span class="comment">//---------------------------------------------------------</span>
00494 <span class="comment">//   putNote</span>
00495 <span class="comment">//    mouse click in state NOTE_ENTRY</span>
00496 <span class="comment">//---------------------------------------------------------</span>
00497 
<a name="l00498"></a><a class="code" href="classScore.html#a80">00498</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#a80">Score::putNote</a>(<span class="keyword">const</span> QPointF&amp; pos, <span class="keywordtype">bool</span> addToChord)
00499       {
00500       <span class="keywordtype">int</span> tick, pitch;
00501       <a class="code" href="classStaff.html">Staff</a>* <a class="code" href="classScore.html#a7">staff</a> = 0;
00502       <a class="code" href="classMeasure.html">Measure</a>* m = <a class="code" href="classScore.html#a21">pos2measure</a>(pos, &amp;tick, &amp;staff, &amp;pitch, 0, 0);
00503 
00504       <span class="keywordflow">if</span> (m == 0 || pitch &lt; 0 || pitch &gt; 127) {
00505             printf(<span class="stringliteral">"cannot put note/rest at this position, bad pitch %d!\n"</span>, pitch);
00506             <span class="keywordflow">return</span>;
00507             }
00508 
00509       <span class="keywordtype">int</span> len   = <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o2">tickLen</a>;
00510       <span class="keywordtype">int</span> voice = <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o5">voice</a>;
00511 
00512       <span class="keywordflow">if</span> (addToChord) {
00513             <span class="comment">// add note to chord</span>
00514             <a class="code" href="classChordRest.html">ChordRest</a>* el = m-&gt;<a class="code" href="classMeasure.html#a50">findChordRest</a>(tick, staff, voice, <span class="keyword">false</span>);
00515             <span class="keywordflow">if</span> (!el) {
00516                   printf(<span class="stringliteral">"putNote: chord/rest not found\n"</span>);
00517                   <span class="keywordflow">return</span>;
00518                   }
00519             <span class="keywordflow">if</span> (el-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a25">CHORD</a>) {
00520                   <a class="code" href="classNote.html">Note</a>* note = <a class="code" href="classScore.html#a68">addNote</a>((<a class="code" href="classChord.html">Chord</a>*)el, pitch);
00521                   <a class="code" href="classScore.html#a47">select</a>(note, 0, 0);
00522                   }
00523             <span class="keywordflow">else</span> {
00524                   <a class="code" href="classScore.html#a41">setNote</a>(tick, staff, voice, pitch, len);
00525                   }
00526             }
00527       <span class="keywordflow">else</span> {
00528             <span class="comment">// replace chord</span>
00529             <a class="code" href="classScore.html#a41">setNote</a>(tick, staff, voice, pitch, len);
00530             }
00531       <a class="code" href="input_8h.html#a0">cis</a>-&gt;<a class="code" href="structInputState.html#o1">staff</a>     = <a class="code" href="classScore.html#r17">_staves</a>-&gt;<a class="code" href="classStaffList.html#a1">idx</a>(staff);
00532       <a class="code" href="input_8h.html#a0">cis</a>-&gt;<a class="code" href="structInputState.html#o2">voice</a>     = voice;
00533       <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o6">pitch</a> = pitch;
00534       <a class="code" href="input_8h.html#a0">cis</a>-&gt;<a class="code" href="structInputState.html#o0">pos</a>       = tick + len;
00535       <a class="code" href="classScore.html#d8">moveCursor</a>();
00536       }
00537 
00538 <span class="comment">//---------------------------------------------------------</span>
00539 <span class="comment">//   modifyElement</span>
00540 <span class="comment">//---------------------------------------------------------</span>
00541 
<a name="l00542"></a><a class="code" href="classCanvas.html#a9">00542</a> <span class="keywordtype">void</span> <a class="code" href="classCanvas.html#a9">Canvas::modifyElement</a>(<a class="code" href="classElement.html">Element</a>* el)
00543       {
00544       <span class="keywordflow">if</span> (el == 0) {
00545             printf(<span class="stringliteral">"modifyElement: el==0\n"</span>);
00546             <span class="keyword">delete</span> el;
00547             <span class="keywordflow">return</span>;
00548             }
00549       <a class="code" href="classScore.html">Score</a>* cs = el-&gt;<a class="code" href="classElement.html#a4">score</a>();
00550       <span class="keywordflow">if</span> (cs-&gt;<a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#o0">state</a> != <a class="code" href="select_8h.html#a5a1">SEL_SINGLE</a>) {
00551             printf(<span class="stringliteral">"modifyElement: cs-&gt;sel-&gt;state != SEL_SINGLE\n"</span>);
00552             <span class="keyword">delete</span> el;
00553             <span class="keywordflow">return</span>;
00554             }
00555       <a class="code" href="classElement.html">Element</a>* e = cs-&gt;<a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#a6">element</a>();
00556       <a class="code" href="classChord.html">Chord</a>* chord;
00557       <span class="keywordflow">if</span> (e-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a25">CHORD</a>)
00558             chord = (<a class="code" href="classChord.html">Chord</a>*) e;
00559       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (e-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a12">NOTE</a>)
00560             chord = ((<a class="code" href="classNote.html">Note</a>*)e)-&gt;chord();
00561       <span class="keywordflow">else</span> {
00562             printf(<span class="stringliteral">"modifyElement: no note/Chord selected:\n  "</span>);
00563             e-&gt;<a class="code" href="classElement.html#a68">dump</a>();
00564             <span class="keyword">delete</span> el;
00565             <span class="keywordflow">return</span>;
00566             }
00567       <span class="keywordflow">switch</span> (el-&gt;<a class="code" href="classElement.html#a40">type</a>()) {
00568             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a30">ATTRIBUTE</a>:
00569                   chord-&gt;<a class="code" href="classChord.html#a28">add</a>((<a class="code" href="classNoteAttribute.html">NoteAttribute</a>*)el);
00570                   <span class="keywordflow">break</span>;
00571             <span class="keywordflow">default</span>:
00572                   printf(<span class="stringliteral">"modifyElement: %s not ATTRIBUTE\n"</span>, el-&gt;<a class="code" href="classNoteAttribute.html#a10">name</a>());
00573                   <span class="keyword">delete</span> el;
00574                   <span class="keywordflow">return</span>;
00575             }
00576       cs-&gt;<a class="code" href="classScore.html#a49">layout</a>();
00577       }
00578 
00579 <span class="comment">//---------------------------------------------------------</span>
00580 <span class="comment">//   addSlur</span>
00581 <span class="comment">//    'S' typed on keyboard</span>
00582 <span class="comment">//---------------------------------------------------------</span>
00583 
<a name="l00584"></a><a class="code" href="classScore.html#a70">00584</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#a70">Score::cmdAddSlur</a>()
00585       {
00586       <a class="code" href="classElement.html">Element</a>* e = <a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#a6">element</a>();
00587       <span class="keywordflow">if</span> (!e || e-&gt;<a class="code" href="classElement.html#a40">type</a>() != <a class="code" href="element_8h.html#a65a12">NOTE</a>) {
00588             printf(<span class="stringliteral">"no note selected\n"</span>);
00589             <span class="keywordflow">return</span>;
00590             }
00591 
00592       <a class="code" href="classNote.html">Note</a>* note    = (<a class="code" href="classNote.html">Note</a>*)(e);
00593       <a class="code" href="classChord.html">Chord</a>* chord  = note-&gt;<a class="code" href="classNote.html#a37">chord</a>();
00594       <a class="code" href="classStaff.html">Staff</a>* <a class="code" href="classScore.html#a7">staff</a>  = chord-&gt;<a class="code" href="classElement.html#a59">staff</a>();
00595       <a class="code" href="classChordRest.html">ChordRest</a>* el = <a class="code" href="classScore.html#d0">nextChordRest</a>(chord);
00596       <span class="keywordflow">if</span> (el == 0) {
00597             printf(<span class="stringliteral">"at end\n"</span>);
00598             <span class="keywordflow">return</span>;
00599             }
00600       <span class="keywordtype">int</span> tick2 = el-&gt;<a class="code" href="classElement.html#a74">tick</a>();
00601 
00602       <a class="code" href="classSlur.html">Slur</a>* slur = <span class="keyword">new</span> <a class="code" href="classSlur.html">Slur</a>(<span class="keyword">this</span>);
00603       slur-&gt;<a class="code" href="classElement.html#a61">setStaff</a>(staff);
00604       slur-&gt;<a class="code" href="classSlur.html#a10">setStart</a>(chord-&gt;<a class="code" href="classElement.html#a74">tick</a>(), staff, chord-&gt;<a class="code" href="classElement.html#a62">voice</a>());
00605       slur-&gt;<a class="code" href="classSlur.html#a11">setEnd</a>(tick2, staff, chord-&gt;<a class="code" href="classElement.html#a62">voice</a>());
00606       slur-&gt;<a class="code" href="classElement.html#a11">setParent</a>(chord-&gt;<a class="code" href="classChordRest.html#a11">measure</a>());
00607       <a class="code" href="classScore.html#a60">addObject</a>(slur);
00608       <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::AddObject, slur);
00609       <a class="code" href="classScore.html#a49">layout</a>();
00610       <a class="code" href="classScore.html#a47">select</a>(slur, 0, 0);
00611       <a class="code" href="classScore.html#r1">refresh</a> |= slur-&gt;<a class="code" href="classElement.html#a34">abbox</a>();
00612       }
00613 
00614 <span class="comment">//---------------------------------------------------------</span>
00615 <span class="comment">//   cmdAddHairpin</span>
00616 <span class="comment">//    'H' typed on keyboard</span>
00617 <span class="comment">//---------------------------------------------------------</span>
00618 
<a name="l00619"></a><a class="code" href="classScore.html#a71">00619</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#a71">Score::cmdAddHairpin</a>(<span class="keywordtype">bool</span> decrescendo)
00620       {
00621       <a class="code" href="classElement.html">Element</a>* el = <a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#a6">element</a>();
00622       <span class="keywordflow">if</span> (!el) {
00623             printf(<span class="stringliteral">"selState != single\n"</span>);
00624             <span class="keywordflow">return</span>;
00625             }
00626 
00627       <span class="keywordtype">int</span> tick1 = el-&gt;<a class="code" href="classElement.html#a74">tick</a>();
00628       <span class="keywordtype">int</span> tick2 = tick1 + 4 * <a class="code" href="mtime_8h.html#a0">division</a>;
00629       <a class="code" href="classHairpin.html">Hairpin</a>* gabel = <span class="keyword">new</span> <a class="code" href="classHairpin.html">Hairpin</a>(<span class="keyword">this</span>);
00630       gabel-&gt;<a class="code" href="classHairpin.html#a5">setTick1</a>(tick1);
00631       gabel-&gt;<a class="code" href="classHairpin.html#a6">setTick2</a>(tick2);
00632       gabel-&gt;<a class="code" href="classHairpin.html#a4">setFlip</a>(decrescendo);
00633 
00634       <a class="code" href="classScore.html#a66">addHairpin</a>(gabel, el-&gt;<a class="code" href="classElement.html#a20">pos</a>());
00635       <a class="code" href="classScore.html#a47">select</a>(gabel, 0, 0);
00636       <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::AddObject, gabel);
00637       <a class="code" href="classScore.html#a49">layout</a>();
00638       }
00639 
00640 <span class="comment">//---------------------------------------------------------</span>
00641 <span class="comment">//   cmdSetBeamMode</span>
00642 <span class="comment">//---------------------------------------------------------</span>
00643 
<a name="l00644"></a><a class="code" href="classScore.html#d4">00644</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#d4">Score::cmdSetBeamMode</a>(<span class="keywordtype">int</span> mode)
00645       {
00646       <a class="code" href="classChordRest.html">ChordRest</a>* cr = <a class="code" href="classScore.html#a127">getSelectedChordRest</a>(<a class="code" href="classScore.html#a46">canvas</a>());
00647       <span class="keywordflow">if</span> (cr == 0)
00648             <span class="keywordflow">return</span>;
00649       cr-&gt;<a class="code" href="classChordRest.html#a5">setBeamMode</a>(<a class="code" href="note_8h.html#a36">BeamMode</a>(mode));
00650       <a class="code" href="classScore.html#a49">layout</a>();
00651       }
00652 
00653 <span class="comment">//---------------------------------------------------------</span>
00654 <span class="comment">//   cmdFlipStemDirection</span>
00655 <span class="comment">//---------------------------------------------------------</span>
00656 
<a name="l00657"></a><a class="code" href="classScore.html#d5">00657</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#d5">Score::cmdFlipStemDirection</a>()
00658       {
00659       <a class="code" href="classElement.html">Element</a>* el = <a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#a6">element</a>();
00660       <span class="keywordflow">if</span> (el &amp;&amp; el-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a12">NOTE</a>) {
00661             <span class="keywordtype">int</span> pitch = ((<a class="code" href="classNote.html">Note</a>*)el)-&gt;pitch();
00662             <a class="code" href="classChord.html">Chord</a>* chord = ((<a class="code" href="classNote.html">Note</a>*)el)-&gt;chord();
00663             <a class="code" href="classChord.html">Chord</a>* nChord = <span class="keyword">new</span> <a class="code" href="classChord.html">Chord</a>(*chord);
00664             nChord-&gt;<a class="code" href="classChord.html#a10">setStemDirection</a>(chord-&gt;<a class="code" href="classChordRest.html#a19">isUp</a>() ? <a class="code" href="globals_8h.html#a24a9">DOWN</a> : <a class="code" href="structUP.html">UP</a>);
00665             <a class="code" href="classScore.html#a61">removeObject</a>(chord);
00666             <a class="code" href="classScore.html#a60">addObject</a>(nChord);
00667             <a class="code" href="classNoteList.html">NoteList</a>* nl = nChord-&gt;<a class="code" href="classChord.html#a15">noteList</a>();
00668             <a class="code" href="classNote.html">Note</a>* sn = nl-&gt;<a class="code" href="classNoteList.html#a3">find</a>(pitch);
00669             <span class="keywordflow">if</span> (sn)
00670                   <a class="code" href="classScore.html#a47">select</a>(sn, 0, 0);
00671             nChord-&gt;<a class="code" href="classChordRest.html#a4">segment</a>()-&gt;<a class="code" href="classSegment.html#a14">measure</a>()-&gt;<a class="code" href="classMeasure.html#a59">layoutNoteHeads</a>(nChord-&gt;<a class="code" href="classElement.html#a60">staffIdx</a>());
00672             <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::RemoveObject, chord);
00673             <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::AddObject, nChord);
00674             }
00675       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (el &amp;&amp; el-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a11">SLUR_SEGMENT</a>) {
00676             <a class="code" href="classSlurTie.html">SlurTie</a>* slur = ((<a class="code" href="classSlurSegment.html">SlurSegment</a>*) el)-&gt;slurTie();
00677             slur-&gt;<a class="code" href="classSlurTie.html#a7">setSlurDirection</a>(slur-&gt;<a class="code" href="classSlurTie.html#a4">isUp</a>() ? <a class="code" href="globals_8h.html#a24a9">DOWN</a> : <a class="code" href="structUP.html">UP</a>);
00678             }
00679       <span class="keywordflow">else</span> {
00680             <a class="code" href="edit_8cpp.html#a2">selectNoteSlurMessage</a>(<a class="code" href="classScore.html#a46">canvas</a>());
00681             <span class="keywordflow">return</span>;
00682             }
00683       <a class="code" href="classScore.html#a49">layout</a>();
00684       }
00685 
00686 <span class="comment">//---------------------------------------------------------</span>
00687 <span class="comment">//   addDynamic</span>
00688 <span class="comment">//---------------------------------------------------------</span>
00689 
<a name="l00690"></a><a class="code" href="classScore.html#a65">00690</a> <a class="code" href="classElement.html">Element</a>* <a class="code" href="classScore.html#a65">Score::addDynamic</a>(<a class="code" href="classDynamic.html">Dynamic</a>* atr, <span class="keyword">const</span> QPointF&amp; pos)
00691       {
00692       <a class="code" href="classStaff.html">Staff</a>* <a class="code" href="classScore.html#a7">staff</a> = 0;
00693       <span class="keywordtype">int</span> pitch, tick;
00694       QPointF offset;
00695       <a class="code" href="classSegment.html">Segment</a>* segment;
00696       <a class="code" href="classMeasure.html">Measure</a>* measure = <a class="code" href="classScore.html#a21">pos2measure</a>(pos, &amp;tick, &amp;staff, &amp;pitch, &amp;segment, &amp;offset);
00697       <span class="keywordflow">if</span> (measure == 0) {
00698             printf(<span class="stringliteral">"addDynamic: cannot put object here\n"</span>);
00699             <span class="keyword">delete</span> atr;
00700             <span class="keywordflow">return</span> 0;
00701             }
00702       atr-&gt;<a class="code" href="classElement.html#a23">setpos</a>(segment-&gt;<a class="code" href="classSegment.html#a15">x</a>(), 0.0);
00703       atr-&gt;<a class="code" href="classElement.html#a29">setUserOff</a>(offset / <a class="code" href="spatium_8h.html#a0">_spatium</a>);
00704       atr-&gt;<a class="code" href="classElement.html#a75">setTick</a>(tick);
00705       atr-&gt;<a class="code" href="classElement.html#a61">setStaff</a>(staff);
00706       measure-&gt;<a class="code" href="classMeasure.html#a8">add</a>(atr);
00707 <span class="comment">// printf("Dyn staff %d tick %d offset %g %g\n", staff, tick, offset.x(), offset.y());</span>
00708       <a class="code" href="classScore.html#r3">updateAll</a> = <span class="keyword">true</span>;
00709       <span class="keywordflow">return</span> atr;
00710       }
00711 
00712 <span class="comment">//---------------------------------------------------------</span>
00713 <span class="comment">//   addHairpin</span>
00714 <span class="comment">//---------------------------------------------------------</span>
00715 
<a name="l00716"></a><a class="code" href="classScore.html#a66">00716</a> <a class="code" href="classElement.html">Element</a>* <a class="code" href="classScore.html#a66">Score::addHairpin</a>(<a class="code" href="classHairpin.html">Hairpin</a>* pin, <span class="keyword">const</span> QPointF&amp; pos)
00717       {
00718       <a class="code" href="classStaff.html">Staff</a>* <a class="code" href="classScore.html#a7">staff</a> = 0;
00719       <span class="keywordtype">int</span> pitch, tick1;
00720       QPointF offset;
00721       <a class="code" href="classSegment.html">Segment</a>* segment;
00722       <a class="code" href="classMeasure.html">Measure</a>* measure = <a class="code" href="classScore.html#a21">pos2measure</a>(pos, &amp;tick1, &amp;staff, &amp;pitch, &amp;segment, &amp;offset);
00723       <span class="keywordflow">if</span> (measure == 0) {
00724             printf(<span class="stringliteral">"addHairpin: cannot put object here\n"</span>);
00725             <span class="keyword">delete</span> pin;
00726             <span class="keywordflow">return</span> 0;
00727             }
00728 <span class="comment">//      pin-&gt;setpos(segment-&gt;x(), 0);</span>
00729 <span class="comment">//      pin-&gt;setUserOff(offset / _spatium);</span>
00730       pin-&gt;<a class="code" href="classElement.html#a61">setStaff</a>(staff);
00731       measure-&gt;<a class="code" href="classMeasure.html#a8">add</a>(pin);   <span class="comment">// system()-&gt;staff(staff)-&gt;elements.push_back(pin);</span>
00732       <span class="keywordflow">return</span> pin;
00733       }
00734 
00735 <span class="comment">//---------------------------------------------------------</span>
00736 <span class="comment">//   addSlur</span>
00737 <span class="comment">//---------------------------------------------------------</span>
00738 
<a name="l00739"></a><a class="code" href="classScore.html#a67">00739</a> <a class="code" href="classElement.html">Element</a>* <a class="code" href="classScore.html#a67">Score::addSlur</a>(<a class="code" href="classSlur.html">Slur</a>* <span class="comment">/*slur*/</span>, <span class="keyword">const</span> QPointF&amp; <span class="comment">/*pos*/</span>)
00740       {
00741       printf(<span class="stringliteral">"addSlur 2\n"</span>);
00742 <span class="preprocessor">#if 0</span>
00743 <span class="preprocessor"></span>      <span class="keywordtype">int</span> <a class="code" href="classScore.html#a7">staff</a>=-1, pitch, tick1;
00744       QPointF offset;
00745       <a class="code" href="classSegment.html">Segment</a>* segment;
00746       <a class="code" href="classMeasure.html">Measure</a>* measure = cs-&gt;pos2measure(pos, &amp;tick1, &amp;staff, &amp;pitch, &amp;segment, &amp;offset);
00747       <span class="keywordflow">if</span> (measure == 0) {
00748             printf(<span class="stringliteral">"addSLur: cannot put object here\n"</span>);
00749             <span class="keyword">delete</span> slur;
00750             <span class="keywordflow">return</span> 0;
00751             }
00752       slur-&gt;setTick1(tick1);
00753       slur-&gt;setTick2(tick2);
00754       slur-&gt;setStaffIdx(staff);
00755       measure-&gt;<a class="code" href="classMeasure.html#a8">add</a>(slur);
00756       <span class="keywordflow">return</span> slur;
00757 <span class="preprocessor">#endif</span>
00758 <span class="preprocessor"></span>      <span class="keywordflow">return</span> 0;
00759       }
00760 
00761 <span class="comment">//---------------------------------------------------------</span>
00762 <span class="comment">//   deleteItem</span>
00763 <span class="comment">//---------------------------------------------------------</span>
00764 
<a name="l00765"></a><a class="code" href="classScore.html#a73">00765</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#a73">Score::deleteItem</a>(<a class="code" href="classElement.html">Element</a>* el)
00766       {
00767       <span class="keywordflow">switch</span>(el-&gt;<a class="code" href="classElement.html#a40">type</a>()) {
00768             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a11">SLUR_SEGMENT</a>:
00769                   <a class="code" href="classScore.html#a73">deleteItem</a>(el-&gt;<a class="code" href="classElement.html#a10">parent</a>());
00770                   <span class="keywordflow">break</span>;
00771             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a7">SYMBOL</a>:
00772             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a15">COMPOUND</a>:
00773             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a8">TEXT</a>:
00774             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a31">DYNAMIC</a>:
00775             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a28">SLUR</a>:
00776             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a10">GABEL</a>:
00777             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a35">LYRICS</a>:
00778             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a30">ATTRIBUTE</a>:
00779             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a38">FINGERING</a>:
00780                   el-&gt;<a class="code" href="classElement.html#a10">parent</a>()-&gt;<a class="code" href="classElement.html#a65">remove</a>(el);
00781                   <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::RemoveObject, el);
00782                   <a class="code" href="classScore.html#r3">updateAll</a> = <span class="keyword">true</span>;
00783                   <span class="keywordflow">break</span>;
00784 
00785             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a22">CLEF</a>:
00786                   <a class="code" href="classScore.html#a72">removeClef</a>((<a class="code" href="classClef.html">Clef</a>*) el);
00787                   <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::RemoveObject, el);
00788                   <span class="keywordflow">break</span>;
00789 
00790             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a12">NOTE</a>:
00791                   {
00792                   <a class="code" href="classChord.html">Chord</a>* chord = (<a class="code" href="classChord.html">Chord</a>*)(el-&gt;<a class="code" href="classElement.html#a10">parent</a>());
00793                   <span class="keywordtype">int</span> notes = chord-&gt;<a class="code" href="classChord.html#a15">noteList</a>()-&gt;size();
00794                   <span class="keywordflow">if</span> (notes &gt; 1) {
00795                         chord-&gt;<a class="code" href="classChord.html#a29">remove</a>((<a class="code" href="classNote.html">Note</a>*) el);
00796                         <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::RemoveObject, el);
00797                         <span class="keywordflow">break</span>;
00798                         }
00799                   <span class="comment">// else fall through</span>
00800                   el = chord;
00801                   }
00802 
00803             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a25">CHORD</a>:
00804                   {
00805                   <a class="code" href="classChord.html">Chord</a>* chord = (<a class="code" href="classChord.html">Chord</a>*) el;
00806                   <a class="code" href="classRest.html">Rest</a>* rest   = <span class="keyword">new</span> <a class="code" href="classRest.html">Rest</a>(<span class="keyword">this</span>, chord-&gt;<a class="code" href="classElement.html#a74">tick</a>(), chord-&gt;<a class="code" href="classElement.html#a76">tickLen</a>());
00807                   rest-&gt;<a class="code" href="classElement.html#a61">setStaff</a>(el-&gt;<a class="code" href="classElement.html#a59">staff</a>());
00808                   <a class="code" href="classScore.html#a61">removeObject</a>(chord);
00809                   <a class="code" href="classScore.html#a60">addObject</a>(rest);
00810                   <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::RemoveObject, chord);
00811                   <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::AddObject, rest);
00812                   }
00813                   <span class="keywordflow">break</span>;
00814 
00815             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a29">MEASURE</a>:
00816                   {
00817                   <a class="code" href="classMeasure.html">Measure</a>* m = (<a class="code" href="classMeasure.html">Measure</a>*)el;
00818                   <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::RemoveMeasure, m);
00819                   <a class="code" href="classScore.html#a19">removeMeasure</a>(m-&gt;<a class="code" href="classElement.html#a74">tick</a>());
00820                   }
00821                   <span class="keywordflow">break</span>;
00822 
00823             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a18">ACCIDENTAL</a>:
00824                   <a class="code" href="classScore.html#d12">addAccidental</a>((<a class="code" href="classNote.html">Note</a>*)(el-&gt;<a class="code" href="classElement.html#a10">parent</a>()), 0);
00825                   <span class="keywordflow">break</span>;
00826 
00827             <span class="keywordflow">default</span>:
00828                   printf(<span class="stringliteral">"delete %s: not implemented\n"</span>, el-&gt;<a class="code" href="classElement.html#a69">name</a>());
00829             }
00830       }
00831 
00832 
00833 <span class="comment">//---------------------------------------------------------</span>
00834 <span class="comment">//   cmdDeleteItem</span>
00835 <span class="comment">//    called from object popup</span>
00836 <span class="comment">//---------------------------------------------------------</span>
00837 
<a name="l00838"></a><a class="code" href="classScore.html#a74">00838</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#a74">Score::cmdDeleteItem</a>(<a class="code" href="classElement.html">Element</a>* el)
00839       {
00840       <a class="code" href="classScore.html#a73">deleteItem</a>(el);
00841       <a class="code" href="classScore.html#a47">select</a>(0, 0, 0);
00842       <a class="code" href="classScore.html#a49">layout</a>();
00843       }
00844 
00845 <span class="comment">//---------------------------------------------------------</span>
00846 <span class="comment">//   cmdDeleteSelection</span>
00847 <span class="comment">//---------------------------------------------------------</span>
00848 
<a name="l00849"></a><a class="code" href="classScore.html#a75">00849</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#a75">Score::cmdDeleteSelection</a>()
00850       {
00851       <span class="keywordflow">if</span> (<a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#o0">state</a> == <a class="code" href="select_8h.html#a5a4">SEL_SYSTEM</a>) {
00852             <span class="keywordtype">int</span> bar, beat, tck;
00853             <a class="code" href="classScore.html#o9">sigmap</a>-&gt;<a class="code" href="classSigList.html#a7">tickValues</a>(<a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#o1">tickStart</a>, &amp;bar, &amp;beat, &amp;tck);
00854             <a class="code" href="classMeasure.html">Measure</a>* is = <a class="code" href="classScore.html#a100">first</a>();
00855             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; bar &amp;&amp; is; ++i)
00856                   is = is-&gt;next();
00857 
00858             <a class="code" href="classScore.html#o9">sigmap</a>-&gt;<a class="code" href="classSigList.html#a7">tickValues</a>(<a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#o2">tickEnd</a>, &amp;bar, &amp;beat, &amp;tck);
00859             <a class="code" href="classMeasure.html">Measure</a>* ie = <a class="code" href="classScore.html#a100">first</a>();
00860             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; bar &amp;&amp; is; ++i)
00861                   ie = ie-&gt;<a class="code" href="classMeasure.html#a64">next</a>();
00862             <span class="keywordflow">do</span> {
00863                   --ie;
00864                   <a class="code" href="classScore.html#a73">deleteItem</a>(ie);
00865                   } <span class="keywordflow">while</span> (ie != is);
00866             }
00867       <span class="keywordflow">else</span> {
00868             <span class="keywordflow">for</span> (<a class="code" href="element_8h.html#a1">iElement</a> i = <a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#a0">elements</a>()-&gt;<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); i != <a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#a0">elements</a>()-&gt;<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++i)
00869                   <a class="code" href="classScore.html#a73">deleteItem</a>(*i);
00870             }
00871       <a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#a5">clear</a>();
00872       <a class="code" href="classScore.html#a49">layout</a>();
00873       }
00874 
00875 <span class="comment">//---------------------------------------------------------</span>
00876 <span class="comment">//   cmdAddElement</span>
00877 <span class="comment">//    add element from palette</span>
00878 <span class="comment">//    paste operation</span>
00879 <span class="comment">//---------------------------------------------------------</span>
00880 
<a name="l00881"></a><a class="code" href="classScore.html#a76">00881</a> <a class="code" href="classElement.html">Element</a>* <a class="code" href="classScore.html#a76">Score::cmdAddElement</a>(<a class="code" href="classElement.html">Element</a>* obj, <span class="keyword">const</span> QPointF&amp; pos)
00882       {
00883       <a class="code" href="classStaff.html">Staff</a>* <a class="code" href="classScore.html#a7">staff</a> = 0;
00884       <span class="keywordtype">int</span> tick;
00885       <a class="code" href="classMeasure.html">Measure</a>* measure = <a class="code" href="classScore.html#a21">pos2measure</a>(pos, &amp;tick, &amp;staff, 0, 0, 0);
00886 
00887       <span class="keywordtype">bool</span> tickFound = measure != 0;
00888       <a class="code" href="classElement.html">Element</a>* el = <a class="code" href="classScore.html#a132">findSelectableElement</a>(pos);
00889 
00890       <a class="code" href="classElement.html">Element</a>* element = 0;
00891       <span class="keywordflow">switch</span>(obj-&gt;<a class="code" href="classElement.html#a40">type</a>()) {
00892             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a7">SYMBOL</a>:
00893             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a15">COMPOUND</a>:
00894             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a8">TEXT</a>:
00895                   {
00896                   <span class="keywordflow">if</span> (measure == 0) {
00897                         printf(<span class="stringliteral">"cmdAddElement(): measure not found\n"</span>);
00898                         <span class="keywordflow">break</span>;
00899                         }
00900                   <a class="code" href="page_8h.html#a0">iPage</a> ip;
00901                   <span class="keywordflow">for</span> (ip = <a class="code" href="classScore.html#o12">pages</a>-&gt;<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); ip != <a class="code" href="classScore.html#o12">pages</a>-&gt;<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++ip) {
00902                         <span class="keywordflow">if</span> ((*ip)-&gt;contains(pos)) {
00903                               obj-&gt;<a class="code" href="classElement.html#a23">setpos</a>(pos - (*ip)-&gt;apos());
00904                               measure-&gt;<a class="code" href="classMeasure.html#a8">add</a>(obj);
00905                               <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::AddObject, obj);
00906                               (*ip)-&gt;add(obj);
00907                               element = obj;
00908                               <span class="keywordflow">break</span>;
00909                               }
00910                         }
00911                   <span class="keywordflow">if</span> (ip == <a class="code" href="classScore.html#o12">pages</a>-&gt;<a class="code" href="classpstl_1_1plist.html#a4">end</a>())
00912                         printf(<span class="stringliteral">"cmdAddElement(): page not found\n"</span>);
00913                   }
00914                   <span class="keywordflow">break</span>;
00915             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a22">CLEF</a>:
00916                   {
00917                   <span class="keywordflow">if</span> (!tickFound) {
00918                         printf(<span class="stringliteral">"cannot put clef at this position\n"</span>);
00919                         <span class="keyword">delete</span> obj;
00920                         <span class="keywordflow">break</span>;
00921                         }
00922                   <a class="code" href="classClef.html">Clef</a>* clef = (<a class="code" href="classClef.html">Clef</a>*)obj;
00923                   clef-&gt;<a class="code" href="classElement.html#a75">setTick</a>(tick);
00924                   clef-&gt;<a class="code" href="classElement.html#a61">setStaff</a>(staff);
00925                   element = <a class="code" href="classScore.html#a62">addClef</a>(clef);
00926                   <span class="keywordflow">if</span> (element)
00927                         <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::AddObject, element);
00928                   <span class="keywordflow">else</span>
00929                         <span class="keyword">delete</span> obj;
00930                   }
00931                   <span class="keywordflow">break</span>;
00932 
00933             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a24">TIMESIG</a>:
00934                   element = <a class="code" href="classScore.html#a63">addTimeSig</a>((<a class="code" href="classTimeSig.html">TimeSig</a>*) obj, pos);
00935                   <span class="keywordflow">break</span>;
00936             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a23">KEYSIG</a>:
00937                   element = <a class="code" href="classScore.html#a64">addKeySig</a>((<a class="code" href="classKeySig.html">KeySig</a>*) obj, pos);
00938                   <span class="keywordflow">break</span>;
00939             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a13">BAR</a>:
00940                   <a class="code" href="classScore.html#a69">addBar</a>((<a class="code" href="classBar.html">Bar</a>*)obj, measure);
00941                   <span class="keywordflow">break</span>;
00942             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a30">ATTRIBUTE</a>:
00943                   <span class="keywordflow">if</span> (el-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a12">NOTE</a>)
00944                         <a class="code" href="classScore.html#d11">addAttribute</a>((<a class="code" href="classNote.html">Note</a>*)el, (<a class="code" href="classNoteAttribute.html">NoteAttribute</a>*)obj);
00945                   <span class="keywordflow">break</span>;
00946             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a31">DYNAMIC</a>:
00947                   element = <a class="code" href="classScore.html#a65">addDynamic</a>((<a class="code" href="classDynamic.html">Dynamic</a>*) obj, pos);
00948                   <span class="keywordflow">break</span>;
00949             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a10">GABEL</a>:
00950                   element = <a class="code" href="classScore.html#a66">addHairpin</a>((<a class="code" href="classHairpin.html">Hairpin</a>*) obj, pos);
00951                   <span class="keywordflow">break</span>;
00952             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a28">SLUR</a>:
00953                   element = <a class="code" href="classScore.html#a67">addSlur</a>((<a class="code" href="classSlur.html">Slur</a>*) obj, pos);
00954                   <span class="keywordflow">break</span>;
00955             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a38">FINGERING</a>:
00956                   {
00957                   <span class="keywordflow">if</span> (el &amp;&amp; el-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a12">NOTE</a>) {
00958                         el-&gt;<a class="code" href="classNote.html#a29">add</a>(obj);
00959                         <a class="code" href="classScore.html#a47">select</a>(obj, 0, 0);
00960                         <a class="code" href="classScore.html#a49">layout</a>();
00961                         <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::AddObject, obj);
00962                         element = obj;
00963                         }
00964                   }
00965                   <span class="keywordflow">break</span>;
00966             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a18">ACCIDENTAL</a>:
00967                   <span class="keywordflow">if</span> (el &amp;&amp; el-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a12">NOTE</a>)
00968                         <a class="code" href="classScore.html#d12">addAccidental</a>((<a class="code" href="classNote.html">Note</a>*)el, ((<a class="code" href="classPrefix.html">Prefix</a>*)obj)-&gt;idx());
00969                   <span class="keyword">delete</span> obj;
00970                   <span class="keywordflow">break</span>;
00971             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a12">NOTE</a>:
00972             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a25">CHORD</a>:
00973             <span class="keywordflow">default</span>:
00974                   printf(<span class="stringliteral">"cannot add element type %s\n"</span>, obj-&gt;<a class="code" href="classElement.html#a69">name</a>());
00975                   <span class="keyword">delete</span> obj;
00976                   <span class="keywordflow">break</span>;
00977             }
00978       <span class="keywordflow">return</span> element;
00979       }
00980 
00981 <span class="comment">//---------------------------------------------------------</span>
00982 <span class="comment">//   lyricsTab</span>
00983 <span class="comment">//---------------------------------------------------------</span>
00984 
<a name="l00985"></a><a class="code" href="classScore.html#a87">00985</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#a87">Score::lyricsTab</a>()
00986       {
00987       <a class="code" href="classLyrics.html">Lyrics</a>* lyrics   = (<a class="code" href="classLyrics.html">Lyrics</a>*)<a class="code" href="classScore.html#o16">editObject</a>;
00988       <a class="code" href="classSegment.html">Segment</a>* segment = (<a class="code" href="classSegment.html">Segment</a>*)(lyrics-&gt;<a class="code" href="classElement.html#a10">parent</a>());
00989       <span class="keywordtype">int</span> <a class="code" href="classScore.html#a7">staff</a>        = lyrics-&gt;<a class="code" href="classElement.html#a60">staffIdx</a>();
00990       <span class="keywordtype">int</span> track        = staff * <a class="code" href="globals_8h.html#a3">VOICES</a>;
00991 
00992       <a class="code" href="classScore.html#a46">canvas</a>()-&gt;<a class="code" href="classCanvas.html#a13">setState</a>(Canvas::NORMAL);
00993       <a class="code" href="classScore.html#a84">endCmd</a>(<span class="keyword">true</span>);
00994 
00995       <span class="comment">// search next chord</span>
00996       <span class="keywordflow">while</span> ((segment = segment-&gt;<a class="code" href="classSegment.html#a6">next1</a>())) {
00997             <a class="code" href="classElement.html">Element</a>* el = segment-&gt;<a class="code" href="classSegment.html#a8">element</a>(track);
00998             <span class="keywordflow">if</span> (el &amp;&amp;  el-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a25">CHORD</a>)
00999                   <span class="keywordflow">break</span>;
01000             }
01001       <span class="keywordflow">if</span> (segment == 0) {
01002             <span class="keywordflow">return</span>;
01003             }
01004 
01005       <a class="code" href="classScore.html#a83">startCmd</a>();
01006 
01007       <span class="keywordflow">if</span> (!segment-&gt;<a class="code" href="classSegment.html#a11">lyricsList</a>(staff)-&gt;empty()) {
01008             <a class="code" href="segment_8h.html#a0">LyricsList</a>* ll = segment-&gt;<a class="code" href="classSegment.html#a11">lyricsList</a>(staff);
01009             lyrics = (*ll)[0];
01010             }
01011       <span class="keywordflow">else</span> {
01012             lyrics = <span class="keyword">new</span> <a class="code" href="classLyrics.html">Lyrics</a>(<span class="keyword">this</span>);
01013             lyrics-&gt;<a class="code" href="classElement.html#a75">setTick</a>(segment-&gt;<a class="code" href="classElement.html#a74">tick</a>());
01014             lyrics-&gt;<a class="code" href="classElement.html#a61">setStaff</a>(lyrics-&gt;<a class="code" href="classElement.html#a59">staff</a>());
01015             lyrics-&gt;<a class="code" href="classElement.html#a11">setParent</a>(segment);
01016             <a class="code" href="classScore.html#a60">addObject</a>(lyrics);
01017             <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::AddObject, lyrics);
01018             }
01019       <a class="code" href="classScore.html#a47">select</a>(lyrics, 0, 0);
01020       <a class="code" href="classScore.html#a46">canvas</a>()-&gt;<a class="code" href="classCanvas.html#a15">startEdit</a>(lyrics);
01021 
01022       <a class="code" href="classScore.html#a49">layout</a>();
01023       }
01024 
01025 <span class="comment">//---------------------------------------------------------</span>
01026 <span class="comment">//   addLyrics</span>
01027 <span class="comment">//    called from Keyboard Accelerator &amp; menue</span>
01028 <span class="comment">//---------------------------------------------------------</span>
01029 
<a name="l01030"></a><a class="code" href="classScore.html#i10">01030</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#i10">Score::addLyrics</a>()
01031       {
01032       <a class="code" href="classNote.html">Note</a>* e = <a class="code" href="classScore.html#d9">getSelectedNote</a>();
01033       <span class="keywordflow">if</span> (e == 0)
01034             <span class="keywordflow">return</span>;
01035 
01036       <a class="code" href="classChord.html">Chord</a>* chord     = e-&gt;<a class="code" href="classNote.html#a37">chord</a>();
01037       <a class="code" href="classSegment.html">Segment</a>* segment = chord-&gt;<a class="code" href="classChordRest.html#a4">segment</a>();
01038       <span class="keywordtype">int</span> tick         = chord-&gt;<a class="code" href="classElement.html#a74">tick</a>();
01039       <span class="keywordtype">int</span> <a class="code" href="classScore.html#a7">staff</a>        = chord-&gt;<a class="code" href="classElement.html#a60">staffIdx</a>();
01040 
01041       <a class="code" href="classScore.html#a83">startCmd</a>();
01042       <span class="comment">// check if there is already a lyrics entry</span>
01043       <a class="code" href="classLyrics.html">Lyrics</a>* lyrics;
01044       <a class="code" href="segment_8h.html#a0">LyricsList</a>* ll = segment-&gt;<a class="code" href="classSegment.html#a11">lyricsList</a>(staff);
01045       <span class="keywordflow">if</span> (ll &amp;&amp; !ll-&gt;empty())
01046             lyrics = ll-&gt;front();
01047       <span class="keywordflow">else</span> {
01048             lyrics = <span class="keyword">new</span> <a class="code" href="classLyrics.html">Lyrics</a>(<span class="keyword">this</span>);
01049             lyrics-&gt;<a class="code" href="classElement.html#a75">setTick</a>(tick);
01050             lyrics-&gt;<a class="code" href="classElement.html#a61">setStaff</a>(chord-&gt;<a class="code" href="classElement.html#a59">staff</a>());
01051             lyrics-&gt;<a class="code" href="classElement.html#a11">setParent</a>(segment);
01052             <a class="code" href="classScore.html#a60">addObject</a>(lyrics);
01053             <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::AddObject, lyrics);
01054             }
01055       <a class="code" href="classScore.html#a47">select</a>(lyrics, 0, 0);
01056       <a class="code" href="classScore.html#a46">canvas</a>()-&gt;<a class="code" href="classCanvas.html#a15">startEdit</a>(lyrics);
01057       <a class="code" href="classScore.html#a49">layout</a>();
01058       }
01059 
01060 <span class="comment">//---------------------------------------------------------</span>
01061 <span class="comment">//   addExpression</span>
01062 <span class="comment">//---------------------------------------------------------</span>
01063 
<a name="l01064"></a><a class="code" href="classScore.html#i14">01064</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#i14">Score::addExpression</a>()
01065       {
01066 
01067       }
01068 
01069 <span class="comment">//---------------------------------------------------------</span>
01070 <span class="comment">//   addTechnik</span>
01071 <span class="comment">//---------------------------------------------------------</span>
01072 
<a name="l01073"></a><a class="code" href="classScore.html#i12">01073</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#i12">Score::addTechnik</a>()
01074       {
01075 
01076       }
01077 
01078 <span class="comment">//---------------------------------------------------------</span>
01079 <span class="comment">//   cmdNTole</span>
01080 <span class="comment">//---------------------------------------------------------</span>
01081 
<a name="l01082"></a><a class="code" href="classScore.html#i18">01082</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#i18">Score::cmdNTole</a>(<span class="keywordtype">int</span> n)
01083       {
01084       <a class="code" href="classNote.html">Note</a>* e1 = <a class="code" href="classScore.html#d9">getSelectedNote</a>();
01085       <span class="keywordflow">if</span> (e1 == 0)
01086             <span class="keywordflow">return</span>;
01087       <span class="keywordtype">int</span> d1, d2;
01088       <a class="code" href="classChord.html">Chord</a>* c1 = e1-&gt;<a class="code" href="classNote.html#a37">chord</a>();
01089       <span class="keywordflow">switch</span>(c1-&gt;<a class="code" href="classElement.html#a76">tickLen</a>()) {
01090             <span class="keywordflow">case</span> <a class="code" href="mtime_8h.html#a0">division</a>:
01091                   d1 = 4;
01092                   d2 = 8;
01093                   <span class="keywordflow">break</span>;
01094             <span class="keywordflow">case</span> <a class="code" href="mtime_8h.html#a0">division</a>/2:
01095                   d1 = 8;
01096                   d2 = 12;
01097                   <span class="keywordflow">break</span>;
01098             <span class="keywordflow">case</span> <a class="code" href="mtime_8h.html#a0">division</a>/4:
01099                   d1 = 16;
01100                   d2 = 24;
01101                   <span class="keywordflow">break</span>;
01102             <span class="keywordflow">case</span> <a class="code" href="mtime_8h.html#a0">division</a>/8:
01103                   d1 = 32;
01104                   d2 = 48;
01105                   <span class="keywordflow">break</span>;
01106             <span class="keywordflow">case</span> <a class="code" href="mtime_8h.html#a0">division</a>/16:
01107                   d1 = 64;
01108                   d2 = 96;
01109                   <span class="keywordflow">break</span>;
01110             <span class="keywordflow">default</span>:
01111                   printf(<span class="stringliteral">"%d Tole does not fit\n"</span>, n);
01112                   <span class="keywordflow">return</span>;
01113             }
01114       printf(<span class="stringliteral">"%d tole 2/%d -&gt; 3/%d\n"</span>, n, d1, d2);
01115 
01116       <span class="comment">//---------------------------------------------------</span>
01117       <span class="comment">//    check if there is room for 2/d1 duration in</span>
01118       <span class="comment">//    message</span>
01119       <span class="comment">//---------------------------------------------------</span>
01120 
01121       <span class="comment">//---------------------------------------------------</span>
01122       <span class="comment">//    - replace selected note with note of 1/d2</span>
01123       <span class="comment">//      duration,</span>
01124       <span class="comment">//    - remove rest/note of 1/d1 duration</span>
01125       <span class="comment">//    - add 2 rests of 1/d2 duration as placeholder</span>
01126       <span class="comment">//---------------------------------------------------</span>
01127 
01128       <a class="code" href="classRest.html">Rest</a>* r2   = <span class="keyword">new</span> <a class="code" href="classRest.html">Rest</a>(<span class="keyword">this</span>);
01129       Rest* r3   = <span class="keyword">new</span> Rest(<span class="keyword">this</span>);
01130       <a class="code" href="classBeam.html">Beam</a>* beam = <span class="keyword">new</span> <a class="code" href="classBeam.html">Beam</a>(<span class="keyword">this</span>);
01131       beam-&gt;<a class="code" href="classBeam.html#a5">add</a>(c1);
01132       beam-&gt;<a class="code" href="classBeam.html#a5">add</a>(r2);
01133       beam-&gt;<a class="code" href="classBeam.html#a5">add</a>(r3);
01134 
01135       <span class="comment">//---------------------------------------------------</span>
01136       <span class="comment">//    - create beam; mark as NTOLE beam</span>
01137       <span class="comment">//---------------------------------------------------</span>
01138 
01139       <span class="comment">//setNote(cis-&gt;pos, cis-&gt;staff, padState.pitch, len, /*prefix*/ 0);</span>
01140       }
01141 
01142 <span class="comment">//---------------------------------------------------------</span>
01143 <span class="comment">//   changeVoice</span>
01144 <span class="comment">//---------------------------------------------------------</span>
01145 
<a name="l01146"></a><a class="code" href="classScore.html#a97">01146</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#a97">Score::changeVoice</a>(<span class="keywordtype">int</span> voice)
01147       {
01148       <a class="code" href="input_8h.html#a0">cis</a>-&gt;<a class="code" href="structInputState.html#o2">voice</a> = voice;
01149 <span class="comment">// printf("change voice\n");</span>
01150       <a class="code" href="classScore.html#a49">layout</a>();
01151       <a class="code" href="classScore.html#d8">moveCursor</a>();
01152       }
01153 
01154 <span class="comment">//---------------------------------------------------------</span>
01155 <span class="comment">//   colorItem</span>
01156 <span class="comment">//---------------------------------------------------------</span>
01157 
<a name="l01158"></a><a class="code" href="classScore.html#a104">01158</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#a104">Score::colorItem</a>(<a class="code" href="classElement.html">Element</a>*)
01159       {
01160       QColor sc = <a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#a6">element</a>() ? <a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#a6">element</a>()-&gt;<a class="code" href="classElement.html#a79">color</a>() : Qt::black;
01161       QColor c = QColorDialog::getColor(sc);
01162 
01163       <a class="code" href="classElementList.html">ElementList</a>* el = <a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#a0">elements</a>();
01164       <a class="code" href="classElementList.html">ElementList</a> dl;
01165       <span class="keywordflow">for</span> (<a class="code" href="element_8h.html#a1">iElement</a> ie = el-&gt;<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); ie != el-&gt;<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++ie) {
01166             <a class="code" href="classElement.html">Element</a>* e = *ie;
01167             <span class="keywordflow">if</span> (e-&gt;<a class="code" href="classElement.html#a79">color</a>() != c) {
01168                   <a class="code" href="classElement.html">Element</a>* ne = e-&gt;<a class="code" href="classElement.html#a3">clone</a>();
01169                   <span class="keywordflow">if</span> (ne == 0)
01170                         <span class="keywordflow">return</span>;
01171                   ne-&gt;<a class="code" href="classElement.html#a80">setColor</a>(c);
01172                   <a class="code" href="classScore.html#a61">removeObject</a>(e);
01173                   <a class="code" href="classScore.html#a60">addObject</a>(ne);
01174                   dl.<a class="code" href="classpstl_1_1plist.html#a2">push_back</a>(ne);
01175                   <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::RemoveObject, e);
01176                   <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::AddObject, ne);
01177                   <a class="code" href="classScore.html#r1">refresh</a> |= ne-&gt;<a class="code" href="classElement.html#a34">abbox</a>();
01178                   }
01179             }
01180       <a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#a3">deselectAll</a>(<span class="keyword">this</span>);
01181       <a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#a1">add</a>(dl);
01182       }
01183 
01184 <span class="comment">//---------------------------------------------------------</span>
01185 <span class="comment">//   pageBreak</span>
01186 <span class="comment">//---------------------------------------------------------</span>
01187 
<a name="l01188"></a><a class="code" href="classScore.html#i22">01188</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#i22">Score::pageBreak</a>()
01189       {
01190       <span class="keywordflow">if</span> (<a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#o0">state</a> != <a class="code" href="select_8h.html#a5a3">SEL_STAFF</a> &amp;&amp; <a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#o0">state</a> != <a class="code" href="select_8h.html#a5a4">SEL_SYSTEM</a>) {
01191             printf(<span class="stringliteral">"no system selected!\n"</span>);
01192             <span class="keywordflow">return</span>;
01193             }
01194       <a class="code" href="classMeasure.html">Measure</a>* m = <a class="code" href="undo_8cpp.html#a3">tick2measure</a>(<a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#o1">tickStart</a>);
01195       m-&gt;<a class="code" href="classMeasure.html#a37">setPageBreak</a>(!m-&gt;<a class="code" href="classMeasure.html#a34">pageBreak</a>());
01196 printf(<span class="stringliteral">"page break %d\n"</span>, m-&gt;<a class="code" href="classMeasure.html#a34">pageBreak</a>());
01197       <a class="code" href="classScore.html#a49">layout</a>();
01198       }
01199 
01200 <span class="comment">//---------------------------------------------------------</span>
01201 <span class="comment">//   systemBreak</span>
01202 <span class="comment">//---------------------------------------------------------</span>
01203 
<a name="l01204"></a><a class="code" href="classScore.html#i23">01204</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#i23">Score::systemBreak</a>()
01205       {
01206       <span class="keywordflow">if</span> (<a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#o0">state</a> != <a class="code" href="select_8h.html#a5a3">SEL_STAFF</a> &amp;&amp; <a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#o0">state</a> != <a class="code" href="select_8h.html#a5a4">SEL_SYSTEM</a>) {
01207             printf(<span class="stringliteral">"no system selected!\n"</span>);
01208             <span class="keywordflow">return</span>;
01209             }
01210       <a class="code" href="classMeasure.html">Measure</a>* m = <a class="code" href="undo_8cpp.html#a3">tick2measure</a>(<a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#o1">tickStart</a>);
01211       m-&gt;<a class="code" href="classMeasure.html#a36">setLineBreak</a>(!m-&gt;<a class="code" href="classMeasure.html#a33">lineBreak</a>());
01212       <a class="code" href="classScore.html#a49">layout</a>();
01213       }
01214 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Mon Jun 27 22:28:28 2005 for MuseScore by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
