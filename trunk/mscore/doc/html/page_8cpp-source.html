<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>MuseScore: page.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>page.cpp</h1><a href="page_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">//=========================================================</span>
00002 <span class="comment">//  MuseScore</span>
00003 <span class="comment">//  Linux Music Score Editor</span>
00004 <span class="comment">//  $Id: page.cpp,v 1.17 2005/06/27 19:50:23 wschweer Exp $</span>
00005 <span class="comment">//</span>
00006 <span class="comment">//  (C) Copyright 2002-2004 Werner Schweer (ws@seh.de)</span>
00007 <span class="comment">//=========================================================</span>
00008 
00009 <span class="preprocessor">#include "<a class="code" href="page_8h.html">page.h</a>"</span>
00010 <span class="preprocessor">#include "<a class="code" href="project_8h.html">project.h</a>"</span>
00011 <span class="preprocessor">#include "<a class="code" href="text_8h.html">text.h</a>"</span>
00012 <span class="preprocessor">#include "<a class="code" href="xml_8h.html">xml.h</a>"</span>
00013 <span class="preprocessor">#include "<a class="code" href="mscore_8h.html">mscore.h</a>"</span>
00014 <span class="preprocessor">#include "<a class="code" href="painter_8h.html">painter.h</a>"</span>
00015 <span class="preprocessor">#include "<a class="code" href="preferences_8h.html">preferences.h</a>"</span>
00016 <span class="preprocessor">#include "<a class="code" href="measure_8h.html">measure.h</a>"</span>
00017 <span class="preprocessor">#include "<a class="code" href="style_8h.html">style.h</a>"</span>
00018 
00019 <span class="comment">//---------------------------------------------------------</span>
00020 <span class="comment">//   Page</span>
00021 <span class="comment">//---------------------------------------------------------</span>
00022 
<a name="l00023"></a><a class="code" href="classPage.html#a0">00023</a> <a class="code" href="classPage.html#a0">Page::Page</a>(<a class="code" href="classScore.html">Score</a>* s, <span class="keywordtype">int</span> n)
00024    : <a class="code" href="classElement.html">Element</a>(s, <a class="code" href="element_8h.html#a65a32">PAGE</a>)
00025       {
00026       <a class="code" href="classPage.html#r1">_no</a>       = n;
00027       <a class="code" href="classPage.html#r2">pageNo</a>    = 0;
00028       <a class="code" href="classPage.html#r3">copyright</a> = 0;
00029       <a class="code" href="classPage.html#r0">_systems</a>  = <span class="keyword">new</span> <a class="code" href="classSystemList.html">SystemList</a>;
00030       }
00031 
<a name="l00032"></a><a class="code" href="classPage.html#a1">00032</a> <a class="code" href="classPage.html#a1">Page::~Page</a>()
00033       {
00034       <span class="keyword">delete</span> <a class="code" href="classPage.html#r0">_systems</a>;
00035       }
00036 
00037 <span class="comment">//---------------------------------------------------------</span>
00038 <span class="comment">//   tm</span>
00039 <span class="comment">//---------------------------------------------------------</span>
00040 
<a name="l00041"></a><a class="code" href="classPage.html#a10">00041</a> <span class="keywordtype">double</span> <a class="code" href="classPage.html#a10">Page::tm</a>()<span class="keyword"> const</span>
00042 <span class="keyword">      </span>{
00043       <a class="code" href="structPageFormat.html">PageFormat</a>* pf = _score-&gt;<a class="code" href="classScore.html#a135">pageFormat</a>();
00044       <span class="keywordflow">return</span> <a class="code" href="classPage.html#a9">isOdd</a>() ? pf-&gt;<a class="code" href="structPageFormat.html#o7">oddTopMargin</a> : pf-&gt;<a class="code" href="structPageFormat.html#o3">evenTopMargin</a>;
00045       }
00046 
<a name="l00047"></a><a class="code" href="classPage.html#a11">00047</a> <span class="keywordtype">double</span> <a class="code" href="classPage.html#a11">Page::bm</a>()<span class="keyword"> const</span>
00048 <span class="keyword">      </span>{
00049       <a class="code" href="structPageFormat.html">PageFormat</a>* pf = _score-&gt;<a class="code" href="classScore.html#a135">pageFormat</a>();
00050       <span class="keywordflow">return</span> <a class="code" href="classPage.html#a9">isOdd</a>() ? pf-&gt;<a class="code" href="structPageFormat.html#o8">oddBottomMargin</a> : pf-&gt;<a class="code" href="structPageFormat.html#o4">evenBottomMargin</a>;
00051       }
00052 
<a name="l00053"></a><a class="code" href="classPage.html#a12">00053</a> <span class="keywordtype">double</span> <a class="code" href="classPage.html#a12">Page::lm</a>()<span class="keyword"> const</span>
00054 <span class="keyword">      </span>{
00055       <a class="code" href="structPageFormat.html">PageFormat</a>* pf = _score-&gt;<a class="code" href="classScore.html#a135">pageFormat</a>();
00056       <span class="keywordflow">return</span> <a class="code" href="classPage.html#a9">isOdd</a>() ? pf-&gt;<a class="code" href="structPageFormat.html#o5">oddLeftMargin</a> : pf-&gt;<a class="code" href="structPageFormat.html#o1">evenLeftMargin</a>;
00057       }
00058 
<a name="l00059"></a><a class="code" href="classPage.html#a13">00059</a> <span class="keywordtype">double</span> <a class="code" href="classPage.html#a13">Page::rm</a>()<span class="keyword"> const</span>
00060 <span class="keyword">      </span>{
00061       <a class="code" href="structPageFormat.html">PageFormat</a>* pf = _score-&gt;<a class="code" href="classScore.html#a135">pageFormat</a>();
00062       <span class="keywordflow">return</span> <a class="code" href="classPage.html#a9">isOdd</a>() ? pf-&gt;<a class="code" href="structPageFormat.html#o6">oddRightMargin</a> : pf-&gt;<a class="code" href="structPageFormat.html#o2">evenRightMargin</a>;
00063       }
00064 
00065 <span class="comment">//---------------------------------------------------------</span>
00066 <span class="comment">//   add Element</span>
00067 <span class="comment">//---------------------------------------------------------</span>
00068 
<a name="l00069"></a><a class="code" href="classPage.html#a16">00069</a> <span class="keywordtype">void</span> <a class="code" href="classPage.html#a16">Page::add</a>(<a class="code" href="classElement.html">Element</a>* el)
00070       {
00071       el-&gt;<a class="code" href="classElement.html#a11">setParent</a>(<span class="keyword">this</span>);
00072       <a class="code" href="classPage.html#r4">_elements</a>.<a class="code" href="classpstl_1_1plist.html#a2">push_back</a>(el);
00073       el-&gt;<a class="code" href="classElement.html#a12">anchor</a>()-&gt;<a class="code" href="classMeasure.html#a8">add</a>(el);
00074       }
00075 
00076 <span class="comment">//---------------------------------------------------------</span>
00077 <span class="comment">//   remove Element</span>
00078 <span class="comment">//---------------------------------------------------------</span>
00079 
<a name="l00080"></a><a class="code" href="classPage.html#a17">00080</a> <span class="keywordtype">void</span> <a class="code" href="classPage.html#a17">Page::remove</a>(<a class="code" href="classElement.html">Element</a>* el)
00081       {
00082       <a class="code" href="classPage.html#r4">_elements</a>.<a class="code" href="classElementList.html#a1">remove</a>(el);
00083       el-&gt;<a class="code" href="classElement.html#a12">anchor</a>()-&gt;<a class="code" href="classMeasure.html#a9">remove</a>(el);
00084       }
00085 
00086 <span class="comment">//---------------------------------------------------------</span>
00087 <span class="comment">//   appendSystem</span>
00088 <span class="comment">//---------------------------------------------------------</span>
00089 
<a name="l00090"></a><a class="code" href="classPage.html#a5">00090</a> <span class="keywordtype">void</span> <a class="code" href="classPage.html#a5">Page::appendSystem</a>(<a class="code" href="classSystem.html">System</a>* s)
00091       {
00092       s-&gt;<a class="code" href="classElement.html#a11">setParent</a>(<span class="keyword">this</span>);
00093       <a class="code" href="classPage.html#r0">_systems</a>-&gt;<a class="code" href="classpstl_1_1plist.html#a2">push_back</a>(s);
00094       }
00095 
00096 <span class="comment">//---------------------------------------------------------</span>
00097 <span class="comment">//   update</span>
00098 <span class="comment">//---------------------------------------------------------</span>
00099 
<a name="l00100"></a><a class="code" href="classPageList.html#a1">00100</a> <span class="keywordtype">void</span> <a class="code" href="classPageList.html#a1">PageList::update</a>(<a class="code" href="classScore.html">Score</a>* s)
00101       {
00102       <span class="keywordtype">double</span> x = 0;
00103       <span class="keywordtype">int</span> no = 0;
00104       <span class="keywordflow">for</span> (<a class="code" href="page_8h.html#a0">iPage</a> ip = <a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); ip != <a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++ip, ++no) {
00105             <a class="code" href="classPage.html">Page</a>* page = *ip;
00106             page-&gt;<a class="code" href="classPage.html#a8">setNo</a>(no);
00107             page-&gt;<a class="code" href="classElement.html#a23">setpos</a>(x, 0);
00108             page-&gt;<a class="code" href="classElement.html#a32">setbbox</a>(QRectF(0, 0, s-&gt;<a class="code" href="classScore.html#a135">pageFormat</a>()-&gt;<a class="code" href="structPageFormat.html#a1">width</a>(), s-&gt;<a class="code" href="classScore.html#a135">pageFormat</a>()-&gt;<a class="code" href="structPageFormat.html#a2">height</a>()));
00109             x += s-&gt;<a class="code" href="classScore.html#a135">pageFormat</a>()-&gt;<a class="code" href="structPageFormat.html#a1">width</a>() + ((no &amp; 1) ? 1.0 : 50.0);
00110             page-&gt;<a class="code" href="classPage.html#a19">layout</a>();
00111             }
00112       }
00113 
00114 <span class="comment">//---------------------------------------------------------</span>
00115 <span class="comment">//   layout</span>
00116 <span class="comment">//---------------------------------------------------------</span>
00117 
<a name="l00118"></a><a class="code" href="classPage.html#a19">00118</a> <span class="keywordtype">void</span> <a class="code" href="classPage.html#a19">Page::layout</a>()
00119       {
00120       <span class="comment">// add page number</span>
00121       <span class="keywordflow">if</span> (::style-&gt;showPageNumber) {
00122             <span class="keywordtype">int</span> n = <a class="code" href="classPage.html#a7">no</a>() + 1 + _score-&gt;<a class="code" href="classScore.html#o8">_pageOffset</a>;
00123             <a class="code" href="style_8h.html#a45">TEXT_STYLE</a> <a class="code" href="style_8cpp.html#a1">style</a> = (n &amp; 1) ? <a class="code" href="style_8h.html#a45a35">TEXT_STYLE_PAGE_NUMBER_ODD</a> : <a class="code" href="style_8h.html#a45a36">TEXT_STYLE_PAGE_NUMBER_EVEN</a>;
00124             <span class="keywordflow">if</span> (n || ::style-&gt;showPageNumberOne) {
00125                   <span class="keywordflow">if</span> (<a class="code" href="classPage.html#r2">pageNo</a> == 0) {
00126                         <a class="code" href="classPage.html#r2">pageNo</a> = <span class="keyword">new</span> <a class="code" href="classSText.html">SText</a>(<a class="code" href="classElement.html#a4">score</a>(), <a class="code" href="element_8h.html#a65a8">TEXT</a>, <a class="code" href="style_8cpp.html#a1">style</a>);
00127                         <a class="code" href="classPage.html#r2">pageNo</a>-&gt;<a class="code" href="classElement.html#a11">setParent</a>(<span class="keyword">this</span>);
00128                         }
00129                   QString txt(<span class="stringliteral">"%1"</span>);
00130                   <a class="code" href="classPage.html#r2">pageNo</a>-&gt;<a class="code" href="classSText.html#a5">setText</a>(txt.arg(n));
00131                   <a class="code" href="classPage.html#r2">pageNo</a>-&gt;<a class="code" href="classSText.html#a22">layout</a>();
00132                   QPointF f(<a class="code" href="classPage.html#r2">pageNo</a>-&gt;<a class="code" href="classElement.html#a35">apos</a>());
00133                   }
00134             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classPage.html#r2">pageNo</a>) {
00135                   <span class="keyword">delete</span> <a class="code" href="classPage.html#r2">pageNo</a>;
00136                   <a class="code" href="classPage.html#r2">pageNo</a> = 0;
00137                   }
00138             }
00139       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classPage.html#r2">pageNo</a>) {
00140             <span class="keyword">delete</span> <a class="code" href="classPage.html#r2">pageNo</a>;
00141             <a class="code" href="classPage.html#r2">pageNo</a> = 0;
00142             }
00143 
00144       <span class="comment">// add copyright to page</span>
00145       <span class="keywordflow">if</span> (!_score-&gt;<a class="code" href="classScore.html#o7">rights</a>.isEmpty()) {
00146             <span class="keywordflow">if</span> (<a class="code" href="classPage.html#r3">copyright</a> == 0) {
00147                   <a class="code" href="classPage.html#r3">copyright</a> = <span class="keyword">new</span> <a class="code" href="classSText.html">SText</a>(<a class="code" href="classElement.html#a4">score</a>(), <a class="code" href="element_8h.html#a65a8">TEXT</a>, <a class="code" href="style_8h.html#a45a33">TEXT_STYLE_COPYRIGHT</a>);
00148                   <a class="code" href="classPage.html#r3">copyright</a>-&gt;<a class="code" href="classElement.html#a11">setParent</a>(<span class="keyword">this</span>);
00149                   }
00150             <a class="code" href="classPage.html#r3">copyright</a>-&gt;<a class="code" href="classSText.html#a5">setText</a>(_score-&gt;<a class="code" href="classScore.html#o7">rights</a>);
00151             <a class="code" href="classPage.html#r3">copyright</a>-&gt;<a class="code" href="classSText.html#a22">layout</a>();
00152             }
00153       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classPage.html#r3">copyright</a>) {
00154             <span class="keyword">delete</span> <a class="code" href="classPage.html#r3">copyright</a>;
00155             <a class="code" href="classPage.html#r3">copyright</a> = 0;
00156             }
00157       }
00158 
00159 <span class="comment">//---------------------------------------------------------</span>
00160 <span class="comment">//   drawBorder</span>
00161 <span class="comment">//---------------------------------------------------------</span>
00162 
<a name="l00163"></a><a class="code" href="classPage.html#a18">00163</a> <span class="keywordtype">void</span> <a class="code" href="classPage.html#a18">Page::drawBorder</a>(<a class="code" href="classPainter.html">Painter</a>&amp; p)<span class="keyword"> const</span>
00164 <span class="keyword">      </span>{
00165       QRectF r = <a class="code" href="classElement.html#a33">bbox</a>();
00166       qreal x1 = r.x();
00167       qreal y1 = r.y();
00168       qreal x2 = x1 + r.width();
00169       qreal y2 = y1 + r.height();
00170 
00171       <span class="comment">//-----------------------------------------</span>
00172       <span class="comment">// draw page boarder gradients</span>
00173       <span class="comment">//-----------------------------------------</span>
00174 
00175       <span class="keyword">const</span> QColor c1(<span class="stringliteral">"#befbbefbbefb"</span>);
00176       <span class="keyword">const</span> QColor c2(<span class="stringliteral">"#79e779e779e7"</span>);
00177       <span class="keywordtype">int</span> h1, h2, s1, s2, v1, v2;
00178       <span class="keywordtype">int</span> bw = 6;
00179       c2.hsv(&amp;h1, &amp;s1, &amp;v1);
00180       c1.hsv(&amp;h2, &amp;s2, &amp;v2);
00181 
00182       <span class="keywordflow">if</span> ((<a class="code" href="classPage.html#a7">no</a>() &amp; 1) == 0) {
00183             <span class="keywordtype">int</span> bbw = bw/2-1;
00184             bbw = bbw &gt;= 1 ? bbw : 1;
00185             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; bw/2; ++i) {
00186                   p.setPen(QColor(h1+((h2-h1)*i)/bbw,
00187                      s1+((s2-s1)*i)/bbw,
00188                      v1+((v2-v1)*i)/bbw, QColor::Hsv));
00189                   p.drawLine(QLineF(x1+i, y1, x1+i, y2));
00190                   }
00191             c1.hsv(&amp;h1, &amp;s1, &amp;v1);
00192             c2.hsv(&amp;h2, &amp;s2, &amp;v2);
00193 
00194             p.fillRect(QRectF(x2-bw, y1, bw, bw), <a class="code" href="preferences_8cpp.html#a0">preferences</a>.<a class="code" href="structPreferences.html#o8">bgColor</a>);
00195             p.fillRect(QRectF(x2-bw, y2-bw, bw, bw), <a class="code" href="preferences_8cpp.html#a0">preferences</a>.<a class="code" href="structPreferences.html#o8">bgColor</a>);
00196 
00197             bbw = bw-1;
00198             bbw = bbw &gt;= 1 ? bbw : 1;
00199             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; bw; ++i) {
00200                   p.setPen(QColor(h1+((h2-h1)*i)/bbw,
00201                      s1+((s2-s1)*i)/bbw,
00202                      v1+((v2-v1)*i)/bbw, QColor::Hsv));
00203                   p.drawLine(QLineF(x2-bw+i, y1+i+1, x2-bw+i, y2-i-1));
00204                   }
00205             }
00206       <span class="keywordflow">else</span> {
00207             c2.hsv(&amp;h1, &amp;s1, &amp;v1);
00208             c1.hsv(&amp;h2, &amp;s2, &amp;v2);
00209 
00210             p.fillRect(QRectF(x1, y1, bw, bw), <a class="code" href="preferences_8cpp.html#a0">preferences</a>.<a class="code" href="structPreferences.html#o8">bgColor</a>);
00211             p.fillRect(QRectF(x1, y2-bw, bw, bw), <a class="code" href="preferences_8cpp.html#a0">preferences</a>.<a class="code" href="structPreferences.html#o8">bgColor</a>);
00212             <span class="keywordtype">int</span> bbw = bw-1;
00213             bbw = bbw &gt;= 1 ? bbw : 1;
00214             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; bw; ++i) {
00215                   p.setPen(QColor(h1+((h2-h1)*i)/bbw,
00216                      s1+((s2-s1)*i)/bbw,
00217                      v1+((v2-v1)*i)/bbw, QColor::Hsv));
00218                   p.drawLine(QLineF(x1+i, y1+(bw-i), x1+i, y2-(bw-i)-1));
00219                   }
00220             c1.hsv(&amp;h1, &amp;s1, &amp;v1);
00221             c2.hsv(&amp;h2, &amp;s2, &amp;v2);
00222 
00223             bw/=2;
00224             bbw = bw-1;
00225             bbw = bbw &gt;= 1 ? bbw : 1;
00226             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; bw; ++i) {
00227                   p.setPen(QColor(h1+((h2-h1)*i)/bbw,
00228                      s1+((s2-s1)*i)/bbw,
00229                      v1+((v2-v1)*i)/bbw, QColor::Hsv));
00230                   p.drawLine(QLineF(x2-bw+i, y1, x2-bw+i, y2));
00231                   }
00232             }
00233       }
00234 
00235 <span class="comment">//---------------------------------------------------------</span>
00236 <span class="comment">//   draw</span>
00237 <span class="comment">//    bounding rectange fr is relative to page QPointF</span>
00238 <span class="comment">//---------------------------------------------------------</span>
00239 
<a name="l00240"></a><a class="code" href="classPage.html#a20">00240</a> <span class="keywordtype">void</span> <a class="code" href="classPage.html#a20">Page::draw</a>(<a class="code" href="classPainter.html">Painter</a>&amp; p)<span class="keyword"> const</span>
00241 <span class="keyword">      </span>{
00242       <span class="keywordflow">if</span> (!p.<a class="code" href="classPainter.html#a2">print</a>())
00243             <a class="code" href="classPage.html#a18">drawBorder</a>(p);
00244       <a class="code" href="classPage.html#a14">pel</a>()-&gt;<a class="code" href="classElementList.html#a4">draw</a>(p);
00245       <span class="keywordflow">if</span> (<a class="code" href="classPage.html#r3">copyright</a>)
00246             <a class="code" href="classPage.html#r3">copyright</a>-&gt;<a class="code" href="classElement.html#a43">draw</a>(p);
00247       <span class="keywordflow">if</span> (<a class="code" href="classPage.html#r2">pageNo</a>)
00248             <a class="code" href="classPage.html#r2">pageNo</a>-&gt;<a class="code" href="classElement.html#a43">draw</a>(p);
00249       <a class="code" href="classSystemList.html">SystemList</a>* sl = <a class="code" href="classPage.html#a4">systems</a>();
00250       <span class="keywordflow">for</span> (<a class="code" href="classpstl_1_1plist.html">ciSystem</a> is = sl-&gt;<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); is != sl-&gt;<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++is)
00251             (*is)-&gt;draw(p);
00252       }
00253 
00254 <span class="comment">//---------------------------------------------------------</span>
00255 <span class="comment">//   PageFormat</span>
00256 <span class="comment">//---------------------------------------------------------</span>
00257 
<a name="l00258"></a><a class="code" href="structPageFormat.html#a0">00258</a> <a class="code" href="structPageFormat.html#a0">PageFormat::PageFormat</a>()
00259       {
00260       <a class="code" href="structPageFormat.html#o0">size</a> = 0;   <span class="comment">// A4</span>
00261       <a class="code" href="structPageFormat.html#o1">evenLeftMargin</a>   = 10.0 * DPMM;
00262       <a class="code" href="structPageFormat.html#o2">evenRightMargin</a>  = 10.0 * DPMM;
00263       <a class="code" href="structPageFormat.html#o3">evenTopMargin</a>    = 10.0 * DPMM;
00264       <a class="code" href="structPageFormat.html#o4">evenBottomMargin</a> = 20.0 * DPMM;
00265       <a class="code" href="structPageFormat.html#o5">oddLeftMargin</a>    = 10.0 * DPMM;
00266       <a class="code" href="structPageFormat.html#o6">oddRightMargin</a>   = 10.0 * DPMM;
00267       <a class="code" href="structPageFormat.html#o7">oddTopMargin</a>     = 10.0 * DPMM;
00268       <a class="code" href="structPageFormat.html#o8">oddBottomMargin</a>  = 20.0 * DPMM;
00269       <a class="code" href="structPageFormat.html#o9">landscape</a>        = <span class="keyword">false</span>;
00270       <a class="code" href="structPageFormat.html#o10">twosided</a>         = <span class="keyword">false</span>;
00271       }
00272 
00273 <span class="comment">//---------------------------------------------------------</span>
00274 <span class="comment">//   read</span>
00275 <span class="comment">//  &lt;page-layout&gt;</span>
00276 <span class="comment">//      &lt;pageFormat&gt;A6&lt;/pageFormat&gt;</span>
00277 <span class="comment">//      &lt;landscape&gt;1&lt;/landscape&gt;</span>
00278 <span class="comment">//      &lt;page-margins&gt;</span>
00279 <span class="comment">//         &lt;left-margin&gt;28.3465&lt;/left-margin&gt;</span>
00280 <span class="comment">//         &lt;right-margin&gt;28.3465&lt;/right-margin&gt;</span>
00281 <span class="comment">//         &lt;top-margin&gt;28.3465&lt;/top-margin&gt;</span>
00282 <span class="comment">//         &lt;bottom-margin&gt;56.6929&lt;/bottom-margin&gt;</span>
00283 <span class="comment">//         &lt;/page-margins&gt;</span>
00284 <span class="comment">//      &lt;/page-layout&gt;</span>
00285 <span class="comment">//---------------------------------------------------------</span>
00286 
<a name="l00287"></a><a class="code" href="structPageFormat.html#a4">00287</a> <span class="keywordtype">void</span> <a class="code" href="structPageFormat.html#a4">PageFormat::read</a>(QDomNode node)
00288       {
00289       <span class="keywordflow">for</span> (node = node.firstChild(); !node.isNull(); node = node.nextSibling()) {
00290             QDomElement e = node.toElement();
00291             QString tag(e.tagName());
00292             QString val(e.text());
00293             <span class="keywordtype">int</span> i = val.toInt();
00294             <span class="keywordflow">if</span> (tag == <span class="stringliteral">"pageFormat"</span>)
00295                   <a class="code" href="structPageFormat.html#o0">size</a> = <a class="code" href="pagesettings_8cpp.html#a3">paperSizeNameToIndex</a>(val);
00296             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tag == <span class="stringliteral">"landscape"</span>)
00297                   <a class="code" href="structPageFormat.html#o9">landscape</a> = i;
00298             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tag == <span class="stringliteral">"page-margins"</span>) {
00299                   QString type = e.attribute(<span class="stringliteral">"type"</span>,<span class="stringliteral">"both"</span>);
00300                   <span class="keywordtype">double</span> lm = 0.0, rm = 0.0, tm = 0.0, bm = 0.0;
00301                   <span class="keywordflow">for</span> (QDomNode n = node.firstChild(); !n.isNull(); n = n.nextSibling()) {
00302                         QDomElement e = n.toElement();
00303                         <span class="keywordflow">if</span> (e.isNull())
00304                               <span class="keywordflow">continue</span>;
00305                         QString tag(e.tagName());
00306                         <span class="comment">// double val = e.text().toDouble() * _spatium * .1;</span>
00307                         <span class="keywordtype">double</span> val = e.text().toDouble();
00308                         <span class="keywordflow">if</span> (tag == <span class="stringliteral">"left-margin"</span>) {
00309                               lm = val * DPMM;
00310                               }
00311                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tag == <span class="stringliteral">"right-margin"</span>)
00312                               rm = val * DPMM;
00313                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tag == <span class="stringliteral">"top-margin"</span>)
00314                               tm = val * DPMM;
00315                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tag == <span class="stringliteral">"bottom-margin"</span>)
00316                               bm = val * DPMM;
00317                         <span class="keywordflow">else</span>
00318                               printf(<span class="stringliteral">"MScore:page-layout:page-margins &lt;%s&gt; not supported\n"</span>, tag.latin1());
00319                         }
00320                   <a class="code" href="structPageFormat.html#o10">twosided</a> = type == <span class="stringliteral">"odd"</span> || type == <span class="stringliteral">"even"</span>;
00321                   <span class="keywordflow">if</span> (type == <span class="stringliteral">"odd"</span> || type == <span class="stringliteral">"both"</span>) {
00322                         <a class="code" href="structPageFormat.html#o5">oddLeftMargin</a>   = lm;
00323                         <a class="code" href="structPageFormat.html#o6">oddRightMargin</a>  = rm;
00324                         <a class="code" href="structPageFormat.html#o7">oddTopMargin</a>    = tm;
00325                         <a class="code" href="structPageFormat.html#o8">oddBottomMargin</a> = bm;
00326                         }
00327                   <span class="keywordflow">if</span> (type == <span class="stringliteral">"even"</span> || type == <span class="stringliteral">"both"</span>) {
00328                         <a class="code" href="structPageFormat.html#o1">evenLeftMargin</a>   = lm;
00329                         <a class="code" href="structPageFormat.html#o2">evenRightMargin</a>  = rm;
00330                         <a class="code" href="structPageFormat.html#o3">evenTopMargin</a>    = tm;
00331                         <a class="code" href="structPageFormat.html#o4">evenBottomMargin</a> = bm;
00332                         }
00333                   }
00334             <span class="keywordflow">else</span>
00335                   printf(<span class="stringliteral">"Mscore:PageFormat: unknown tag %s\n"</span>,
00336                      tag.latin1());
00337             }
00338       }
00339 
00340 <span class="comment">//---------------------------------------------------------</span>
00341 <span class="comment">//   write</span>
00342 <span class="comment">//---------------------------------------------------------</span>
00343 
<a name="l00344"></a><a class="code" href="structPageFormat.html#a5">00344</a> <span class="keywordtype">void</span> <a class="code" href="structPageFormat.html#a5">PageFormat::write</a>(<a class="code" href="classXml.html">Xml</a>&amp; xml)
00345       {
00346       xml.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"page-layout"</span>);
00347 
00348       <span class="keywordflow">if</span> (<a class="code" href="structPageFormat.html#a3">name</a>() != <span class="stringliteral">"Other"</span>) {
00349             xml.<a class="code" href="classXml.html#a16">strTag</a>(<span class="stringliteral">"pageFormat"</span>, <a class="code" href="structPageFormat.html#a3">name</a>());
00350             <span class="keywordflow">if</span> (<a class="code" href="structPageFormat.html#o9">landscape</a>)
00351                   xml.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"landscape"</span>, <a class="code" href="structPageFormat.html#o9">landscape</a>);
00352             }
00353       <span class="keywordflow">else</span> {
00354             xml.<a class="code" href="classXml.html#a14">doubleTag</a>(<span class="stringliteral">"page-height"</span>, <a class="code" href="structPageFormat.html#a2">height</a>() / DPMM);
00355             xml.<a class="code" href="classXml.html#a14">doubleTag</a>(<span class="stringliteral">"page-width"</span>, <a class="code" href="structPageFormat.html#a1">width</a>() / DPMM);
00356             }
00357       QString type(<span class="stringliteral">"both"</span>);
00358       <span class="keywordflow">if</span> (<a class="code" href="structPageFormat.html#o10">twosided</a>) {
00359             type = <span class="stringliteral">"even"</span>;
00360             xml.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"page-margins type=\"%s\""</span>, type.latin1());
00361             xml.<a class="code" href="classXml.html#a14">doubleTag</a>(<span class="stringliteral">"left-margin"</span>,   <a class="code" href="structPageFormat.html#o1">evenLeftMargin</a> / DPMM);
00362             xml.<a class="code" href="classXml.html#a14">doubleTag</a>(<span class="stringliteral">"right-margin"</span>,  <a class="code" href="structPageFormat.html#o2">evenRightMargin</a> / DPMM);
00363             xml.<a class="code" href="classXml.html#a14">doubleTag</a>(<span class="stringliteral">"top-margin"</span>,    <a class="code" href="structPageFormat.html#o3">evenTopMargin</a> / DPMM);
00364             xml.<a class="code" href="classXml.html#a14">doubleTag</a>(<span class="stringliteral">"bottom-margin"</span>, <a class="code" href="structPageFormat.html#o4">evenBottomMargin</a> / DPMM);
00365             xml.<a class="code" href="classXml.html#a9">etag</a>(<span class="stringliteral">"page-margins"</span>);
00366             type = <span class="stringliteral">"odd"</span>;
00367             }
00368       xml.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"page-margins type=\"%s\""</span>, type.latin1());
00369       xml.<a class="code" href="classXml.html#a14">doubleTag</a>(<span class="stringliteral">"left-margin"</span>,   <a class="code" href="structPageFormat.html#o5">oddLeftMargin</a> / DPMM);
00370       xml.<a class="code" href="classXml.html#a14">doubleTag</a>(<span class="stringliteral">"right-margin"</span>,  <a class="code" href="structPageFormat.html#o6">oddRightMargin</a> / DPMM);
00371       xml.<a class="code" href="classXml.html#a14">doubleTag</a>(<span class="stringliteral">"top-margin"</span>,    <a class="code" href="structPageFormat.html#o7">oddTopMargin</a> / DPMM);
00372       xml.<a class="code" href="classXml.html#a14">doubleTag</a>(<span class="stringliteral">"bottom-margin"</span>, <a class="code" href="structPageFormat.html#o8">oddBottomMargin</a> / DPMM);
00373       xml.<a class="code" href="classXml.html#a9">etag</a>(<span class="stringliteral">"page-margins"</span>);
00374 
00375       xml.<a class="code" href="classXml.html#a9">etag</a>(<span class="stringliteral">"page-layout"</span>);
00376       }
00377 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Mon Jun 27 22:28:29 2005 for MuseScore by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
