<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>MuseScore: tempo.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>tempo.cpp</h1><a href="tempo_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">//=========================================================</span>
00002 <span class="comment">//  MuseScore</span>
00003 <span class="comment">//  Linux Music Score Editor</span>
00004 <span class="comment">//  $Id: tempo.cpp,v 1.5 2005/03/23 14:54:13 wschweer Exp $</span>
00005 <span class="comment">//</span>
00006 <span class="comment">//  (C) Copyright 1999-2004 Werner Schweer (ws@seh.de)</span>
00007 <span class="comment">//=========================================================</span>
00008 
00009 <span class="preprocessor">#include "<a class="code" href="mtime_8h.html">mtime.h</a>"</span>
00010 <span class="preprocessor">#include "<a class="code" href="tempo_8h.html">tempo.h</a>"</span>
00011 <span class="preprocessor">#include "<a class="code" href="xml_8h.html">xml.h</a>"</span>
00012 
00013 <span class="comment">//---------------------------------------------------------</span>
00014 <span class="comment">//   TempoList</span>
00015 <span class="comment">//---------------------------------------------------------</span>
00016 
<a name="l00017"></a><a class="code" href="classTempoList.html#a0">00017</a> <a class="code" href="classTempoList.html#a0">TempoList::TempoList</a>()
00018       {
00019       <a class="code" href="classTempoList.html#r2">_tempo</a>    = 500000;
00020       insert(std::pair&lt;const int, TEvent*&gt; (<a class="code" href="tempo_8h.html#a0">MAX_TICK</a>, <span class="keyword">new</span> <a class="code" href="structTEvent.html">TEvent</a>(<a class="code" href="classTempoList.html#r2">_tempo</a>, 0)));
00021       <a class="code" href="classTempoList.html#r0">_tempoSN</a>  = 1;
00022       <a class="code" href="classTempoList.html#r3">_relTempo</a> = 100;
00023       <a class="code" href="classTempoList.html#r1">useList</a>   = <span class="keyword">true</span>;
00024       }
00025 
00026 <span class="comment">//---------------------------------------------------------</span>
00027 <span class="comment">//   add</span>
00028 <span class="comment">//---------------------------------------------------------</span>
00029 
<a name="l00030"></a><a class="code" href="classTempoList.html#d1">00030</a> <span class="keywordtype">void</span> <a class="code" href="classTempoList.html#d1">TempoList::add</a>(<span class="keywordtype">int</span> tick, <span class="keywordtype">int</span> tempo)
00031       {
00032       <a class="code" href="classpstl_1_1ipmap.html">iTEvent</a> e = upper_bound(tick);
00033       assert(e != <a class="code" href="classpstl_1_1ipmap.html#a2">end</a>());     <span class="comment">// happens if tick &gt; MAX_TICK</span>
00034 
00035       <span class="keywordflow">if</span> (tick == e-&gt;second-&gt;tick)
00036             e-&gt;second-&gt;tempo = tempo;
00037       <span class="keywordflow">else</span> {
00038             <a class="code" href="structTEvent.html">TEvent</a>* ne = e-&gt;second;
00039             <a class="code" href="structTEvent.html">TEvent</a>* ev = <span class="keyword">new</span> <a class="code" href="structTEvent.html">TEvent</a>(ne-&gt;<a class="code" href="structTEvent.html#o0">tempo</a>, ne-&gt;<a class="code" href="structTEvent.html#o1">tick</a>);
00040             ne-&gt;<a class="code" href="structTEvent.html#o0">tempo</a>  = tempo;
00041             ne-&gt;<a class="code" href="structTEvent.html#o1">tick</a>   = tick;
00042             insert(std::pair&lt;const int, TEvent*&gt; (tick, ev));
00043             }
00044       <a class="code" href="classTempoList.html#d0">normalize</a>();
00045       }
00046 
00047 <span class="comment">//---------------------------------------------------------</span>
00048 <span class="comment">//   TempoList::normalize</span>
00049 <span class="comment">//---------------------------------------------------------</span>
00050 
<a name="l00051"></a><a class="code" href="classTempoList.html#d0">00051</a> <span class="keywordtype">void</span> <a class="code" href="classTempoList.html#d0">TempoList::normalize</a>()
00052       {
00053       <span class="keywordtype">double</span> time = 0;
00054       <span class="keywordflow">for</span> (<a class="code" href="classpstl_1_1ipmap.html">iTEvent</a> e = <a class="code" href="classpstl_1_1ipmap.html#a1">begin</a>(); e != <a class="code" href="classpstl_1_1ipmap.html#a2">end</a>(); ++e) {
00055             e-&gt;second-&gt;time = time;
00056             <span class="keywordtype">int</span> delta = e-&gt;first - e-&gt;second-&gt;tick;
00057             time += double(delta) / (<a class="code" href="mtime_8h.html#a0">division</a> * <a class="code" href="classTempoList.html#r3">_relTempo</a> * 10000.0/e-&gt;second-&gt;tempo);
00058             }
00059       }
00060 
00061 <span class="comment">//---------------------------------------------------------</span>
00062 <span class="comment">//   TempoList::dump</span>
00063 <span class="comment">//---------------------------------------------------------</span>
00064 
<a name="l00065"></a><a class="code" href="classTempoList.html#a4">00065</a> <span class="keywordtype">void</span> <a class="code" href="classTempoList.html#a4">TempoList::dump</a>()<span class="keyword"> const</span>
00066 <span class="keyword">      </span>{
00067       printf(<span class="stringliteral">"\nTempoList:\n"</span>);
00068       <span class="keywordflow">for</span> (<a class="code" href="classpstl_1_1ipmap.html">ciTEvent</a> i = <a class="code" href="classpstl_1_1ipmap.html#a1">begin</a>(); i != <a class="code" href="classpstl_1_1ipmap.html#a2">end</a>(); ++i) {
00069             printf(<span class="stringliteral">"%6d %06d Tempo %6d %f\n"</span>,
00070                i-&gt;first, i-&gt;second-&gt;tick, i-&gt;second-&gt;tempo,
00071                i-&gt;second-&gt;time);
00072             }
00073       }
00074 
00075 <span class="comment">//---------------------------------------------------------</span>
00076 <span class="comment">//   clear</span>
00077 <span class="comment">//---------------------------------------------------------</span>
00078 
<a name="l00079"></a><a class="code" href="classTempoList.html#a1">00079</a> <span class="keywordtype">void</span> <a class="code" href="classTempoList.html#a1">TempoList::clear</a>()
00080       {
00081       <span class="keywordflow">for</span> (<a class="code" href="classpstl_1_1ipmap.html">iTEvent</a> i = <a class="code" href="classpstl_1_1ipmap.html#a1">begin</a>(); i != <a class="code" href="classpstl_1_1ipmap.html#a2">end</a>(); ++i)
00082             <span class="keyword">delete</span> i-&gt;second;
00083       <a class="code" href="classpstl_1_1ipmap.html">pstl::ipmap&lt;TEvent* &gt;::clear</a>();
00084       insert(std::pair&lt;const int, TEvent*&gt; (<a class="code" href="tempo_8h.html#a0">MAX_TICK</a>, <span class="keyword">new</span> <a class="code" href="structTEvent.html">TEvent</a>(500000, 0)));
00085       ++<a class="code" href="classTempoList.html#r0">_tempoSN</a>;
00086       }
00087 
00088 <span class="comment">//---------------------------------------------------------</span>
00089 <span class="comment">//   tempo</span>
00090 <span class="comment">//---------------------------------------------------------</span>
00091 
<a name="l00092"></a><a class="code" href="classTempoList.html#a5">00092</a> <span class="keywordtype">int</span> <a class="code" href="classTempoList.html#a5">TempoList::tempo</a>(<span class="keywordtype">int</span> tick)<span class="keyword"> const</span>
00093 <span class="keyword">      </span>{
00094       <span class="keywordflow">if</span> (<a class="code" href="classTempoList.html#r1">useList</a>) {
00095             <a class="code" href="classpstl_1_1ipmap.html">ciTEvent</a> i = upper_bound(tick);
00096             <span class="keywordflow">if</span> (i == <a class="code" href="classpstl_1_1ipmap.html#a2">end</a>()) {
00097                   printf(<span class="stringliteral">"no TEMPO\n"</span>);
00098                   <span class="keywordflow">return</span> 1000;
00099                   }
00100             <span class="keywordflow">return</span> i-&gt;second-&gt;tempo;
00101             }
00102       <span class="keywordflow">else</span>
00103             <span class="keywordflow">return</span> <a class="code" href="classTempoList.html#r2">_tempo</a>;
00104       }
00105 
00106 <span class="comment">//---------------------------------------------------------</span>
00107 <span class="comment">//   del</span>
00108 <span class="comment">//---------------------------------------------------------</span>
00109 
<a name="l00110"></a><a class="code" href="classTempoList.html#d4">00110</a> <span class="keywordtype">void</span> <a class="code" href="classTempoList.html#d3">TempoList::del</a>(<span class="keywordtype">int</span> tick)
00111       {
00112 <span class="comment">// printf("TempoList::del(%d)\n", tick);</span>
00113       <a class="code" href="classpstl_1_1ipmap.html">iTEvent</a> e = find(tick);
00114       <span class="keywordflow">if</span> (e == <a class="code" href="classpstl_1_1ipmap.html#a2">end</a>()) {
00115             printf(<span class="stringliteral">"TempoList::del(%d): not found\n"</span>, tick);
00116             <span class="keywordflow">return</span>;
00117             }
00118       <a class="code" href="classTempoList.html#d3">del</a>(e);
00119       ++<a class="code" href="classTempoList.html#r0">_tempoSN</a>;
00120       }
00121 
<a name="l00122"></a><a class="code" href="classTempoList.html#d3">00122</a> <span class="keywordtype">void</span> <a class="code" href="classTempoList.html#d3">TempoList::del</a>(<a class="code" href="classpstl_1_1ipmap.html">iTEvent</a> e)
00123       {
00124       <a class="code" href="classpstl_1_1ipmap.html">iTEvent</a> ne = e;
00125       ++ne;
00126       <span class="keywordflow">if</span> (ne == <a class="code" href="classpstl_1_1ipmap.html#a2">end</a>()) {
00127             printf(<span class="stringliteral">"TempoList::del() HALLO\n"</span>);
00128             <span class="keywordflow">return</span>;
00129             }
00130       ne-&gt;second-&gt;tempo = e-&gt;second-&gt;tempo;
00131       ne-&gt;second-&gt;tick  = e-&gt;second-&gt;tick;
00132       erase(e);
00133       <a class="code" href="classTempoList.html#d0">normalize</a>();
00134       ++<a class="code" href="classTempoList.html#r0">_tempoSN</a>;
00135       }
00136 
00137 <span class="comment">//---------------------------------------------------------</span>
00138 <span class="comment">//   change</span>
00139 <span class="comment">//---------------------------------------------------------</span>
00140 
<a name="l00141"></a><a class="code" href="classTempoList.html#d2">00141</a> <span class="keywordtype">void</span> <a class="code" href="classTempoList.html#d2">TempoList::change</a>(<span class="keywordtype">int</span> tick, <span class="keywordtype">int</span> newTempo)
00142       {
00143       <a class="code" href="classpstl_1_1ipmap.html">iTEvent</a> e = find(tick);
00144       assert(e != <a class="code" href="classpstl_1_1ipmap.html#a2">end</a>());
00145       e-&gt;second-&gt;tempo = newTempo;
00146       <a class="code" href="classTempoList.html#d0">normalize</a>();
00147       ++<a class="code" href="classTempoList.html#r0">_tempoSN</a>;
00148       }
00149 
00150 <span class="comment">//---------------------------------------------------------</span>
00151 <span class="comment">//   setTempo</span>
00152 <span class="comment">//    called from transport window</span>
00153 <span class="comment">//    &amp; slave mode tempo changes</span>
00154 <span class="comment">//---------------------------------------------------------</span>
00155 
<a name="l00156"></a><a class="code" href="classTempoList.html#a12">00156</a> <span class="keywordtype">void</span> <a class="code" href="classTempoList.html#a12">TempoList::setTempo</a>(<span class="keywordtype">int</span> tick, <span class="keywordtype">int</span> newTempo)
00157       {
00158 <span class="comment">// printf("set tempo useList:%d %d, diff %3d\n", useList, newTempo, newTempo-_tempo);</span>
00159       <span class="keywordflow">if</span> (<a class="code" href="classTempoList.html#r1">useList</a>)
00160             <a class="code" href="classTempoList.html#d1">add</a>(tick, newTempo);
00161       <span class="keywordflow">else</span>
00162             <a class="code" href="classTempoList.html#r2">_tempo</a> = newTempo;
00163       ++<a class="code" href="classTempoList.html#r0">_tempoSN</a>;
00164       }
00165 
00166 <span class="comment">//---------------------------------------------------------</span>
00167 <span class="comment">//   setRelTempo</span>
00168 <span class="comment">//---------------------------------------------------------</span>
00169 
<a name="l00170"></a><a class="code" href="classTempoList.html#a19">00170</a> <span class="keywordtype">void</span> <a class="code" href="classTempoList.html#a19">TempoList::setRelTempo</a>(<span class="keywordtype">int</span> val)
00171       {
00172       <a class="code" href="classTempoList.html#r3">_relTempo</a> = val;
00173       ++<a class="code" href="classTempoList.html#r0">_tempoSN</a>;
00174       <a class="code" href="classTempoList.html#d0">normalize</a>();
00175       }
00176 
00177 <span class="comment">//---------------------------------------------------------</span>
00178 <span class="comment">//   addTempo</span>
00179 <span class="comment">//---------------------------------------------------------</span>
00180 
<a name="l00181"></a><a class="code" href="classTempoList.html#a13">00181</a> <span class="keywordtype">void</span> <a class="code" href="classTempoList.html#a13">TempoList::addTempo</a>(<span class="keywordtype">int</span> t, <span class="keywordtype">int</span> tempo)
00182       {
00183       <a class="code" href="classTempoList.html#d1">add</a>(t, tempo);
00184       ++<a class="code" href="classTempoList.html#r0">_tempoSN</a>;
00185       }
00186 
00187 <span class="comment">//---------------------------------------------------------</span>
00188 <span class="comment">//   delTempo</span>
00189 <span class="comment">//---------------------------------------------------------</span>
00190 
<a name="l00191"></a><a class="code" href="classTempoList.html#a14">00191</a> <span class="keywordtype">void</span> <a class="code" href="classTempoList.html#a14">TempoList::delTempo</a>(<span class="keywordtype">int</span> tick)
00192       {
00193       <a class="code" href="classTempoList.html#d3">del</a>(tick);
00194       ++<a class="code" href="classTempoList.html#r0">_tempoSN</a>;
00195       }
00196 
00197 <span class="comment">//---------------------------------------------------------</span>
00198 <span class="comment">//   changeTempo</span>
00199 <span class="comment">//---------------------------------------------------------</span>
00200 
<a name="l00201"></a><a class="code" href="classTempoList.html#a15">00201</a> <span class="keywordtype">void</span> <a class="code" href="classTempoList.html#a15">TempoList::changeTempo</a>(<span class="keywordtype">int</span> tick, <span class="keywordtype">int</span> newTempo)
00202       {
00203       <a class="code" href="classTempoList.html#d2">change</a>(tick, newTempo);
00204       ++<a class="code" href="classTempoList.html#r0">_tempoSN</a>;
00205       }
00206 
00207 <span class="comment">//---------------------------------------------------------</span>
00208 <span class="comment">//   setMasterFlag</span>
00209 <span class="comment">//---------------------------------------------------------</span>
00210 
<a name="l00211"></a><a class="code" href="classTempoList.html#a16">00211</a> <span class="keywordtype">bool</span> <a class="code" href="classTempoList.html#a16">TempoList::setMasterFlag</a>(<span class="keywordtype">int</span> <span class="comment">/*tick*/</span>, <span class="keywordtype">bool</span> val)
00212       {
00213       <span class="keywordflow">if</span> (<a class="code" href="classTempoList.html#r1">useList</a> != val) {
00214             <a class="code" href="classTempoList.html#r1">useList</a> = val;
00215             ++<a class="code" href="classTempoList.html#r0">_tempoSN</a>;
00216             <span class="keywordflow">return</span> <span class="keyword">true</span>;
00217             }
00218       <span class="keywordflow">return</span> <span class="keyword">false</span>;
00219       }
00220 
00221 <span class="comment">//---------------------------------------------------------</span>
00222 <span class="comment">//   tick2time</span>
00223 <span class="comment">//---------------------------------------------------------</span>
00224 
<a name="l00225"></a><a class="code" href="classTempoList.html#a8">00225</a> <span class="keywordtype">double</span> <a class="code" href="classTempoList.html#a6">TempoList::tick2time</a>(<span class="keywordtype">int</span> tick, <span class="keywordtype">double</span> time, <span class="keywordtype">int</span>* sn)<span class="keyword"> const</span>
00226 <span class="keyword">      </span>{
00227       <span class="keywordflow">return</span> (*sn == <a class="code" href="classTempoList.html#r0">_tempoSN</a>) ? time : <a class="code" href="classTempoList.html#a6">tick2time</a>(tick, sn);
00228       }
00229 
00230 <span class="comment">//---------------------------------------------------------</span>
00231 <span class="comment">//   time2tick</span>
00232 <span class="comment">//    return cached value t if list did not change</span>
00233 <span class="comment">//---------------------------------------------------------</span>
00234 
<a name="l00235"></a><a class="code" href="classTempoList.html#a10">00235</a> <span class="keywordtype">int</span> <a class="code" href="classTempoList.html#a9">TempoList::time2tick</a>(<span class="keywordtype">double</span> time, <span class="keywordtype">int</span> t, <span class="keywordtype">int</span>* sn)<span class="keyword"> const</span>
00236 <span class="keyword">      </span>{
00237       <span class="keywordflow">return</span> (*sn == <a class="code" href="classTempoList.html#r0">_tempoSN</a>) ? t : <a class="code" href="classTempoList.html#a9">time2tick</a>(time, sn);
00238       }
00239 
00240 <span class="comment">//---------------------------------------------------------</span>
00241 <span class="comment">//   tick2time</span>
00242 <span class="comment">//---------------------------------------------------------</span>
00243 
<a name="l00244"></a><a class="code" href="classTempoList.html#a6">00244</a> <span class="keywordtype">double</span> <a class="code" href="classTempoList.html#a6">TempoList::tick2time</a>(<span class="keywordtype">int</span> tick, <span class="keywordtype">int</span>* sn)<span class="keyword"> const</span>
00245 <span class="keyword">      </span>{
00246       <span class="keywordtype">double</span> t;
00247       <span class="keywordflow">if</span> (<a class="code" href="classTempoList.html#r1">useList</a>) {
00248             <a class="code" href="classpstl_1_1ipmap.html">ciTEvent</a> i = upper_bound(tick);
00249             <span class="keywordtype">int</span> delta = tick - i-&gt;second-&gt;tick;
00250             t = i-&gt;second-&gt;time + double(delta) / (<a class="code" href="mtime_8h.html#a0">division</a> * <a class="code" href="classTempoList.html#r3">_relTempo</a> * 10000.0 / i-&gt;second-&gt;tempo);
00251             }
00252       <span class="keywordflow">else</span>
00253             t = (double(tick) * double(<a class="code" href="classTempoList.html#r2">_tempo</a>)) / (double(<a class="code" href="mtime_8h.html#a0">division</a>) * <a class="code" href="classTempoList.html#r3">_relTempo</a> * 10000.0);
00254       <span class="keywordflow">if</span> (sn)
00255             *sn = <a class="code" href="classTempoList.html#r0">_tempoSN</a>;
00256       <span class="keywordflow">return</span> t;
00257       }
00258 
00259 <span class="comment">//---------------------------------------------------------</span>
00260 <span class="comment">//   time2tick</span>
00261 <span class="comment">//---------------------------------------------------------</span>
00262 
<a name="l00263"></a><a class="code" href="classTempoList.html#a9">00263</a> <span class="keywordtype">int</span> <a class="code" href="classTempoList.html#a9">TempoList::time2tick</a>(<span class="keywordtype">double</span> time, <span class="keywordtype">int</span>* sn)<span class="keyword"> const</span>
00264 <span class="keyword">      </span>{
00265       <span class="keywordtype">int</span> tick;
00266       <span class="keywordflow">if</span> (<a class="code" href="classTempoList.html#r1">useList</a>) {
00267             <a class="code" href="classpstl_1_1ipmap.html">ciTEvent</a> e;
00268             <span class="keywordflow">for</span> (e = <a class="code" href="classpstl_1_1ipmap.html#a1">begin</a>(); e != <a class="code" href="classpstl_1_1ipmap.html#a2">end</a>();) {
00269                   <a class="code" href="classpstl_1_1ipmap.html">ciTEvent</a> ee = e;
00270                   ++ee;
00271                   <span class="keywordflow">if</span> (ee == <a class="code" href="classpstl_1_1ipmap.html#a2">end</a>())
00272                         <span class="keywordflow">break</span>;
00273                   <span class="keywordflow">if</span> (time &lt; ee-&gt;second-&gt;time)
00274                         <span class="keywordflow">break</span>;
00275                   e = ee;
00276                   }
00277             <span class="keywordtype">int</span> te = e-&gt;second-&gt;tempo;
00278             <span class="keywordtype">double</span> dtime = time - e-&gt;second-&gt;time;
00279             tick = e-&gt;second-&gt;tick + lrint(dtime * <a class="code" href="classTempoList.html#r3">_relTempo</a> * <a class="code" href="mtime_8h.html#a0">division</a> * 10000.0 / te);
00280             }
00281       <span class="keywordflow">else</span>
00282             tick = lrint(time * <a class="code" href="classTempoList.html#r3">_relTempo</a> * <a class="code" href="mtime_8h.html#a0">division</a> * 10000.0 / <span class="keywordtype">double</span>(<a class="code" href="classTempoList.html#r2">_tempo</a>));
00283       <span class="keywordflow">if</span> (sn)
00284             *sn = <a class="code" href="classTempoList.html#r0">_tempoSN</a>;
00285       <span class="keywordflow">return</span> tick;
00286       }
00287 
00288 <span class="comment">//---------------------------------------------------------</span>
00289 <span class="comment">//   TempoList::write</span>
00290 <span class="comment">//---------------------------------------------------------</span>
00291 
<a name="l00292"></a><a class="code" href="classTempoList.html#a3">00292</a> <span class="keywordtype">void</span> <a class="code" href="classTempoList.html#a3">TempoList::write</a>(<a class="code" href="classXml.html">Xml</a>&amp; xml)<span class="keyword"> const</span>
00293 <span class="keyword">      </span>{
00294       xml.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"tempolist fix=\"%d\""</span>, <a class="code" href="classTempoList.html#r2">_tempo</a>);
00295       <span class="keywordflow">if</span> (<a class="code" href="classTempoList.html#r3">_relTempo</a> != 100)
00296             xml.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"relTempo"</span>, <a class="code" href="classTempoList.html#r3">_relTempo</a>);
00297       <span class="keywordflow">for</span> (<a class="code" href="classpstl_1_1ipmap.html">ciTEvent</a> i = <a class="code" href="classpstl_1_1ipmap.html#a1">begin</a>(); i != <a class="code" href="classpstl_1_1ipmap.html#a2">end</a>(); ++i)
00298             i-&gt;second-&gt;write(xml, i-&gt;first);
00299       xml.<a class="code" href="classXml.html#a9">etag</a>(<span class="stringliteral">"tempolist"</span>);
00300       }
00301 
00302 <span class="comment">//---------------------------------------------------------</span>
00303 <span class="comment">//   TempoList::read</span>
00304 <span class="comment">//---------------------------------------------------------</span>
00305 
<a name="l00306"></a><a class="code" href="classTempoList.html#a2">00306</a> <span class="keywordtype">void</span> <a class="code" href="classTempoList.html#a2">TempoList::read</a>(QDomNode node)
00307       {
00308       QDomElement e = node.toElement();
00309       <a class="code" href="classTempoList.html#r2">_tempo</a> = e.attribute(<span class="stringliteral">"fix"</span>,<span class="stringliteral">"500000"</span>).toInt();
00310 
00311       node = node.firstChild();
00312       <span class="keywordflow">while</span> (!node.isNull()) {
00313             e = node.toElement();
00314             <span class="keywordflow">if</span> (e.tagName() == <span class="stringliteral">"tempo"</span>) {
00315                   <a class="code" href="structTEvent.html">TEvent</a>* t = <span class="keyword">new</span> <a class="code" href="structTEvent.html">TEvent</a>();
00316                   <span class="keywordtype">unsigned</span> tick = t-&gt;<a class="code" href="structTEvent.html#a0">read</a>(node);
00317                   <a class="code" href="classpstl_1_1ipmap.html">iTEvent</a> pos = find(tick);
00318                   <span class="keywordflow">if</span> (pos != <a class="code" href="classpstl_1_1ipmap.html#a2">end</a>())
00319                         erase(pos);
00320                   insert(std::pair&lt;const int, TEvent*&gt; (tick, t));
00321                   }
00322             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (e.tagName() == <span class="stringliteral">"relTempo"</span>)
00323                   <a class="code" href="classTempoList.html#r3">_relTempo</a> = e.text().toInt();
00324             <span class="keywordflow">else</span>
00325                   printf(<span class="stringliteral">"MuseScore:Tempolist: unknown tag %s\n"</span>, e.tagName().latin1());
00326             node = node.nextSibling();
00327             }
00328       <a class="code" href="classTempoList.html#d0">normalize</a>();
00329       ++<a class="code" href="classTempoList.html#r0">_tempoSN</a>;
00330       }
00331 
00332 <span class="comment">//---------------------------------------------------------</span>
00333 <span class="comment">//   TEvent::write</span>
00334 <span class="comment">//---------------------------------------------------------</span>
00335 
<a name="l00336"></a><a class="code" href="structTEvent.html#a1">00336</a> <span class="keywordtype">void</span> <a class="code" href="structTEvent.html#a1">TEvent::write</a>(<a class="code" href="classXml.html">Xml</a>&amp; xml, <span class="keywordtype">int</span> at)<span class="keyword"> const</span>
00337 <span class="keyword">      </span>{
00338       xml.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"tempo at=\"%d\""</span>, at);
00339       xml.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"tick"</span>, <a class="code" href="structTEvent.html#o1">tick</a>);
00340       xml.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"val"</span>, <a class="code" href="structTEvent.html#o0">tempo</a>);
00341       xml.<a class="code" href="classXml.html#a9">etag</a>(<span class="stringliteral">"tempo"</span>);
00342       }
00343 
00344 <span class="comment">//---------------------------------------------------------</span>
00345 <span class="comment">//   TEvent::read</span>
00346 <span class="comment">//---------------------------------------------------------</span>
00347 
<a name="l00348"></a><a class="code" href="structTEvent.html#a0">00348</a> <span class="keywordtype">int</span> <a class="code" href="structTEvent.html#a0">TEvent::read</a>(QDomNode node)
00349       {
00350       QDomElement e = node.toElement();
00351       <span class="keywordtype">int</span> at = e.attribute(<span class="stringliteral">"tick"</span>, <span class="stringliteral">"0"</span>).toInt();
00352 
00353       node = node.firstChild();
00354       <span class="keywordflow">while</span> (!node.isNull()) {
00355             QDomElement e = node.toElement();
00356             QString tag(e.tagName());
00357             QString val(e.text());
00358             <span class="keywordtype">int</span> i = val.toInt();
00359             <span class="keywordflow">if</span> (tag == <span class="stringliteral">"tick"</span>)
00360                   <a class="code" href="structTEvent.html#o1">tick</a> = i;
00361             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tag == <span class="stringliteral">"val"</span>)
00362                   <a class="code" href="structTEvent.html#o0">tempo</a> = i;
00363             <span class="keywordflow">else</span>
00364                   printf(<span class="stringliteral">"Mscore:TEvent: unknown tag %s\n"</span>,
00365                      tag.latin1());
00366             node = node.nextSibling();
00367             }
00368       <span class="keywordflow">return</span> at;
00369       }
00370 
00371 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Mon Jun 27 22:28:30 2005 for MuseScore by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
