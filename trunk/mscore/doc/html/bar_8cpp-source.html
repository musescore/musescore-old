<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>MuseScore: bar.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>bar.cpp</h1><a href="bar_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">//=========================================================</span>
00002 <span class="comment">//  MuseScore</span>
00003 <span class="comment">//  Linux Music Score Editor</span>
00004 <span class="comment">//  $Id: bar.cpp,v 1.12 2005/06/20 13:54:53 wschweer Exp $</span>
00005 <span class="comment">//</span>
00006 <span class="comment">//  (C) Copyright 2002-2004 Werner Schweer (ws@seh.de)</span>
00007 <span class="comment">//=========================================================</span>
00008 
00009 <span class="preprocessor">#include "<a class="code" href="xml_8h.html">xml.h</a>"</span>
00010 <span class="preprocessor">#include "<a class="code" href="bar_8h.html">bar.h</a>"</span>
00011 <span class="preprocessor">#include "<a class="code" href="preferences_8h.html">preferences.h</a>"</span>
00012 <span class="preprocessor">#include "<a class="code" href="painter_8h.html">painter.h</a>"</span>
00013 <span class="preprocessor">#include "<a class="code" href="style_8h.html">style.h</a>"</span>
00014 
00015 <span class="comment">//---------------------------------------------------------</span>
00016 <span class="comment">//   Bar</span>
00017 <span class="comment">//---------------------------------------------------------</span>
00018 
<a name="l00019"></a><a class="code" href="classBar.html#a0">00019</a> <a class="code" href="classBar.html#a0">Bar::Bar</a>(<a class="code" href="classScore.html">Score</a>* s)
00020    : <a class="code" href="classElement.html">Element</a>(s, <a class="code" href="element_8h.html#a65a13">BAR</a>)
00021       {
00022       <a class="code" href="classBar.html#r0">_barType</a> = <a class="code" href="classBar.html#w7w0">NORMAL_BAR</a>;
00023       _bbox.setWidth(point(<a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o6">barWidth</a>));
00024       }
00025 
<a name="l00026"></a><a class="code" href="classBar.html#a1">00026</a> <a class="code" href="classBar.html#a0">Bar::Bar</a>(<span class="keyword">const</span> <a class="code" href="classBar.html">Bar</a>&amp; b)
00027    : <a class="code" href="classElement.html">Element</a>(b)
00028       {
00029       <a class="code" href="classBar.html#r0">_barType</a> = b.<a class="code" href="classBar.html#r0">_barType</a>;
00030       }
00031 
00032 <span class="comment">//---------------------------------------------------------</span>
00033 <span class="comment">//   draw</span>
00034 <span class="comment">//---------------------------------------------------------</span>
00035 
<a name="l00036"></a><a class="code" href="classBar.html#a7">00036</a> <span class="keywordtype">void</span> <a class="code" href="classBar.html#a7">Bar::draw1</a>(<a class="code" href="classPainter.html">Painter</a>&amp; p)<span class="keyword"> const</span>
00037 <span class="keyword">      </span>{
00038       qreal lw    = point(<a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o6">barWidth</a>);
00039       qreal h     = _bbox.height();
00040       QPointF ipos(0, 0);
00041       qreal x     = ipos.x();
00042       qreal y     = ipos.y();
00043 
00044       QColor <a class="code" href="classElement.html#a79">color</a>(<a class="code" href="classElement.html#a14">isSelected</a>() ? <a class="code" href="preferences_8cpp.html#a0">preferences</a>.<a class="code" href="structPreferences.html#o9">selectColor</a>[0] : Qt::black);
00045 
00046       <span class="keywordtype">bool</span> split = _bbox.height() &gt; (<a class="code" href="spatium_8h.html#a0">_spatium</a> * 4.01);
00047 
00048       QPen pen(color);
00049       pen.setWidthF(lw);
00050       p.setPen(pen);
00051 
00052       <span class="keywordflow">switch</span>(<a class="code" href="classBar.html#r0">_barType</a>) {
00053             <span class="keywordflow">case</span> <a class="code" href="classBar.html#w7w4">BROKEN_BAR</a>:
00054             <span class="keywordflow">case</span> <a class="code" href="classBar.html#w7w0">NORMAL_BAR</a>:
00055                   p.drawLine(QLineF(x + lw/2, y, x + lw/2, y + h));
00056                   <span class="keywordflow">break</span>;
00057 
00058             <span class="keywordflow">case</span> <a class="code" href="classBar.html#w7w5">END_BAR</a>:
00059                   {
00060                   qreal lw2 = point(<a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o8">endBarWidth</a>);
00061                   qreal d   = point(<a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o10">endBarDistance</a>);
00062 
00063                   p.drawLine(QLineF(x + lw/2, y, x + lw/2, y + h));
00064                   pen.setWidthF(lw2);
00065                   p.setPen(pen);
00066                   x += d + lw2/2 + lw + 1;
00067                   p.drawLine(QLineF(x, y, x, y + h));
00068                   }
00069                   <span class="keywordflow">break</span>;
00070             <span class="keywordflow">case</span> <a class="code" href="classBar.html#w7w1">DOUBLE_BAR</a>:
00071                   {
00072                   qreal lw2 = point(<a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o7">doubleBarWidth</a>);
00073                   qreal d   = point(<a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o9">doubleBarDistance</a>);
00074 
00075                   pen.setWidthF(lw2);
00076                   p.setPen(pen);
00077                   x += lw2/2;
00078                   p.drawLine(QLineF(x, y, x, y + h));
00079                   x += d + lw2;
00080                   p.drawLine(QLineF(x, y, x, y + h));
00081                   }
00082                   <span class="keywordflow">break</span>;
00083 
00084             <span class="keywordflow">case</span> <a class="code" href="classBar.html#w7w2">START_REPEAT</a>:
00085                   {
00086                   qreal lw2  = point(<a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o8">endBarWidth</a>);
00087                   qreal lw22 = point(<a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o8">endBarWidth</a>) / 2.0;
00088                   qreal d1   = point(<a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o10">endBarDistance</a>);
00089                   qreal dotw = <a class="code" href="symbols_8cpp.html#a31">dotSym</a>.<a class="code" href="structSym.html#a4">width</a>();
00090                   qreal x2   =  x + dotw/2;
00091                   qreal x1   =  x + dotw + d1 + lw/2;
00092                   qreal x0   =  x + dotw + d1 + lw + d1 + lw22;
00093 
00094                   <a class="code" href="symbols_8cpp.html#a31">dotSym</a>.<a class="code" href="structSym.html#a7">draw</a>(p, x0, y + 1.5 * <a class="code" href="spatium_8h.html#a0">_spatium</a>);
00095                   <a class="code" href="symbols_8cpp.html#a31">dotSym</a>.<a class="code" href="structSym.html#a7">draw</a>(p, x0, y + 2.5 * <a class="code" href="spatium_8h.html#a0">_spatium</a>);
00096                   <span class="keywordflow">if</span> (split) {
00097                         <a class="code" href="symbols_8cpp.html#a31">dotSym</a>.<a class="code" href="structSym.html#a7">draw</a>(p, x0, y + h - 1.5 * <a class="code" href="spatium_8h.html#a0">_spatium</a>);
00098                         <a class="code" href="symbols_8cpp.html#a31">dotSym</a>.<a class="code" href="structSym.html#a7">draw</a>(p, x0, y + h - 2.5 * <a class="code" href="spatium_8h.html#a0">_spatium</a>);
00099                         }
00100 
00101                   p.drawLine(QLineF(x1, y, x1, y + h));
00102                   pen.setWidthF(lw2);
00103                   p.setPen(pen);
00104                   p.drawLine(QLineF(x2, y, x2, y + h));
00105                   }
00106                   <span class="keywordflow">break</span>;
00107 
00108             <span class="keywordflow">case</span> <a class="code" href="classBar.html#w7w3">END_REPEAT</a>:
00109                   {
00110                   qreal lw2  = point(<a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o8">endBarWidth</a>);
00111                   qreal lw22 = point(<a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o8">endBarWidth</a>) / 2.0;
00112                   qreal d1   = point(<a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o10">endBarDistance</a>);
00113 
00114                   qreal dotw = <a class="code" href="symbols_8cpp.html#a31">dotSym</a>.<a class="code" href="structSym.html#a4">width</a>();
00115                   qreal x0   =  x + dotw/2;
00116                   qreal x1   =  x + dotw + d1 + lw/2;
00117                   qreal x2   =  x + dotw + d1 + lw + d1 + lw22;
00118 
00119                   <a class="code" href="symbols_8cpp.html#a31">dotSym</a>.<a class="code" href="structSym.html#a7">draw</a>(p, x0, y + 1.5 * <a class="code" href="spatium_8h.html#a0">_spatium</a>);
00120                   <a class="code" href="symbols_8cpp.html#a31">dotSym</a>.<a class="code" href="structSym.html#a7">draw</a>(p, x0, y + 2.5 * <a class="code" href="spatium_8h.html#a0">_spatium</a>);
00121                   <span class="keywordflow">if</span> (split) {
00122                         <a class="code" href="symbols_8cpp.html#a31">dotSym</a>.<a class="code" href="structSym.html#a7">draw</a>(p, x0, y + h - 1.5 * <a class="code" href="spatium_8h.html#a0">_spatium</a>);
00123                         <a class="code" href="symbols_8cpp.html#a31">dotSym</a>.<a class="code" href="structSym.html#a7">draw</a>(p, x0, y + h - 2.5 * <a class="code" href="spatium_8h.html#a0">_spatium</a>);
00124                         }
00125 
00126                   p.drawLine(QLineF(x1, y, x1, y + h));
00127 
00128                   pen.setWidthF(lw2);
00129                   p.setPen(pen);
00130                   p.drawLine(QLineF(x2, y, x2, y + h));
00131                   }
00132                   <span class="keywordflow">break</span>;
00133 
00134             <span class="keywordflow">case</span> <a class="code" href="classBar.html#w7w6">INVISIBLE_BAR</a>:
00135                   <span class="keywordflow">break</span>;
00136             }
00137       }
00138 
00139 <span class="comment">//---------------------------------------------------------</span>
00140 <span class="comment">//   Bar::write</span>
00141 <span class="comment">//---------------------------------------------------------</span>
00142 
<a name="l00143"></a><a class="code" href="classBar.html#a5">00143</a> <span class="keywordtype">void</span> <a class="code" href="classBar.html#a5">Bar::write</a>(<a class="code" href="classXml.html">Xml</a>&amp; xml)<span class="keyword"> const</span>
00144 <span class="keyword">      </span>{
00145       <span class="keywordflow">if</span> (<a class="code" href="classBar.html#r0">_barType</a> == <a class="code" href="classBar.html#w7w0">NORMAL_BAR</a>)
00146             xml.<a class="code" href="classXml.html#a10">tagE</a>(<span class="stringliteral">"Bar"</span>);
00147       <span class="keywordflow">else</span>
00148             xml.<a class="code" href="classXml.html#a10">tagE</a>(<span class="stringliteral">"Bar type=\"%d\""</span>, <a class="code" href="classBar.html#r0">_barType</a>);
00149       }
00150 
00151 <span class="comment">//---------------------------------------------------------</span>
00152 <span class="comment">//   Bar::read</span>
00153 <span class="comment">//---------------------------------------------------------</span>
00154 
<a name="l00155"></a><a class="code" href="classBar.html#a6">00155</a> <span class="keywordtype">void</span> <a class="code" href="classBar.html#a6">Bar::read</a>(QDomNode node)
00156       {
00157       QDomElement e = node.toElement();
00158       <a class="code" href="classBar.html#a2">setBarType</a>(<a class="code" href="classBar.html#w7">BarType</a>(e.attribute(<span class="stringliteral">"type"</span>, <span class="stringliteral">"0"</span>).toInt()));
00159       }
00160 
00161 <span class="comment">//---------------------------------------------------------</span>
00162 <span class="comment">//   dump</span>
00163 <span class="comment">//---------------------------------------------------------</span>
00164 
<a name="l00165"></a><a class="code" href="classBar.html#a8">00165</a> <span class="keywordtype">void</span> <a class="code" href="classBar.html#a8">Bar::dump</a>()<span class="keyword"> const</span>
00166 <span class="keyword">      </span>{
00167       <a class="code" href="classElement.html#a68">Element::dump</a>();
00168       }
00169 
00170 <span class="comment">//---------------------------------------------------------</span>
00171 <span class="comment">//   setBarType</span>
00172 <span class="comment">//---------------------------------------------------------</span>
00173 
<a name="l00174"></a><a class="code" href="classBar.html#a2">00174</a> <span class="keywordtype">void</span> <a class="code" href="classBar.html#a2">Bar::setBarType</a>(BarType t)
00175       {
00176       <a class="code" href="classBar.html#r0">_barType</a> = t;
00177       <a class="code" href="classSpatium.html">Spatium</a> w = <a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o6">barWidth</a>;
00178       <span class="keywordtype">double</span> dw = point(w);
00179 
00180       <span class="keywordflow">switch</span>(<a class="code" href="classBar.html#r0">_barType</a>) {
00181             <span class="keywordflow">case</span> <a class="code" href="classBar.html#w7w1">DOUBLE_BAR</a>:
00182                   w = <a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o7">doubleBarWidth</a> * 2 + <a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o9">doubleBarDistance</a>;
00183                   dw = point(w);
00184                   <span class="keywordflow">break</span>;
00185             <span class="keywordflow">case</span> <a class="code" href="classBar.html#w7w2">START_REPEAT</a>:
00186             <span class="keywordflow">case</span> <a class="code" href="classBar.html#w7w3">END_REPEAT</a>:
00187                   w  += <a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o8">endBarWidth</a> + 2 * <a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o10">endBarDistance</a>;
00188                   dw = point(w) + <a class="code" href="symbols_8cpp.html#a31">dotSym</a>.<a class="code" href="structSym.html#a4">width</a>();
00189                   <span class="keywordflow">break</span>;
00190             <span class="keywordflow">case</span> <a class="code" href="classBar.html#w7w5">END_BAR</a>:
00191                   w += <a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o8">endBarWidth</a> + <a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o10">endBarDistance</a>;
00192                   dw = point(w);
00193                   <span class="keywordflow">break</span>;
00194             <span class="keywordflow">case</span> <a class="code" href="classBar.html#w7w4">BROKEN_BAR</a>:
00195             <span class="keywordflow">case</span> <a class="code" href="classBar.html#w7w0">NORMAL_BAR</a>:
00196             <span class="keywordflow">case</span> <a class="code" href="classBar.html#w7w6">INVISIBLE_BAR</a>:
00197                   <span class="keywordflow">break</span>;
00198             }
00199       _bbox.setWidth(dw);
00200       }
00201 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Mon Jun 27 22:28:28 2005 for MuseScore by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
