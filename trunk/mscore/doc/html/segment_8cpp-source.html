<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>MuseScore: segment.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>segment.cpp</h1><a href="segment_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">//=========================================================</span>
00002 <span class="comment">//  MuseScore</span>
00003 <span class="comment">//  Linux Music Score Editor</span>
00004 <span class="comment">//  $Id: segment.cpp,v 1.18 2005/06/20 13:54:54 wschweer Exp $</span>
00005 <span class="comment">//</span>
00006 <span class="comment">//  (C) Copyright 2002-2004 Werner Schweer (ws@seh.de)</span>
00007 <span class="comment">//=========================================================</span>
00008 
00009 <span class="preprocessor">#include "<a class="code" href="globals_8h.html">globals.h</a>"</span>
00010 <span class="preprocessor">#include "<a class="code" href="segment_8h.html">segment.h</a>"</span>
00011 <span class="preprocessor">#include "<a class="code" href="element_8h.html">element.h</a>"</span>
00012 <span class="preprocessor">#include "<a class="code" href="note_8h.html">note.h</a>"</span>
00013 <span class="preprocessor">#include "<a class="code" href="project_8h.html">project.h</a>"</span>
00014 <span class="preprocessor">#include "<a class="code" href="beam_8h.html">beam.h</a>"</span>
00015 <span class="preprocessor">#include "<a class="code" href="tuplet_8h.html">tuplet.h</a>"</span>
00016 <span class="preprocessor">#include "<a class="code" href="text_8h.html">text.h</a>"</span>
00017 <span class="preprocessor">#include "<a class="code" href="measure_8h.html">measure.h</a>"</span>
00018 <span class="preprocessor">#include "<a class="code" href="painter_8h.html">painter.h</a>"</span>
00019 
00020 <span class="comment">//---------------------------------------------------------</span>
00021 <span class="comment">//   segment</span>
00022 <span class="comment">//---------------------------------------------------------</span>
00023 
<a name="l00024"></a><a class="code" href="classSegment.html#a1">00024</a> <a class="code" href="classSegment.html#a0">Segment::Segment</a>(<span class="keyword">const</span> <a class="code" href="classSegment.html">Segment</a>&amp; s)
00025    : <a class="code" href="classElement.html">Element</a>(s)
00026       {
00027       printf(<span class="stringliteral">"gibts nicht\n"</span>);
00028       }
00029 
00030 <span class="comment">//---------------------------------------------------------</span>
00031 <span class="comment">//   setElement</span>
00032 <span class="comment">//---------------------------------------------------------</span>
00033 
<a name="l00034"></a><a class="code" href="classSegment.html#a10">00034</a> <span class="keywordtype">void</span> <a class="code" href="classSegment.html#a10">Segment::setElement</a>(<span class="keywordtype">int</span> track, <a class="code" href="classElement.html">Element</a>* el)
00035       {
00036       <span class="keywordflow">if</span> (el)
00037             el-&gt;<a class="code" href="classElement.html#a11">setParent</a>(<span class="keyword">this</span>);
00038       <a class="code" href="classSegment.html#r1">_elist</a>[track] = el;
00039       }
00040 
00041 <span class="comment">//---------------------------------------------------------</span>
00042 <span class="comment">//   setLyrics</span>
00043 <span class="comment">//---------------------------------------------------------</span>
00044 
<a name="l00045"></a><a class="code" href="classSegment.html#a13">00045</a> <span class="keywordtype">void</span> <a class="code" href="classSegment.html#a13">Segment::setLyrics</a>(<span class="keywordtype">int</span> staff, <a class="code" href="classLyrics.html">Lyrics</a>* l)
00046       {
00047       <span class="keywordtype">int</span> idx = l-&gt;<a class="code" href="classLyrics.html#a6">no</a>();
00048       <span class="keywordtype">int</span> n = <a class="code" href="classSegment.html#r2">_lyrics</a>[staff].size();
00049       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = n; i &lt;= idx; ++i)
00050             _lyrics[staff].push_back(0);
00051       _lyrics[staff][idx] = l;
00052       }
00053 
00054 <span class="comment">//---------------------------------------------------------</span>
00055 <span class="comment">//   remove</span>
00056 <span class="comment">//---------------------------------------------------------</span>
00057 
<a name="l00058"></a><a class="code" href="classSegment.html#a9">00058</a> <span class="keywordtype">void</span> <a class="code" href="classSegment.html#a9">Segment::removeElement</a>(<span class="keywordtype">int</span> track)
00059       {
00060       <a class="code" href="classElement.html">Element</a>* el = <a class="code" href="classSegment.html#a8">element</a>(track);
00061       <span class="keywordflow">if</span> (el-&gt;<a class="code" href="classElement.html#a42">isChordRest</a>()) {
00062             <a class="code" href="classChordRest.html">ChordRest</a>* cr = (<a class="code" href="classChordRest.html">ChordRest</a>*)el;
00063             <a class="code" href="classBeam.html">Beam</a>* beam = cr-&gt;<a class="code" href="classChordRest.html#a8">beam</a>();
00064             <span class="keywordflow">if</span> (beam)
00065                   beam-&gt;<a class="code" href="classBeam.html#a6">remove</a>(cr);
00066             <a class="code" href="classTuplet.html">Tuplet</a>* tuplet = cr-&gt;<a class="code" href="classChordRest.html#a10">tuplet</a>();
00067             <span class="keywordflow">if</span> (tuplet)
00068                   tuplet-&gt;<a class="code" href="classTuplet.html#a10">remove</a>(cr);
00069             }
00070       }
00071 
00072 <span class="comment">//---------------------------------------------------------</span>
00073 <span class="comment">//   Segment</span>
00074 <span class="comment">//---------------------------------------------------------</span>
00075 
<a name="l00076"></a><a class="code" href="classSegment.html#a0">00076</a> <a class="code" href="classSegment.html#a0">Segment::Segment</a>(<a class="code" href="classMeasure.html">Measure</a>* m)
00077    : <a class="code" href="classElement.html">Element</a>(m-&gt;score(), <a class="code" href="element_8h.html#a65a44">SEGMENT</a>)
00078       {
00079       setParent(m);
00080       <a class="code" href="classSegment.html#d0">init</a>();
00081       }
00082 
<a name="l00083"></a><a class="code" href="classSegment.html#a3">00083</a> <a class="code" href="classSegment.html#a0">Segment::Segment</a>(<a class="code" href="classMeasure.html">Measure</a>* m, <span class="keywordtype">int</span> t)
00084    : <a class="code" href="classElement.html">Element</a>(m-&gt;score(), <a class="code" href="element_8h.html#a65a44">SEGMENT</a>)
00085       {
00086       setParent(m);
00087       setTick(t);
00088       <a class="code" href="classSegment.html#d0">init</a>();
00089       }
00090 
00091 <span class="comment">//---------------------------------------------------------</span>
00092 <span class="comment">//   init</span>
00093 <span class="comment">//---------------------------------------------------------</span>
00094 
<a name="l00095"></a><a class="code" href="classSegment.html#d0">00095</a> <span class="keywordtype">void</span> <a class="code" href="classSegment.html#d0">Segment::init</a>()
00096       {
00097       <span class="keywordtype">int</span> staves = <a class="code" href="classSegment.html#a14">measure</a>()-&gt;<a class="code" href="classElement.html#a4">score</a>()-&gt;<a class="code" href="classScore.html#a6">nstaves</a>();
00098       <span class="keywordtype">int</span> tracks = staves * <a class="code" href="globals_8h.html#a3">VOICES</a>;
00099       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; tracks; ++i)
00100             <a class="code" href="classSegment.html#r1">_elist</a>.push_back(0);
00101       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; staves; ++i)
00102             <a class="code" href="classSegment.html#r2">_lyrics</a>.push_back(<a class="code" href="segment_8h.html#a0">LyricsList</a>());
00103       }
00104 
00105 <span class="comment">//---------------------------------------------------------</span>
00106 <span class="comment">//   next1</span>
00107 <span class="comment">//---------------------------------------------------------</span>
00108 
<a name="l00109"></a><a class="code" href="classSegment.html#a6">00109</a> <a class="code" href="classSegment.html">Segment</a>* <a class="code" href="classSegment.html#a6">Segment::next1</a>()<span class="keyword"> const</span>
00110 <span class="keyword">      </span>{
00111       <span class="keywordflow">if</span> (<a class="code" href="classSegment.html#a4">next</a>())
00112             <span class="keywordflow">return</span> <a class="code" href="classSegment.html#a4">next</a>();
00113       <a class="code" href="classMeasure.html">Measure</a>* m = <a class="code" href="classSegment.html#a14">measure</a>()-&gt;<a class="code" href="classMeasure.html#a64">next</a>();
00114       <span class="keywordflow">if</span> (m)
00115             <span class="keywordflow">return</span> m-&gt;<a class="code" href="classMeasure.html#a28">first</a>();
00116       <span class="keywordflow">return</span> 0;
00117       }
00118 
00119 <span class="comment">//---------------------------------------------------------</span>
00120 <span class="comment">//   prev1</span>
00121 <span class="comment">//---------------------------------------------------------</span>
00122 
<a name="l00123"></a><a class="code" href="classSegment.html#a7">00123</a> <a class="code" href="classSegment.html">Segment</a>* <a class="code" href="classSegment.html#a7">Segment::prev1</a>()<span class="keyword"> const</span>
00124 <span class="keyword">      </span>{
00125       <span class="keywordflow">if</span> (<a class="code" href="classSegment.html#a5">prev</a>())
00126             <span class="keywordflow">return</span> <a class="code" href="classSegment.html#a5">prev</a>();
00127       <a class="code" href="classMeasure.html">Measure</a>* m = <a class="code" href="classSegment.html#a14">measure</a>()-&gt;<a class="code" href="classMeasure.html#a65">prev</a>();
00128       <span class="keywordflow">if</span> (m)
00129             <span class="keywordflow">return</span> m-&gt;<a class="code" href="classMeasure.html#a29">last</a>();
00130       <span class="keywordflow">return</span> 0;
00131       }
00132 
00133 <span class="comment">//---------------------------------------------------------</span>
00134 <span class="comment">//   insertStaff</span>
00135 <span class="comment">//---------------------------------------------------------</span>
00136 
<a name="l00137"></a><a class="code" href="classSegment.html#a20">00137</a> <span class="keywordtype">void</span> <a class="code" href="classSegment.html#a20">Segment::insertStaff</a>(<span class="keywordtype">int</span> staff)
00138       {
00139       <span class="keywordtype">int</span> track = staff * <a class="code" href="globals_8h.html#a3">VOICES</a>;
00140       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> voice = 0; voice &lt; <a class="code" href="globals_8h.html#a3">VOICES</a>; ++voice)
00141             <a class="code" href="classSegment.html#r1">_elist</a>.insert(<a class="code" href="classSegment.html#r1">_elist</a>.begin() + track, 0);
00142       <a class="code" href="classSegment.html#r2">_lyrics</a>.insert(<a class="code" href="classSegment.html#r2">_lyrics</a>.begin() + staff, <a class="code" href="segment_8h.html#a0">LyricsList</a>());
00143       }
00144 
00145 <span class="comment">//---------------------------------------------------------</span>
00146 <span class="comment">//   removeStaff</span>
00147 <span class="comment">//---------------------------------------------------------</span>
00148 
<a name="l00149"></a><a class="code" href="classSegment.html#a21">00149</a> <span class="keywordtype">void</span> <a class="code" href="classSegment.html#a21">Segment::removeStaff</a>(<span class="keywordtype">int</span> staff)
00150       {
00151       <span class="keywordtype">int</span> track = staff * <a class="code" href="globals_8h.html#a3">VOICES</a>;
00152       <a class="code" href="classSegment.html#r1">_elist</a>.erase(<a class="code" href="classSegment.html#r1">_elist</a>.begin() + track, <a class="code" href="classSegment.html#r1">_elist</a>.begin() + track + <a class="code" href="globals_8h.html#a3">VOICES</a>);
00153       <a class="code" href="classSegment.html#r2">_lyrics</a>.erase(<a class="code" href="classSegment.html#r2">_lyrics</a>.begin() + staff);
00154       }
00155 
00156 <span class="comment">//---------------------------------------------------------</span>
00157 <span class="comment">//   draw</span>
00158 <span class="comment">//---------------------------------------------------------</span>
00159 
<a name="l00160"></a><a class="code" href="classSegment.html#a24">00160</a> <span class="keywordtype">void</span> <a class="code" href="classSegment.html#a24">Segment::draw</a>(<a class="code" href="classPainter.html">Painter</a>&amp; p)<span class="keyword"> const</span>
00161 <span class="keyword">      </span>{
00162       p.translate(<a class="code" href="classElement.html#a20">pos</a>());
00163 
00164       <span class="keywordtype">int</span> staves = <a class="code" href="classSegment.html#a14">measure</a>()-&gt;<a class="code" href="classElement.html#a4">score</a>()-&gt;<a class="code" href="classScore.html#a6">nstaves</a>();
00165       <span class="keywordtype">int</span> tracks = staves * <a class="code" href="globals_8h.html#a3">VOICES</a>;
00166       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> track = 0; track &lt; tracks; ++track) {
00167             <a class="code" href="classElement.html">Element</a>* e = <a class="code" href="classSegment.html#r1">_elist</a>[track];
00168             <span class="keywordflow">if</span> (e)
00169                   e-&gt;<a class="code" href="classElement.html#a43">draw</a>(p);
00170             }
00171       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> staff = 0; staff &lt; staves; ++staff) {
00172             <span class="keyword">const</span> <a class="code" href="segment_8h.html#a0">LyricsList</a>* ll = <a class="code" href="classSegment.html#a11">lyricsList</a>(staff);
00173             <span class="keywordflow">for</span> (<a class="code" href="segment_8h.html#a2">ciLyrics</a> i = ll-&gt;begin(); i != ll-&gt;end(); ++i) {
00174                   <span class="keywordflow">if</span> (*i)
00175                         (*i)-&gt;draw(p);
00176                   }
00177             }
00178       p.translate(-<a class="code" href="classElement.html#a20">pos</a>());
00179       }
00180 
00181 <span class="comment">//---------------------------------------------------------</span>
00182 <span class="comment">//   add</span>
00183 <span class="comment">//---------------------------------------------------------</span>
00184 
<a name="l00185"></a><a class="code" href="classSegment.html#a22">00185</a> <span class="keywordtype">void</span> <a class="code" href="classSegment.html#a22">Segment::add</a>(<a class="code" href="classElement.html">Element</a>* el)
00186       {
00187       el-&gt;<a class="code" href="classElement.html#a11">setParent</a>(<span class="keyword">this</span>);
00188       <span class="keywordtype">int</span> staffIdx = <a class="code" href="classSegment.html#a14">measure</a>()-&gt;<a class="code" href="classElement.html#a4">score</a>()-&gt;<a class="code" href="classScore.html#a7">staff</a>(el-&gt;<a class="code" href="classElement.html#a59">staff</a>());
00189       <span class="keywordflow">if</span> (el-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a35">LYRICS</a>) {
00190             <a class="code" href="segment_8h.html#a0">LyricsList</a>* ll = &amp;<a class="code" href="classSegment.html#r2">_lyrics</a>[staffIdx];
00191             ll-&gt;push_back((<a class="code" href="classLyrics.html">Lyrics</a>*)el);
00192             <span class="keywordflow">return</span>;
00193             }
00194       <a class="code" href="classSegment.html#r1">_elist</a>[staffIdx * <a class="code" href="globals_8h.html#a3">VOICES</a> + el-&gt;<a class="code" href="classElement.html#a62">voice</a>()] = el;
00195       }
00196 
00197 <span class="comment">//---------------------------------------------------------</span>
00198 <span class="comment">//   remove</span>
00199 <span class="comment">//---------------------------------------------------------</span>
00200 
<a name="l00201"></a><a class="code" href="classSegment.html#a23">00201</a> <span class="keywordtype">void</span> <a class="code" href="classSegment.html#a23">Segment::remove</a>(<a class="code" href="classElement.html">Element</a>* el)
00202       {
00203       <span class="keywordtype">int</span> staffIdx = <a class="code" href="classSegment.html#a14">measure</a>()-&gt;<a class="code" href="classElement.html#a4">score</a>()-&gt;<a class="code" href="classScore.html#a7">staff</a>(el-&gt;<a class="code" href="classElement.html#a59">staff</a>());
00204       <span class="keywordflow">if</span> (el-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a35">LYRICS</a>) {
00205             <a class="code" href="segment_8h.html#a0">LyricsList</a>* ll = &amp;<a class="code" href="classSegment.html#r2">_lyrics</a>[staffIdx];
00206             <span class="keywordflow">for</span> (<a class="code" href="segment_8h.html#a1">iLyrics</a> il = ll-&gt;begin(); il != ll-&gt;end(); ++il) {
00207                   <span class="keywordflow">if</span> ((*il) == el) {
00208                         ll-&gt;erase(il);
00209                         <span class="keywordflow">return</span>;
00210                         }
00211                   }
00212             printf(<span class="stringliteral">"Measure::remove: %s %p not found\n"</span>, el-&gt;<a class="code" href="classElement.html#a69">name</a>(), el);
00213             <span class="keywordflow">return</span>;
00214             }
00215       <a class="code" href="classSegment.html#r1">_elist</a>[staffIdx * <a class="code" href="globals_8h.html#a3">VOICES</a> + el-&gt;<a class="code" href="classElement.html#a62">voice</a>()] = 0;
00216       }
00217 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Mon Jun 27 22:28:29 2005 for MuseScore by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
