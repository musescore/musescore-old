<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>MuseScore: system.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>system.cpp</h1><a href="system_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">//=========================================================</span>
00002 <span class="comment">//  MuseScore</span>
00003 <span class="comment">//  Linux Music Score Editor</span>
00004 <span class="comment">//  $Id: system.cpp,v 1.20 2005/06/27 19:50:39 wschweer Exp $</span>
00005 <span class="comment">//</span>
00006 <span class="comment">//  (C) Copyright 2002-2004 Werner Schweer (ws@seh.de)</span>
00007 <span class="comment">//=========================================================</span>
00008 
00009 <span class="preprocessor">#include "<a class="code" href="system_8h.html">system.h</a>"</span>
00010 <span class="preprocessor">#include "<a class="code" href="measure_8h.html">measure.h</a>"</span>
00011 <span class="preprocessor">#include "<a class="code" href="segment_8h.html">segment.h</a>"</span>
00012 <span class="preprocessor">#include "<a class="code" href="project_8h.html">project.h</a>"</span>
00013 <span class="preprocessor">#include "<a class="code" href="sig_8h.html">sig.h</a>"</span>
00014 <span class="preprocessor">#include "<a class="code" href="key_8h.html">key.h</a>"</span>
00015 <span class="preprocessor">#include "<a class="code" href="xml_8h.html">xml.h</a>"</span>
00016 <span class="preprocessor">#include "<a class="code" href="clef_8h.html">clef.h</a>"</span>
00017 <span class="preprocessor">#include "<a class="code" href="text_8h.html">text.h</a>"</span>
00018 <span class="preprocessor">#include "<a class="code" href="navigate_8h.html">navigate.h</a>"</span>
00019 <span class="preprocessor">#include "<a class="code" href="select_8h.html">select.h</a>"</span>
00020 <span class="preprocessor">#include "<a class="code" href="staff_8h.html">staff.h</a>"</span>
00021 <span class="preprocessor">#include "<a class="code" href="part_8h.html">part.h</a>"</span>
00022 <span class="preprocessor">#include "<a class="code" href="page_8h.html">page.h</a>"</span>
00023 <span class="preprocessor">#include "<a class="code" href="painter_8h.html">painter.h</a>"</span>
00024 <span class="preprocessor">#include "<a class="code" href="style_8h.html">style.h</a>"</span>
00025 
00026 <span class="comment">//---------------------------------------------------------</span>
00027 <span class="comment">//   SysStaff</span>
00028 <span class="comment">//---------------------------------------------------------</span>
00029 
<a name="l00030"></a><a class="code" href="classSysStaff.html#a5">00030</a> <a class="code" href="classSysStaff.html#a5">SysStaff::SysStaff</a>()
00031       {
00032       <a class="code" href="classSysStaff.html#o0">idx</a>             = 0;
00033       <a class="code" href="classSysStaff.html#o1">klammer</a>         = 0;
00034       <a class="code" href="classSysStaff.html#o2">sstaff</a>          = 0;
00035       <a class="code" href="classSysStaff.html#r1">_distance</a>       = ::style-&gt;staffDistance;
00036       <a class="code" href="classSysStaff.html#o3">instrumentName</a>  = 0;
00037       <a class="code" href="classSysStaff.html#r0">_bbox</a>.setHeight(4.0 * <a class="code" href="spatium_8h.html#a0">_spatium</a>); <span class="comment">// bbox of sstaff</span>
00038       }
00039 
00040 <span class="comment">//---------------------------------------------------------</span>
00041 <span class="comment">//   ~SysStaff</span>
00042 <span class="comment">//---------------------------------------------------------</span>
00043 
<a name="l00044"></a><a class="code" href="classSysStaff.html#a6">00044</a> <a class="code" href="classSysStaff.html#a6">SysStaff::~SysStaff</a>()
00045       {
00046       <span class="keywordflow">if</span> (<a class="code" href="classSysStaff.html#o1">klammer</a>)
00047             <span class="keyword">delete</span> <a class="code" href="classSysStaff.html#o1">klammer</a>;
00048       <span class="keywordflow">if</span> (<a class="code" href="classSysStaff.html#o2">sstaff</a>)
00049             <span class="keyword">delete</span> <a class="code" href="classSysStaff.html#o2">sstaff</a>;
00050       <span class="keywordflow">if</span> (<a class="code" href="classSysStaff.html#o3">instrumentName</a>)
00051             <span class="keyword">delete</span> <a class="code" href="classSysStaff.html#o3">instrumentName</a>;
00052       }
00053 
00054 <span class="comment">//---------------------------------------------------------</span>
00055 <span class="comment">//   System</span>
00056 <span class="comment">//---------------------------------------------------------</span>
00057 
<a name="l00058"></a><a class="code" href="classSystem.html#a0">00058</a> <a class="code" href="classSystem.html#a0">System::System</a>(<a class="code" href="classScore.html">Score</a>* s)
00059    : <a class="code" href="classElement.html">Element</a>(s, <a class="code" href="element_8h.html#a65a39">SYSTEM</a>)
00060       {
00061       <a class="code" href="classSystem.html#r2">bar</a> = <span class="keyword">new</span> <a class="code" href="classBar.html">Bar</a>(s);
00062       <a class="code" href="classSystem.html#r2">bar</a>-&gt;<a class="code" href="classElement.html#a11">setParent</a>(<span class="keyword">this</span>);
00063       <a class="code" href="classSystem.html#r0">ml</a> = <span class="keyword">new</span> <a class="code" href="classMeasureList.html">MeasureList</a>;
00064       }
00065 
00066 <span class="comment">//---------------------------------------------------------</span>
00067 <span class="comment">//   ~System</span>
00068 <span class="comment">//---------------------------------------------------------</span>
00069 
<a name="l00070"></a><a class="code" href="classSystem.html#a1">00070</a> <a class="code" href="classSystem.html#a1">System::~System</a>()
00071       {
00072       <span class="keywordflow">if</span> (<a class="code" href="classSystem.html#r2">bar</a>)
00073             <span class="keyword">delete</span> <a class="code" href="classSystem.html#r2">bar</a>;
00074       <span class="keyword">delete</span> <a class="code" href="classSystem.html#r0">ml</a>;
00075       }
00076 
00077 <span class="comment">//---------------------------------------------------------</span>
00078 <span class="comment">//   bboxStaff</span>
00079 <span class="comment">//---------------------------------------------------------</span>
00080 
<a name="l00081"></a><a class="code" href="classSystem.html#a11">00081</a> <span class="keyword">const</span> QRectF&amp; <a class="code" href="classSystem.html#a11">System::bboxStaff</a>(<span class="keywordtype">int</span> staff)<span class="keyword"> const</span>
00082 <span class="keyword">      </span>{
00083       <span class="keywordflow">if</span> (staff &gt;= int(<a class="code" href="classSystem.html#r1">_staves</a>.size()))
00084             abort();
00085       <span class="keywordflow">return</span> <a class="code" href="classSystem.html#r1">_staves</a>[staff]-&gt;bbox();
00086       }
00087 
00088 <span class="comment">//---------------------------------------------------------</span>
00089 <span class="comment">//   insertStaff</span>
00090 <span class="comment">//---------------------------------------------------------</span>
00091 
<a name="l00092"></a><a class="code" href="classSystem.html#a16">00092</a> <a class="code" href="classSysStaff.html">SysStaff</a>* <a class="code" href="classSystem.html#a16">System::insertStaff</a>(<a class="code" href="classStaff.html">Staff</a>* s, <span class="keywordtype">int</span> idx)
00093       {
00094       <a class="code" href="classSysStaff.html">SysStaff</a>* <a class="code" href="classSystem.html#a13">staff</a> = <span class="keyword">new</span> <a class="code" href="classSysStaff.html">SysStaff</a>;
00095       staff-&gt;<a class="code" href="classSysStaff.html#o2">sstaff</a>   = <span class="keyword">new</span> <a class="code" href="classSStaff.html">SStaff</a>(<a class="code" href="classElement.html#a4">score</a>());
00096       staff-&gt;<a class="code" href="classSysStaff.html#o2">sstaff</a>-&gt;<a class="code" href="classElement.html#a11">setParent</a>(<span class="keyword">this</span>);
00097       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="classStaff.html#a5">isTopSplit</a>()) {
00098             staff-&gt;<a class="code" href="classSysStaff.html#o1">klammer</a> = <span class="keyword">new</span> <a class="code" href="classAkkolade.html">Akkolade</a>(<a class="code" href="classElement.html#a4">score</a>());
00099             staff-&gt;<a class="code" href="classSysStaff.html#o1">klammer</a>-&gt;<a class="code" href="classElement.html#a11">setParent</a>(<span class="keyword">this</span>);
00100             }
00101       <a class="code" href="classSystem.html#a17">insertSysStaff</a>(staff, idx);
00102       <a class="code" href="classSystem.html#d0">setInstrumentName</a>(idx);
00103 
00104       <span class="comment">// calculate new height of bounding box</span>
00105       <span class="keywordtype">double</span> h = <a class="code" href="spatium_8h.html#a0">_spatium</a> * 4;
00106       <span class="keywordtype">int</span> n    = <a class="code" href="classSystem.html#r1">_staves</a>.size();
00107       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; n; ++i) {
00108             h += <a class="code" href="classSystem.html#a14">distance</a>(i);
00109             h += <a class="code" href="spatium_8h.html#a0">_spatium</a> * 4;
00110             }
00111       _bbox.setHeight(h);
00112       <span class="keywordflow">return</span> staff;
00113       }
00114 
00115 <span class="comment">//---------------------------------------------------------</span>
00116 <span class="comment">//   insertStaff</span>
00117 <span class="comment">//---------------------------------------------------------</span>
00118 
<a name="l00119"></a><a class="code" href="classSystem.html#a17">00119</a> <span class="keywordtype">void</span> <a class="code" href="classSystem.html#a17">System::insertSysStaff</a>(<a class="code" href="classSysStaff.html">SysStaff</a>* staff, <span class="keywordtype">int</span> idx)
00120       {
00121       <span class="keywordflow">if</span> (idx &gt;= int(<a class="code" href="classSystem.html#r1">_staves</a>.size()))
00122             <a class="code" href="classSystem.html#r1">_staves</a>.push_back(staff);
00123       <span class="keywordflow">else</span>
00124             <a class="code" href="classSystem.html#r1">_staves</a>.insert(<a class="code" href="classSystem.html#r1">_staves</a>.begin()+idx, staff);
00125       }
00126 
00127 <span class="comment">//---------------------------------------------------------</span>
00128 <span class="comment">//   removeStaff</span>
00129 <span class="comment">//---------------------------------------------------------</span>
00130 
<a name="l00131"></a><a class="code" href="classSystem.html#a18">00131</a> <a class="code" href="classSysStaff.html">SysStaff</a>* <a class="code" href="classSystem.html#a18">System::removeStaff</a>(<span class="keywordtype">int</span> idx)
00132       {
00133       <a class="code" href="classSysStaff.html">SysStaff</a>* <a class="code" href="classSystem.html#a13">staff</a> = <a class="code" href="classSystem.html#r1">_staves</a>[idx];
00134       _staves.erase(_staves.begin()+idx);
00135       <span class="keywordflow">return</span> staff;
00136       }
00137 
00138 <span class="comment">//---------------------------------------------------------</span>
00139 <span class="comment">//   minWidth</span>
00140 <span class="comment">//---------------------------------------------------------</span>
00141 
<a name="l00142"></a><a class="code" href="classSystem.html#a19">00142</a> <a class="code" href="classSpatium.html">Spatium</a> <a class="code" href="classSystem.html#a19">System::minWidth</a>()<span class="keyword"> const</span>
00143 <span class="keyword">      </span>{
00144       <span class="keywordtype">double</span> xoff1 = 0.0;     <span class="comment">// klammer, akkolade</span>
00145       <span class="keywordtype">double</span> xoff2 = 0.0;     <span class="comment">// instrument name</span>
00146 
00147       <span class="keywordflow">for</span> (<a class="code" href="system_8h.html#a2">ciSysStaff</a> is = <a class="code" href="classSystem.html#r1">_staves</a>.begin(); is != <a class="code" href="classSystem.html#r1">_staves</a>.end(); ++is) {
00148             <a class="code" href="classElement.html">Element</a>* el = (*is)-&gt;klammer;
00149             <span class="keywordflow">if</span> (el) {
00150                   <span class="keywordflow">if</span> (el-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a17">AKKOLADE</a>)
00151                         xoff1 = ((<a class="code" href="classAkkolade.html">Akkolade</a>*)el)-&gt;width();
00152                   }
00153             <span class="keywordflow">if</span> ((*is)-&gt;instrumentName) {
00154                   <span class="keywordtype">double</span> w = (*is)-&gt;instrumentName-&gt;width();
00155                   <span class="keywordflow">if</span> (w &gt; xoff2)
00156                         xoff2 = w;
00157                   }
00158             }
00159       <span class="keywordflow">if</span> (xoff2)
00160             xoff2 += <a class="code" href="spatium_8h.html#a0">_spatium</a>;      <span class="comment">// distance instrument name - staff</span>
00161       <a class="code" href="classSpatium.html">Spatium</a> w = spatium(xoff1) + spatium(xoff2);
00162       <span class="keywordflow">return</span> w;
00163       }
00164 
00165 <span class="comment">//---------------------------------------------------------</span>
00166 <span class="comment">//   layout</span>
00167 <span class="comment">//---------------------------------------------------------</span>
00168 
<a name="l00169"></a><a class="code" href="classSystem.html#a6">00169</a> <span class="keywordtype">void</span> <a class="code" href="classElement.html#a66">System::layout</a>(<span class="keyword">const</span> QPointF&amp; p, <span class="keywordtype">double</span> w)
00170       {
00171       setpos(p);
00172       _bbox.setWidth(w);
00173 
00174       <span class="keywordtype">double</span> xoff1 = 0.0;         <span class="comment">// x offset for akkolade</span>
00175       <span class="keywordtype">double</span> xoff2 = 0.0;         <span class="comment">// x offset for instrument name</span>
00176 
00177       <span class="keywordflow">for</span> (<a class="code" href="system_8h.html#a2">ciSysStaff</a> is = <a class="code" href="classSystem.html#r1">_staves</a>.begin(); is != <a class="code" href="classSystem.html#r1">_staves</a>.end(); ++is) {
00178             <a class="code" href="classElement.html">Element</a>* el = (*is)-&gt;klammer;
00179             <span class="keywordflow">if</span> (el) {
00180                   <span class="keywordflow">if</span> (el-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a17">AKKOLADE</a>)
00181                         xoff1 = ((<a class="code" href="classAkkolade.html">Akkolade</a>*)el)-&gt;width();
00182                   }
00183             <span class="keywordflow">if</span> ((*is)-&gt;instrumentName) {
00184                   <span class="keywordtype">double</span> w = (*is)-&gt;instrumentName-&gt;width() + <a class="code" href="spatium_8h.html#a0">_spatium</a>;
00185                   <span class="keywordflow">if</span> (w &gt; xoff2)
00186                         xoff2 = w;
00187                   }
00188             }
00189       <span class="keywordtype">double</span> xoffset = xoff1 + xoff2;
00190       QPointF pos;
00191       pos.rx() += xoffset;
00192 
00193       <span class="keywordtype">int</span> nstaves = <a class="code" href="classSystem.html#a5">page</a>()-&gt;<a class="code" href="classElement.html#a4">score</a>()-&gt;<a class="code" href="classScore.html#a6">nstaves</a>();
00194       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> idx = 0;;) {
00195             <a class="code" href="classSysStaff.html">SysStaff</a>* s = <a class="code" href="classElement.html#a59">staff</a>(idx);
00196 
00197             <a class="code" href="classSStaff.html">SStaff</a>* sstaff = s-&gt;<a class="code" href="classSysStaff.html#o2">sstaff</a>;
00198             sstaff-&gt;<a class="code" href="classElement.html#a23">setpos</a>(pos);
00199             sstaff-&gt;<a class="code" href="classElement.html#a38">setWidth</a>(w - xoffset);
00200             s-&gt;<a class="code" href="classSysStaff.html#a1">setbbox</a>(QRectF(pos.x(), pos.y(), w, 4 * <a class="code" href="spatium_8h.html#a0">_spatium</a>));
00201             ++idx;
00202             <span class="keywordflow">if</span> (idx &gt;= nstaves)
00203                   <span class="keywordflow">break</span>;
00204             <span class="keywordtype">double</span> h = <a class="code" href="classSystem.html#a14">distance</a>(idx) + <a class="code" href="classSystem.html#r1">_staves</a>[idx]-&gt;bbox().height();
00205             pos.ry() += h;
00206             }
00207 
00208       <a class="code" href="classPartList.html">PartList</a>* pl = <a class="code" href="classSystem.html#a5">page</a>()-&gt;<a class="code" href="classElement.html#a4">score</a>()-&gt;<a class="code" href="classScore.html#a109">parts</a>();
00209       <span class="keywordtype">int</span> idx = 0;
00210       <span class="keywordflow">for</span> (<a class="code" href="part_8h.html#a0">iPart</a> ip = pl-&gt;<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); ip != pl-&gt;<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++ip) {
00211             <a class="code" href="classPart.html">Part</a>* p     = *ip;
00212             <span class="keywordtype">int</span> nstaves = p-&gt;<a class="code" href="classPart.html#a4">nstaves</a>();
00213             <a class="code" href="classSysStaff.html">SysStaff</a>* s = <a class="code" href="classElement.html#a59">staff</a>(idx);
00214             <span class="keywordtype">double</span> y1   = s-&gt;<a class="code" href="classSysStaff.html#a0">bbox</a>().y();
00215             <span class="keywordflow">if</span> (s-&gt;<a class="code" href="classSysStaff.html#o1">klammer</a> &amp;&amp; s-&gt;<a class="code" href="classSysStaff.html#o1">klammer</a>-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a17">AKKOLADE</a>) {
00216                   <a class="code" href="classAkkolade.html">Akkolade</a>* a = (<a class="code" href="classAkkolade.html">Akkolade</a>*) s-&gt;<a class="code" href="classSysStaff.html#o1">klammer</a>;
00217                   <span class="keywordtype">int</span> idx2  = idx + nstaves - 1;
00218                   <span class="keywordtype">double</span> ah = <a class="code" href="classElement.html#a59">staff</a>(idx2)-&gt;bbox().height();
00219                   <span class="keywordtype">double</span> y2 = <a class="code" href="classElement.html#a59">staff</a>(idx2)-&gt;bbox().y() + ah;
00220 
00221                   a-&gt;<a class="code" href="classElement.html#a23">setpos</a>(xoff2, y1 + (y2-y1) / 2);
00222                   a-&gt;<a class="code" href="classAkkolade.html#a3">setHeight</a>(y2-y1);
00223                   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="classSysStaff.html#o3">instrumentName</a>)
00224                         s-&gt;<a class="code" href="classSysStaff.html#o3">instrumentName</a>-&gt;<a class="code" href="classElement.html#a23">setpos</a>(xoff2 - <a class="code" href="spatium_8h.html#a0">_spatium</a>,
00225                         y1 + (y2-y1)/2.0);
00226                   }
00227             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s-&gt;<a class="code" href="classSysStaff.html#o3">instrumentName</a>) {
00228                   s-&gt;<a class="code" href="classSysStaff.html#o3">instrumentName</a>-&gt;<a class="code" href="classElement.html#a23">setpos</a>(xoff2 - <a class="code" href="spatium_8h.html#a0">_spatium</a>,
00229                      y1 + 2 * <a class="code" href="spatium_8h.html#a0">_spatium</a>);
00230                   }
00231             idx += nstaves;
00232             }
00233 
00234       <span class="keywordtype">double</span> height = pos.y() + <a class="code" href="classSystem.html#r1">_staves</a>[<a class="code" href="classSystem.html#a5">page</a>()-&gt;<a class="code" href="classElement.html#a4">score</a>()-&gt;<a class="code" href="classScore.html#a6">nstaves</a>()-1]-&gt;bbox().height();
00235       <span class="keywordflow">if</span> (<a class="code" href="classSystem.html#r2">bar</a>) {
00236             <a class="code" href="classSystem.html#r2">bar</a>-&gt;<a class="code" href="classElement.html#a39">setHeight</a>(height);
00237             <a class="code" href="classSystem.html#r2">bar</a>-&gt;<a class="code" href="classElement.html#a23">setpos</a>(pos.x(), 0);
00238             }
00239       _bbox.setHeight(height);
00240       }
00241 
00242 <span class="comment">//---------------------------------------------------------</span>
00243 <span class="comment">//   layout2</span>
00244 <span class="comment">//    after measure layout</span>
00245 <span class="comment">//---------------------------------------------------------</span>
00246 
<a name="l00247"></a><a class="code" href="classSystem.html#a7">00247</a> <span class="keywordtype">void</span> <a class="code" href="classSystem.html#a7">System::layout2</a>()
00248       {
00249       <span class="keywordtype">int</span> <a class="code" href="classSystem.html#a12">staves</a> = <a class="code" href="classSystem.html#a5">page</a>()-&gt;<a class="code" href="classElement.html#a4">score</a>()-&gt;<a class="code" href="classScore.html#a6">nstaves</a>();
00250 
00251       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="classSystem.html#a13">staff</a> = 0; staff &lt; staves; ++staff) {
00252             <span class="keywordtype">double</span> dist = 0.0;
00253             <span class="keywordflow">for</span> (<a class="code" href="measure_8h.html#a9">iMeasure</a> im = <a class="code" href="classSystem.html#r0">ml</a>-&gt;<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); im != <a class="code" href="classSystem.html#r0">ml</a>-&gt;<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++im) {
00254                   <a class="code" href="classMeasure.html">Measure</a>* m = *im;
00255                   dist = std::max(dist, m-&gt;<a class="code" href="classMeasure.html#a23">distance</a>(staff));
00256                   }
00257             <span class="keywordflow">if</span> (dist &gt; <a class="code" href="classSystem.html#a14">distance</a>(staff))
00258                  <a class="code" href="classSystem.html#a15">setDistance</a>(staff, dist);
00259             }
00260       }
00261 
00262 <span class="comment">//---------------------------------------------------------</span>
00263 <span class="comment">//   move</span>
00264 <span class="comment">//---------------------------------------------------------</span>
00265 
<a name="l00266"></a><a class="code" href="classSysStaff.html#a2">00266</a> <span class="keywordtype">void</span> <a class="code" href="classSysStaff.html#a2">SysStaff::move</a>(<span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y)
00267       {
00268       <a class="code" href="classSysStaff.html#r0">_bbox</a>.translate(x, y);
00269       <a class="code" href="classSysStaff.html#o2">sstaff</a>-&gt;<a class="code" href="classElement.html#a25">move</a>(x, y);
00270 
00271       <span class="keywordflow">if</span> (<a class="code" href="classSysStaff.html#o1">klammer</a>)
00272             <a class="code" href="classSysStaff.html#o1">klammer</a>-&gt;<a class="code" href="classElement.html#a25">move</a>(x, y);
00273       <span class="keywordflow">if</span> (<a class="code" href="classSysStaff.html#o3">instrumentName</a>)
00274             <a class="code" href="classSysStaff.html#o3">instrumentName</a>-&gt;<a class="code" href="classElement.html#a25">move</a>(x, y);
00275       }
00276 
00277 <span class="comment">//---------------------------------------------------------</span>
00278 <span class="comment">//   layoutY</span>
00279 <span class="comment">//---------------------------------------------------------</span>
00280 
<a name="l00281"></a><a class="code" href="classSystem.html#a9">00281</a> <span class="keywordtype">void</span> <a class="code" href="classSystem.html#a9">System::layoutY</a>()
00282       {
00283       <span class="keywordtype">double</span> y = _bbox.y();
00284 
00285       <span class="keywordtype">int</span> <a class="code" href="classSystem.html#a12">staves</a> = <a class="code" href="classSystem.html#a5">page</a>()-&gt;<a class="code" href="classElement.html#a4">score</a>()-&gt;<a class="code" href="classScore.html#a6">nstaves</a>();
00286       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; staves;) {
00287             <a class="code" href="classSysStaff.html">SysStaff</a>* s  = <a class="code" href="classElement.html#a59">staff</a>(i);
00288             <span class="keywordtype">double</span> dy = y - s-&gt;<a class="code" href="classSysStaff.html#a0">bbox</a>().y();
00289             s-&gt;<a class="code" href="classSysStaff.html#a2">move</a>(0, dy);
00290 
00291             <span class="keywordflow">for</span> (<a class="code" href="measure_8h.html#a9">iMeasure</a> im = <a class="code" href="classSystem.html#r0">ml</a>-&gt;<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); im != <a class="code" href="classSystem.html#r0">ml</a>-&gt;<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++im)
00292                   (*im)-&gt;moveY(i, dy);
00293             ++i;
00294             <span class="keywordflow">if</span> (i == <a class="code" href="classSystem.html#a5">page</a>()-&gt;<a class="code" href="classElement.html#a4">score</a>()-&gt;<a class="code" href="classScore.html#a6">nstaves</a>())
00295                   <span class="keywordflow">break</span>;
00296             <span class="keywordtype">double</span> oy = y;
00297             y += <a class="code" href="classSystem.html#a14">distance</a>(i) + + <a class="code" href="classSystem.html#r1">_staves</a>[i-1]-&gt;bbox().height();
00298             <span class="keywordflow">if</span> (s-&gt;<a class="code" href="classSysStaff.html#o1">klammer</a> &amp;&amp; s-&gt;<a class="code" href="classSysStaff.html#o1">klammer</a>-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a17">AKKOLADE</a>) {
00299                   <a class="code" href="classAkkolade.html">Akkolade</a>* a = (<a class="code" href="classAkkolade.html">Akkolade</a>*) s-&gt;<a class="code" href="classSysStaff.html#o1">klammer</a>;
00300                   a-&gt;<a class="code" href="classAkkolade.html#a3">setHeight</a>(y - oy + 4 * <a class="code" href="spatium_8h.html#a0">_spatium</a>);
00301                   }
00302             }
00303       <span class="keywordtype">double</span> height = _bbox.height();
00304       <span class="keywordflow">if</span> (<a class="code" href="classSystem.html#r2">bar</a>)
00305             <a class="code" href="classSystem.html#r2">bar</a>-&gt;<a class="code" href="classElement.html#a39">setHeight</a>(height);
00306       <span class="keywordflow">for</span> (<a class="code" href="measure_8h.html#a9">iMeasure</a> im = <a class="code" href="classSystem.html#r0">ml</a>-&gt;<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); im != <a class="code" href="classSystem.html#r0">ml</a>-&gt;<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++im) {
00307             <a class="code" href="classMeasure.html">Measure</a>* m = *im;
00308             m-&gt;<a class="code" href="classMeasure.html#a58">layoutBeams</a>();
00309             }
00310       }
00311 
00312 <span class="comment">//---------------------------------------------------------</span>
00313 <span class="comment">//   clear</span>
00314 <span class="comment">//    clear layout of System</span>
00315 <span class="comment">//---------------------------------------------------------</span>
00316 
<a name="l00317"></a><a class="code" href="classSystem.html#a8">00317</a> <span class="keywordtype">void</span> <a class="code" href="classSystem.html#a8">System::clear</a>()
00318       {
00319       <a class="code" href="classSystem.html#r0">ml</a>-&gt;clear();
00320       }
00321 
00322 <span class="comment">//---------------------------------------------------------</span>
00323 <span class="comment">//   findSelectableElement</span>
00324 <span class="comment">//    p is Page relative</span>
00325 <span class="comment">//---------------------------------------------------------</span>
00326 
<a name="l00327"></a><a class="code" href="classSystem.html#a23">00327</a> <a class="code" href="classElement.html">Element</a>* <a class="code" href="classSystem.html#a23">System::findSelectableElement</a>(QPointF p)<span class="keyword"> const</span>
00328 <span class="keyword">      </span>{
00329       <span class="keywordflow">for</span> (<a class="code" href="measure_8h.html#a11">ciMeasure</a> im = <a class="code" href="classSystem.html#r0">ml</a>-&gt;<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); im != <a class="code" href="classSystem.html#r0">ml</a>-&gt;<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++im) {
00330             <a class="code" href="classMeasure.html">Measure</a>* measure = *im;
00331             <a class="code" href="classElement.html">Element</a>* element = measure-&gt;<a class="code" href="classMeasure.html#a57">findSelectableElement</a>(p - <a class="code" href="classElement.html#a20">pos</a>());
00332             <span class="keywordflow">if</span> (element)
00333                   <span class="keywordflow">return</span> element;
00334             }
00335       p -= <a class="code" href="classElement.html#a20">pos</a>();
00336       <span class="keywordflow">for</span> (<a class="code" href="system_8h.html#a2">ciSysStaff</a> is = <a class="code" href="classSystem.html#r1">_staves</a>.begin(); is != <a class="code" href="classSystem.html#r1">_staves</a>.end(); ++is) {
00337             <a class="code" href="classElement.html">Element</a>* el = (*is)-&gt;klammer;
00338             <span class="keywordflow">if</span> (el &amp;&amp; el-&gt;<a class="code" href="classElement.html#a30">contains</a>(p))
00339                   <span class="keywordflow">return</span> el;
00340             <span class="keywordflow">if</span> ((*is)-&gt;instrumentName &amp;&amp; (*is)-&gt;instrumentName-&gt;contains(p))
00341                   <span class="keywordflow">return</span> (*is)-&gt;instrumentName;
00342             }
00343       <span class="keywordflow">return</span> 0;
00344       }
00345 
00346 <span class="comment">//---------------------------------------------------------</span>
00347 <span class="comment">//   setInstrumentNames</span>
00348 <span class="comment">//---------------------------------------------------------</span>
00349 
<a name="l00350"></a><a class="code" href="classSystem.html#a24">00350</a> <span class="keywordtype">void</span> <a class="code" href="classSystem.html#a24">System::setInstrumentNames</a>()
00351       {
00352       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="classSystem.html#a13">staff</a> = 0; staff &lt; <a class="code" href="classSystem.html#a5">page</a>()-&gt;<a class="code" href="classElement.html#a4">score</a>()-&gt;<a class="code" href="classScore.html#a6">nstaves</a>(); ++staff)
00353             <a class="code" href="classSystem.html#d0">setInstrumentName</a>(staff);
00354       }
00355 
00356 <span class="comment">//---------------------------------------------------------</span>
00357 <span class="comment">//   setInstrumentName</span>
00358 <span class="comment">//---------------------------------------------------------</span>
00359 
<a name="l00360"></a><a class="code" href="classSystem.html#d0">00360</a> <span class="keywordtype">void</span> <a class="code" href="classSystem.html#d0">System::setInstrumentName</a>(<span class="keywordtype">int</span> idx)
00361       {
00362       <a class="code" href="classStaff.html">Staff</a>* s = <a class="code" href="classSystem.html#a5">page</a>()-&gt;<a class="code" href="classElement.html#a4">score</a>()-&gt;<a class="code" href="classScore.html#a7">staff</a>(idx);
00363       <span class="keywordflow">if</span> (!s-&gt;<a class="code" href="classStaff.html#a4">isTop</a>())
00364             <span class="keywordflow">return</span>;
00365       <a class="code" href="classSysStaff.html">SysStaff</a>* <a class="code" href="classSystem.html#a13">staff</a> = <a class="code" href="classSystem.html#r1">_staves</a>[idx];
00366       <a class="code" href="classScore.html">Score</a>* cs = <a class="code" href="classSystem.html#a5">page</a>()-&gt;<a class="code" href="classElement.html#a4">score</a>();
00367       <span class="keywordflow">if</span> (cs-&gt;<a class="code" href="classScore.html#o13">systems</a> &amp;&amp; !cs-&gt;<a class="code" href="classScore.html#o13">systems</a>-&gt;empty() &amp;&amp; cs-&gt;<a class="code" href="classScore.html#o13">systems</a>-&gt;<a class="code" href="classpstl_1_1plist.html#a12">front</a>() == <span class="keyword">this</span>) {
00368             <span class="keywordflow">if</span> (!s-&gt;<a class="code" href="classStaff.html#a7">longName</a>().isEmpty()) {
00369                   <span class="keywordflow">if</span> (staff-&gt;<a class="code" href="classSysStaff.html#o3">instrumentName</a> == 0)
00370                         staff-&gt;<a class="code" href="classSysStaff.html#o3">instrumentName</a> = <span class="keyword">new</span> <a class="code" href="classInstrumentName1.html">InstrumentName1</a>(<a class="code" href="classElement.html#a4">score</a>());
00371                   staff-&gt;<a class="code" href="classSysStaff.html#o3">instrumentName</a>-&gt;<a class="code" href="classSText.html#a5">setText</a>(s-&gt;<a class="code" href="classStaff.html#a7">longName</a>());
00372                   }
00373             }
00374       <span class="keywordflow">else</span> {
00375             <span class="keywordflow">if</span> (!s-&gt;<a class="code" href="classStaff.html#a8">shortName</a>().isEmpty()) {
00376                   <span class="keywordflow">if</span> (staff-&gt;<a class="code" href="classSysStaff.html#o3">instrumentName</a> == 0)
00377                         staff-&gt;<a class="code" href="classSysStaff.html#o3">instrumentName</a> = <span class="keyword">new</span> <a class="code" href="classInstrumentName2.html">InstrumentName2</a>(<a class="code" href="classElement.html#a4">score</a>());
00378                   staff-&gt;<a class="code" href="classSysStaff.html#o3">instrumentName</a>-&gt;<a class="code" href="classSText.html#a5">setText</a>(s-&gt;<a class="code" href="classStaff.html#a8">shortName</a>());
00379                   }
00380             }
00381       <span class="keywordflow">if</span> (staff-&gt;<a class="code" href="classSysStaff.html#o3">instrumentName</a>) {
00382             staff-&gt;<a class="code" href="classSysStaff.html#o3">instrumentName</a>-&gt;<a class="code" href="classElement.html#a11">setParent</a>(<span class="keyword">this</span>);
00383             staff-&gt;<a class="code" href="classSysStaff.html#o3">instrumentName</a>-&gt;<a class="code" href="classElement.html#a61">setStaff</a>(s);
00384             }
00385       }
00386 
00387 <span class="comment">//---------------------------------------------------------</span>
00388 <span class="comment">//   draw</span>
00389 <span class="comment">//    p - has page coordinate system</span>
00390 <span class="comment">//    f - System relative</span>
00391 <span class="comment">//---------------------------------------------------------</span>
00392 
<a name="l00393"></a><a class="code" href="classSystem.html#a20">00393</a> <span class="keywordtype">void</span> <a class="code" href="classSystem.html#a20">System::draw</a>(<a class="code" href="classPainter.html">Painter</a>&amp; p)<span class="keyword"> const</span>
00394 <span class="keyword">      </span>{
00395       p.translate(<a class="code" href="classElement.html#a20">pos</a>());
00396 
00397       <span class="keywordflow">if</span> (<a class="code" href="classSystem.html#r2">bar</a> <span class="comment">/*&amp;&amp; bar-&gt;bbox().intersects(f)*/</span>)
00398             <a class="code" href="classSystem.html#r2">bar</a>-&gt;<a class="code" href="classElement.html#a43">draw</a>(p);
00399       <span class="keywordflow">for</span> (<a class="code" href="system_8h.html#a2">ciSysStaff</a> is = <a class="code" href="classSystem.html#r1">_staves</a>.begin(); is != <a class="code" href="classSystem.html#r1">_staves</a>.end(); ++is) {
00400             <span class="keyword">const</span> <a class="code" href="classElement.html">Element</a>* el = (*is)-&gt;klammer;
00401 
00402             (*is)-&gt;sstaff-&gt;draw(p);
00403             <span class="keywordflow">if</span> (el)
00404                   el-&gt;<a class="code" href="classElement.html#a43">draw</a>(p);
00405             <span class="keywordflow">if</span> ((*is)-&gt;instrumentName)
00406                   (*is)-&gt;instrumentName-&gt;draw(p);
00407             }
00408       <span class="keywordflow">for</span> (<a class="code" href="measure_8h.html#a11">ciMeasure</a> im = <a class="code" href="classSystem.html#r0">ml</a>-&gt;<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); im != <a class="code" href="classSystem.html#r0">ml</a>-&gt;<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++im) {
00409             <a class="code" href="classMeasure.html">Measure</a>* m = *im;
00410             m-&gt;<a class="code" href="classMeasure.html#a4">draw</a>(p);
00411             }
00412       p.translate(-<a class="code" href="classElement.html#a20">pos</a>());
00413       }
00414 
00415 <span class="comment">//---------------------------------------------------------</span>
00416 <span class="comment">//   pos2tick</span>
00417 <span class="comment">//    fp is Page relative</span>
00418 <span class="comment">//---------------------------------------------------------</span>
00419 
<a name="l00420"></a><a class="code" href="classSystem.html#a22">00420</a> <span class="keywordtype">bool</span> <a class="code" href="classSystem.html#a22">System::pos2tick</a>(<span class="keyword">const</span> QPointF&amp; fp, <span class="keywordtype">int</span>* tick, <a class="code" href="classStaff.html">Staff</a>** staff, <span class="keywordtype">int</span>* pitch)<span class="keyword"> const</span>
00421 <span class="keyword">      </span>{
00422       *pitch      = 64;  <span class="comment">// default</span>
00423       <span class="keywordtype">double</span> dy   = point(<a class="code" href="classSpatium.html">Spatium</a>(4) + <a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o2">staffDistance</a>);
00424 
00425       <a class="code" href="classElement.html">Element</a>* el = <a class="code" href="classSystem.html#a23">findSelectableElement</a>(fp);
00426       <span class="keywordflow">if</span> (el) {
00427             *tick  = el-&gt;<a class="code" href="classElement.html#a74">tick</a>();
00428             *pitch = <a class="code" href="classSystem.html#a5">page</a>()-&gt;<a class="code" href="classElement.html#a4">score</a>()-&gt;<a class="code" href="classScore.html#a23">y2pitch</a>(fp.y() - <a class="code" href="classElement.html#a22">y</a>(), *staff, *tick);
00429             *staff = el-&gt;<a class="code" href="classElement.html#a59">staff</a>();
00430             <span class="keywordflow">return</span> <span class="keyword">true</span>;
00431             }
00432       <span class="comment">//</span>
00433       <span class="comment">// es wurde kein Element direkt angeclickt, also suchen wir nach</span>
00434       <span class="comment">// dem angeclickten Segment</span>
00435 
00436       <span class="keywordtype">double</span> sy = _bbox.y();
00437       <a class="code" href="classStaffList.html">StaffList</a>* sl = <a class="code" href="classSystem.html#a5">page</a>()-&gt;<a class="code" href="classElement.html#a4">score</a>()-&gt;<a class="code" href="classScore.html#a5">staves</a>();
00438       <span class="keywordflow">for</span> (<a class="code" href="staff_8h.html#a0">iStaff</a> i = sl-&gt;begin(); i != sl-&gt;end(); ++i) {
00439             <span class="keywordtype">double</span> ey = sy + <a class="code" href="spatium_8h.html#a0">_spatium</a>*4;
00440             <span class="keywordtype">double</span> eey = <a class="code" href="classSystem.html#a14">distance</a>(sl-&gt;<a class="code" href="classStaffList.html#a1">idx</a>(*i));
00441             <span class="keywordflow">if</span> (fp.y() &lt; ey + (eey/2)) {
00442                   *staff = *i;
00443                   <span class="keywordflow">break</span>;
00444                   }
00445             sy = ey + eey;
00446             }
00447 
00448       <span class="keywordflow">for</span> (<a class="code" href="measure_8h.html#a11">ciMeasure</a> im = <a class="code" href="classSystem.html#r0">ml</a>-&gt;<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); im != <a class="code" href="classSystem.html#r0">ml</a>-&gt;<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++im) {
00449             <span class="keyword">const</span> <a class="code" href="classMeasure.html">Measure</a>* measure = *im;
00450             <span class="keywordtype">double</span> x1 = measure-&gt;<a class="code" href="classElement.html#a21">x</a>();
00451             <span class="keywordtype">double</span> x2 = x1 + measure-&gt;<a class="code" href="classElement.html#a37">width</a>();
00452             <span class="keywordflow">if</span> (x2 &lt; fp.x())
00453                   <span class="keywordflow">continue</span>;
00454             <span class="keywordtype">double</span> measurex2 = measure-&gt;<a class="code" href="classElement.html#a21">x</a>() + measure-&gt;<a class="code" href="classElement.html#a37">width</a>();
00455             <span class="keywordflow">for</span> (<a class="code" href="classSegment.html">Segment</a>* segment = measure-&gt;<a class="code" href="classMeasure.html#a28">first</a>(); segment;) {
00456                   <a class="code" href="classSegment.html">Segment</a>* ns = segment-&gt;<a class="code" href="classSegment.html#a4">next</a>();
00457                   <span class="keywordtype">double</span> x1 = segment-&gt;<a class="code" href="classSegment.html#a15">x</a>();
00458                   <span class="keywordtype">double</span> x2 = ns ? ns-&gt;<a class="code" href="classSegment.html#a15">x</a>() : measurex2;
00459                   <span class="keywordflow">if</span> (fp.x() &gt;= x1 &amp;&amp; fp.x() &lt; x2) {
00460                         *tick = segment-&gt;<a class="code" href="classElement.html#a74">tick</a>();
00461                         <span class="keywordtype">double</span> y1 = measure-&gt;<a class="code" href="classElement.html#a22">y</a>() + (sl-&gt;<a class="code" href="classStaffList.html#a1">idx</a>(*staff)) * dy;
00462                         *pitch = <a class="code" href="classSystem.html#a5">page</a>()-&gt;<a class="code" href="classElement.html#a4">score</a>()-&gt;<a class="code" href="classScore.html#a23">y2pitch</a>(fp.y() - y1, *staff, *tick);
00463                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00464                         }
00465                   segment = ns;
00466                   }
00467             }
00468       <span class="keywordflow">return</span> <span class="keyword">false</span>;
00469       }
00470 
00471 <span class="comment">//---------------------------------------------------------</span>
00472 <span class="comment">//   distance</span>
00473 <span class="comment">//---------------------------------------------------------</span>
00474 
<a name="l00475"></a><a class="code" href="classSystem.html#a14">00475</a> <span class="keywordtype">double</span> <a class="code" href="classSystem.html#a14">System::distance</a>(<span class="keywordtype">int</span> n)<span class="keyword"> const</span>
00476 <span class="keyword">      </span>{
00477       <span class="keywordflow">if</span> ((<span class="keywordtype">unsigned</span>)n &gt;= <a class="code" href="classSystem.html#r1">_staves</a>.size()) {
00478             printf(<span class="stringliteral">"System::distance(): bad stave index %d &gt;= %d\n"</span>, n, <a class="code" href="classSystem.html#r1">_staves</a>.size());
00479             <span class="keywordflow">return</span> 0;
00480             }
00481       <span class="keywordflow">return</span> <a class="code" href="classSystem.html#r1">_staves</a>[n]-&gt;distance();
00482       }
00483 
00484 <span class="comment">//---------------------------------------------------------</span>
00485 <span class="comment">//   add</span>
00486 <span class="comment">//---------------------------------------------------------</span>
00487 
<a name="l00488"></a><a class="code" href="classSystem.html#a3">00488</a> <span class="keywordtype">void</span> <a class="code" href="classSystem.html#a3">System::add</a>(<a class="code" href="classElement.html">Element</a>* el)
00489       {
00490 <span class="comment">// printf("System::add: %s staff %d\n", el-&gt;name(), el-&gt;staffIdx());</span>
00491       <a class="code" href="classSysStaff.html">SysStaff</a>* <a class="code" href="classSystem.html#a13">staff</a> = <a class="code" href="classSystem.html#r1">_staves</a>[el-&gt;<a class="code" href="classElement.html#a60">staffIdx</a>()];
00492       <span class="keywordflow">if</span> (el-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a36">INSTRUMENT_NAME1</a> || el-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a37">INSTRUMENT_NAME2</a>)
00493             staff-&gt;<a class="code" href="classSysStaff.html#o3">instrumentName</a> = (<a class="code" href="classSText.html">SText</a>*)el;
00494       }
00495 
00496 <span class="comment">//---------------------------------------------------------</span>
00497 <span class="comment">//   remove</span>
00498 <span class="comment">//---------------------------------------------------------</span>
00499 
<a name="l00500"></a><a class="code" href="classSystem.html#a4">00500</a> <span class="keywordtype">void</span> <a class="code" href="classSystem.html#a4">System::remove</a>(<a class="code" href="classElement.html">Element</a>* el)
00501       {
00502 <span class="comment">// printf("System::remove: %s staff %d\n", el-&gt;name(), el-&gt;staffIdx());</span>
00503       <a class="code" href="classSysStaff.html">SysStaff</a>* <a class="code" href="classSystem.html#a13">staff</a> = <a class="code" href="classSystem.html#r1">_staves</a>[el-&gt;<a class="code" href="classElement.html#a60">staffIdx</a>()];
00504       <span class="keywordflow">if</span> (el-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a36">INSTRUMENT_NAME1</a> || el-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a37">INSTRUMENT_NAME2</a>)
00505             staff-&gt;<a class="code" href="classSysStaff.html#o3">instrumentName</a> = 0;
00506       }
00507 
00508 <span class="comment">//---------------------------------------------------------</span>
00509 <span class="comment">//   snap</span>
00510 <span class="comment">//---------------------------------------------------------</span>
00511 
<a name="l00512"></a><a class="code" href="classSystem.html#a25">00512</a> <span class="keywordtype">int</span> <a class="code" href="classSystem.html#a25">System::snap</a>(<span class="keywordtype">int</span> tick, <span class="keyword">const</span> QPointF p)<span class="keyword"> const</span>
00513 <span class="keyword">      </span>{
00514       <span class="keywordflow">for</span> (<a class="code" href="measure_8h.html#a11">ciMeasure</a> im = <a class="code" href="classSystem.html#r0">ml</a>-&gt;<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); im != <a class="code" href="classSystem.html#r0">ml</a>-&gt;<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++im) {
00515             <a class="code" href="classMeasure.html">Measure</a>* m = *im;
00516             <span class="keywordflow">if</span> (p.x() &lt; m-&gt;<a class="code" href="classElement.html#a21">x</a>() + m-&gt;<a class="code" href="classElement.html#a37">width</a>())
00517                   <span class="keywordflow">return</span> m-&gt;<a class="code" href="classMeasure.html#a51">snap</a>(tick, p - m-&gt;<a class="code" href="classElement.html#a20">pos</a>());
00518             }
00519       <span class="keywordflow">return</span> <a class="code" href="classSystem.html#r0">ml</a>-&gt;<a class="code" href="classpstl_1_1plist.html#a11">back</a>()-&gt;<a class="code" href="classMeasure.html#a51">snap</a>(tick, p-<a class="code" href="classElement.html#a20">pos</a>());
00520       }
00521 
00522 <span class="comment">//---------------------------------------------------------</span>
00523 <span class="comment">//   snap</span>
00524 <span class="comment">//---------------------------------------------------------</span>
00525 
<a name="l00526"></a><a class="code" href="classSystem.html#a26">00526</a> <span class="keywordtype">int</span> <a class="code" href="classSystem.html#a26">System::snapNote</a>(<span class="keywordtype">int</span> tick, <span class="keyword">const</span> QPointF p, <span class="keywordtype">int</span> staff)<span class="keyword"> const</span>
00527 <span class="keyword">      </span>{
00528       <span class="keywordflow">for</span> (<a class="code" href="measure_8h.html#a11">ciMeasure</a> im = <a class="code" href="classSystem.html#r0">ml</a>-&gt;<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); im != <a class="code" href="classSystem.html#r0">ml</a>-&gt;<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++im) {
00529             <a class="code" href="classMeasure.html">Measure</a>* m = *im;
00530             <span class="keywordflow">if</span> (p.x() &lt; m-&gt;<a class="code" href="classElement.html#a21">x</a>() + m-&gt;<a class="code" href="classElement.html#a37">width</a>())
00531                   <span class="keywordflow">return</span> m-&gt;<a class="code" href="classMeasure.html#a52">snapNote</a>(tick, p - m-&gt;<a class="code" href="classElement.html#a20">pos</a>(), staff);
00532             }
00533       <span class="keywordflow">return</span> <a class="code" href="classSystem.html#r0">ml</a>-&gt;<a class="code" href="classpstl_1_1plist.html#a11">back</a>()-&gt;<a class="code" href="classMeasure.html#a51">snap</a>(tick, p-<a class="code" href="classElement.html#a20">pos</a>());
00534       }
00535 
00536 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Mon Jun 27 22:28:30 2005 for MuseScore by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
