<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>MuseScore: keyb.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>keyb.cpp</h1><a href="keyb_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">//=========================================================</span>
00002 <span class="comment">//  MuseScore</span>
00003 <span class="comment">//  Linux Music Score Editor</span>
00004 <span class="comment">//  $Id: keyb.cpp,v 1.29 2005/06/20 13:54:53 wschweer Exp $</span>
00005 <span class="comment">//</span>
00006 <span class="comment">//  (C) Copyright 2002-2004 Werner Schweer (ws@seh.de)</span>
00007 <span class="comment">//=========================================================</span>
00008 
00009 <span class="preprocessor">#include "<a class="code" href="canvas_8h.html">canvas.h</a>"</span>
00010 <span class="preprocessor">#include "<a class="code" href="note_8h.html">note.h</a>"</span>
00011 <span class="preprocessor">#include "<a class="code" href="pad_8h.html">pad.h</a>"</span>
00012 <span class="preprocessor">#include "<a class="code" href="padids_8h.html">padids.h</a>"</span>
00013 <span class="preprocessor">#include "<a class="code" href="symbols_8h.html">symbols.h</a>"</span>
00014 <span class="preprocessor">#include "<a class="code" href="padstate_8h.html">padstate.h</a>"</span>
00015 <span class="preprocessor">#include "<a class="code" href="note_8h.html">note.h</a>"</span>
00016 <span class="preprocessor">#include "<a class="code" href="project_8h.html">project.h</a>"</span>
00017 <span class="preprocessor">#include "<a class="code" href="select_8h.html">select.h</a>"</span>
00018 <span class="preprocessor">#include "<a class="code" href="input_8h.html">input.h</a>"</span>
00019 <span class="preprocessor">#include "<a class="code" href="app_8h.html">app.h</a>"</span>
00020 <span class="preprocessor">#include "<a class="code" href="key_8h.html">key.h</a>"</span>
00021 <span class="preprocessor">#include "<a class="code" href="measure_8h.html">measure.h</a>"</span>
00022 
00023 <span class="comment">//---------------------------------------------------------</span>
00024 <span class="comment">//   keyPressEvent</span>
00025 <span class="comment">//---------------------------------------------------------</span>
00026 
<a name="l00027"></a><a class="code" href="classCanvas.html#i0">00027</a> <span class="keywordtype">void</span> <a class="code" href="classCanvas.html#i0">Canvas::keyPressEvent</a>(QKeyEvent* ev)
00028       {
00029 <span class="comment">// printf("key key:%x state:%x code:%x\n", ev-&gt;key(), ev-&gt;state(), ev-&gt;ascii());</span>
00030       <span class="keywordflow">if</span> (<a class="code" href="classCanvas.html#r4">state</a> == <a class="code" href="classCanvas.html#w9w4">EDIT</a>) {
00031             <span class="keywordflow">if</span> ((ev-&gt;key() == Qt::Key_Tab) &amp;&amp; (<a class="code" href="classCanvas.html#r0">_score</a>-&gt;<a class="code" href="classScore.html#o16">editObject</a>-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a35">LYRICS</a>))
00032                   <a class="code" href="classCanvas.html#r0">_score</a>-&gt;<a class="code" href="classScore.html#a87">lyricsTab</a>();
00033             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classCanvas.html#r0">_score</a>-&gt;<a class="code" href="classScore.html#a89">edit</a>(ev))
00034                   <a class="code" href="classCanvas.html#r4">state</a> = <a class="code" href="classCanvas.html#w9w0">NORMAL</a>;
00035             }
00036       <span class="keywordflow">else</span>
00037             <a class="code" href="classCanvas.html#r0">_score</a>-&gt;<a class="code" href="classScore.html#a40">keyPressEvent</a>(ev);
00038       }
00039 
<a name="l00040"></a><a class="code" href="classScore.html#a40">00040</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#a40">Score::keyPressEvent</a>(QKeyEvent* ev)
00041       {
00042       <a class="code" href="classScore.html#r4">keyState</a> = ev-&gt;state();
00043       <span class="keywordflow">if</span> (ev-&gt;state() &amp; Qt::Keypad) {
00044             <span class="keywordflow">switch</span>(ev-&gt;key()) {
00045                   <span class="keywordflow">case</span> Qt::Key_Home:
00046                   <span class="keywordflow">case</span> Qt::Key_7:
00047                         <a class="code" href="classScore.html#i6">keyPadToggle</a>(<a class="code" href="pad_8h.html#a25a10">PAD_7</a>);
00048                         <span class="keywordflow">break</span>;
00049                   <span class="keywordflow">case</span> Qt::Key_End:
00050                   <span class="keywordflow">case</span> Qt::Key_1:
00051                         <a class="code" href="classScore.html#i6">keyPadToggle</a>(<a class="code" href="pad_8h.html#a25a4">PAD_1</a>);
00052                         <span class="keywordflow">break</span>;
00053                   <span class="keywordflow">case</span> Qt::Key_PageUp:
00054                   <span class="keywordflow">case</span> Qt::Key_9:
00055                         <a class="code" href="classScore.html#i6">keyPadToggle</a>(<a class="code" href="pad_8h.html#a25a12">PAD_9</a>);
00056                         <span class="keywordflow">break</span>;
00057                   <span class="keywordflow">case</span> Qt::Key_PageDown:
00058                   <span class="keywordflow">case</span> Qt::Key_3:
00059                         <a class="code" href="classScore.html#i6">keyPadToggle</a>(<a class="code" href="pad_8h.html#a25a6">PAD_3</a>);
00060                         <span class="keywordflow">break</span>;
00061                   <span class="keywordflow">case</span> Qt::Key_5:
00062                         <a class="code" href="classScore.html#i6">keyPadToggle</a>(<a class="code" href="pad_8h.html#a25a8">PAD_5</a>);
00063                         <span class="keywordflow">break</span>;
00064                   <span class="keywordflow">case</span> Qt::Key_Up:
00065                   <span class="keywordflow">case</span> Qt::Key_8:
00066                         <a class="code" href="classScore.html#i6">keyPadToggle</a>(<a class="code" href="pad_8h.html#a25a11">PAD_8</a>);
00067                         <span class="keywordflow">break</span>;
00068                   <span class="keywordflow">case</span> Qt::Key_Down:
00069                   <span class="keywordflow">case</span> Qt::Key_2:
00070                         <a class="code" href="classScore.html#i6">keyPadToggle</a>(<a class="code" href="pad_8h.html#a25a5">PAD_2</a>);
00071                         <span class="keywordflow">break</span>;
00072                   <span class="keywordflow">case</span> Qt::Key_Right:
00073                   <span class="keywordflow">case</span> Qt::Key_6:
00074                         <a class="code" href="classScore.html#i6">keyPadToggle</a>(<a class="code" href="pad_8h.html#a25a9">PAD_6</a>);
00075                         <span class="keywordflow">break</span>;
00076                   <span class="keywordflow">case</span> Qt::Key_Left:
00077                   <span class="keywordflow">case</span> Qt::Key_4:
00078                         <a class="code" href="classScore.html#i6">keyPadToggle</a>(<a class="code" href="pad_8h.html#a25a7">PAD_4</a>);
00079                         <span class="keywordflow">break</span>;
00080                   <span class="keywordflow">case</span> Qt::Key_Insert:
00081                   <span class="keywordflow">case</span> Qt::Key_0:
00082                         <a class="code" href="classScore.html#i6">keyPadToggle</a>(<a class="code" href="pad_8h.html#a25a3">PAD_0</a>);
00083                         <span class="keywordflow">break</span>;
00084                   <span class="keywordflow">case</span> Qt::Key_Delete:
00085                   <span class="keywordflow">case</span> <span class="charliteral">'.'</span>:
00086                         <a class="code" href="classScore.html#i6">keyPadToggle</a>(<a class="code" href="pad_8h.html#a25a19">PAD_COMMA</a>);
00087                         <span class="keywordflow">break</span>;
00088                   <span class="keywordflow">case</span> Qt::Key_NumLock:
00089                         <a class="code" href="classScore.html#i6">keyPadToggle</a>(<a class="code" href="pad_8h.html#a25a13">PAD_NUM</a>);
00090                         <span class="keywordflow">break</span>;
00091                   <span class="keywordflow">case</span> Qt::Key_Enter:
00092                         <a class="code" href="classScore.html#i6">keyPadToggle</a>(<a class="code" href="pad_8h.html#a25a18">PAD_ENTER</a>);
00093                         <span class="keywordflow">break</span>;
00094                   <span class="keywordflow">case</span> Qt::Key_Plus:
00095                         <a class="code" href="classScore.html#i6">keyPadToggle</a>(<a class="code" href="pad_8h.html#a25a17">PAD_PLUS</a>);
00096                         <span class="keywordflow">break</span>;
00097                   <span class="keywordflow">case</span> Qt::Key_Minus:
00098                         <a class="code" href="classScore.html#i6">keyPadToggle</a>(<a class="code" href="pad_8h.html#a25a16">PAD_MINUS</a>);
00099                         <span class="keywordflow">break</span>;
00100                   <span class="keywordflow">case</span> Qt::Key_Asterisk:
00101                         <span class="comment">// Mult</span>
00102                         <a class="code" href="classScore.html#i6">keyPadToggle</a>(<a class="code" href="pad_8h.html#a25a15">PAD_MULT</a>);
00103                         <span class="keywordflow">break</span>;
00104                   <span class="keywordflow">case</span> <span class="charliteral">'/'</span>:
00105                         <a class="code" href="classScore.html#i6">keyPadToggle</a>(<a class="code" href="pad_8h.html#a25a14">PAD_DIV</a>);
00106                         <span class="keywordflow">break</span>;
00107                   <span class="keywordflow">default</span>:
00108                         printf(<span class="stringliteral">"unknown key pad key 0x%02x\n"</span>, ev-&gt;key());
00109                         <span class="keywordflow">break</span>;
00110                   }
00111             <span class="keywordflow">return</span>;
00112             }
00113 
00114       <span class="keywordflow">if</span> (ev-&gt;state() == Qt::ShiftButton) {
00115             <span class="comment">// hack to get Shift+1 etc.</span>
00116             <span class="keywordtype">int</span> code = -1;
00117             <span class="keywordflow">switch</span>(<a class="code" href="app_8h.html#a0">app</a>-&gt;<a class="code" href="classMscoreApplication.html#a3">keyCode</a>()) {
00118                   <span class="keywordflow">case</span> 10: code = 12; <span class="keywordflow">break</span>;
00119                   <span class="keywordflow">case</span> 11: code = 13; <span class="keywordflow">break</span>;
00120                   <span class="keywordflow">case</span> 12: code = 14; <span class="keywordflow">break</span>;
00121                   <span class="keywordflow">case</span> 13: code = 15; <span class="keywordflow">break</span>;
00122                   <span class="keywordflow">case</span> 14: code = 16; <span class="keywordflow">break</span>;
00123                   <span class="keywordflow">case</span> 15: code = 17; <span class="keywordflow">break</span>;
00124                   <span class="keywordflow">case</span> 16: code = 18; <span class="keywordflow">break</span>;
00125                   <span class="keywordflow">case</span> 17: code = 19; <span class="keywordflow">break</span>;
00126                   }
00127             <span class="keywordflow">if</span> (code != -1)
00128                   <a class="code" href="classScore.html#i17">cmdAddIntervall</a>(code);
00129             }
00130       <a class="code" href="classScore.html#a83">startCmd</a>();
00131       <a class="code" href="classChordRest.html">ChordRest</a>* cr;
00132       <a class="code" href="classElement.html">Element</a>* el = <a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#a6">element</a>(); <span class="comment">// single selection</span>
00133       <span class="keywordtype">int</span> note    = -1;
00134 
00135       <span class="keywordflow">switch</span> (ev-&gt;key()) {
00136             <span class="keywordflow">case</span> Qt::Key_Plus:
00137                   <span class="keywordflow">if</span> (<a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#o0">state</a> == <a class="code" href="select_8h.html#a5a4">SEL_SYSTEM</a> || <a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#o0">state</a> == <a class="code" href="select_8h.html#a5a3">SEL_STAFF</a>) {
00138                         <span class="keywordtype">int</span> startTick = <a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#o1">tickStart</a>;
00139                         <span class="keywordtype">int</span> endTick = <a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#o2">tickEnd</a>;
00140                         <span class="keywordflow">for</span> (<a class="code" href="classMeasure.html">Measure</a>* im = <a class="code" href="classScore.html#a100">first</a>(); im; im = im-&gt;<a class="code" href="classMeasure.html#a64">next</a>()) {
00141                               <span class="keywordflow">if</span> (im-&gt;<a class="code" href="classElement.html#a74">tick</a>() &lt; startTick)
00142                                     <span class="keywordflow">continue</span>;
00143                               <span class="keywordflow">if</span> (im-&gt;<a class="code" href="classElement.html#a74">tick</a>() &gt;= endTick)
00144                                     <span class="keywordflow">break</span>;
00145                               <span class="keywordtype">double</span> stretch = im-&gt;<a class="code" href="classMeasure.html#a32">userStretch</a>();
00146                               stretch += 0.1;
00147                               im-&gt;<a class="code" href="classMeasure.html#a35">setUserStretch</a>(stretch);
00148                               }
00149                         <a class="code" href="classScore.html#a49">layout</a>();
00150                         }
00151                   <span class="keywordflow">break</span>;
00152             <span class="keywordflow">case</span> Qt::Key_Minus:
00153                   <span class="keywordflow">if</span> (<a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#o0">state</a> == <a class="code" href="select_8h.html#a5a4">SEL_SYSTEM</a> || <a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#o0">state</a> == <a class="code" href="select_8h.html#a5a3">SEL_STAFF</a>) {
00154                         <span class="keywordtype">int</span> startTick = <a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#o1">tickStart</a>;
00155                         <span class="keywordtype">int</span> endTick = <a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#o2">tickEnd</a>;
00156                         <span class="keywordflow">for</span> (<a class="code" href="classMeasure.html">Measure</a>* im = <a class="code" href="classScore.html#a100">first</a>(); im; im = im-&gt;<a class="code" href="classMeasure.html#a64">next</a>()) {
00157                               <span class="keywordflow">if</span> (im-&gt;<a class="code" href="classElement.html#a74">tick</a>() &lt; startTick)
00158                                     <span class="keywordflow">continue</span>;
00159                               <span class="keywordflow">if</span> (im-&gt;<a class="code" href="classElement.html#a74">tick</a>() &gt;= endTick)
00160                                     <span class="keywordflow">break</span>;
00161                               <span class="keywordtype">double</span> stretch = im-&gt;<a class="code" href="classMeasure.html#a32">userStretch</a>();
00162                               stretch -= 0.1;
00163                               im-&gt;<a class="code" href="classMeasure.html#a35">setUserStretch</a>(stretch);
00164                               }
00165                         <a class="code" href="classScore.html#a49">layout</a>();
00166                         }
00167                   <span class="keywordflow">break</span>;
00168             <span class="keywordflow">case</span> Qt::Key_C:  note = 0; <span class="keywordflow">break</span>;
00169             <span class="keywordflow">case</span> Qt::Key_D:  note = 1; <span class="keywordflow">break</span>;
00170             <span class="keywordflow">case</span> Qt::Key_E:  note = 2; <span class="keywordflow">break</span>;
00171             <span class="keywordflow">case</span> Qt::Key_F:  note = 3; <span class="keywordflow">break</span>;
00172             <span class="keywordflow">case</span> Qt::Key_G:  note = 4; <span class="keywordflow">break</span>;
00173             <span class="keywordflow">case</span> Qt::Key_A:  note = 5; <span class="keywordflow">break</span>;
00174             <span class="keywordflow">case</span> Qt::Key_B:  note = 6; <span class="keywordflow">break</span>;
00175 
00176             <span class="keywordflow">case</span> Qt::Key_X:
00177                   <a class="code" href="classScore.html#d5">cmdFlipStemDirection</a>();
00178                   <span class="keywordflow">break</span>;
00179 
00180             <span class="keywordflow">case</span> Qt::Key_Space:
00181                   <span class="keywordflow">if</span> (<a class="code" href="input_8h.html#a0">cis</a>-&gt;<a class="code" href="structInputState.html#o0">pos</a> == -1) {
00182                         <a class="code" href="classScore.html#a98">setNoteEntry</a>(<span class="keyword">true</span>, <span class="keyword">true</span>);
00183                         <a class="code" href="classElement.html">Element</a>* el = <a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#a6">element</a>();
00184                         <span class="keywordflow">if</span> (el-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a12">NOTE</a>)
00185                               el = el-&gt;<a class="code" href="classElement.html#a10">parent</a>();
00186                         <span class="keywordflow">if</span> (el-&gt;<a class="code" href="classElement.html#a42">isChordRest</a>())
00187                               <a class="code" href="input_8h.html#a0">cis</a>-&gt;<a class="code" href="structInputState.html#o0">pos</a> = ((<a class="code" href="classChordRest.html">ChordRest</a>*)el)-&gt;tick();
00188                         }
00189                   <span class="keywordflow">if</span> (<a class="code" href="input_8h.html#a0">cis</a>-&gt;<a class="code" href="structInputState.html#o0">pos</a> != -1) {
00190                         <span class="keywordtype">int</span> len = <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o2">tickLen</a>;
00191                         <a class="code" href="classScore.html#a44">setRest</a>(<a class="code" href="input_8h.html#a0">cis</a>-&gt;<a class="code" href="structInputState.html#o0">pos</a>, <a class="code" href="input_8h.html#a0">cis</a>-&gt;<a class="code" href="structInputState.html#o1">staff</a>, <a class="code" href="input_8h.html#a0">cis</a>-&gt;<a class="code" href="structInputState.html#o2">voice</a>, len);
00192                         <a class="code" href="input_8h.html#a0">cis</a>-&gt;<a class="code" href="structInputState.html#o0">pos</a> += len;
00193                         }
00194                   <a class="code" href="classScore.html#d8">moveCursor</a>();
00195                   <span class="keywordflow">break</span>;
00196 
00197             <span class="keywordflow">case</span> Qt::Key_Up:
00198                   <span class="keywordflow">if</span> (ev-&gt;state() == 0 || ev-&gt;state() == Qt::ControlButton)
00199                         <a class="code" href="classScore.html#a56">cmdUpDown</a>(<span class="keyword">true</span>, ev-&gt;state() == Qt::ControlButton);
00200                   <span class="keywordflow">else</span> {
00201                         <span class="keywordflow">if</span> (!el)
00202                               <span class="keywordflow">break</span>;
00203                         <a class="code" href="classElement.html">Element</a>* e = 0;
00204                         <span class="keywordflow">if</span> (el-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a12">NOTE</a>) {
00205                               <a class="code" href="classNote.html">Note</a>* note = (<a class="code" href="classNote.html">Note</a>*)el;
00206                               <span class="keywordflow">if</span> (ev-&gt;state() == Qt::AltButton)
00207                                     e = <a class="code" href="classScore.html#d17">upAlt</a>(el);
00208                               <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ev-&gt;state() == (Qt::AltButton|Qt::ControlButton))
00209                                     e = <a class="code" href="classScore.html#d18">upAltCtrl</a>(note);
00210                               <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ev-&gt;state() == (Qt::ShiftButton | Qt::ControlButton))
00211                                     e = <a class="code" href="classScore.html#d21">moveUp</a>(note);
00212                               }
00213                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ev-&gt;state() == Qt::AltButton)
00214                               e = <a class="code" href="classScore.html#d17">upAlt</a>(el);
00215                         <span class="keywordflow">if</span> (e) {
00216                               <span class="keywordflow">if</span> (e-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a12">NOTE</a>)
00217                                     <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o6">pitch</a> = ((<a class="code" href="classNote.html">Note</a>*)e)-&gt;pitch();
00218                               <a class="code" href="classScore.html#a47">select</a>(e, 0, 0);
00219                               }
00220                         }
00221                   <span class="keywordflow">break</span>;
00222 
00223             <span class="keywordflow">case</span> Qt::Key_Down:
00224                   <span class="keywordflow">if</span> (ev-&gt;state() == 0 || ev-&gt;state() == Qt::ControlButton)
00225                         <a class="code" href="classScore.html#a56">cmdUpDown</a>(<span class="keyword">false</span>, ev-&gt;state() == Qt::ControlButton);
00226                   <span class="keywordflow">else</span> {
00227                         <span class="keywordflow">if</span> (!el)
00228                               <span class="keywordflow">break</span>;
00229                         <a class="code" href="classElement.html">Element</a>* e = 0;
00230                         <span class="keywordflow">if</span> (el-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a12">NOTE</a> || el-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a25">CHORD</a>) {
00231                               <span class="keywordflow">if</span> (el-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a12">NOTE</a>) {
00232                                     <a class="code" href="classNote.html">Note</a>* note = (<a class="code" href="classNote.html">Note</a>*)el;
00233                                     <span class="keywordflow">if</span> (ev-&gt;state() == Qt::AltButton)
00234                                           e = <a class="code" href="classScore.html#d19">downAlt</a>(el);
00235                                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ev-&gt;state() == (Qt::AltButton|Qt::ControlButton))
00236                                           e = <a class="code" href="classScore.html#d20">downAltCtrl</a>(note);
00237                                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ev-&gt;state() == (Qt::ShiftButton | Qt::ControlButton))
00238                                           e = <a class="code" href="classScore.html#d22">moveDown</a>(note);
00239                                     }
00240                               }
00241                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ev-&gt;state() == Qt::AltButton)
00242                               e = <a class="code" href="classScore.html#d19">downAlt</a>(el);
00243                         <span class="keywordflow">if</span> (e) {
00244                               <span class="keywordflow">if</span> (e-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a12">NOTE</a>)
00245                                     <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o6">pitch</a> = ((<a class="code" href="classNote.html">Note</a>*)e)-&gt;pitch();
00246                               <a class="code" href="classScore.html#a47">select</a>(e, 0, 0);
00247                               }
00248                         }
00249                   <span class="keywordflow">break</span>;
00250             <span class="keywordflow">case</span> Qt::Key_Right:
00251                   <span class="keywordflow">if</span> (<a class="code" href="classScore.html#a46">canvas</a>()-&gt;<a class="code" href="classCanvas.html#a14">getState</a>() == Canvas::NOTE_ENTRY)
00252                         <a class="code" href="classScore.html#a98">setNoteEntry</a>(<span class="keyword">false</span>, <span class="keyword">false</span>);
00253                   cr = <a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#a8">lastChordRest</a>();
00254                   <span class="keywordflow">if</span> (cr) {
00255                         <span class="keywordflow">if</span> (ev-&gt;state() == Qt::ControlButton)
00256                               el = <a class="code" href="classScore.html#d2">nextMeasure</a>(cr);
00257                         <span class="keywordflow">else</span>
00258                               el = <a class="code" href="classScore.html#d0">nextChordRest</a>(cr);
00259                         <span class="keywordflow">if</span> (el &amp;&amp; el-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a25">CHORD</a>)
00260                               el = ((<a class="code" href="classChord.html">Chord</a>*)el)-&gt;upNote();
00261                         <span class="keywordflow">if</span> (el) {
00262                               <a class="code" href="classScore.html#a47">select</a>(el, 0, 0);
00263                               <a class="code" href="classScore.html#a105">adjustCanvasPosition</a>(el);
00264                               }
00265                         }
00266                   <span class="keywordflow">break</span>;
00267             <span class="keywordflow">case</span> Qt::Key_Left:
00268                   <span class="keywordflow">if</span> (<a class="code" href="classScore.html#a46">canvas</a>()-&gt;<a class="code" href="classCanvas.html#a14">getState</a>() == Canvas::NOTE_ENTRY)
00269                         <a class="code" href="classScore.html#a98">setNoteEntry</a>(<span class="keyword">false</span>, <span class="keyword">false</span>);
00270                   cr = <a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#a7">firstChordRest</a>();
00271                   <span class="keywordflow">if</span> (cr) {
00272                         <span class="keywordflow">if</span> (ev-&gt;state() == Qt::ControlButton)
00273                               el = <a class="code" href="classScore.html#d3">prevMeasure</a>(cr);
00274                         <span class="keywordflow">else</span>
00275                               el = <a class="code" href="classScore.html#d1">prevChordRest</a>(cr);
00276                         <span class="keywordflow">if</span> (el &amp;&amp; el-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a25">CHORD</a>)
00277                               el = ((<a class="code" href="classChord.html">Chord</a>*)el)-&gt;upNote();
00278                         <span class="keywordflow">if</span> (el) {
00279                               <a class="code" href="classScore.html#a47">select</a>(el, 0, 0);
00280                               <a class="code" href="classScore.html#a105">adjustCanvasPosition</a>(el);
00281                               }
00282                         }
00283                   <span class="keywordflow">break</span>;
00284 
00285             <span class="keywordflow">case</span> Qt::Key_PageUp:
00286                   <a class="code" href="classScore.html#d14">pagePrev</a>();
00287                   <span class="keywordflow">break</span>;
00288             <span class="keywordflow">case</span> Qt::Key_PageDown:
00289                   <a class="code" href="classScore.html#d13">pageNext</a>();
00290                   <span class="keywordflow">break</span>;
00291             <span class="keywordflow">case</span> Qt::Key_Home:
00292                   <a class="code" href="classScore.html#d15">pageTop</a>();
00293                   <span class="keywordflow">break</span>;
00294             <span class="keywordflow">case</span> Qt::Key_End:
00295                   <a class="code" href="classScore.html#d16">pageEnd</a>();
00296                   <span class="keywordflow">break</span>;
00297             <span class="keywordflow">case</span> Qt::Key_S:
00298                   <a class="code" href="classScore.html#a70">cmdAddSlur</a>();
00299                   <span class="keywordflow">break</span>;
00300 
00301             <span class="keywordflow">case</span> Qt::Key_H:
00302                   <a class="code" href="classScore.html#a71">cmdAddHairpin</a>(ev-&gt;state() &amp; Qt::ShiftButton);
00303                   <span class="keywordflow">break</span>;
00304 
00305             <span class="keywordflow">case</span> Qt::Key_Escape:
00306                   <span class="keywordflow">if</span> (<a class="code" href="input_8h.html#a0">cis</a>-&gt;<a class="code" href="structInputState.html#o0">pos</a> != -1 || <a class="code" href="classScore.html#a46">canvas</a>()-&gt;<a class="code" href="classCanvas.html#a14">getState</a>() == Canvas::PALETTE) {
00307                         <a class="code" href="classScore.html#a98">setNoteEntry</a>(<span class="keyword">false</span>, <span class="keyword">false</span>);
00308                         <span class="keywordflow">break</span>;
00309                         }
00310                   <a class="code" href="classScore.html#a47">select</a>(0, 0, 0);
00311                   <span class="keywordflow">break</span>;
00312 
00313             <span class="keywordflow">case</span> Qt::Key_Delete:
00314                   <a class="code" href="classScore.html#a75">cmdDeleteSelection</a>();
00315                   <span class="keywordflow">break</span>;
00316 
00317             <span class="keywordflow">case</span> Qt::Key_F10:
00318                   <a class="code" href="classScore.html#a46">canvas</a>()-&gt;<a class="code" href="classCanvas.html#i1">showPad</a>();
00319                   <span class="keywordflow">break</span>;
00320 
00321             <span class="keywordflow">default</span>:
00322                   <a class="code" href="classScore.html#a84">endCmd</a>(<span class="keyword">true</span>);
00323                   <span class="keywordflow">return</span>;
00324             }
00325       <span class="keywordflow">if</span> (note != -1) {
00326             <span class="comment">// c d e f g a b   entered</span>
00327             <span class="keywordtype">int</span> octave = <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o6">pitch</a> / 12;
00328             <span class="keyword">static</span> <span class="keywordtype">int</span> ptab[15][7] = {
00329               <span class="comment">//    c  d  e  f  g  a  b</span>
00330                   { -1, 1, 3, 5, 6,  8, 10 },     <span class="comment">// Bes</span>
00331                   { -1, 2, 3, 5, 6,  8, 10 },     <span class="comment">// Ges</span>
00332                   {  0, 2, 3, 5, 6,  8, 10 },     <span class="comment">// Des</span>
00333                   {  0, 2, 3, 5, 7,  8, 10 },     <span class="comment">// As</span>
00334                   {  0, 2, 3, 5, 7,  8, 10 },     <span class="comment">// Es</span>
00335                   {  0, 2, 3, 5, 7,  9, 10 },     <span class="comment">// B</span>
00336                   {  0, 2, 4, 5, 7,  9, 11 },     <span class="comment">// F</span>
00337                   {  0, 2, 4, 5, 7,  9, 11 },     <span class="comment">// C</span>
00338                   {  0, 2, 4, 6, 7,  9, 11 },     <span class="comment">// G</span>
00339                   {  1, 2, 4, 6, 7,  9, 11 },     <span class="comment">// D</span>
00340                   {  1, 2, 4, 6, 8,  9, 11 },     <span class="comment">// A</span>
00341                   {  1, 3, 4, 6, 8,  9, 11 },     <span class="comment">// E</span>
00342                   {  1, 3, 4, 6, 8, 10, 11 },     <span class="comment">// H</span>
00343                   {  1, 3, 5, 6, 8, 10, 11 },     <span class="comment">// Fis</span>
00344                   {  1, 3, 5, 6, 8, 10, 12 },     <span class="comment">// Cis</span>
00345                   };
00346             <span class="keywordtype">int</span> key   = <a class="code" href="classScore.html#o10">keymap</a>-&gt;<a class="code" href="classKeyList.html#a1">key</a>(<a class="code" href="input_8h.html#a0">cis</a>-&gt;<a class="code" href="structInputState.html#o0">pos</a>) + 7;
00347             <span class="keywordtype">int</span> pitch = ptab[key][note];
00348 
00349             <span class="keywordtype">int</span> delta = <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o6">pitch</a> - (octave*12 + pitch);
00350             <span class="keywordflow">if</span> (delta &gt; 6)
00351                   <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o6">pitch</a> = (octave+1)*12 + pitch;
00352             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (delta &lt; -6)
00353                   <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o6">pitch</a> = (octave-1)*12 + pitch;
00354             <span class="keywordflow">else</span>
00355                   <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o6">pitch</a> = octave*12 + pitch;
00356             <span class="keywordflow">if</span> (<a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o6">pitch</a> &lt; 0)
00357                   <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o6">pitch</a> = 0;
00358             <span class="keywordflow">if</span> (<a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o6">pitch</a> &gt; 127)
00359                   <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o6">pitch</a> = 127;
00360             <span class="keywordtype">int</span> len = <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o2">tickLen</a>;
00361             <span class="keywordflow">if</span> (<a class="code" href="input_8h.html#a0">cis</a>-&gt;<a class="code" href="structInputState.html#o0">pos</a> == -1)
00362                   <a class="code" href="classScore.html#a98">setNoteEntry</a>(<span class="keyword">true</span>, <span class="keyword">false</span>);
00363             <a class="code" href="classScore.html#a41">setNote</a>(<a class="code" href="input_8h.html#a0">cis</a>-&gt;<a class="code" href="structInputState.html#o0">pos</a>, <a class="code" href="classScore.html#a7">staff</a>(<a class="code" href="input_8h.html#a0">cis</a>-&gt;<a class="code" href="structInputState.html#o1">staff</a>), <a class="code" href="input_8h.html#a0">cis</a>-&gt;<a class="code" href="structInputState.html#o2">voice</a>, <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o6">pitch</a>, len);
00364             <a class="code" href="input_8h.html#a0">cis</a>-&gt;<a class="code" href="structInputState.html#o0">pos</a> += len;
00365             <a class="code" href="classScore.html#d8">moveCursor</a>();
00366             }
00367       <a class="code" href="classScore.html#a84">endCmd</a>(<span class="keyword">true</span>);
00368       }
00369 
00370 <span class="comment">//---------------------------------------------------------</span>
00371 <span class="comment">//   keyPadToggle</span>
00372 <span class="comment">//---------------------------------------------------------</span>
00373 
<a name="l00374"></a><a class="code" href="classScore.html#i6">00374</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#i6">Score::keyPadToggle</a>(<span class="keywordtype">int</span> key)
00375       {
00376       <span class="keywordtype">int</span> padno = -1;
00377       <span class="keywordflow">if</span> (key &gt;= <a class="code" href="pad_8h.html#a25a20">PAD_N0</a> &amp;&amp; key &lt;= <a class="code" href="pad_8h.html#a25a24">PAD_N4</a>)
00378             padno = key - <a class="code" href="pad_8h.html#a25a20">PAD_N0</a>;
00379       <span class="keywordflow">if</span> (key == <a class="code" href="pad_8h.html#a25a17">PAD_PLUS</a>) {
00380             padno = <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o4">pad</a> + 1;
00381             <span class="keywordflow">if</span> (padno == 5)
00382                   padno = 0;
00383             }
00384       <span class="keywordflow">if</span> (padno &gt;= 0) {
00385             <a class="code" href="classScore.html#a46">canvas</a>()-&gt;<a class="code" href="classCanvas.html#a16">setPadNo</a>(padno);
00386             <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o4">pad</a> = padno;
00387             <a class="code" href="classScore.html#a82">setPadState</a>();
00388             <span class="keywordflow">return</span>;
00389             }
00390       <a class="code" href="classScore.html#i7">padToggle</a>(<a class="code" href="pad_8cpp.html#a2">padTrans</a>[<a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o4">pad</a>][key].cmd);
00391       }
00392 
00393 <span class="comment">//---------------------------------------------------------</span>
00394 <span class="comment">//   padToggle</span>
00395 <span class="comment">//    called from keyPadToggle</span>
00396 <span class="comment">//    menu button callback</span>
00397 <span class="comment">//---------------------------------------------------------</span>
00398 
<a name="l00399"></a><a class="code" href="classScore.html#i7">00399</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#i7">Score::padToggle</a>(<span class="keywordtype">int</span> n)
00400       {
00401       <a class="code" href="classScore.html#a83">startCmd</a>();
00402       <span class="keywordflow">switch</span> (n) {
00403             <span class="keywordflow">case</span> <a class="code" href="padids_8h.html#a29a0">PAD_NOTE1</a>:
00404                   <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o1">len</a> = <a class="code" href="mtime_8h.html#a0">division</a> * 4;
00405                   <span class="keywordflow">break</span>;
00406             <span class="keywordflow">case</span> <a class="code" href="padids_8h.html#a29a1">PAD_NOTE2</a>:
00407                   <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o1">len</a> = <a class="code" href="mtime_8h.html#a0">division</a> * 2;
00408                   <span class="keywordflow">break</span>;
00409             <span class="keywordflow">case</span> <a class="code" href="padids_8h.html#a29a2">PAD_NOTE4</a>:
00410                   <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o1">len</a> = <a class="code" href="mtime_8h.html#a0">division</a>;
00411                   <span class="keywordflow">break</span>;
00412             <span class="keywordflow">case</span> <a class="code" href="padids_8h.html#a29a3">PAD_NOTE8</a>:
00413                   <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o1">len</a> = <a class="code" href="mtime_8h.html#a0">division</a>/2;
00414                   <span class="keywordflow">break</span>;
00415             <span class="keywordflow">case</span> <a class="code" href="padids_8h.html#a29a4">PAD_NOTE16</a>:
00416                   <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o1">len</a> = <a class="code" href="mtime_8h.html#a0">division</a>/4;
00417                   <span class="keywordflow">break</span>;
00418             <span class="keywordflow">case</span> <a class="code" href="padids_8h.html#a29a5">PAD_NOTE32</a>:
00419                   <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o1">len</a> = <a class="code" href="mtime_8h.html#a0">division</a>/8;
00420                   <span class="keywordflow">break</span>;
00421             <span class="keywordflow">case</span> <a class="code" href="padids_8h.html#a29a6">PAD_NOTE64</a>:
00422                   <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o1">len</a> = <a class="code" href="mtime_8h.html#a0">division</a>/16;
00423                   <span class="keywordflow">break</span>;
00424             <span class="keywordflow">case</span> <a class="code" href="padids_8h.html#a29a9">PAD_SHARP2</a>:
00425                   <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o7">prefix</a> = <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o7">prefix</a> != 3 ? 3 : 0;
00426                   <span class="keywordflow">break</span>;
00427             <span class="keywordflow">case</span> <a class="code" href="padids_8h.html#a29a10">PAD_SHARP</a>:
00428                   <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o7">prefix</a> = <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o7">prefix</a> != 1 ? 1 : 0;
00429                   <span class="keywordflow">break</span>;
00430             <span class="keywordflow">case</span> <a class="code" href="padids_8h.html#a29a11">PAD_NAT</a>:
00431                   <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o7">prefix</a> = <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o7">prefix</a> != 5 ? 5 : 0;
00432                   <span class="keywordflow">break</span>;
00433             <span class="keywordflow">case</span> <a class="code" href="padids_8h.html#a29a12">PAD_FLAT</a>:
00434                   <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o7">prefix</a> = <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o7">prefix</a> != 2 ? 2 : 0;
00435                   <span class="keywordflow">break</span>;
00436             <span class="keywordflow">case</span> <a class="code" href="padids_8h.html#a29a13">PAD_FLAT2</a>:
00437                   <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o7">prefix</a> = <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o7">prefix</a> != 4 ? 4 : 0;
00438                   <span class="keywordflow">break</span>;
00439             <span class="keywordflow">case</span> <a class="code" href="padids_8h.html#a29a7">PAD_REST</a>:
00440                   <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o3">rest</a> = !<a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o3">rest</a>;
00441                   <span class="keywordflow">break</span>;
00442             <span class="keywordflow">case</span> <a class="code" href="padids_8h.html#a29a8">PAD_DOT</a>:
00443                   <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o0">dot</a> = !<a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o0">dot</a>;
00444                   <span class="keywordflow">break</span>;
00445             <span class="keywordflow">case</span> <a class="code" href="padids_8h.html#a29a16">PAD_TIE</a>:
00446                   <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o8">tie</a> = !<a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o8">tie</a>;
00447                   <span class="keywordflow">break</span>;
00448             <span class="keywordflow">case</span> <a class="code" href="padids_8h.html#a29a14">PAD_ESCAPE</a>:
00449                   <a class="code" href="classScore.html#a46">canvas</a>()-&gt;<a class="code" href="classCanvas.html#a13">setState</a>(Canvas::NORMAL);
00450                   <span class="keywordflow">break</span>;
00451             <span class="keywordflow">case</span> <a class="code" href="padids_8h.html#a29a17">PAD_TENUTO</a>:
00452                   <a class="code" href="classScore.html#a59">addObjectToSelected</a>(<span class="keyword">new</span> <a class="code" href="classNoteAttribute.html">NoteAttribute</a>(<span class="keyword">this</span>, <a class="code" href="note_8h.html#a35a17">TenutoSym</a>));
00453                   <span class="keywordflow">break</span>;
00454             <span class="keywordflow">case</span> <a class="code" href="padids_8h.html#a29a19">PAD_AKZENT</a>:
00455                   <a class="code" href="classScore.html#a59">addObjectToSelected</a>(<span class="keyword">new</span> <a class="code" href="classNoteAttribute.html">NoteAttribute</a>(<span class="keyword">this</span>, <a class="code" href="note_8h.html#a35a13">SforzatoaccentSym</a>));
00456                   <span class="keywordflow">break</span>;
00457             <span class="keywordflow">case</span> <a class="code" href="padids_8h.html#a29a18">PAD_STACCATO</a>:
00458                   <a class="code" href="classScore.html#a59">addObjectToSelected</a>(<span class="keyword">new</span> <a class="code" href="classNoteAttribute.html">NoteAttribute</a>(<span class="keyword">this</span>, <a class="code" href="note_8h.html#a35a14">StaccatoSym</a>));
00459                   <span class="keywordflow">break</span>;
00460             <span class="keywordflow">case</span> <a class="code" href="padids_8h.html#a29a21">PAD_BEAM_START</a>:
00461                   <a class="code" href="classScore.html#d4">cmdSetBeamMode</a>(<a class="code" href="note_8h.html#a36a30">BEAM_BEGIN</a>);
00462                   <span class="keywordflow">break</span>;
00463             <span class="keywordflow">case</span> <a class="code" href="padids_8h.html#a29a22">PAD_BEAM_MID</a>:
00464                   <a class="code" href="classScore.html#d4">cmdSetBeamMode</a>(<a class="code" href="note_8h.html#a36a31">BEAM_MID</a>);
00465                   <span class="keywordflow">break</span>;
00466             <span class="keywordflow">case</span> <a class="code" href="padids_8h.html#a29a23">PAD_BEAM_NO</a>:
00467                   <a class="code" href="classScore.html#d4">cmdSetBeamMode</a>(<a class="code" href="note_8h.html#a36a33">BEAM_NO</a>);
00468                   <span class="keywordflow">break</span>;
00469             <span class="keywordflow">case</span> <a class="code" href="padids_8h.html#a29a24">PAD_BEAM32</a>:
00470                   <a class="code" href="classScore.html#d4">cmdSetBeamMode</a>(<a class="code" href="note_8h.html#a36a34">BEAM_BEGIN32</a>);
00471                   <span class="keywordflow">break</span>;
00472             <span class="keywordflow">case</span> <a class="code" href="padids_8h.html#a29a20">PAD_FLIP</a>:
00473                   <a class="code" href="classScore.html#d5">cmdFlipStemDirection</a>();
00474                   <span class="keywordflow">break</span>;
00475             <span class="keywordflow">case</span> <a class="code" href="padids_8h.html#a29a25">PAD_VOICE0</a>:
00476                   <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o5">voice</a> = 0;
00477                   <span class="keywordflow">break</span>;
00478             <span class="keywordflow">case</span> <a class="code" href="padids_8h.html#a29a26">PAD_VOICE1</a>:
00479                   <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o5">voice</a> = 1;
00480                   <span class="keywordflow">break</span>;
00481             <span class="keywordflow">case</span> <a class="code" href="padids_8h.html#a29a27">PAD_VOICE2</a>:
00482                   <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o5">voice</a> = 2;
00483                   <span class="keywordflow">break</span>;
00484             <span class="keywordflow">case</span> <a class="code" href="padids_8h.html#a29a28">PAD_VOICE3</a>:
00485                   <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o5">voice</a> = 3;
00486                   <span class="keywordflow">break</span>;
00487             }
00488       <a class="code" href="classScore.html#a82">setPadState</a>();
00489       <span class="keywordflow">if</span> (n &gt;= <a class="code" href="padids_8h.html#a29a0">PAD_NOTE1</a> &amp;&amp; n &lt;= <a class="code" href="padids_8h.html#a29a8">PAD_DOT</a>) {
00490             <span class="keywordflow">if</span> (n &gt;= <a class="code" href="padids_8h.html#a29a0">PAD_NOTE1</a> &amp;&amp; n &lt;= <a class="code" href="padids_8h.html#a29a6">PAD_NOTE64</a>)
00491                   <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o0">dot</a> = <span class="keyword">false</span>;
00492             <span class="keywordflow">if</span> (<a class="code" href="input_8h.html#a0">cis</a>-&gt;<a class="code" href="structInputState.html#o0">pos</a> == -1 &amp;&amp; <a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#o0">state</a> == <a class="code" href="select_8h.html#a5a1">SEL_SINGLE</a>) {
00493                   <a class="code" href="classElement.html">Element</a>* el = <a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#a6">element</a>();
00494                   <span class="keywordflow">if</span> (el-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a12">NOTE</a>)
00495                         el = el-&gt;<a class="code" href="classElement.html#a10">parent</a>();
00496                   <span class="keywordflow">if</span> (el-&gt;<a class="code" href="classElement.html#a42">isChordRest</a>()) {
00497                         <span class="keywordtype">int</span> tick = ((<a class="code" href="classChordRest.html">ChordRest</a>*)el)-&gt;tick();
00498                         <span class="keywordtype">int</span> len = <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o2">tickLen</a>;
00499                         <span class="keywordflow">if</span> (<a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o3">rest</a>)
00500                               <a class="code" href="classScore.html#a44">setRest</a>(tick, <a class="code" href="input_8h.html#a0">cis</a>-&gt;<a class="code" href="structInputState.html#o1">staff</a>, <a class="code" href="input_8h.html#a0">cis</a>-&gt;<a class="code" href="structInputState.html#o2">voice</a>, len);
00501                         <span class="keywordflow">else</span>
00502                               <a class="code" href="classScore.html#a41">setNote</a>(tick, <a class="code" href="classScore.html#a7">staff</a>(<a class="code" href="input_8h.html#a0">cis</a>-&gt;<a class="code" href="structInputState.html#o1">staff</a>), <a class="code" href="input_8h.html#a0">cis</a>-&gt;<a class="code" href="structInputState.html#o2">voice</a>, <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o6">pitch</a>, len);
00503                         }
00504                   }
00505             }
00506       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (n &gt;= <a class="code" href="padids_8h.html#a29a9">PAD_SHARP2</a> &amp;&amp; n &lt;= <a class="code" href="padids_8h.html#a29a13">PAD_FLAT2</a>)
00507             <a class="code" href="classScore.html#a59">addObjectToSelected</a>(<span class="keyword">new</span> <a class="code" href="classPrefix.html">Prefix</a>(<span class="keyword">this</span>, <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o7">prefix</a>, <span class="keyword">false</span>));
00508       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (n &gt;= <a class="code" href="padids_8h.html#a29a25">PAD_VOICE0</a> &amp;&amp; n &lt;= <a class="code" href="padids_8h.html#a29a28">PAD_VOICE3</a>)
00509             <a class="code" href="classScore.html#a97">changeVoice</a>(<a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o5">voice</a>);
00510       <a class="code" href="classScore.html#a84">endCmd</a>(<span class="keyword">true</span>);
00511       }
00512 
00513 <span class="comment">//---------------------------------------------------------</span>
00514 <span class="comment">//   setKeyPad</span>
00515 <span class="comment">//---------------------------------------------------------</span>
00516 
<a name="l00517"></a><a class="code" href="classScore.html#a81">00517</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#a81">Score::setKeyPad</a>(<span class="keywordtype">bool</span> val, <span class="keywordtype">int</span> <span class="keywordtype">id</span>)
00518       {
00519       emit <a class="code" href="classScore.html#l1">padChanged</a>(val, <span class="keywordtype">id</span>);
00520       }
00521 
00522 <span class="comment">//---------------------------------------------------------</span>
00523 <span class="comment">//   setPadState</span>
00524 <span class="comment">//---------------------------------------------------------</span>
00525 
<a name="l00526"></a><a class="code" href="project_8h.html#a9">00526</a> <span class="keywordtype">void</span> <a class="code" href="project_8h.html#a9">setPadState</a>(<a class="code" href="classElement.html">Element</a>* obj)
00527       {
00528       <a class="code" href="element_8h.html#a65">ElementType</a> type = obj-&gt;<a class="code" href="classElement.html#a40">type</a>();
00529       <span class="keywordtype">int</span> len = -1;
00530       <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o8">tie</a> = <span class="keyword">false</span>;
00531 
00532       <span class="keywordflow">if</span> (type == <a class="code" href="element_8h.html#a65a12">NOTE</a>) {
00533             len             = ((<a class="code" href="classNote.html">Note</a>*)obj)-&gt;totalTicks();
00534             <a class="code" href="classPrefix.html">Prefix</a>* prefix  = ((<a class="code" href="classNote.html">Note</a>*)obj)-&gt;accidental();
00535             <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o7">prefix</a> = prefix ? prefix-&gt;<a class="code" href="classPrefix.html#a2">idx</a>() : 0;
00536             <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o3">rest</a>   = <span class="keyword">false</span>;
00537             <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o5">voice</a>  = obj-&gt;<a class="code" href="classElement.html#a62">voice</a>();
00538             <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o6">pitch</a>  = ((<a class="code" href="classNote.html">Note</a>*)obj)-&gt;pitch();
00539             <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o8">tie</a>    = ((<a class="code" href="classNote.html">Note</a>*)obj)-&gt;tieFor();
00540             }
00541       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == <a class="code" href="element_8h.html#a65a26">REST</a>) {
00542             len             = ((<a class="code" href="classRest.html">Rest</a>*)obj)-&gt;tickLen();
00543             <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o7">prefix</a> = 0;
00544             <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o3">rest</a>   = <span class="keyword">true</span>;
00545             <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o5">voice</a>  = obj-&gt;<a class="code" href="classElement.html#a62">voice</a>();
00546             }
00547       <span class="keywordflow">else</span> {
00548             <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o3">rest</a>   = <span class="keyword">false</span>;
00549             <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o1">len</a>    = 0;
00550             <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o7">prefix</a> = 0;
00551             }
00552       <span class="keywordflow">if</span> (len == -1) {
00553             <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o0">dot</a> = <span class="keyword">false</span>;
00554             <span class="keywordflow">return</span>;
00555             }
00556 
00557       <span class="keyword">struct </span>nv {
00558             <span class="keywordtype">int</span> ticks;
00559             <span class="keywordtype">int</span> pad;
00560             } values[] = {
00561             { <a class="code" href="mtime_8h.html#a0">division</a>*4 ,  <a class="code" href="padids_8h.html#a29a0">PAD_NOTE1</a>},
00562             { <a class="code" href="mtime_8h.html#a0">division</a>*2 ,  <a class="code" href="padids_8h.html#a29a1">PAD_NOTE2</a>},
00563             { <a class="code" href="mtime_8h.html#a0">division</a> ,    <a class="code" href="padids_8h.html#a29a2">PAD_NOTE4</a>},
00564             { <a class="code" href="mtime_8h.html#a0">division</a>/2 ,  <a class="code" href="padids_8h.html#a29a3">PAD_NOTE8</a>},
00565             { <a class="code" href="mtime_8h.html#a0">division</a>/4 ,  <a class="code" href="padids_8h.html#a29a4">PAD_NOTE16</a>},
00566             { <a class="code" href="mtime_8h.html#a0">division</a>/8 ,  <a class="code" href="padids_8h.html#a29a5">PAD_NOTE32</a>},
00567             { <a class="code" href="mtime_8h.html#a0">division</a>/16 , <a class="code" href="padids_8h.html#a29a6">PAD_NOTE64</a>},
00568             };
00569 
00570       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <span class="keyword">sizeof</span>(values)/<span class="keyword">sizeof</span>(*values); ++i) {
00571             <span class="keywordtype">int</span> n = values[i].ticks;
00572             <span class="keywordflow">if</span> (len / n) {
00573                   <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o1">len</a> = n;
00574                   <span class="keywordtype">int</span> rest     = len % n;
00575                   <span class="keywordflow">if</span> (len &lt;= (<a class="code" href="mtime_8h.html#a0">division</a> * 4))
00576                         <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o0">dot</a> = (rest == n/2);
00577                   <span class="keywordflow">else</span>
00578                         <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o0">dot</a> = <span class="keyword">false</span>;
00579                   <span class="keywordflow">break</span>;
00580                   }
00581             }
00582       }
00583 
00584 <span class="comment">//---------------------------------------------------------</span>
00585 <span class="comment">//   setPadState</span>
00586 <span class="comment">//---------------------------------------------------------</span>
00587 
<a name="l00588"></a><a class="code" href="classScore.html#a82">00588</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#a82">Score::setPadState</a>()
00589       {
00590       <a class="code" href="classScore.html#a81">setKeyPad</a>(<span class="keyword">false</span>, <a class="code" href="padids_8h.html#a29a14">PAD_ESCAPE</a>);
00591       <a class="code" href="classScore.html#a81">setKeyPad</a>(<a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o3">rest</a>, <a class="code" href="padids_8h.html#a29a7">PAD_REST</a>);
00592       <a class="code" href="classScore.html#a81">setKeyPad</a>(<a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o0">dot</a>, <a class="code" href="padids_8h.html#a29a8">PAD_DOT</a>);
00593       <a class="code" href="classScore.html#a81">setKeyPad</a>(<a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o8">tie</a>, <a class="code" href="padids_8h.html#a29a16">PAD_TIE</a>);
00594       <a class="code" href="classScore.html#a81">setKeyPad</a>(<a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o1">len</a> == <a class="code" href="mtime_8h.html#a0">division</a>*4, <a class="code" href="padids_8h.html#a29a0">PAD_NOTE1</a>);
00595       <a class="code" href="classScore.html#a81">setKeyPad</a>(<a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o1">len</a> == <a class="code" href="mtime_8h.html#a0">division</a>*2, <a class="code" href="padids_8h.html#a29a1">PAD_NOTE2</a>);
00596       <a class="code" href="classScore.html#a81">setKeyPad</a>(<a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o1">len</a> == <a class="code" href="mtime_8h.html#a0">division</a>, <a class="code" href="padids_8h.html#a29a2">PAD_NOTE4</a>);
00597       <a class="code" href="classScore.html#a81">setKeyPad</a>(<a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o1">len</a> == <a class="code" href="mtime_8h.html#a0">division</a>/2, <a class="code" href="padids_8h.html#a29a3">PAD_NOTE8</a>);
00598       <a class="code" href="classScore.html#a81">setKeyPad</a>(<a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o1">len</a> == <a class="code" href="mtime_8h.html#a0">division</a>/4, <a class="code" href="padids_8h.html#a29a4">PAD_NOTE16</a>);
00599       <a class="code" href="classScore.html#a81">setKeyPad</a>(<a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o1">len</a> == <a class="code" href="mtime_8h.html#a0">division</a>/8, <a class="code" href="padids_8h.html#a29a5">PAD_NOTE32</a>);
00600       <a class="code" href="classScore.html#a81">setKeyPad</a>(<a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o1">len</a> == <a class="code" href="mtime_8h.html#a0">division</a>/16, <a class="code" href="padids_8h.html#a29a6">PAD_NOTE64</a>);
00601       <a class="code" href="classScore.html#a81">setKeyPad</a>(<a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o7">prefix</a> == 3, <a class="code" href="padids_8h.html#a29a9">PAD_SHARP2</a>);
00602       <a class="code" href="classScore.html#a81">setKeyPad</a>(<a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o7">prefix</a> == 1, <a class="code" href="padids_8h.html#a29a10">PAD_SHARP</a>);
00603       <a class="code" href="classScore.html#a81">setKeyPad</a>(<a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o7">prefix</a> == 5, <a class="code" href="padids_8h.html#a29a11">PAD_NAT</a>);
00604       <a class="code" href="classScore.html#a81">setKeyPad</a>(<a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o7">prefix</a> == 2, <a class="code" href="padids_8h.html#a29a12">PAD_FLAT</a>);
00605       <a class="code" href="classScore.html#a81">setKeyPad</a>(<a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o7">prefix</a> == 4, <a class="code" href="padids_8h.html#a29a13">PAD_FLAT2</a>);
00606       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="globals_8h.html#a3">VOICES</a>; ++i)
00607             <a class="code" href="classScore.html#a81">setKeyPad</a>(<a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o5">voice</a> == i, <a class="code" href="padids_8h.html#a29a25">PAD_VOICE0</a> + i);
00608       <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o2">tickLen</a> = <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o1">len</a> +
00609          (<a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o0">dot</a> ? <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o1">len</a>/2 : 0);
00610       }
00611 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Mon Jun 27 22:28:28 2005 for MuseScore by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
