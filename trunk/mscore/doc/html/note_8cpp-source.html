<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>MuseScore: note.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>note.cpp</h1><a href="note_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">//=========================================================</span>
00002 <span class="comment">//  MuseScore</span>
00003 <span class="comment">//  Linux Music Score Editor</span>
00004 <span class="comment">//  $Id: note.cpp,v 1.40 2005/06/20 13:54:53 wschweer Exp $</span>
00005 <span class="comment">//</span>
00006 <span class="comment">//  (C) Copyright 2002-2004 Werner Schweer (ws@seh.de)</span>
00007 <span class="comment">//=========================================================</span>
00008 
00009 <span class="preprocessor">#include "<a class="code" href="project_8h.html">project.h</a>"</span>
00010 <span class="preprocessor">#include "<a class="code" href="key_8h.html">key.h</a>"</span>
00011 <span class="preprocessor">#include "<a class="code" href="note_8h.html">note.h</a>"</span>
00012 <span class="preprocessor">#include "<a class="code" href="symbols_8h.html">symbols.h</a>"</span>
00013 <span class="preprocessor">#include "<a class="code" href="xml_8h.html">xml.h</a>"</span>
00014 <span class="preprocessor">#include "<a class="code" href="slur_8h.html">slur.h</a>"</span>
00015 <span class="preprocessor">#include "<a class="code" href="navigate_8h.html">navigate.h</a>"</span>
00016 <span class="preprocessor">#include "<a class="code" href="measure_8h.html">measure.h</a>"</span>
00017 <span class="preprocessor">#include "<a class="code" href="text_8h.html">text.h</a>"</span>
00018 <span class="preprocessor">#include "<a class="code" href="sig_8h.html">sig.h</a>"</span>
00019 <span class="preprocessor">#include "<a class="code" href="clef_8h.html">clef.h</a>"</span>
00020 <span class="preprocessor">#include "<a class="code" href="globals_8h.html">globals.h</a>"</span>
00021 <span class="preprocessor">#include "<a class="code" href="segment_8h.html">segment.h</a>"</span>
00022 <span class="preprocessor">#include "<a class="code" href="preferences_8h.html">preferences.h</a>"</span>
00023 <span class="preprocessor">#include "<a class="code" href="padstate_8h.html">padstate.h</a>"</span>
00024 <span class="preprocessor">#include "<a class="code" href="utils_8h.html">utils.h</a>"</span>
00025 <span class="preprocessor">#include "<a class="code" href="painter_8h.html">painter.h</a>"</span>
00026 <span class="preprocessor">#include "<a class="code" href="style_8h.html">style.h</a>"</span>
00027 
00028 <span class="comment">//---------------------------------------------------------</span>
00029 <span class="comment">//   NoteAttribute::atrList</span>
00030 <span class="comment">//---------------------------------------------------------</span>
00031 
<a name="l00032"></a><a class="code" href="classNoteAttribute.html#s0">00032</a> <a class="code" href="structArticulation.html">Articulation</a> <a class="code" href="classNoteAttribute.html#s0">NoteAttribute::atrList</a>[] = {
00033      { <a class="code" href="symbols_8cpp.html#a49">ledgerendingSym</a>,   QString(<span class="stringliteral">"ledgerending"</span>),    <span class="keyword">false</span>, <span class="keyword">false</span> },
00034      { <a class="code" href="symbols_8cpp.html#a50">ufermataSym</a>,       QString(<span class="stringliteral">"ufermata"</span>),        <span class="keyword">false</span>, <span class="keyword">false</span> },
00035      { <a class="code" href="symbols_8cpp.html#a51">dfermataSym</a>,       QString(<span class="stringliteral">"dfermata"</span>),        <span class="keyword">false</span>, <span class="keyword">false</span> },
00036      { <a class="code" href="symbols_8cpp.html#a52">thumbSym</a>,          QString(<span class="stringliteral">"thumb"</span>),           <span class="keyword">false</span>, <span class="keyword">false</span> },
00037      { <a class="code" href="symbols_8cpp.html#a53">sforzatoaccentSym</a>, QString(<span class="stringliteral">"sforzato"</span>),        <span class="keyword">false</span>, <span class="keyword">false</span> },
00038      { <a class="code" href="symbols_8cpp.html#a54">staccatoSym</a>,       QString(<span class="stringliteral">"staccato"</span>),        <span class="keyword">true</span>,  <span class="keyword">false</span> },
00039      { <a class="code" href="symbols_8cpp.html#a55">ustaccatissimoSym</a>, QString(<span class="stringliteral">"ustaccatissimo"</span>),  <span class="keyword">false</span>, <span class="keyword">false</span> },
00040      { <a class="code" href="symbols_8cpp.html#a56">dstaccatissimoSym</a>, QString(<span class="stringliteral">"dstaccatissimo"</span>),  <span class="keyword">false</span>, <span class="keyword">false</span> },
00041      { <a class="code" href="symbols_8cpp.html#a57">tenutoSym</a>,         QString(<span class="stringliteral">"tenuto"</span>),          <span class="keyword">true</span>,  <span class="keyword">false</span> },
00042      { <a class="code" href="symbols_8cpp.html#a58">uportatoSym</a>,       QString(<span class="stringliteral">"uportato"</span>),        <span class="keyword">false</span>, <span class="keyword">false</span> },
00043      { <a class="code" href="symbols_8cpp.html#a59">dportatoSym</a>,       QString(<span class="stringliteral">"dportato"</span>),        <span class="keyword">false</span>, <span class="keyword">false</span> },
00044      { <a class="code" href="symbols_8cpp.html#a60">umarcatoSym</a>,       QString(<span class="stringliteral">"umarcato"</span>),        <span class="keyword">true</span>,  <span class="keyword">false</span> },
00045      { <a class="code" href="symbols_8cpp.html#a61">dmarcatoSym</a>,       QString(<span class="stringliteral">"dmarcato"</span>),        <span class="keyword">true</span>,  <span class="keyword">false</span> },
00046      { <a class="code" href="symbols_8cpp.html#a62">ouvertSym</a>,         QString(<span class="stringliteral">"ouvert"</span>),          <span class="keyword">false</span>, <span class="keyword">false</span> },
00047      { <a class="code" href="symbols_8cpp.html#a63">plusstopSym</a>,       QString(<span class="stringliteral">"plusstop"</span>),        <span class="keyword">false</span>, <span class="keyword">false</span> },
00048      { <a class="code" href="symbols_8cpp.html#a64">upbowSym</a>,          QString(<span class="stringliteral">"upbow"</span>),           <span class="keyword">false</span>, <span class="keyword">false</span> },
00049      { <a class="code" href="symbols_8cpp.html#a65">downbowSym</a>,        QString(<span class="stringliteral">"downbow"</span>),         <span class="keyword">false</span>, <span class="keyword">false</span> },
00050      { <a class="code" href="symbols_8cpp.html#a66">reverseturnSym</a>,    QString(<span class="stringliteral">"reverseturn"</span>),     <span class="keyword">false</span>, <span class="keyword">false</span> },
00051      { <a class="code" href="symbols_8cpp.html#a67">turnSym</a>,           QString(<span class="stringliteral">"turn"</span>),            <span class="keyword">false</span>, <span class="keyword">false</span> },
00052      { <a class="code" href="symbols_8cpp.html#a68">trillSym</a>,          QString(<span class="stringliteral">"trill"</span>),           <span class="keyword">false</span>, <span class="keyword">false</span> }
00053      };
00054 
00055 <span class="comment">//---------------------------------------------------------</span>
00056 <span class="comment">//   HelpLine</span>
00057 <span class="comment">//---------------------------------------------------------</span>
00058 
<a name="l00059"></a><a class="code" href="classHelpLine.html#a0">00059</a> <a class="code" href="classHelpLine.html#a0">HelpLine::HelpLine</a>(<a class="code" href="classScore.html">Score</a>* s)
00060    : <a class="code" href="classLine.html">Line</a>(s, false)
00061       {
00062       setLineWidth(<a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o25">helpLineWidth</a>);
00063       setLen(<a class="code" href="classSpatium.html">Spatium</a>(2));
00064       }
00065 
00066 <span class="comment">//---------------------------------------------------------</span>
00067 <span class="comment">//   Stem</span>
00068 <span class="comment">//    Notenhals</span>
00069 <span class="comment">//---------------------------------------------------------</span>
00070 
<a name="l00071"></a><a class="code" href="classStem.html#a0">00071</a> <a class="code" href="classStem.html#a0">Stem::Stem</a>(<a class="code" href="classScore.html">Score</a>* s)
00072    : <a class="code" href="classLine.html">Line</a>(s, true)
00073       {
00074       setType(<a class="code" href="element_8h.html#a65a14">STEM</a>);
00075       setLineWidth(<a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o15">stemWidth</a>);
00076       }
00077 
00078 <span class="comment">//---------------------------------------------------------</span>
00079 <span class="comment">//   NoteAttribute</span>
00080 <span class="comment">//---------------------------------------------------------</span>
00081 
<a name="l00082"></a><a class="code" href="classNoteAttribute.html#a0">00082</a> <a class="code" href="classNoteAttribute.html#a0">NoteAttribute::NoteAttribute</a>(<a class="code" href="classScore.html">Score</a>* s)
00083    : <a class="code" href="classSymbol.html">Symbol</a>(s)
00084       {
00085       setType(<a class="code" href="element_8h.html#a65a30">ATTRIBUTE</a>);
00086       }
00087 
<a name="l00088"></a><a class="code" href="classNoteAttribute.html#a1">00088</a> <a class="code" href="classNoteAttribute.html#a0">NoteAttribute::NoteAttribute</a>(<a class="code" href="classScore.html">Score</a>* s, NoteAttributeIdx idx)
00089    : <a class="code" href="classSymbol.html">Symbol</a>(s)
00090       {
00091       setType(<a class="code" href="element_8h.html#a65a30">ATTRIBUTE</a>);
00092       <a class="code" href="classNoteAttribute.html#a4">setIdx</a>(idx);
00093       }
00094 
<a name="l00095"></a><a class="code" href="classNoteAttribute.html#a2">00095</a> <a class="code" href="classNoteAttribute.html#a0">NoteAttribute::NoteAttribute</a>(<span class="keyword">const</span> <a class="code" href="classNoteAttribute.html">NoteAttribute</a>&amp; a)
00096    : <a class="code" href="classSymbol.html">Symbol</a>(a)
00097       {
00098       <a class="code" href="classNoteAttribute.html#r0">val</a> = a.<a class="code" href="classNoteAttribute.html#r0">val</a>;
00099       }
00100 
00101 <span class="comment">//---------------------------------------------------------</span>
00102 <span class="comment">//   drag</span>
00103 <span class="comment">//    return update Rect relative to canvas</span>
00104 <span class="comment">//---------------------------------------------------------</span>
00105 
<a name="l00106"></a><a class="code" href="classNoteAttribute.html#a8">00106</a> QRectF <a class="code" href="classNoteAttribute.html#a8">NoteAttribute::drag</a>(<span class="keyword">const</span> QPointF&amp; s)
00107       {
00108       QRectF r = _bbox.translated(<a class="code" href="classElement.html#a27">aref</a>());
00109       setUserOff(s / <a class="code" href="spatium_8h.html#a0">_spatium</a>);
00110       r |= _bbox.translated(<a class="code" href="classElement.html#a27">aref</a>());
00111       <a class="code" href="classNoteAttribute.html#a9">chord</a>()-&gt;<a class="code" href="classChord.html#a9">bboxUpdate</a>();
00112       <span class="keywordflow">return</span> r;
00113       }
00114 
00115 <span class="comment">//---------------------------------------------------------</span>
00116 <span class="comment">//   setIdx</span>
00117 <span class="comment">//---------------------------------------------------------</span>
00118 
<a name="l00119"></a><a class="code" href="classNoteAttribute.html#a4">00119</a> <span class="keywordtype">void</span> <a class="code" href="classNoteAttribute.html#a4">NoteAttribute::setIdx</a>(NoteAttributeIdx idx)
00120       {
00121       <a class="code" href="classNoteAttribute.html#r0">val</a> = idx;
00122       setSym(<a class="code" href="classNoteAttribute.html#s0">atrList</a>[<a class="code" href="classNoteAttribute.html#r0">val</a>].sym);
00123       }
00124 
00125 <span class="comment">//---------------------------------------------------------</span>
00126 <span class="comment">//   read</span>
00127 <span class="comment">//---------------------------------------------------------</span>
00128 
<a name="l00129"></a><a class="code" href="classNoteAttribute.html#a6">00129</a> <span class="keywordtype">void</span> <a class="code" href="classNoteAttribute.html#a6">NoteAttribute::read</a>(QDomNode node)
00130       {
00131       node = node.firstChild();
00132       <span class="keywordflow">while</span> (!node.isNull()) {
00133             QDomElement e = node.toElement();
00134             QString tag(e.tagName());
00135             <span class="keywordflow">if</span> (tag == <span class="stringliteral">"idx"</span>)
00136                   <a class="code" href="classNoteAttribute.html#a4">setIdx</a>(<a class="code" href="note_8h.html#a35">NoteAttributeIdx</a>(e.text().toInt()));
00137             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Element::readProperties(node))
00138                   ;
00139             <span class="keywordflow">else</span>
00140                   <a class="code" href="utils_8h.html#a4">domError</a>(node);
00141             node = node.nextSibling();
00142             }
00143       }
00144 
00145 <span class="comment">//---------------------------------------------------------</span>
00146 <span class="comment">//   write</span>
00147 <span class="comment">//---------------------------------------------------------</span>
00148 
<a name="l00149"></a><a class="code" href="classNoteAttribute.html#a7">00149</a> <span class="keywordtype">void</span> <a class="code" href="classNoteAttribute.html#a7">NoteAttribute::write</a>(<a class="code" href="classXml.html">Xml</a>&amp; xml)<span class="keyword"> const</span>
00150 <span class="keyword">      </span>{
00151       xml.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"Attribute"</span>);
00152       xml.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"idx"</span>, <a class="code" href="classNoteAttribute.html#r0">val</a>);
00153       Element::writeProperties(xml);
00154       xml.<a class="code" href="classXml.html#a9">etag</a>(<span class="stringliteral">"Attribute"</span>);
00155       }
00156 
00157 <span class="comment">//---------------------------------------------------------</span>
00158 <span class="comment">//   Note</span>
00159 <span class="comment">//    pitch - midi pitch 0 - 127</span>
00160 <span class="comment">//    len   - midi ticks (1/division) quarternote</span>
00161 <span class="comment">//    stem/flag</span>
00162 <span class="comment">//---------------------------------------------------------</span>
00163 
<a name="l00164"></a><a class="code" href="classNote.html#a0">00164</a> <a class="code" href="classNote.html#a0">Note::Note</a>(<a class="code" href="classScore.html">Score</a>* s)
00165    : <a class="code" href="classElement.html">Element</a>(s, <a class="code" href="element_8h.html#a65a12">NOTE</a>)
00166       {
00167       <a class="code" href="classNote.html#r0">_pitch</a>          = 0;
00168       <a class="code" href="classNote.html#r1">_userAccidental</a> = -1;
00169       <a class="code" href="classNote.html#r6">_durationType</a>   = <a class="code" href="globals_8h.html#a26a13">D_QUARTER</a>;
00170       <a class="code" href="classNote.html#r7">_grace</a>          = <span class="keyword">false</span>;
00171       <a class="code" href="classNote.html#r4">_accidental</a>     = 0;
00172       <a class="code" href="classNote.html#r8">_mirror</a>         = <span class="keyword">false</span>;
00173       <a class="code" href="classNote.html#r2">_line</a>           = 0;
00174       <a class="code" href="classNote.html#r3">_move</a>           = 0;
00175       <a class="code" href="classNote.html#r13">_lineOffset</a>     = 0;
00176       <a class="code" href="classNote.html#r9">_dots</a>           = 0;
00177       <a class="code" href="classNote.html#r11">_tieFor</a>         = 0;
00178       <a class="code" href="classNote.html#r12">_tieBack</a>        = 0;
00179       <a class="code" href="classNote.html#r10">_fingering</a>      = 0;
00180       }
00181 
<a name="l00182"></a><a class="code" href="classNote.html#a2">00182</a> <a class="code" href="classNote.html#a0">Note::Note</a>(<span class="keyword">const</span> <a class="code" href="classNote.html">Note</a>&amp; n)
00183    : <a class="code" href="classElement.html">Element</a>(n)
00184       {
00185       <a class="code" href="classNote.html#r0">_pitch</a>          = n.<a class="code" href="classNote.html#r0">_pitch</a>;
00186       <a class="code" href="classNote.html#r1">_userAccidental</a> = n.<a class="code" href="classNote.html#r1">_userAccidental</a>;
00187       <a class="code" href="classNote.html#r2">_line</a>           = n.<a class="code" href="classNote.html#r2">_line</a>;
00188       <a class="code" href="classNote.html#r3">_move</a>           = n.<a class="code" href="classNote.html#r3">_move</a>;
00189       <span class="keywordflow">if</span> (n.<a class="code" href="classNote.html#r4">_accidental</a>) {
00190              <a class="code" href="classNote.html#r4">_accidental</a> = <span class="keyword">new</span> <a class="code" href="classPrefix.html">Prefix</a>(<a class="code" href="classElement.html#a4">score</a>(), n.<a class="code" href="classNote.html#r4">_accidental</a>-&gt;<a class="code" href="classPrefix.html#a2">idx</a>(), n.<a class="code" href="classNote.html#r7">_grace</a>);
00191              <a class="code" href="classNote.html#r4">_accidental</a>-&gt;<a class="code" href="classElement.html#a11">setParent</a>(<span class="keyword">this</span>);
00192              <a class="code" href="classNote.html#r4">_accidental</a>-&gt;<a class="code" href="classElement.html#a63">setVoice</a>(<a class="code" href="classElement.html#a62">voice</a>());
00193             }
00194       <span class="keywordflow">else</span>
00195             <a class="code" href="classNote.html#r4">_accidental</a> = 0;
00196 
00197       <a class="code" href="classNote.html#r5">_sym</a>          = n.<a class="code" href="classNote.html#r5">_sym</a>;
00198       <a class="code" href="classNote.html#r6">_durationType</a> = n.<a class="code" href="classNote.html#r6">_durationType</a>;
00199       <a class="code" href="classNote.html#r7">_grace</a>        = n.<a class="code" href="classNote.html#r7">_grace</a>;
00200       <a class="code" href="classNote.html#r8">_mirror</a>       = n.<a class="code" href="classNote.html#r8">_mirror</a>;
00201       <a class="code" href="classNote.html#r13">_lineOffset</a>   = 0;
00202       <a class="code" href="classNote.html#r9">_dots</a>         = n.<a class="code" href="classNote.html#r9">_dots</a>;
00203       <span class="keywordflow">if</span> (n.<a class="code" href="classNote.html#r10">_fingering</a>) {
00204             <a class="code" href="classNote.html#r10">_fingering</a>  = <span class="keyword">new</span> <a class="code" href="classFingering.html">Fingering</a>(*(n.<a class="code" href="classNote.html#r10">_fingering</a>));
00205             <a class="code" href="classNote.html#r10">_fingering</a>-&gt;<a class="code" href="classElement.html#a11">setParent</a>(<span class="keyword">this</span>);
00206             }
00207       <span class="keywordflow">else</span>
00208             <a class="code" href="classNote.html#r10">_fingering</a> = 0;
00209       <a class="code" href="classNote.html#r11">_tieFor</a>  = n.<a class="code" href="classNote.html#r11">_tieFor</a>;
00210       <a class="code" href="classNote.html#r12">_tieBack</a> = n.<a class="code" href="classNote.html#r12">_tieBack</a>;
00211       }
00212 
<a name="l00213"></a><a class="code" href="classNote.html#a1">00213</a> <a class="code" href="classNote.html#a0">Note::Note</a>(<a class="code" href="classScore.html">Score</a>* s, <span class="keywordtype">int</span> p, <span class="keywordtype">bool</span> g)
00214    : <a class="code" href="classElement.html">Element</a>(s, <a class="code" href="element_8h.html#a65a12">NOTE</a>)
00215       {
00216       <a class="code" href="classNote.html#r6">_durationType</a>   = <a class="code" href="globals_8h.html#a26a13">D_QUARTER</a>;
00217       <a class="code" href="classNote.html#r7">_grace</a>          = g;
00218       <a class="code" href="classNote.html#r4">_accidental</a>     = 0;
00219       <a class="code" href="classNote.html#r1">_userAccidental</a> = -1;
00220       <a class="code" href="classNote.html#r8">_mirror</a>         = <span class="keyword">false</span>;
00221       <a class="code" href="classNote.html#r2">_line</a>           = 0;
00222       <a class="code" href="classNote.html#r3">_move</a>           = 0;
00223       <a class="code" href="classNote.html#r13">_lineOffset</a>     = 0;
00224       <a class="code" href="classNote.html#r9">_dots</a>           = 0;
00225       <a class="code" href="classNote.html#r11">_tieFor</a>         = 0;
00226       <a class="code" href="classNote.html#r12">_tieBack</a>        = 0;
00227       <a class="code" href="classNote.html#r10">_fingering</a>      = 0;
00228       <a class="code" href="classNote.html#r0">_pitch</a>          = p;
00229       }
00230 
00231 <span class="comment">//---------------------------------------------------------</span>
00232 <span class="comment">//   Note</span>
00233 <span class="comment">//---------------------------------------------------------</span>
00234 
<a name="l00235"></a><a class="code" href="classNote.html#a3">00235</a> <a class="code" href="classNote.html#a3">Note::~Note</a>()
00236       {
00237       <span class="keywordflow">if</span> (<a class="code" href="classNote.html#r10">_fingering</a>)
00238             <span class="keyword">delete</span> <a class="code" href="classNote.html#r10">_fingering</a>;
00239       <span class="keywordflow">if</span> (<a class="code" href="classNote.html#r4">_accidental</a>)
00240             <span class="keyword">delete</span> <a class="code" href="classNote.html#r4">_accidental</a>;
00241       }
00242 
00243 <span class="comment">//---------------------------------------------------------</span>
00244 <span class="comment">//   totalTicks</span>
00245 <span class="comment">//    give total tick len of tied notes</span>
00246 <span class="comment">//---------------------------------------------------------</span>
00247 
<a name="l00248"></a><a class="code" href="classNote.html#a9">00248</a> <span class="keywordtype">int</span> <a class="code" href="classNote.html#a9">Note::totalTicks</a>()<span class="keyword"> const</span>
00249 <span class="keyword">      </span>{
00250       <span class="keyword">const</span> <a class="code" href="classNote.html">Note</a>* note = <span class="keyword">this</span>;
00251       <span class="keywordflow">while</span> (note-&gt;<a class="code" href="classNote.html#a34">tieBack</a>())
00252             note = note-&gt;<a class="code" href="classNote.html#a34">tieBack</a>()-&gt;<a class="code" href="classTie.html#a5">startNote</a>();
00253       <span class="keywordtype">int</span> len = 0;
00254       <span class="keywordflow">while</span> (note-&gt;<a class="code" href="classNote.html#a33">tieFor</a>() &amp;&amp; note-&gt;<a class="code" href="classNote.html#a33">tieFor</a>()-&gt;<a class="code" href="classTie.html#a6">endNote</a>()) {
00255             len += note-&gt;<a class="code" href="classNote.html#a37">chord</a>()-&gt;<a class="code" href="classElement.html#a76">tickLen</a>();
00256             note = note-&gt;<a class="code" href="classNote.html#a33">tieFor</a>()-&gt;<a class="code" href="classTie.html#a6">endNote</a>();
00257             }
00258       len += note-&gt;<a class="code" href="classNote.html#a37">chord</a>()-&gt;<a class="code" href="classElement.html#a76">tickLen</a>();
00259       <span class="keywordflow">return</span> len;
00260       }
00261 
00262 <span class="comment">//---------------------------------------------------------</span>
00263 <span class="comment">//   changePitch</span>
00264 <span class="comment">//---------------------------------------------------------</span>
00265 
<a name="l00266"></a><a class="code" href="classNote.html#a17">00266</a> <span class="keywordtype">void</span> <a class="code" href="classNote.html#a17">Note::changePitch</a>(<span class="keywordtype">int</span> n)
00267       {
00268       <a class="code" href="classNote.html#a16">setPitch</a>(n);
00269       <a class="code" href="classNote.html#r1">_userAccidental</a> = -1;
00270       <a class="code" href="classNote.html#a37">chord</a>()-&gt;<a class="code" href="classChordRest.html#a11">measure</a>()-&gt;<a class="code" href="classMeasure.html#a59">layoutNoteHeads</a>(<a class="code" href="classElement.html#a60">staffIdx</a>());
00271       }
00272 
00273 <span class="comment">//---------------------------------------------------------</span>
00274 <span class="comment">//   changeAccidental</span>
00275 <span class="comment">//    sets a "user selected" accidental</span>
00276 <span class="comment">//    this recomputes _pitch</span>
00277 <span class="comment">//---------------------------------------------------------</span>
00278 
<a name="l00279"></a><a class="code" href="classNote.html#a25">00279</a> <span class="keywordtype">void</span> <a class="code" href="classNote.html#a25">Note::changeAccidental</a>(<a class="code" href="classScore.html">Score</a>* cs, <span class="keywordtype">int</span> pre)
00280       {
00281       <a class="code" href="classNote.html#r1">_userAccidental</a> = pre;
00282 
00283       <a class="code" href="classMeasure.html">Measure</a>* m = <a class="code" href="classNote.html#a37">chord</a>()-&gt;<a class="code" href="classChordRest.html#a11">measure</a>();
00284       <span class="keywordtype">char</span> tversatz[128];
00285       memset(tversatz, 0, <span class="keyword">sizeof</span>(tversatz));
00286       <span class="keywordflow">if</span> (pre == <a class="code" href="element_8h.html#a66a47">ACC_NONE</a>) {
00287             <span class="comment">// compute current state:</span>
00288             <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;
00289             <a class="code" href="classSegment.html">Segment</a>* segment;
00290             <span class="keywordflow">for</span> (segment = m-&gt;<a class="code" href="classMeasure.html#a28">first</a>(); segment; segment = segment-&gt;<a class="code" href="classSegment.html#a4">next</a>()) {
00291                   <span class="keywordtype">int</span> startTrack = <a class="code" href="classElement.html#a60">staffIdx</a>() * <a class="code" href="globals_8h.html#a3">VOICES</a>;
00292                   <span class="keywordtype">int</span> endTrack   = startTrack + <a class="code" href="globals_8h.html#a3">VOICES</a>;
00293                   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> track = startTrack; track &lt; endTrack; ++track) {
00294                         <a class="code" href="classElement.html">Element</a>* e = segment-&gt;<a class="code" href="classSegment.html#a8">element</a>(track);
00295                         <span class="keywordflow">if</span> (e == 0 || e-&gt;<a class="code" href="classElement.html#a40">type</a>() != <a class="code" href="element_8h.html#a65a25">CHORD</a>)
00296                               <span class="keywordflow">continue</span>;
00297                         <span class="keywordflow">if</span> (<a class="code" href="classNote.html#a37">chord</a>() == (<a class="code" href="classChord.html">Chord</a>*) e) {
00298                               found = <span class="keyword">true</span>;
00299                               <span class="keywordflow">break</span>;
00300                               }
00301                         <a class="code" href="classNoteList.html">NoteList</a>* nl = ((<a class="code" href="classChord.html">Chord</a>*)e)-&gt;noteList();
00302                         <span class="keywordtype">int</span> tick     = ((<a class="code" href="classChord.html">Chord</a>*)e)-&gt;tick();
00303                         <span class="keywordflow">for</span> (<a class="code" href="note_8h.html#a1">iNote</a> in = nl-&gt;begin(); in != nl-&gt;end(); ++in) {
00304                               <a class="code" href="classNote.html">Note</a>* note  = in-&gt;second;
00305                               <span class="keywordtype">int</span> nPrefix = note-&gt;<a class="code" href="classNote.html#a22">accidentalIdx</a>();
00306                               <span class="keywordflow">if</span> (nPrefix) {
00307                                     <span class="keywordtype">int</span> offset   = cs-&gt;<a class="code" href="classScore.html#a43">clefOffset</a>(tick, <a class="code" href="classElement.html#a60">staffIdx</a>());
00308                                     <span class="keywordtype">int</span> <a class="code" href="classNote.html#a26">line</a>     = note-&gt;<a class="code" href="classNote.html#a26">line</a>();
00309                                     <span class="keywordtype">int</span> l1       = 45 - line + offset;
00310                                     tversatz[l1] = nPrefix;
00311                                     }
00312                               }
00313                         }
00314                   <span class="keywordflow">if</span> (found)
00315                         <span class="keywordflow">break</span>;
00316                   }
00317             <span class="keywordflow">if</span> (segment == 0)
00318                   printf(<span class="stringliteral">"Note not found in measure\n"</span>);
00319             }
00320 
00321       <span class="keyword">static</span> <span class="keywordtype">int</span> preTab[] = {
00322             0,  <span class="comment">// ACC_NONE</span>
00323             1,  <span class="comment">// ACC_SHARP</span>
00324             -1, <span class="comment">// ACC_FLAT</span>
00325             2,  <span class="comment">// ACC_SHARP2</span>
00326             -2, <span class="comment">// ACC_FLAT2</span>
00327             0,  <span class="comment">// ACC_NAT</span>
00328             };
00329 
00330      <span class="keyword">static</span> <span class="keywordtype">int</span> tab3[15][8] = {
00331           <span class="comment">//c  d  e  f  g  a  b  c</span>
00332           <span class="comment">//------------------------</span>
00333           { 2, 2, 2, 2, 2, 2, 2, 2 },    <span class="comment">// ces</span>
00334           { 2, 2, 2, 0, 2, 2, 2, 2 },    <span class="comment">// ges</span>
00335           { 0, 2, 2, 0, 2, 2, 2, 0 },    <span class="comment">// des</span>
00336           { 0, 2, 2, 0, 0, 2, 2, 0 },    <span class="comment">// as</span>
00337           { 0, 0, 2, 0, 0, 2, 2, 0 },    <span class="comment">// es</span>
00338           { 0, 0, 2, 0, 0, 0, 2, 0 },    <span class="comment">// B</span>
00339           { 0, 0, 0, 0, 0, 0, 2, 0 },    <span class="comment">// F</span>
00340 
00341           { 0, 0, 0, 0, 0, 0, 0, 0 },    <span class="comment">// C</span>
00342 
00343           { 0, 0, 0, 1, 0, 0, 0, 0 },    <span class="comment">// G</span>
00344           { 1, 0, 0, 1, 0, 0, 0, 1 },    <span class="comment">// D</span>
00345           { 1, 0, 0, 1, 1, 0, 0, 1 },    <span class="comment">// A</span>
00346           { 1, 1, 0, 1, 1, 0, 0, 1 },    <span class="comment">// E</span>
00347           { 1, 1, 0, 1, 1, 1, 0, 1 },    <span class="comment">// H</span>
00348           { 1, 1, 1, 1, 1, 1, 0, 1 },    <span class="comment">// fis</span>
00349           { 1, 1, 1, 1, 1, 1, 1, 1 }     <span class="comment">// cis</span>
00350           };
00351 
00352       <span class="keywordtype">int</span> tick = <a class="code" href="classNote.html#a37">chord</a>()-&gt;<a class="code" href="classElement.html#a74">tick</a>();
00353       <span class="keywordtype">int</span> offset = cs-&gt;<a class="code" href="classScore.html#a43">clefOffset</a>(tick, <a class="code" href="classElement.html#a60">staffIdx</a>());
00354       <span class="keywordtype">int</span> l1 = 45 - <a class="code" href="classNote.html#r2">_line</a> + offset;
00355 
00356       <span class="keywordtype">int</span> curPre = tversatz[l1];
00357 
00358       <span class="keywordtype">int</span> key    = cs-&gt;<a class="code" href="classScore.html#o10">keymap</a>-&gt;<a class="code" href="classKeyList.html#a1">key</a>(tick);
00359       <span class="keywordtype">int</span> keyPre = tab3[key+7][l1 % 7];
00360 
00361       <span class="keywordtype">int</span> pitchOffset;
00362 
00363       <span class="keywordflow">if</span> (pre == <a class="code" href="element_8h.html#a66a47">ACC_NONE</a>) {
00364             <span class="keywordflow">if</span> (curPre == <a class="code" href="element_8h.html#a66a47">ACC_NONE</a>)
00365                   pitchOffset = preTab[keyPre];
00366             <span class="keywordflow">else</span>
00367                   pitchOffset = preTab[curPre];
00368             }
00369       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pre == <a class="code" href="element_8h.html#a66a52">ACC_NATURAL</a>)
00370             pitchOffset = 0;
00371       <span class="keywordflow">else</span> {
00372             pitchOffset = preTab[pre]; <span class="comment">//  + preTab[keyPre];</span>
00373             }
00374 
00375       <span class="keywordtype">int</span> newPitch = cs-&gt;<a class="code" href="classScore.html#a24">line2pitch</a>(<a class="code" href="classNote.html#r2">_line</a>, <a class="code" href="classElement.html#a60">staffIdx</a>(), tick) + pitchOffset;
00376 
00377       <a class="code" href="classNote.html#a16">setPitch</a>(newPitch);
00378       <a class="code" href="classNote.html#a37">chord</a>()-&gt;<a class="code" href="classChordRest.html#a11">measure</a>()-&gt;<a class="code" href="classMeasure.html#a59">layoutNoteHeads</a>(<a class="code" href="classElement.html#a60">staffIdx</a>());
00379       }
00380 
00381 <span class="comment">//---------------------------------------------------------</span>
00382 <span class="comment">//   add</span>
00383 <span class="comment">//---------------------------------------------------------</span>
00384 
<a name="l00385"></a><a class="code" href="classNote.html#a29">00385</a> <span class="keywordtype">void</span> <a class="code" href="classNote.html#a29">Note::add</a>(<a class="code" href="classElement.html">Element</a>* el)
00386       {
00387       <span class="keywordflow">if</span> (el-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a38">FINGERING</a>) {
00388             <a class="code" href="classNote.html#r10">_fingering</a> = (<a class="code" href="classFingering.html">Fingering</a>*) el;
00389             el-&gt;<a class="code" href="classElement.html#a11">setParent</a>(<span class="keyword">this</span>);
00390             }
00391       <span class="keywordflow">else</span>
00392             printf(<span class="stringliteral">"Note::add() not impl. %s\n"</span>, el-&gt;<a class="code" href="classElement.html#a69">name</a>());
00393       }
00394 
00395 <span class="comment">//---------------------------------------------------------</span>
00396 <span class="comment">//   setTieBack</span>
00397 <span class="comment">//---------------------------------------------------------</span>
00398 
<a name="l00399"></a><a class="code" href="classNote.html#a36">00399</a> <span class="keywordtype">void</span> <a class="code" href="classNote.html#a36">Note::setTieBack</a>(<a class="code" href="classTie.html">Tie</a>* t)
00400       {
00401       <a class="code" href="classNote.html#r12">_tieBack</a> = t;
00402       <span class="keywordflow">if</span> (t &amp;&amp; <a class="code" href="classNote.html#r4">_accidental</a>) {          <span class="comment">// dont show prefix of second tied note</span>
00403             <span class="keyword">delete</span> <a class="code" href="classNote.html#r4">_accidental</a>;
00404             <a class="code" href="classNote.html#r4">_accidental</a> = 0;
00405             }
00406       }
00407 
00408 <span class="comment">//---------------------------------------------------------</span>
00409 <span class="comment">//   remove</span>
00410 <span class="comment">//---------------------------------------------------------</span>
00411 
<a name="l00412"></a><a class="code" href="classNote.html#a30">00412</a> <span class="keywordtype">void</span> <a class="code" href="classNote.html#a30">Note::remove</a>(<a class="code" href="classElement.html">Element</a>* el)
00413       {
00414       <span class="keywordflow">if</span> (el-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a38">FINGERING</a>)
00415             <a class="code" href="classNote.html#r10">_fingering</a> = 0;
00416       <span class="keywordflow">else</span>
00417             printf(<span class="stringliteral">"Note::remove() not impl. %s\n"</span>, el-&gt;<a class="code" href="classElement.html#a69">name</a>());
00418       }
00419 
00420 <span class="comment">//---------------------------------------------------------</span>
00421 <span class="comment">//   stemPos</span>
00422 <span class="comment">//---------------------------------------------------------</span>
00423 
<a name="l00424"></a><a class="code" href="classNote.html#a42">00424</a> QPointF <a class="code" href="classNote.html#a42">Note::stemPos</a>(<span class="keywordtype">bool</span> upFlag)<span class="keyword"> const</span>
00425 <span class="keyword">      </span>{
00426       <span class="keywordtype">double</span> stemWidth = point(<a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o15">stemWidth</a>);
00427       <span class="keywordtype">double</span> x = <a class="code" href="classElement.html#a20">pos</a>().x();
00428       <span class="keywordtype">double</span> y = <a class="code" href="classElement.html#a20">pos</a>().y();
00429 
00430       <span class="keywordflow">if</span> (<a class="code" href="classNote.html#r8">_mirror</a>)
00431             upFlag = !upFlag;
00432       <span class="keywordflow">if</span> (upFlag) {
00433             x += <a class="code" href="classNote.html#r5">_sym</a>.<a class="code" href="structSym.html#a4">width</a>() - stemWidth/2.0;
00434             y -= <a class="code" href="spatium_8h.html#a0">_spatium</a> * .2;
00435             }
00436       <span class="keywordflow">else</span> {
00437             x += stemWidth * .5;
00438             y += <a class="code" href="spatium_8h.html#a0">_spatium</a> * .2;
00439             }
00440       <span class="keywordflow">return</span> QPointF(x, y);
00441       }
00442 
00443 <span class="comment">//---------------------------------------------------------</span>
00444 <span class="comment">//   setAccidental</span>
00445 <span class="comment">//    called from</span>
00446 <span class="comment">//       Measure::layoutNoteHeads()</span>
00447 <span class="comment">//       Note::changeAccidental()</span>
00448 <span class="comment">//---------------------------------------------------------</span>
00449 
<a name="l00450"></a><a class="code" href="classNote.html#a24">00450</a> <span class="keywordtype">void</span> <a class="code" href="classNote.html#a24">Note::setAccidental</a>(<span class="keywordtype">int</span> pre)
00451       {
00452       <span class="keywordflow">if</span> (pre &amp;&amp; !<a class="code" href="classNote.html#r12">_tieBack</a>) {
00453             <span class="keywordflow">if</span> (<a class="code" href="classNote.html#r4">_accidental</a>) {
00454                   <a class="code" href="classNote.html#r4">_accidental</a>-&gt;<a class="code" href="classPrefix.html#a3">setIdx</a>(pre);
00455                   }
00456             <span class="keywordflow">else</span> {
00457                   <a class="code" href="classNote.html#r4">_accidental</a> = <span class="keyword">new</span> <a class="code" href="classPrefix.html">Prefix</a>(<a class="code" href="classElement.html#a4">score</a>(), pre, <a class="code" href="classNote.html#r7">_grace</a>);
00458                   <a class="code" href="classNote.html#r4">_accidental</a>-&gt;<a class="code" href="classElement.html#a11">setParent</a>(<span class="keyword">this</span>);
00459                   <a class="code" href="classNote.html#r4">_accidental</a>-&gt;<a class="code" href="classElement.html#a63">setVoice</a>(<a class="code" href="classElement.html#a62">voice</a>());
00460                   }
00461             }
00462       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classNote.html#r4">_accidental</a>) {
00463             <span class="keyword">delete</span> <a class="code" href="classNote.html#r4">_accidental</a>;
00464             <a class="code" href="classNote.html#r4">_accidental</a> = 0;
00465             }
00466       <a class="code" href="classNote.html#a5">bboxUpdate</a>();
00467       }
00468 
00469 <span class="comment">//---------------------------------------------------------</span>
00470 <span class="comment">//   setTicks</span>
00471 <span class="comment">//    set note head + dots depending on tick len</span>
00472 <span class="comment">//---------------------------------------------------------</span>
00473 
<a name="l00474"></a><a class="code" href="classNote.html#a8">00474</a> <span class="keywordtype">void</span> <a class="code" href="classNote.html#a8">Note::setTicks</a>(<span class="keywordtype">int</span> ticks)
00475       {
00476       <span class="keywordflow">switch</span> (ticks) {
00477             <span class="keywordflow">case</span> 0:     <span class="comment">// grace note?</span>
00478                   <a class="code" href="classNote.html#r5">_sym</a> = <a class="code" href="classNote.html#r7">_grace</a> ? <a class="code" href="symbols_8cpp.html#a160">s_quartheadSym</a> : <a class="code" href="symbols_8cpp.html#a35">quartheadSym</a>;
00479                   <span class="keywordflow">break</span>;
00480             <span class="keywordflow">case</span> 6*<a class="code" href="mtime_8h.html#a0">division</a>:        <span class="comment">// 1/1 + 1/2  (gibt's das???)</span>
00481                   <a class="code" href="classNote.html#r9">_dots</a>  = 1;
00482             <span class="keywordflow">case</span> 4*<a class="code" href="mtime_8h.html#a0">division</a>:        <span class="comment">// 1/1</span>
00483                   <a class="code" href="classNote.html#r5">_sym</a> = <a class="code" href="classNote.html#r7">_grace</a> ? <a class="code" href="symbols_8cpp.html#a162">s_wholeheadSym</a> : <a class="code" href="symbols_8cpp.html#a33">wholeheadSym</a>;
00484                   <span class="keywordflow">break</span>;
00485             <span class="keywordflow">case</span> 3*<a class="code" href="mtime_8h.html#a0">division</a>:        <span class="comment">// 1/2</span>
00486                   <a class="code" href="classNote.html#r9">_dots</a> = 1;
00487             <span class="keywordflow">case</span> 2*<a class="code" href="mtime_8h.html#a0">division</a>:        <span class="comment">// 1/2</span>
00488                   <a class="code" href="classNote.html#r5">_sym</a> = <a class="code" href="classNote.html#r7">_grace</a> ? <a class="code" href="symbols_8cpp.html#a161">s_halfheadSym</a> : <a class="code" href="symbols_8cpp.html#a34">halfheadSym</a>;
00489                   <span class="keywordflow">break</span>;
00490             <span class="keywordflow">case</span> <a class="code" href="mtime_8h.html#a0">division</a> + <a class="code" href="mtime_8h.html#a0">division</a>/2:         <span class="comment">// dotted values</span>
00491             <span class="keywordflow">case</span> <a class="code" href="mtime_8h.html#a0">division</a>/2 + <a class="code" href="mtime_8h.html#a0">division</a>/4:
00492             <span class="keywordflow">case</span> <a class="code" href="mtime_8h.html#a0">division</a>/4 + <a class="code" href="mtime_8h.html#a0">division</a>/8:
00493             <span class="keywordflow">case</span> <a class="code" href="mtime_8h.html#a0">division</a>/8 + <a class="code" href="mtime_8h.html#a0">division</a>/16:
00494             <span class="keywordflow">case</span> <a class="code" href="mtime_8h.html#a0">division</a>/16 + <a class="code" href="mtime_8h.html#a0">division</a>/32:
00495             <span class="keywordflow">case</span> <a class="code" href="mtime_8h.html#a0">division</a>/32 + <a class="code" href="mtime_8h.html#a0">division</a>/64:
00496                   <a class="code" href="classNote.html#r9">_dots</a>  = 1;
00497             <span class="keywordflow">case</span> <a class="code" href="mtime_8h.html#a0">division</a>:          <span class="comment">// quarternote</span>
00498             <span class="keywordflow">case</span> <a class="code" href="mtime_8h.html#a0">division</a>/2:        <span class="comment">// 1/8</span>
00499             <span class="keywordflow">case</span> <a class="code" href="mtime_8h.html#a0">division</a>/4:        <span class="comment">// 1/16</span>
00500             <span class="keywordflow">case</span> <a class="code" href="mtime_8h.html#a0">division</a>/8:        <span class="comment">// 1/32</span>
00501             <span class="keywordflow">case</span> <a class="code" href="mtime_8h.html#a0">division</a>/16:       <span class="comment">// 1/64</span>
00502             <span class="keywordflow">case</span> <a class="code" href="mtime_8h.html#a0">division</a>/32:       <span class="comment">// 1/128</span>
00503                   <a class="code" href="classNote.html#r5">_sym</a> = <a class="code" href="classNote.html#r7">_grace</a> ? <a class="code" href="symbols_8cpp.html#a160">s_quartheadSym</a> : <a class="code" href="symbols_8cpp.html#a35">quartheadSym</a>;
00504                   <span class="keywordflow">break</span>;
00505             <span class="keywordflow">default</span>:
00506 <span class="comment">//                  fprintf(stderr, "invalid note len %d\n", l);</span>
00507                   <a class="code" href="classNote.html#r5">_sym</a> = <a class="code" href="classNote.html#r7">_grace</a> ? <a class="code" href="symbols_8cpp.html#a160">s_quartheadSym</a> : <a class="code" href="symbols_8cpp.html#a35">quartheadSym</a>;
00508                   <span class="keywordflow">return</span>;
00509             }
00510       <a class="code" href="classNote.html#a5">bboxUpdate</a>();
00511       }
00512 
00513 <span class="comment">//---------------------------------------------------------</span>
00514 <span class="comment">//   setType</span>
00515 <span class="comment">//---------------------------------------------------------</span>
00516 
<a name="l00517"></a><a class="code" href="classNote.html#a10">00517</a> <span class="keywordtype">void</span> <a class="code" href="classNote.html#a10">Note::setType</a>(DurationType t)
00518       {
00519       <span class="keywordflow">switch</span>(t) {
00520             <span class="keywordflow">case</span> <a class="code" href="globals_8h.html#a26a15">D_256TH</a>:
00521             <span class="keywordflow">case</span> <a class="code" href="globals_8h.html#a26a16">D_128TH</a>:
00522             <span class="keywordflow">case</span> <a class="code" href="globals_8h.html#a26a17">D_64TH</a>:
00523             <span class="keywordflow">case</span> <a class="code" href="globals_8h.html#a26a18">D_32ND</a>:
00524             <span class="keywordflow">case</span> <a class="code" href="globals_8h.html#a26a19">D_16TH</a>:
00525             <span class="keywordflow">case</span> <a class="code" href="globals_8h.html#a26a14">D_EIGHT</a>:
00526             <span class="keywordflow">case</span> <a class="code" href="globals_8h.html#a26a13">D_QUARTER</a>:
00527                   <a class="code" href="classNote.html#r5">_sym</a> = <a class="code" href="classNote.html#r7">_grace</a> ? <a class="code" href="symbols_8cpp.html#a160">s_quartheadSym</a> : <a class="code" href="symbols_8cpp.html#a35">quartheadSym</a>;
00528                   <span class="keywordflow">break</span>;
00529             <span class="keywordflow">case</span> <a class="code" href="globals_8h.html#a26a20">D_HALF</a>:
00530                   <a class="code" href="classNote.html#r5">_sym</a> = <a class="code" href="classNote.html#r7">_grace</a> ? <a class="code" href="symbols_8cpp.html#a161">s_halfheadSym</a> : <a class="code" href="symbols_8cpp.html#a34">halfheadSym</a>;
00531                   <span class="keywordflow">break</span>;
00532             <span class="keywordflow">case</span> <a class="code" href="globals_8h.html#a26a21">D_WHOLE</a>:
00533                   <a class="code" href="classNote.html#r5">_sym</a> = <a class="code" href="classNote.html#r7">_grace</a> ? <a class="code" href="symbols_8cpp.html#a162">s_wholeheadSym</a> : <a class="code" href="symbols_8cpp.html#a33">wholeheadSym</a>;
00534                   <span class="keywordflow">break</span>;
00535             <span class="keywordflow">case</span> <a class="code" href="globals_8h.html#a26a22">D_BREVE</a>:
00536             <span class="keywordflow">case</span> <a class="code" href="globals_8h.html#a26a23">D_LONG</a>:      <span class="comment">// not impl.</span>
00537                   <a class="code" href="classNote.html#r5">_sym</a> = <a class="code" href="classNote.html#r7">_grace</a> ? <a class="code" href="symbols_8cpp.html#a163">s_brevisheadSym</a> : <a class="code" href="symbols_8cpp.html#a32">brevisheadSym</a>;
00538                   <span class="keywordflow">break</span>;
00539             }
00540       }
00541 
00542 <span class="comment">//---------------------------------------------------------</span>
00543 <span class="comment">//   draw</span>
00544 <span class="comment">//---------------------------------------------------------</span>
00545 
<a name="l00546"></a><a class="code" href="classNote.html#a39">00546</a> <span class="keywordtype">void</span> <a class="code" href="classNote.html#a39">Note::draw1</a>(<a class="code" href="classPainter.html">Painter</a>&amp; p)<span class="keyword"> const</span>
00547 <span class="keyword">      </span>{
00548       <a class="code" href="classNote.html#r5">_sym</a>.<a class="code" href="structSym.html#a7">draw</a>(p);
00549 
00550       <span class="keywordflow">if</span> (<a class="code" href="classNote.html#r9">_dots</a>) {
00551             <span class="keywordtype">double</span> y = 0;
00552             <span class="comment">// do not draw dots on line</span>
00553             <span class="keywordflow">if</span> ((<a class="code" href="classNote.html#r2">_line</a> &amp; 1) == 0) {
00554                   <span class="keywordflow">if</span> (<a class="code" href="classNote.html#a37">chord</a>()-&gt;<a class="code" href="classChordRest.html#a19">isUp</a>())
00555                         y = -<a class="code" href="spatium_8h.html#a0">_spatium</a> *.5;
00556                   <span class="keywordflow">else</span>
00557                         y = <a class="code" href="spatium_8h.html#a0">_spatium</a> * .5;
00558                   }
00559             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt;= <a class="code" href="classNote.html#r9">_dots</a>; ++i) {
00560                   QPointF <a class="code" href="classElement.html#a20">pos</a>(<a class="code" href="classNote.html#r5">_sym</a>.<a class="code" href="structSym.html#a4">width</a>() + point(<a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o36">dotNoteDistance</a>) * i, y);
00561                   p.save();
00562                   p.translate(pos+<a class="code" href="classElement.html#a35">apos</a>());
00563                   <a class="code" href="symbols_8cpp.html#a31">dotSym</a>.<a class="code" href="structSym.html#a7">draw</a>(p);
00564                   p.restore();
00565                   }
00566             }
00567       <span class="keywordflow">if</span> (<a class="code" href="classNote.html#r11">_tieFor</a>)
00568             <a class="code" href="classNote.html#r11">_tieFor</a>-&gt;<a class="code" href="classElement.html#a43">draw</a>(p);
00569       <span class="keywordflow">if</span> (<a class="code" href="classNote.html#r4">_accidental</a>)
00570             <a class="code" href="classNote.html#r4">_accidental</a>-&gt;<a class="code" href="classElement.html#a43">draw</a>(p);
00571       <span class="keywordflow">if</span> (<a class="code" href="classNote.html#r10">_fingering</a>)
00572             <a class="code" href="classNote.html#r10">_fingering</a>-&gt;<a class="code" href="classElement.html#a43">draw</a>(p);
00573       }
00574 
00575 <span class="comment">//---------------------------------------------------------</span>
00576 <span class="comment">//   bboxUpdate</span>
00577 <span class="comment">//---------------------------------------------------------</span>
00578 
<a name="l00579"></a><a class="code" href="classNote.html#a5">00579</a> <span class="keywordtype">void</span> <a class="code" href="classNote.html#a5">Note::bboxUpdate</a>()
00580       {
00581       _bbox = <a class="code" href="classNote.html#r5">_sym</a>.<a class="code" href="structSym.html#a9">bbox</a>();
00582 
00583       <span class="keywordflow">if</span> (<a class="code" href="classNote.html#r11">_tieFor</a>)
00584             _bbox |= <a class="code" href="classNote.html#r11">_tieFor</a>-&gt;<a class="code" href="classElement.html#a33">bbox</a>().translated(<a class="code" href="classNote.html#r11">_tieFor</a>-&gt;<a class="code" href="classElement.html#a20">pos</a>());
00585       <span class="keywordflow">if</span> (<a class="code" href="classNote.html#r4">_accidental</a>)
00586             _bbox |= <a class="code" href="classNote.html#r4">_accidental</a>-&gt;<a class="code" href="classElement.html#a33">bbox</a>().translated(<a class="code" href="classNote.html#r4">_accidental</a>-&gt;<a class="code" href="classElement.html#a20">pos</a>());
00587       <span class="keywordflow">if</span> (<a class="code" href="classNote.html#r10">_fingering</a>)
00588             _bbox |= <a class="code" href="classNote.html#r10">_fingering</a>-&gt;<a class="code" href="classElement.html#a33">bbox</a>().translated(<a class="code" href="classNote.html#r10">_fingering</a>-&gt;<a class="code" href="classSText.html#a6">pos</a>());
00589       <span class="keywordflow">if</span> (<a class="code" href="classNote.html#r9">_dots</a>) {
00590             <span class="keywordtype">double</span> y = 0;
00591             <span class="keywordflow">if</span> ((<a class="code" href="classNote.html#r2">_line</a> &amp; 1) == 0) {
00592                   <span class="keywordflow">if</span> (<a class="code" href="classNote.html#a37">chord</a>()-&gt;<a class="code" href="classChordRest.html#a19">isUp</a>())
00593                         y = -<a class="code" href="spatium_8h.html#a0">_spatium</a> *.5;
00594                   <span class="keywordflow">else</span>
00595                         y = <a class="code" href="spatium_8h.html#a0">_spatium</a> * .5;
00596                   }
00597             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt;= <a class="code" href="classNote.html#r9">_dots</a>; ++i) {
00598                   QRectF dot = <a class="code" href="symbols_8cpp.html#a31">dotSym</a>.<a class="code" href="structSym.html#a9">bbox</a>();
00599                   <span class="keywordtype">double</span> xoff = <a class="code" href="classNote.html#r5">_sym</a>.<a class="code" href="structSym.html#a4">width</a>() + point(<a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o36">dotNoteDistance</a>) * i;
00600                   dot.translate(xoff, y);
00601                   _bbox |= dot;
00602                   }
00603             }
00604       }
00605 
00606 <span class="comment">//---------------------------------------------------------</span>
00607 <span class="comment">//   Note::write</span>
00608 <span class="comment">//---------------------------------------------------------</span>
00609 
<a name="l00610"></a><a class="code" href="classNote.html#a41">00610</a> <span class="keywordtype">void</span> <a class="code" href="classNote.html#a41">Note::write</a>(<a class="code" href="classXml.html">Xml</a>&amp; xml)<span class="keyword"> const</span>
00611 <span class="keyword">      </span>{
00612       xml.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"Note"</span>);
00613       Element::writeProperties(xml);
00614       xml.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"pitch"</span>, <a class="code" href="classNote.html#a15">pitch</a>());
00615       <span class="keywordflow">if</span> (<a class="code" href="classNote.html#r1">_userAccidental</a> != -1)
00616             xml.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"prefix"</span>, <a class="code" href="classNote.html#r1">_userAccidental</a>);
00617       <span class="keywordflow">if</span> (<a class="code" href="classNote.html#r10">_fingering</a>)
00618             <a class="code" href="classNote.html#r10">_fingering</a>-&gt;<a class="code" href="classFingering.html#a3">write</a>(xml);
00619       <span class="keywordflow">if</span> (<a class="code" href="classNote.html#r11">_tieFor</a>)
00620             <a class="code" href="classNote.html#r11">_tieFor</a>-&gt;<a class="code" href="classTie.html#a7">write</a>(xml);
00621       <span class="keywordflow">if</span> (<a class="code" href="classNote.html#r3">_move</a>)
00622             xml.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"move"</span>, <a class="code" href="classNote.html#r3">_move</a>);
00623       xml.<a class="code" href="classXml.html#a9">etag</a>(<span class="stringliteral">"Note"</span>);
00624       }
00625 
00626 <span class="comment">//---------------------------------------------------------</span>
00627 <span class="comment">//   readSlur</span>
00628 <span class="comment">//---------------------------------------------------------</span>
00629 
<a name="l00630"></a><a class="code" href="classChord.html#d2">00630</a> <span class="keywordtype">void</span> <a class="code" href="classChord.html#d2">Chord::readSlur</a>(QDomNode node, <span class="keywordtype">int</span> <span class="comment">/*staff*/</span>)
00631       {
00632       <span class="keywordtype">int</span> type = 0;         <span class="comment">// 0 - begin, 1 - end</span>
00633       <a class="code" href="globals_8h.html#a25">Placement</a> placement = <a class="code" href="globals_8h.html#a25a10">PLACE_AUTO</a>;
00634 
00635       QDomElement e = node.toElement();
00636       QString s = e.attribute(<span class="stringliteral">"type"</span>, <span class="stringliteral">""</span>);
00637       <span class="keywordflow">if</span> (s == <span class="stringliteral">"begin"</span>)
00638             type = 0;
00639       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s == <span class="stringliteral">"end"</span>)
00640             type = 1;
00641       <span class="keywordflow">else</span>
00642             printf(<span class="stringliteral">"Chord::readSlur: unknown type &lt;%s&gt;\n"</span>, s.latin1());
00643 
00644 <span class="comment">//      int number = e.attribute("number", "0").toInt();</span>
00645       s = e.attribute(<span class="stringliteral">"placement"</span>, <span class="stringliteral">""</span>);
00646       <span class="keywordflow">if</span> (s == <span class="stringliteral">"auto"</span>)
00647             placement = <a class="code" href="globals_8h.html#a25a10">PLACE_AUTO</a>;
00648       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s == <span class="stringliteral">"above"</span>)
00649             placement = <a class="code" href="globals_8h.html#a25a11">PLACE_ABOVE</a>;
00650       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s == <span class="stringliteral">"below"</span>)
00651             placement = <a class="code" href="globals_8h.html#a25a12">PLACE_BELOW</a>;
00652 <span class="preprocessor">#if 0 //TODO</span>
00653 <span class="preprocessor"></span>      XmlSlur* xs = &amp;(xml.slurs[number]);
00654       <span class="keywordflow">if</span> (type == 0) {
00655             xs-&gt;tick = <a class="code" href="classElement.html#a74">tick</a>();
00656             xs-&gt;placement = placement;
00657             xs-&gt;voice = <a class="code" href="classElement.html#a62">voice</a>();
00658             }
00659       <span class="keywordflow">else</span> {
00660             <a class="code" href="classSlur.html">Slur</a>* slur = <span class="keyword">new</span> <a class="code" href="classSlur.html">Slur</a>(<a class="code" href="classElement.html#a4">score</a>());
00661             slur-&gt;setUpMode(xs-&gt;placement);
00662 
00663             slur-&gt;<a class="code" href="classSlur.html#a10">setStart</a>(xs-&gt;tick, staff);
00664             slur-&gt;<a class="code" href="classSlur.html#a11">setEnd</a>(<a class="code" href="classElement.html#a74">tick</a>(), staff);
00665             <a class="code" href="classChordRest.html#a11">measure</a>()-&gt;<a class="code" href="classMeasure.html#a8">add</a>(slur);
00666             }
00667 <span class="preprocessor">#endif</span>
00668 <span class="preprocessor"></span>      }
00669 
00670 <span class="comment">//---------------------------------------------------------</span>
00671 <span class="comment">//   Note::read</span>
00672 <span class="comment">//---------------------------------------------------------</span>
00673 
<a name="l00674"></a><a class="code" href="classNote.html#a40">00674</a> <span class="keywordtype">void</span> <a class="code" href="classNote.html#a40">Note::read</a>(QDomNode node)
00675       {
00676       QDomElement e = node.toElement();
00677       node = node.firstChild();
00678       <span class="keywordflow">while</span> (!node.isNull()) {
00679             QDomElement e = node.toElement();
00680             QString tag(e.tagName());
00681             QString val(e.text());
00682             <span class="keywordtype">int</span> i = val.toInt();
00683 
00684             <span class="keywordflow">if</span> (tag == <span class="stringliteral">"pitch"</span>)
00685                   <a class="code" href="classNote.html#a16">setPitch</a>(i);
00686             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tag == <span class="stringliteral">"prefix"</span>)
00687                   <a class="code" href="classNote.html#r1">_userAccidental</a> = i;
00688             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tag == <span class="stringliteral">"Tie"</span>) {
00689                   <a class="code" href="classNote.html#r11">_tieFor</a> = <span class="keyword">new</span> <a class="code" href="classTie.html">Tie</a>(<a class="code" href="classElement.html#a4">score</a>());
00690                   <a class="code" href="classNote.html#r11">_tieFor</a>-&gt;<a class="code" href="classElement.html#a61">setStaff</a>(<a class="code" href="classElement.html#a59">staff</a>());
00691                   <a class="code" href="classNote.html#r11">_tieFor</a>-&gt;<a class="code" href="classTie.html#a8">read</a>(node);
00692                   <a class="code" href="classNote.html#r11">_tieFor</a>-&gt;<a class="code" href="classTie.html#a3">setStartNote</a>(<span class="keyword">this</span>);
00693                   }
00694             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tag == <span class="stringliteral">"Fingering"</span>) {
00695                   <a class="code" href="classNote.html#r10">_fingering</a> = <span class="keyword">new</span> <a class="code" href="classFingering.html">Fingering</a>(<a class="code" href="classElement.html#a4">score</a>());
00696                   <a class="code" href="classNote.html#r10">_fingering</a>-&gt;<a class="code" href="classElement.html#a61">setStaff</a>(<a class="code" href="classElement.html#a59">staff</a>());
00697                   <a class="code" href="classNote.html#r10">_fingering</a>-&gt;<a class="code" href="classFingering.html#a4">read</a>(node);
00698                   <a class="code" href="classNote.html#r10">_fingering</a>-&gt;<a class="code" href="classElement.html#a11">setParent</a>(<span class="keyword">this</span>);
00699                   }
00700             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tag == <span class="stringliteral">"move"</span>)
00701                   <a class="code" href="classNote.html#r3">_move</a> = i;
00702             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Element::readProperties(node))
00703                   ;
00704             <span class="keywordflow">else</span>
00705                   <a class="code" href="utils_8h.html#a4">domError</a>(node);
00706             node = node.nextSibling();
00707             }
00708       }
00709 
00710 <span class="comment">//---------------------------------------------------------</span>
00711 <span class="comment">//   Chord</span>
00712 <span class="comment">//---------------------------------------------------------</span>
00713 
<a name="l00714"></a><a class="code" href="classChord.html#d1">00714</a> <span class="keywordtype">void</span> <a class="code" href="classChord.html#d1">Chord::init</a>()
00715       {
00716       _up            = <span class="keyword">true</span>;
00717       <a class="code" href="classChord.html#r3">_stem</a>          = 0;
00718       <a class="code" href="classChord.html#r4">_flag</a>          = 0;
00719       <a class="code" href="classChord.html#r5">_stemDirection</a> = <a class="code" href="globals_8h.html#a24a7">AUTO</a>;
00720       <a class="code" href="classChord.html#r6">_grace</a>         = <span class="keyword">false</span>;
00721       }
00722 
<a name="l00723"></a><a class="code" href="classChord.html#a0">00723</a> <a class="code" href="classChord.html#a0">Chord::Chord</a>(<a class="code" href="classScore.html">Score</a>* s)
00724    : <a class="code" href="classChordRest.html">ChordRest</a>(s, <a class="code" href="element_8h.html#a65a25">CHORD</a>)
00725       {
00726       <a class="code" href="classChord.html#d1">init</a>();
00727       }
00728 
<a name="l00729"></a><a class="code" href="classChord.html#a1">00729</a> <a class="code" href="classChord.html#a0">Chord::Chord</a>(<a class="code" href="classScore.html">Score</a>* s, <span class="keywordtype">int</span> tick)
00730    : <a class="code" href="classChordRest.html">ChordRest</a>(s, <a class="code" href="element_8h.html#a65a25">CHORD</a>)
00731       {
00732       <a class="code" href="classChord.html#d1">init</a>();
00733       setTick(tick);
00734       }
00735 
<a name="l00736"></a><a class="code" href="classChord.html#a2">00736</a> <a class="code" href="classChord.html#a0">Chord::Chord</a>(<span class="keyword">const</span> <a class="code" href="classChord.html">Chord</a>&amp; a)
00737    : <a class="code" href="classChordRest.html">ChordRest</a>(a)
00738       {
00739       <a class="code" href="classChord.html#r3">_stem</a> = 0;
00740       <a class="code" href="classChord.html#r4">_flag</a> = 0;
00741       <span class="keywordflow">for</span> (<a class="code" href="note_8h.html#a3">ciNote</a> i = a.<a class="code" href="classChord.html#r0">notes</a>.begin(); i != a.<a class="code" href="classChord.html#r0">notes</a>.end(); ++i) {
00742             <a class="code" href="classNote.html">Note</a>* note = <span class="keyword">new</span> <a class="code" href="classNote.html">Note</a>(*(i-&gt;second));
00743             <a class="code" href="classChord.html#a28">add</a>(note);
00744             }
00745       <a class="code" href="classChord.html#r1">attributes</a> = a.<a class="code" href="classChord.html#r1">attributes</a>;    <span class="comment">// TODO: clone</span>
00746       <a class="code" href="classChord.html#r2">helpLines</a> = a.<a class="code" href="classChord.html#r2">helpLines</a>;      <span class="comment">// TODO: clone</span>
00747       <span class="keywordflow">if</span> (a.<a class="code" href="classChord.html#r3">_stem</a>)
00748             <a class="code" href="classChord.html#r3">_stem</a> = <span class="keyword">new</span> <a class="code" href="classStem.html">Stem</a>(*(a.<a class="code" href="classChord.html#r3">_stem</a>));
00749       <span class="keywordflow">if</span> (a.<a class="code" href="classChord.html#r4">_flag</a>)
00750             <a class="code" href="classChord.html#r4">_flag</a> = <span class="keyword">new</span> <a class="code" href="classFlag.html">Flag</a>(*(a.<a class="code" href="classChord.html#r4">_flag</a>));
00751       <a class="code" href="classChord.html#r5">_stemDirection</a> = a.<a class="code" href="classChord.html#r5">_stemDirection</a>;
00752       _up = a.<a class="code" href="classChordRest.html#p3">_up</a>;
00753       <a class="code" href="classChord.html#r6">_grace</a> = a.<a class="code" href="classChord.html#r6">_grace</a>;
00754       }
00755 
00756 <span class="comment">//---------------------------------------------------------</span>
00757 <span class="comment">//   setFlag</span>
00758 <span class="comment">//---------------------------------------------------------</span>
00759 
<a name="l00760"></a><a class="code" href="classChord.html#a27">00760</a> <span class="keywordtype">void</span> <a class="code" href="classChord.html#a27">Chord::setFlag</a>(<a class="code" href="classFlag.html">Flag</a>* f)
00761       {
00762       <span class="keywordflow">if</span> (<a class="code" href="classChord.html#r4">_flag</a>)
00763             <span class="keyword">delete</span> <a class="code" href="classChord.html#r4">_flag</a>;
00764       <a class="code" href="classChord.html#r4">_flag</a> = f;
00765       <span class="keywordflow">if</span> (<a class="code" href="classChord.html#r4">_flag</a>)
00766             <a class="code" href="classChord.html#r4">_flag</a>-&gt;<a class="code" href="classElement.html#a11">setParent</a>(<span class="keyword">this</span>);
00767       }
00768 
00769 <span class="comment">//---------------------------------------------------------</span>
00770 <span class="comment">//   setStem</span>
00771 <span class="comment">//---------------------------------------------------------</span>
00772 
<a name="l00773"></a><a class="code" href="classChord.html#a24">00773</a> <span class="keywordtype">void</span> <a class="code" href="classChord.html#a24">Chord::setStem</a>(<a class="code" href="classStem.html">Stem</a>* s)
00774       {
00775       <span class="keywordflow">if</span> (<a class="code" href="classChord.html#r3">_stem</a>)
00776             <span class="keyword">delete</span> <a class="code" href="classChord.html#r3">_stem</a>;
00777       <a class="code" href="classChord.html#r3">_stem</a> = s;
00778       <span class="keywordflow">if</span> (<a class="code" href="classChord.html#r3">_stem</a>)
00779             <a class="code" href="classChord.html#r3">_stem</a>-&gt;<a class="code" href="classElement.html#a11">setParent</a>(<span class="keyword">this</span>);
00780       }
00781 
00782 <span class="comment">//---------------------------------------------------------</span>
00783 <span class="comment">//   stemPos</span>
00784 <span class="comment">//---------------------------------------------------------</span>
00785 
<a name="l00786"></a><a class="code" href="classChord.html#a25">00786</a> QPointF <a class="code" href="classChord.html#a25">Chord::stemPos</a>(<span class="keywordtype">bool</span> upFlag, <span class="keywordtype">bool</span> top)<span class="keyword"> const</span>
00787 <span class="keyword">      </span>{
00788       <a class="code" href="classNote.html">Note</a>* note = (top ? !upFlag : upFlag) ? <a class="code" href="classChord.html#a15">noteList</a>()-&gt;<a class="code" href="classNoteList.html#a1">front</a>() : <a class="code" href="classChord.html#a15">noteList</a>()-&gt;<a class="code" href="classNoteList.html#a2">back</a>();
00789       <span class="keywordflow">return</span> note-&gt;<a class="code" href="classNote.html#a42">stemPos</a>(upFlag);
00790       }
00791 
00792 <span class="comment">//---------------------------------------------------------</span>
00793 <span class="comment">//   setSelected</span>
00794 <span class="comment">//---------------------------------------------------------</span>
00795 
<a name="l00796"></a><a class="code" href="classChord.html#a7">00796</a> <span class="keywordtype">void</span> <a class="code" href="classChord.html#a7">Chord::setSelected</a>(<span class="keywordtype">bool</span> f)
00797       {
00798       Element::setSelected(f);
00799       <a class="code" href="classNoteList.html">NoteList</a>* nl = <a class="code" href="classChord.html#a15">noteList</a>();
00800       <span class="keywordflow">for</span> (<a class="code" href="note_8h.html#a1">iNote</a> in = nl-&gt;begin(); in != nl-&gt;end(); ++in)
00801             in-&gt;second-&gt;setSelected(f);
00802       }
00803 
00804 <span class="comment">//---------------------------------------------------------</span>
00805 <span class="comment">//   hasAttribute</span>
00806 <span class="comment">//---------------------------------------------------------</span>
00807 
<a name="l00808"></a><a class="code" href="classChord.html#a30">00808</a> <a class="code" href="classNoteAttribute.html">NoteAttribute</a>* <a class="code" href="classChord.html#a30">Chord::hasAttribute</a>(<span class="keyword">const</span> <a class="code" href="classNoteAttribute.html">NoteAttribute</a>* a)
00809       {
00810       <span class="keywordtype">int</span> idx = a-&gt;<a class="code" href="classNoteAttribute.html#a5">idx</a>();
00811       <span class="keywordflow">for</span> (<a class="code" href="classpstl_1_1plist.html">iAttribute</a> l = <a class="code" href="classChord.html#r1">attributes</a>.<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); l != <a class="code" href="classChord.html#r1">attributes</a>.<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++l) {
00812             <span class="keywordflow">if</span> (idx == (*l)-&gt;idx())
00813                   <span class="keywordflow">return</span> *l;
00814             }
00815       <span class="keywordflow">return</span> 0;
00816       }
00817 
00818 <span class="comment">//---------------------------------------------------------</span>
00819 <span class="comment">//   add</span>
00820 <span class="comment">//---------------------------------------------------------</span>
00821 
<a name="l00822"></a><a class="code" href="classChord.html#a28">00822</a> <span class="keywordtype">void</span> <a class="code" href="classChord.html#a28">Chord::add</a>(<a class="code" href="classElement.html">Element</a>* e)
00823       {
00824       e-&gt;<a class="code" href="classElement.html#a63">setVoice</a>(<a class="code" href="classElement.html#a62">voice</a>());
00825       e-&gt;<a class="code" href="classElement.html#a11">setParent</a>(<span class="keyword">this</span>);
00826       e-&gt;<a class="code" href="classElement.html#a61">setStaff</a>(<a class="code" href="classElement.html#a59">staff</a>());
00827       <span class="keywordflow">if</span> (e-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a12">NOTE</a>)
00828             <a class="code" href="classChord.html#r0">notes</a>.<a class="code" href="classNoteList.html#a0">add</a>((<a class="code" href="classNote.html">Note</a>*)e);
00829       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (e-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a30">ATTRIBUTE</a>)
00830             <a class="code" href="classChord.html#r1">attributes</a>.<a class="code" href="classpstl_1_1plist.html#a2">push_back</a>((<a class="code" href="classNoteAttribute.html">NoteAttribute</a>*)e);
00831       <a class="code" href="classChord.html#a9">bboxUpdate</a>();
00832       }
00833 
00834 <span class="comment">//---------------------------------------------------------</span>
00835 <span class="comment">//   remove</span>
00836 <span class="comment">//---------------------------------------------------------</span>
00837 
<a name="l00838"></a><a class="code" href="classChord.html#a29">00838</a> <span class="keywordtype">void</span> <a class="code" href="classChord.html#a29">Chord::remove</a>(<a class="code" href="classElement.html">Element</a>* e)
00839       {
00840       <span class="keywordflow">if</span> (e-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a12">NOTE</a>) {
00841             <a class="code" href="note_8h.html#a1">iNote</a> i = <a class="code" href="classChord.html#r0">notes</a>.begin();
00842             <span class="keywordflow">for</span> (; i != <a class="code" href="classChord.html#r0">notes</a>.end(); ++i) {
00843                   <span class="keywordflow">if</span> (i-&gt;second == e) {
00844                         <a class="code" href="classChord.html#r0">notes</a>.erase(i);
00845                         <span class="keywordflow">break</span>;
00846                         }
00847                   }
00848             <span class="keywordflow">if</span> (i == <a class="code" href="classChord.html#r0">notes</a>.end())
00849                   printf(<span class="stringliteral">"Chord::remove() note %p not found!\n"</span>, e);
00850             }
00851       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (e-&gt;<a class="code" href="classElement.html#a40">type</a>() == <a class="code" href="element_8h.html#a65a30">ATTRIBUTE</a>) {
00852             <a class="code" href="classpstl_1_1plist.html">iAttribute</a> l = <a class="code" href="classChord.html#r1">attributes</a>.<a class="code" href="classpstl_1_1plist.html#a13">find</a>((<a class="code" href="classNoteAttribute.html">NoteAttribute</a>*)e);
00853             <span class="keywordflow">if</span> (l == <a class="code" href="classChord.html#r1">attributes</a>.<a class="code" href="classpstl_1_1plist.html#a4">end</a>())
00854                   printf(<span class="stringliteral">"Chord::remove(): attribute not found\n"</span>);
00855             <span class="keywordflow">else</span> {
00856                   <a class="code" href="classChord.html#r1">attributes</a>.erase(l);
00857                   }
00858             }
00859       <a class="code" href="classChord.html#a9">bboxUpdate</a>();
00860       }
00861 
00862 <span class="comment">//---------------------------------------------------------</span>
00863 <span class="comment">//   drawPosMark</span>
00864 <span class="comment">//---------------------------------------------------------</span>
00865 
<a name="l00866"></a><a class="code" href="note_8cpp.html#a0">00866</a> <span class="keywordtype">void</span> <a class="code" href="note_8cpp.html#a0">drawPosMark</a>(<a class="code" href="classPainter.html">Painter</a>&amp; painter, <span class="keyword">const</span> QPointF&amp; p)
00867       {
00868       qreal x = p.x();
00869       qreal y = p.y();
00870       painter.setPen(Qt::blue);
00871       painter.drawLine(QLineF(x-10, y-10, x+10, y+10));
00872       painter.drawLine(QLineF(x+10, y-10, x-10, y+10));
00873       }
00874 
00875 <span class="comment">//---------------------------------------------------------</span>
00876 <span class="comment">//   draw</span>
00877 <span class="comment">//    draw chord and calculate bounding region</span>
00878 <span class="comment">//---------------------------------------------------------</span>
00879 
<a name="l00880"></a><a class="code" href="classChord.html#a4">00880</a> <span class="keywordtype">void</span> <a class="code" href="classChord.html#a4">Chord::draw1</a>(<a class="code" href="classPainter.html">Painter</a>&amp; p)<span class="keyword"> const</span>
00881 <span class="keyword">      </span>{
00882       <span class="keywordflow">for</span> (<a class="code" href="note_8h.html#a3">ciNote</a> i = <a class="code" href="classChord.html#r0">notes</a>.begin(); i != <a class="code" href="classChord.html#r0">notes</a>.end(); ++i)
00883             i-&gt;second-&gt;draw(p);
00884       <span class="keywordflow">for</span> (<a class="code" href="classpstl_1_1plist.html">ciHelpLine</a> l = <a class="code" href="classChord.html#r2">helpLines</a>.<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); l != <a class="code" href="classChord.html#r2">helpLines</a>.<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++l)
00885             (*l)-&gt;draw(p);
00886       <span class="keywordflow">for</span> (<a class="code" href="classpstl_1_1plist.html">ciAttribute</a> l = <a class="code" href="classChord.html#r1">attributes</a>.<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); l != <a class="code" href="classChord.html#r1">attributes</a>.<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++l)
00887             (*l)-&gt;draw(p);
00888       <span class="keywordflow">if</span> (<a class="code" href="classChord.html#r4">_flag</a>)
00889             <a class="code" href="classChord.html#r4">_flag</a>-&gt;<a class="code" href="classElement.html#a43">draw</a>(p);
00890       <span class="keywordflow">if</span> (<a class="code" href="classChord.html#r3">_stem</a>)
00891             <a class="code" href="classChord.html#r3">_stem</a>-&gt;<a class="code" href="classElement.html#a43">draw</a>(p);
00892       }
00893 
00894 <span class="comment">//---------------------------------------------------------</span>
00895 <span class="comment">//   bboxUpdate</span>
00896 <span class="comment">//---------------------------------------------------------</span>
00897 
<a name="l00898"></a><a class="code" href="classChord.html#a9">00898</a> <span class="keywordtype">void</span> <a class="code" href="classChord.html#a9">Chord::bboxUpdate</a>()
00899       {
00900       _bbox = QRectF(0, 0, 0, 0);
00901       <span class="keywordflow">for</span> (<a class="code" href="note_8h.html#a3">ciNote</a> i = <a class="code" href="classChord.html#r0">notes</a>.begin(); i != <a class="code" href="classChord.html#r0">notes</a>.end(); ++i) {
00902             i-&gt;second-&gt;bboxUpdate();
00903             _bbox |= i-&gt;second-&gt;bbox().translated(i-&gt;second-&gt;pos());
00904             }
00905       <span class="keywordflow">for</span> (<a class="code" href="classpstl_1_1plist.html">ciHelpLine</a> i = <a class="code" href="classChord.html#r2">helpLines</a>.<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); i != <a class="code" href="classChord.html#r2">helpLines</a>.<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++i)
00906             _bbox |= (*i)-&gt;bbox().translated((*i)-&gt;pos());
00907       <span class="keywordflow">for</span> (<a class="code" href="classpstl_1_1plist.html">ciAttribute</a> i = <a class="code" href="classChord.html#r1">attributes</a>.<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); i != <a class="code" href="classChord.html#r1">attributes</a>.<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++i)
00908             _bbox |= (*i)-&gt;bbox().translated((*i)-&gt;pos());
00909       <span class="keywordflow">if</span> (<a class="code" href="classChord.html#r4">_flag</a>)
00910             _bbox |= <a class="code" href="classChord.html#r4">_flag</a>-&gt;<a class="code" href="classElement.html#a33">bbox</a>().translated(<a class="code" href="classChord.html#r4">_flag</a>-&gt;<a class="code" href="classElement.html#a20">pos</a>());
00911       <span class="keywordflow">if</span> (<a class="code" href="classChord.html#r3">_stem</a>)
00912             _bbox |= <a class="code" href="classChord.html#r3">_stem</a>-&gt;<a class="code" href="classElement.html#a33">bbox</a>().translated(<a class="code" href="classChord.html#r3">_stem</a>-&gt;<a class="code" href="classElement.html#a20">pos</a>());
00913       }
00914 
00915 <span class="comment">//---------------------------------------------------------</span>
00916 <span class="comment">//   layoutStem</span>
00917 <span class="comment">//    layout chord stem and hook</span>
00918 <span class="comment">//    (Notenhals &amp; Fhnchen)</span>
00919 <span class="comment">//---------------------------------------------------------</span>
00920 
<a name="l00921"></a><a class="code" href="classChord.html#a14">00921</a> <span class="keywordtype">void</span> <a class="code" href="classChord.html#a14">Chord::layoutStem</a>()
00922       {
00923       <a class="code" href="classSystem.html">System</a>* s      = <a class="code" href="classChordRest.html#a4">segment</a>()-&gt;<a class="code" href="classSegment.html#a14">measure</a>()-&gt;<a class="code" href="classMeasure.html#a40">system</a>();
00924       <span class="keywordtype">double</span> sy      = s-&gt;<a class="code" href="classSystem.html#a13">staff</a>(<a class="code" href="classElement.html#a60">staffIdx</a>())-&gt;<a class="code" href="classSysStaff.html#a0">bbox</a>().y();
00925       <a class="code" href="classNote.html">Note</a>* upnote   = <a class="code" href="classChord.html#r0">notes</a>.<a class="code" href="classNoteList.html#a2">back</a>();
00926       <a class="code" href="classNote.html">Note</a>* downnote = <a class="code" href="classChord.html#r0">notes</a>.<a class="code" href="classNoteList.html#a1">front</a>();
00927 
00928       <span class="keywordtype">double</span> uppos   = s-&gt;<a class="code" href="classSystem.html#a13">staff</a>(<a class="code" href="classElement.html#a60">staffIdx</a>() + upnote-&gt;<a class="code" href="classNote.html#a18">move</a>())-&gt;<a class="code" href="classSysStaff.html#a0">bbox</a>().y();
00929             uppos    = (uppos - sy)/<a class="code" href="spatium_8h.html#a0">_spatium</a> * 2.0 + upnote-&gt;<a class="code" href="classNote.html#a26">line</a>();
00930 
00931       <span class="keywordtype">double</span> downpos = s-&gt;<a class="code" href="classSystem.html#a13">staff</a>(<a class="code" href="classElement.html#a60">staffIdx</a>() + downnote-&gt;<a class="code" href="classNote.html#a18">move</a>())-&gt;<a class="code" href="classSysStaff.html#a0">bbox</a>().y();
00932             downpos  = (downpos - sy)/<a class="code" href="spatium_8h.html#a0">_spatium</a> * 2.0 + downnote-&gt;<a class="code" href="classNote.html#a26">line</a>();
00933 
00934       <span class="comment">//-----------------------------------------</span>
00935       <span class="comment">//  process stem (Hals)</span>
00936       <span class="comment">//-----------------------------------------</span>
00937 
00938       <span class="keywordtype">bool</span> up = <a class="code" href="classChordRest.html#a19">isUp</a>();
00939 
00940       <span class="keywordtype">int</span> hookIdx;
00941       <a class="code" href="classSpatium.html">Spatium</a> stemLen;
00942 
00943       <span class="keywordflow">if</span> (<a class="code" href="classChord.html#r6">_grace</a>) {
00944             stemLen = <a class="code" href="classSpatium.html">Spatium</a>(2.5);
00945             hookIdx = 1;
00946             }
00947       <span class="keywordflow">else</span> {
00948             stemLen = <a class="code" href="classSpatium.html">Spatium</a>((up ? uppos - 3 : 3 - downpos) / 2.0);
00949             <span class="keywordflow">if</span> (stemLen &lt; Spatium(3.5))
00950                   stemLen = Spatium(3.5);
00951             <span class="keywordflow">if</span> (<a class="code" href="classElement.html#a76">tickLen</a>() &lt; <a class="code" href="mtime_8h.html#a0">division</a>/16)
00952                   hookIdx = 5;
00953             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classElement.html#a76">tickLen</a>() &lt; <a class="code" href="mtime_8h.html#a0">division</a>/8)
00954                   hookIdx = 4;
00955             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classElement.html#a76">tickLen</a>() &lt; <a class="code" href="mtime_8h.html#a0">division</a>/4)
00956                   hookIdx = 3;
00957             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classElement.html#a76">tickLen</a>() &lt; <a class="code" href="mtime_8h.html#a0">division</a>/2) {
00958                   hookIdx = 2;
00959                   stemLen -= Spatium(.5);    <span class="comment">//??</span>
00960                   }
00961             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classElement.html#a76">tickLen</a>() &lt; <a class="code" href="mtime_8h.html#a0">division</a>)
00962                   hookIdx = 1;
00963             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classElement.html#a76">tickLen</a>() &lt; <a class="code" href="mtime_8h.html#a0">division</a>*2)
00964                   hookIdx = 0;
00965             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classElement.html#a76">tickLen</a>() &lt; <a class="code" href="mtime_8h.html#a0">division</a>*4)  <span class="comment">// &lt; 1/1</span>
00966                   hookIdx = 0;
00967             <span class="keywordflow">else</span> {
00968                   <a class="code" href="classChord.html#a24">setStem</a>(0);
00969                   <span class="keywordflow">return</span>;
00970                   }
00971             }
00972 
00973       <span class="keywordtype">double</span> headCorrection = 0.2;
00974 
00975       stemLen += <a class="code" href="classSpatium.html">Spatium</a>((downpos - uppos) * .5 - headCorrection);
00976       <span class="keywordflow">if</span> (!<a class="code" href="classChord.html#r3">_stem</a>) {
00977             <a class="code" href="classChord.html#r3">_stem</a> = <span class="keyword">new</span> <a class="code" href="classStem.html">Stem</a>(<a class="code" href="classElement.html#a4">score</a>());
00978             <a class="code" href="classChord.html#r3">_stem</a>-&gt;<a class="code" href="classElement.html#a11">setParent</a>(<span class="keyword">this</span>);
00979             }
00980       <a class="code" href="classChord.html#r3">_stem</a>-&gt;<a class="code" href="classLine.html#a10">setLen</a>(stemLen);
00981 
00982       <span class="keywordtype">double</span> pstemLen = point(stemLen);
00983       QPointF npos = <a class="code" href="classChord.html#a25">stemPos</a>(up, <span class="keyword">false</span>);
00984       <span class="keywordflow">if</span> (up)
00985             npos += QPointF(0, -pstemLen);
00986       <a class="code" href="classChord.html#r3">_stem</a>-&gt;<a class="code" href="classElement.html#a23">setpos</a>(npos);
00987 
00988       <span class="comment">//-----------------------------------------</span>
00989       <span class="comment">//  process hook (Fhnchen)</span>
00990       <span class="comment">//-----------------------------------------</span>
00991 
00992       <span class="keywordflow">if</span> (hookIdx) {
00993             <span class="keywordflow">if</span> (!up)
00994                   hookIdx = -hookIdx;
00995             <span class="keywordflow">if</span> (!<a class="code" href="classChord.html#r4">_flag</a>) {
00996                   <a class="code" href="classChord.html#r4">_flag</a> = <span class="keyword">new</span> <a class="code" href="classFlag.html">Flag</a>(<a class="code" href="classElement.html#a4">score</a>());
00997                   <a class="code" href="classChord.html#r4">_flag</a>-&gt;<a class="code" href="classElement.html#a11">setParent</a>(<span class="keyword">this</span>);
00998                   }
00999             <a class="code" href="classChord.html#r4">_flag</a>-&gt;<a class="code" href="classFlag.html#a4">setIdx</a>(hookIdx, <a class="code" href="classChord.html#r6">_grace</a>);
01000             <a class="code" href="classChord.html#r4">_flag</a>-&gt;<a class="code" href="classElement.html#a23">setpos</a>(npos + QPointF(1.5, up ? -1.5 : pstemLen));
01001             }
01002       <span class="keywordflow">else</span>
01003             <a class="code" href="classChord.html#a27">setFlag</a>(0);
01004       <a class="code" href="classChord.html#a9">bboxUpdate</a>();
01005       }
01006 
01007 <span class="comment">//---------------------------------------------------------</span>
01008 <span class="comment">//   layout</span>
01009 <span class="comment">//---------------------------------------------------------</span>
01010 
<a name="l01011"></a><a class="code" href="classChord.html#a32">01011</a> <span class="keywordtype">void</span> <a class="code" href="classElement.html#a66">Chord::layout</a>(<span class="keywordtype">int</span>)
01012       {
01013       <span class="keywordflow">if</span> (<a class="code" href="classChord.html#r0">notes</a>.empty())
01014             <span class="keywordflow">return</span>;
01015       <a class="code" href="classNote.html">Note</a>* upnote     = <a class="code" href="classChord.html#r0">notes</a>.<a class="code" href="classNoteList.html#a2">back</a>();
01016 <span class="comment">//      Note* downnote   = notes.front();</span>
01017       <span class="keywordtype">double</span> headWidth = upnote-&gt;<a class="code" href="classNote.html#a13">headWidth</a>();
01018 
01019       <a class="code" href="classChord.html#d0">computeUp</a>();
01020       <span class="keywordtype">bool</span> up = <a class="code" href="classChordRest.html#a19">isUp</a>();
01021 
01022       <span class="comment">//-----------------------------------------</span>
01023       <span class="comment">//  process notes</span>
01024       <span class="comment">//    - position</span>
01025       <span class="comment">//-----------------------------------------</span>
01026 
01027       <span class="keywordtype">int</span> minMove = 1;
01028       <span class="keywordtype">int</span> maxMove = -1;
01029 
01030       <a class="code" href="classSystem.html">System</a>* s = <a class="code" href="classChordRest.html#a4">segment</a>()-&gt;<a class="code" href="classSegment.html#a14">measure</a>()-&gt;<a class="code" href="classMeasure.html#a40">system</a>();
01031       <span class="keywordflow">for</span> (<a class="code" href="note_8h.html#a1">iNote</a> in = <a class="code" href="classChord.html#r0">notes</a>.begin(); in != <a class="code" href="classChord.html#r0">notes</a>.end(); ++in) {
01032             <a class="code" href="classNote.html">Note</a>* note = in-&gt;second;
01033             <span class="keywordtype">double</span> x = 0;
01034 
01035             <span class="keywordtype">int</span> <a class="code" href="classChord.html#a21">move</a> = note-&gt;<a class="code" href="classNote.html#a18">move</a>();
01036             <span class="keywordflow">if</span> (move &lt; minMove)
01037                   minMove = move;
01038             <span class="keywordflow">if</span> (move &gt; maxMove)
01039                   maxMove = move;
01040             <span class="keywordtype">double</span> y = s-&gt;<a class="code" href="classSystem.html#a13">staff</a>(<a class="code" href="classElement.html#a60">staffIdx</a>() + move)-&gt;<a class="code" href="classSysStaff.html#a0">bbox</a>().y();
01041             y        -= s-&gt;<a class="code" href="classSystem.html#a13">staff</a>(<a class="code" href="classElement.html#a60">staffIdx</a>())-&gt;<a class="code" href="classSysStaff.html#a0">bbox</a>().y();
01042             y        += in-&gt;second-&gt;line() * <a class="code" href="spatium_8h.html#a0">_spatium</a> * .5;
01043 
01044             <span class="keywordflow">if</span> (note-&gt;<a class="code" href="classNote.html#a31">mirror</a>())
01045                   x += up ? headWidth : - headWidth;
01046             note-&gt;<a class="code" href="classElement.html#a23">setpos</a>(x, y);
01047             <a class="code" href="classPrefix.html">Prefix</a>* accidental = note-&gt;<a class="code" href="classNote.html#a23">accidental</a>();
01048             <span class="keywordflow">if</span> (accidental) {
01049                   <span class="keywordtype">double</span> x = point(<a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o29">prefixNoteDistance</a>);
01050                   <span class="keywordflow">if</span> (<a class="code" href="classChord.html#r6">_grace</a>)
01051                         x /= 2;
01052                   accidental-&gt;<a class="code" href="classElement.html#a23">setpos</a>(- x - accidental-&gt;<a class="code" href="classElement.html#a37">width</a>(), 0);
01053                   }
01054             }
01055 
01056       <span class="comment">//-----------------------------------------</span>
01057       <span class="comment">//  process help lines</span>
01058       <span class="comment">//-----------------------------------------</span>
01059 
01060       <span class="keywordflow">for</span> (<a class="code" href="classpstl_1_1plist.html">iHelpLine</a> l = <a class="code" href="classChord.html#r2">helpLines</a>.<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); l != <a class="code" href="classChord.html#r2">helpLines</a>.<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++l)
01061             <span class="keyword">delete</span> *l;
01062       <a class="code" href="classChord.html#r2">helpLines</a>.clear();
01063 
01064       <span class="comment">//---------------------------------------------------</span>
01065       <span class="comment">//    process help lines for notes</span>
01066       <span class="comment">//    moved to upper staff</span>
01067       <span class="comment">//---------------------------------------------------</span>
01068 
01069       <span class="keywordtype">int</span> uppos;
01070       <span class="keywordtype">int</span> downpos;
01071       <span class="keywordflow">if</span> (minMove == -1) {
01072             uppos   = 1000;
01073             downpos = -1000;
01074             <span class="keywordflow">for</span> (<a class="code" href="note_8h.html#a1">iNote</a> in = <a class="code" href="classChord.html#r0">notes</a>.begin(); in != <a class="code" href="classChord.html#r0">notes</a>.end(); ++in) {
01075                   <span class="keywordflow">if</span> (in-&gt;second-&gt;move() == -1) {
01076                         <span class="keywordflow">if</span> (in-&gt;second-&gt;line() &lt; uppos)
01077                               uppos = in-&gt;second-&gt;line();
01078                         <span class="keywordflow">if</span> (in-&gt;second-&gt;line() &gt; downpos)
01079                               downpos = in-&gt;second-&gt;line();
01080                         }
01081                   }
01082             <span class="keywordflow">if</span> (uppos &lt; 0 || downpos &gt;= 10) {
01083                   <span class="keywordtype">double</span> x = upnote-&gt;<a class="code" href="classElement.html#a20">pos</a>().x();
01084                   x += headWidth/2 - <a class="code" href="spatium_8h.html#a0">_spatium</a>;
01085 
01086                   <span class="keywordtype">double</span> y = s-&gt;<a class="code" href="classSystem.html#a13">staff</a>(<a class="code" href="classElement.html#a60">staffIdx</a>() - 1)-&gt;<a class="code" href="classSysStaff.html#a0">bbox</a>().y();
01087                   y        -= s-&gt;<a class="code" href="classSystem.html#a13">staff</a>(<a class="code" href="classElement.html#a60">staffIdx</a>())-&gt;<a class="code" href="classSysStaff.html#a0">bbox</a>().y();
01088 
01089                   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = -2; i &gt;= uppos; i -= 2) {
01090                         <a class="code" href="classHelpLine.html">HelpLine</a>* h = <span class="keyword">new</span> <a class="code" href="classHelpLine.html">HelpLine</a>(<a class="code" href="classElement.html#a4">score</a>());
01091                         h-&gt;<a class="code" href="classElement.html#a11">setParent</a>(<span class="keyword">this</span>);
01092                         h-&gt;<a class="code" href="classElement.html#a23">setpos</a>(x, y + <a class="code" href="spatium_8h.html#a0">_spatium</a> * .5 * i);
01093                         <a class="code" href="classChord.html#r2">helpLines</a>.<a class="code" href="classpstl_1_1plist.html#a2">push_back</a>(h);
01094                         }
01095                   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 10; i &lt;= downpos; i += 2) {
01096                         <a class="code" href="classHelpLine.html">HelpLine</a>* h = <span class="keyword">new</span> <a class="code" href="classHelpLine.html">HelpLine</a>(<a class="code" href="classElement.html#a4">score</a>());
01097                         h-&gt;<a class="code" href="classElement.html#a11">setParent</a>(<span class="keyword">this</span>);
01098                         h-&gt;<a class="code" href="classElement.html#a23">setpos</a>(x, y + <a class="code" href="spatium_8h.html#a0">_spatium</a> * .5 * i);
01099                         <a class="code" href="classChord.html#r2">helpLines</a>.<a class="code" href="classpstl_1_1plist.html#a2">push_back</a>(h);
01100                         }
01101                   }
01102             }
01103 
01104       uppos   = 1000;
01105       downpos = -1000;
01106       <span class="keywordflow">for</span> (<a class="code" href="note_8h.html#a1">iNote</a> in = <a class="code" href="classChord.html#r0">notes</a>.begin(); in != <a class="code" href="classChord.html#r0">notes</a>.end(); ++in) {
01107             <span class="keywordflow">if</span> (in-&gt;second-&gt;move() == 0) {
01108                   <span class="keywordflow">if</span> (in-&gt;second-&gt;line() &lt; uppos)
01109                         uppos = in-&gt;second-&gt;line();
01110                   <span class="keywordflow">if</span> (in-&gt;second-&gt;line() &gt; downpos)
01111                         downpos = in-&gt;second-&gt;line();
01112                   }
01113             }
01114       <span class="keywordflow">if</span> (uppos &lt; 0 || downpos &gt;= 10) {
01115             <span class="keywordtype">double</span> x = upnote-&gt;<a class="code" href="classElement.html#a20">pos</a>().x();
01116             x += headWidth/2 - <a class="code" href="spatium_8h.html#a0">_spatium</a>;
01117 
01118             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = -2; i &gt;= uppos; i -= 2) {
01119                   <a class="code" href="classHelpLine.html">HelpLine</a>* h = <span class="keyword">new</span> <a class="code" href="classHelpLine.html">HelpLine</a>(<a class="code" href="classElement.html#a4">score</a>());
01120                   h-&gt;<a class="code" href="classElement.html#a11">setParent</a>(<span class="keyword">this</span>);
01121                   h-&gt;<a class="code" href="classElement.html#a23">setpos</a>(x, <a class="code" href="spatium_8h.html#a0">_spatium</a> * .5 * i);
01122                   <a class="code" href="classChord.html#r2">helpLines</a>.<a class="code" href="classpstl_1_1plist.html#a2">push_back</a>(h);
01123                   }
01124             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 10; i &lt;= downpos; i += 2) {
01125                   <a class="code" href="classHelpLine.html">HelpLine</a>* h = <span class="keyword">new</span> <a class="code" href="classHelpLine.html">HelpLine</a>(<a class="code" href="classElement.html#a4">score</a>());
01126                   h-&gt;<a class="code" href="classElement.html#a11">setParent</a>(<span class="keyword">this</span>);
01127                   h-&gt;<a class="code" href="classElement.html#a23">setpos</a>(x, <a class="code" href="spatium_8h.html#a0">_spatium</a> * .5 * i);
01128                   <a class="code" href="classChord.html#r2">helpLines</a>.<a class="code" href="classpstl_1_1plist.html#a2">push_back</a>(h);
01129                   }
01130             }
01131 
01132       <span class="comment">//---------------------------------------------------</span>
01133       <span class="comment">//    process help lines for notes</span>
01134       <span class="comment">//    moved to lower staff</span>
01135       <span class="comment">//---------------------------------------------------</span>
01136 
01137       <span class="keywordflow">if</span> (maxMove == 1) {
01138             uppos   = 1000;
01139             downpos = -1000;
01140             <span class="keywordflow">for</span> (<a class="code" href="note_8h.html#a1">iNote</a> in = <a class="code" href="classChord.html#r0">notes</a>.begin(); in != <a class="code" href="classChord.html#r0">notes</a>.end(); ++in) {
01141                   <span class="keywordflow">if</span> (in-&gt;second-&gt;move() == 1) {
01142                         <span class="keywordflow">if</span> (in-&gt;second-&gt;line() &lt; uppos)
01143                               uppos = in-&gt;second-&gt;line();
01144                         <span class="keywordflow">if</span> (in-&gt;second-&gt;line() &gt; downpos)
01145                               downpos = in-&gt;second-&gt;line();
01146                         }
01147                   }
01148             <span class="keywordflow">if</span> (uppos &lt; 0 || downpos &gt;= 10) {
01149                   <span class="keywordtype">double</span> x = upnote-&gt;<a class="code" href="classElement.html#a20">pos</a>().x();
01150                   x += headWidth/2 - <a class="code" href="spatium_8h.html#a0">_spatium</a>;
01151 
01152                   <span class="keywordtype">double</span> y = s-&gt;<a class="code" href="classSystem.html#a13">staff</a>(<a class="code" href="classElement.html#a60">staffIdx</a>() + 1)-&gt;<a class="code" href="classSysStaff.html#a0">bbox</a>().y();
01153                   y        -= s-&gt;<a class="code" href="classSystem.html#a13">staff</a>(<a class="code" href="classElement.html#a60">staffIdx</a>())-&gt;<a class="code" href="classSysStaff.html#a0">bbox</a>().y();
01154 
01155                   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = -2; i &gt;= uppos; i -= 2) {
01156                         <a class="code" href="classHelpLine.html">HelpLine</a>* h = <span class="keyword">new</span> <a class="code" href="classHelpLine.html">HelpLine</a>(<a class="code" href="classElement.html#a4">score</a>());
01157                         h-&gt;<a class="code" href="classElement.html#a11">setParent</a>(<span class="keyword">this</span>);
01158                         h-&gt;<a class="code" href="classElement.html#a23">setpos</a>(x, y + <a class="code" href="spatium_8h.html#a0">_spatium</a> * .5 * i);
01159                         <a class="code" href="classChord.html#r2">helpLines</a>.<a class="code" href="classpstl_1_1plist.html#a2">push_back</a>(h);
01160                         }
01161                   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 10; i &lt;= downpos; i += 2) {
01162                         <a class="code" href="classHelpLine.html">HelpLine</a>* h = <span class="keyword">new</span> <a class="code" href="classHelpLine.html">HelpLine</a>(<a class="code" href="classElement.html#a4">score</a>());
01163                         h-&gt;<a class="code" href="classElement.html#a11">setParent</a>(<span class="keyword">this</span>);
01164                         h-&gt;<a class="code" href="classElement.html#a23">setpos</a>(x, y + <a class="code" href="spatium_8h.html#a0">_spatium</a> * .5 * i);
01165                         <a class="code" href="classChord.html#r2">helpLines</a>.<a class="code" href="classpstl_1_1plist.html#a2">push_back</a>(h);
01166                         }
01167                   }
01168             }
01169 
01170       <span class="comment">//-----------------------------------------</span>
01171       <span class="comment">//  Note Attributes</span>
01172       <span class="comment">//-----------------------------------------</span>
01173 
01174       <span class="keywordtype">double</span> x = upnote-&gt;<a class="code" href="classElement.html#a20">pos</a>().x();
01175       <span class="keywordtype">double</span> y = upnote-&gt;<a class="code" href="classElement.html#a20">pos</a>().y();
01176       <span class="keywordtype">double</span> headHeight = upnote-&gt;<a class="code" href="classElement.html#a36">height</a>();
01177       <span class="keywordflow">if</span> (up) {
01178             y -= point(<a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o40">propertyDistanceStem</a> + <a class="code" href="classSpatium.html">Spatium</a>(3.5));
01179             x += headWidth;
01180             }
01181       <span class="keywordflow">else</span> {
01182             y -= (point(<a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o39">propertyDistanceHead</a>) + headHeight/2);
01183             x += headWidth * .5;
01184             }
01185       <span class="keywordflow">for</span> (<a class="code" href="classpstl_1_1plist.html">iAttribute</a> ia = <a class="code" href="classChord.html#r1">attributes</a>.<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); ia != <a class="code" href="classChord.html#r1">attributes</a>.<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++ia) {
01186             (*ia)-&gt;setpos(x, y);
01187             y -= (point(<a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o41">propertyDistance</a>) + (*ia)-&gt;bbox().height());
01188             }
01189 
01190       <span class="comment">//-----------------------------------------</span>
01191       <span class="comment">//  Fingering</span>
01192       <span class="comment">//-----------------------------------------</span>
01193 
01194       <span class="keywordflow">for</span> (<a class="code" href="note_8h.html#a1">iNote</a> in = <a class="code" href="classChord.html#r0">notes</a>.begin(); in != <a class="code" href="classChord.html#r0">notes</a>.end(); ++in) {
01195             <a class="code" href="classNote.html">Note</a>* note = in-&gt;second;
01196             <a class="code" href="classFingering.html">Fingering</a>* fingersatz = note-&gt;<a class="code" href="classNote.html#a28">fingering</a>();
01197             <span class="keywordflow">if</span> (fingersatz) {
01198                   <span class="keywordtype">double</span> x = <a class="code" href="spatium_8h.html#a0">_spatium</a> + note-&gt;<a class="code" href="classNote.html#a13">headWidth</a>();
01199                   fingersatz-&gt;<a class="code" href="classElement.html#a23">setpos</a>(x, 0.0);
01200                   }
01201             }
01202       <a class="code" href="classChord.html#a9">bboxUpdate</a>();
01203       }
01204 
01205 <span class="comment">//-----------------------------------------------------------------------------</span>
01206 <span class="comment">//   computeUp</span>
01207 <span class="comment">//    rules:</span>
01208 <span class="comment">//      single note:</span>
01209 <span class="comment">//          All notes beneath the middle line: upward stems</span>
01210 <span class="comment">//          All notes on or above the middle line: downward stems</span>
01211 <span class="comment">//      two notes:</span>
01212 <span class="comment">//          If the interval above the middle line is greater than the interval</span>
01213 <span class="comment">//             below the middle line: downward stems</span>
01214 <span class="comment">//          If the interval below the middle line is greater than the interval</span>
01215 <span class="comment">//             above the middle line: upward stems</span>
01216 <span class="comment">//          If the two notes are the same distance from the middle line:</span>
01217 <span class="comment">//             stem can go in either direction. but most engravers prefer</span>
01218 <span class="comment">//             downward stems</span>
01219 <span class="comment">//       &gt; two notes:</span>
01220 <span class="comment">//          If the interval of the highest note above the middle line is greater</span>
01221 <span class="comment">//             than the interval of the lowest note below the middle line:</span>
01222 <span class="comment">//             downward stems</span>
01223 <span class="comment">//          If the interval of the lowest note below the middle line is greater</span>
01224 <span class="comment">//             than the interval of the highest note above the middle line:</span>
01225 <span class="comment">//             upward stem</span>
01226 <span class="comment">//          If the highest and the lowest notes are the same distance from</span>
01227 <span class="comment">//          the middle line:, use these rules to determine stem direction:</span>
01228 <span class="comment">//             - If the majority of the notes are above the middle:</span>
01229 <span class="comment">//               downward stems</span>
01230 <span class="comment">//             - If the majority of the notes are below the middle:</span>
01231 <span class="comment">//               upward stems</span>
01232 <span class="comment">//-----------------------------------------------------------------------------</span>
01233 
<a name="l01234"></a><a class="code" href="classChord.html#d0">01234</a> <span class="keywordtype">void</span> <a class="code" href="classChord.html#d0">Chord::computeUp</a>()
01235       {
01236       <span class="keywordflow">if</span> (<a class="code" href="classChord.html#r5">_stemDirection</a> != <a class="code" href="globals_8h.html#a24a7">AUTO</a>) {
01237             _up = <a class="code" href="classChord.html#r5">_stemDirection</a> == <a class="code" href="structUP.html">UP</a>;
01238             <span class="keywordflow">return</span>;
01239             }
01240       <span class="keywordflow">if</span> (<a class="code" href="classChord.html#r6">_grace</a>) {
01241             _up = <span class="keyword">true</span>;
01242             <span class="keywordflow">return</span>;
01243             }
01244       <span class="keywordflow">if</span> (<a class="code" href="classElement.html#a76">tickLen</a>() &gt;= <a class="code" href="mtime_8h.html#a0">division</a>*4) {
01245             _up = <span class="keyword">true</span>;
01246             <span class="keywordflow">return</span>;
01247             }
01248 
01249       <a class="code" href="classNote.html">Note</a>* upnote = <a class="code" href="classChord.html#r0">notes</a>.rbegin()-&gt;second;
01250       <span class="keywordflow">if</span> (<a class="code" href="classChord.html#r0">notes</a>.size() == 1) {
01251             _up = upnote-&gt;<a class="code" href="classNote.html#a26">line</a>() &gt; 4;
01252             <span class="keywordflow">return</span>;
01253             }
01254       <a class="code" href="classNote.html">Note</a>* downnote = <a class="code" href="classChord.html#r0">notes</a>.begin()-&gt;second;
01255       <span class="keywordtype">int</span> ud = upnote-&gt;<a class="code" href="classNote.html#a26">line</a>() - 4;
01256       <span class="keywordtype">int</span> dd = downnote-&gt;<a class="code" href="classNote.html#a26">line</a>() - 4;
01257       <span class="keywordflow">if</span> (-ud == dd) {
01258             <span class="keywordtype">int</span> up = 0;
01259             <span class="keywordflow">for</span> (<a class="code" href="note_8h.html#a3">ciNote</a> in = <a class="code" href="classChord.html#r0">notes</a>.begin(); in != <a class="code" href="classChord.html#r0">notes</a>.end(); ++in) {
01260                   <span class="keywordtype">int</span> l = in-&gt;second-&gt;line();
01261                   <span class="keywordflow">if</span> (l &lt;= 4)
01262                         --up;
01263                   <span class="keywordflow">else</span>
01264                         ++up;
01265                   }
01266             _up = up &gt; 0;
01267             }
01268       _up = dd &gt; -ud;
01269       }
01270 
01271 <span class="comment">//---------------------------------------------------------</span>
01272 <span class="comment">//   move</span>
01273 <span class="comment">//---------------------------------------------------------</span>
01274 
<a name="l01275"></a><a class="code" href="classChord.html#a21">01275</a> <span class="keywordtype">int</span> <a class="code" href="classChord.html#a21">Chord::move</a>()<span class="keyword"> const</span>
01276 <span class="keyword">      </span>{
01277       <span class="keywordtype">int</span> <a class="code" href="classChord.html#a21">move</a> = <a class="code" href="classChord.html#r0">notes</a>.<a class="code" href="classNoteList.html#a1">front</a>()-&gt;<a class="code" href="classNote.html#a18">move</a>();
01278       <span class="keywordflow">for</span> (<a class="code" href="note_8h.html#a3">ciNote</a> in = <a class="code" href="classChord.html#r0">notes</a>.begin(); in != <a class="code" href="classChord.html#r0">notes</a>.end(); ++in) {
01279             <span class="keywordflow">if</span> (in-&gt;second-&gt;move() != move)
01280                   <span class="keywordflow">return</span> 0;
01281             }
01282       <span class="keywordflow">return</span> move;
01283       }
01284 
01285 <span class="comment">//---------------------------------------------------------</span>
01286 <span class="comment">//   selectedNote</span>
01287 <span class="comment">//---------------------------------------------------------</span>
01288 
<a name="l01289"></a><a class="code" href="classChord.html#a31">01289</a> <a class="code" href="classNote.html">Note</a>* <a class="code" href="classChord.html#a31">Chord::selectedNote</a>()<span class="keyword"> const</span>
01290 <span class="keyword">      </span>{
01291       <a class="code" href="classNote.html">Note</a>* note = 0;
01292       <span class="keywordflow">for</span> (<a class="code" href="note_8h.html#a3">ciNote</a> in = <a class="code" href="classChord.html#r0">notes</a>.begin(); in != <a class="code" href="classChord.html#r0">notes</a>.end(); ++in) {
01293             <span class="keywordflow">if</span> (in-&gt;second-&gt;isSelected()) {
01294                   <span class="keywordflow">if</span> (note)
01295                         <span class="keywordflow">return</span> 0;
01296                   note = in-&gt;second;
01297                   }
01298             }
01299       <span class="keywordflow">return</span> note;
01300       }
01301 
01302 <span class="comment">//---------------------------------------------------------</span>
01303 <span class="comment">//   findSelectableElement</span>
01304 <span class="comment">//    p is Measure relative</span>
01305 <span class="comment">//---------------------------------------------------------</span>
01306 
<a name="l01307"></a><a class="code" href="classChord.html#a33">01307</a> <a class="code" href="classElement.html">Element</a>* <a class="code" href="classChord.html#a33">Chord::findSelectableElement</a>(QPointF p)<span class="keyword"> const</span>
01308 <span class="keyword">      </span>{
01309       p -= <a class="code" href="classElement.html#a20">pos</a>();
01310       <span class="keywordflow">for</span> (<a class="code" href="note_8h.html#a3">ciNote</a> in = <a class="code" href="classChord.html#r0">notes</a>.begin(); in != <a class="code" href="classChord.html#r0">notes</a>.end(); ++in) {
01311             <a class="code" href="classNote.html">Note</a>* note = in-&gt;second;
01312             <span class="keywordflow">if</span> (note-&gt;<a class="code" href="classElement.html#a30">contains</a>(p)) {
01313                   <a class="code" href="classElement.html">Element</a>* se = note-&gt;<a class="code" href="classNote.html#a43">findSelectableElement</a>(p);
01314                   <span class="keywordflow">if</span> (se)
01315                         <span class="keywordflow">return</span> se;
01316                   }
01317             }
01318       <span class="keywordflow">for</span> (<a class="code" href="classpstl_1_1plist.html">ciAttribute</a> ia = <a class="code" href="classChord.html#r1">attributes</a>.<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); ia != <a class="code" href="classChord.html#r1">attributes</a>.<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++ia) {
01319             <span class="keywordflow">if</span> ((*ia)-&gt;contains(p))
01320                   <span class="keywordflow">return</span> *ia;
01321             }
01322       <span class="keywordflow">return</span> 0;
01323       }
01324 
01325 <span class="comment">//---------------------------------------------------------</span>
01326 <span class="comment">//   findSelectableElement</span>
01327 <span class="comment">//    p is Chord relative</span>
01328 <span class="comment">//---------------------------------------------------------</span>
01329 
<a name="l01330"></a><a class="code" href="classNote.html#a43">01330</a> <a class="code" href="classElement.html">Element</a>* <a class="code" href="classNote.html#a43">Note::findSelectableElement</a>(QPointF p)<span class="keyword"> const</span>
01331 <span class="keyword">      </span>{
01332       p -= <a class="code" href="classElement.html#a20">pos</a>();       <span class="comment">// note relative</span>
01333       <span class="keywordflow">if</span> (<a class="code" href="classNote.html#a33">tieFor</a>() &amp;&amp; <a class="code" href="classNote.html#a33">tieFor</a>()-&gt;<a class="code" href="classSlurTie.html#a12">contains</a>(p))
01334             <span class="keywordflow">return</span> <a class="code" href="classNote.html#a33">tieFor</a>();
01335       <span class="keywordflow">if</span> (<a class="code" href="classNote.html#a23">accidental</a>() &amp;&amp; <a class="code" href="classNote.html#a23">accidental</a>()-&gt;<a class="code" href="classElement.html#a30">contains</a>(p))
01336             <span class="keywordflow">return</span> <a class="code" href="classNote.html#a23">accidental</a>();
01337       <span class="keywordflow">if</span> (<a class="code" href="classNote.html#a28">fingering</a>() &amp;&amp; <a class="code" href="classNote.html#a28">fingering</a>()-&gt;<a class="code" href="classElement.html#a30">contains</a>(p))
01338             <span class="keywordflow">return</span> <a class="code" href="classNote.html#a28">fingering</a>();
01339       <span class="keywordflow">if</span> (<a class="code" href="classNote.html#r5">_sym</a>.<a class="code" href="structSym.html#a9">bbox</a>().contains(p))
01340             <span class="keywordflow">return</span> (<a class="code" href="classElement.html">Element</a>*)<span class="keyword">this</span>;
01341       <span class="keywordflow">return</span> 0;
01342       }
01343 
01344 <span class="comment">//---------------------------------------------------------</span>
01345 <span class="comment">//   ChordRest</span>
01346 <span class="comment">//---------------------------------------------------------</span>
01347 
<a name="l01348"></a><a class="code" href="classChordRest.html#a0">01348</a> <a class="code" href="classChordRest.html#a0">ChordRest::ChordRest</a>(<a class="code" href="classScore.html">Score</a>* s, ElementType t)
01349    : <a class="code" href="classElement.html">Element</a>(s, t)
01350       {
01351       <a class="code" href="classChordRest.html#p0">_beam</a>     = 0;
01352       <a class="code" href="classChordRest.html#p2">_tuplet</a>   = 0;
01353       <a class="code" href="classChordRest.html#p1">_beamMode</a> = <a class="code" href="note_8h.html#a36a29">BEAM_AUTO</a>;
01354       }
01355 
01356 <span class="comment">//---------------------------------------------------------</span>
01357 <span class="comment">//   ChordRest</span>
01358 <span class="comment">//---------------------------------------------------------</span>
01359 
<a name="l01360"></a><a class="code" href="classChordRest.html#a1">01360</a> <a class="code" href="classChordRest.html#a0">ChordRest::ChordRest</a>(<span class="keyword">const</span> <a class="code" href="classChordRest.html">ChordRest</a>&amp; r)
01361    : <a class="code" href="classElement.html">Element</a>(r)
01362       {
01363       <a class="code" href="classChordRest.html#p0">_beam</a>     = 0;
01364       <a class="code" href="classChordRest.html#p1">_beamMode</a> = r.<a class="code" href="classChordRest.html#p1">_beamMode</a>;
01365       <a class="code" href="classChordRest.html#p2">_tuplet</a>   = 0;    <span class="comment">// TODO</span>
01366       }
01367 
01368 <span class="comment">//---------------------------------------------------------</span>
01369 <span class="comment">//   setBeamMode</span>
01370 <span class="comment">//---------------------------------------------------------</span>
01371 
<a name="l01372"></a><a class="code" href="classChordRest.html#a5">01372</a> <span class="keywordtype">void</span> <a class="code" href="classChordRest.html#a5">ChordRest::setBeamMode</a>(BeamMode m)
01373       {
01374       <span class="keywordflow">if</span> (!<a class="code" href="classChordRest.html#p2">_tuplet</a>)
01375             <a class="code" href="classChordRest.html#p1">_beamMode</a> = m;
01376       }
01377 
01378 <span class="comment">//---------------------------------------------------------</span>
01379 <span class="comment">//   setTuplet</span>
01380 <span class="comment">//---------------------------------------------------------</span>
01381 
<a name="l01382"></a><a class="code" href="classChordRest.html#a9">01382</a> <span class="keywordtype">void</span> <a class="code" href="classChordRest.html#a9">ChordRest::setTuplet</a>(<a class="code" href="classTuplet.html">Tuplet</a>* t)
01383       {
01384       <a class="code" href="classChordRest.html#p2">_tuplet</a> = t;
01385       }
01386 
01387 <span class="comment">//---------------------------------------------------------</span>
01388 <span class="comment">//   beams</span>
01389 <span class="comment">//---------------------------------------------------------</span>
01390 
<a name="l01391"></a><a class="code" href="classChordRest.html#a12">01391</a> <span class="keywordtype">int</span> <a class="code" href="classChordRest.html#a12">ChordRest::beams</a>()<span class="keyword"> const</span>
01392 <span class="keyword">      </span>{
01393       <span class="keywordtype">int</span> t = <a class="code" href="classElement.html#a76">tickLen</a>();
01394       <span class="keywordflow">if</span> (t &lt; <a class="code" href="mtime_8h.html#a0">division</a>/8)
01395             <span class="keywordflow">return</span> 4;
01396       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t &lt; <a class="code" href="mtime_8h.html#a0">division</a>/4)
01397             <span class="keywordflow">return</span> 3;
01398       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t &lt; <a class="code" href="mtime_8h.html#a0">division</a>/2)
01399             <span class="keywordflow">return</span> 2;
01400       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t &lt; <a class="code" href="mtime_8h.html#a0">division</a>)
01401             <span class="keywordflow">return</span> 1;
01402       <span class="keywordflow">else</span>
01403             printf(<span class="stringliteral">"ChordRest::beams(): unsupported ticlLen %d\n"</span>, t);
01404       <span class="keywordflow">return</span> 0;
01405       }
01406 
01407 <span class="comment">//---------------------------------------------------------</span>
01408 <span class="comment">//   Rest</span>
01409 <span class="comment">//---------------------------------------------------------</span>
01410 
<a name="l01411"></a><a class="code" href="classRest.html#a0">01411</a> <a class="code" href="classRest.html#a0">Rest::Rest</a>(<a class="code" href="classScore.html">Score</a>* s)
01412   : <a class="code" href="classChordRest.html">ChordRest</a>(s, <a class="code" href="element_8h.html#a65a26">REST</a>)
01413       {
01414       _beamMode = <a class="code" href="note_8h.html#a36a33">BEAM_NO</a>;
01415       <a class="code" href="classRest.html#r1">_move</a>     = 0;
01416       }
01417 
<a name="l01418"></a><a class="code" href="classRest.html#a1">01418</a> <a class="code" href="classRest.html#a0">Rest::Rest</a>(<a class="code" href="classScore.html">Score</a>* s, <span class="keywordtype">int</span> tick, <span class="keywordtype">int</span> len)
01419   : <a class="code" href="classChordRest.html">ChordRest</a>(s, <a class="code" href="element_8h.html#a65a26">REST</a>)
01420       {
01421       setTick(tick);
01422       <a class="code" href="classRest.html#a4">setTickLen</a>(len);
01423       _beamMode = <a class="code" href="note_8h.html#a36a33">BEAM_NO</a>;
01424       <a class="code" href="classRest.html#r1">_move</a>     = 0;
01425       }
01426 
<a name="l01427"></a><a class="code" href="classRest.html#a2">01427</a> <a class="code" href="classRest.html#a0">Rest::Rest</a>(<span class="keyword">const</span> <a class="code" href="classRest.html">Rest</a>&amp; r)
01428    : <a class="code" href="classChordRest.html">ChordRest</a>(r)
01429       {
01430       <a class="code" href="classRest.html#r0">_sym</a>  = r.<a class="code" href="classRest.html#r0">_sym</a>;
01431       <a class="code" href="classRest.html#r1">_move</a> = r.<a class="code" href="classRest.html#r1">_move</a>;
01432       }
01433 
01434 <span class="comment">//---------------------------------------------------------</span>
01435 <span class="comment">//   Rest::draw</span>
01436 <span class="comment">//---------------------------------------------------------</span>
01437 
<a name="l01438"></a><a class="code" href="classRest.html#a6">01438</a> <span class="keywordtype">void</span> <a class="code" href="classRest.html#a6">Rest::draw1</a>(<a class="code" href="classPainter.html">Painter</a>&amp; p)<span class="keyword"> const</span>
01439 <span class="keyword">      </span>{
01440       <a class="code" href="classRest.html#r0">_sym</a>.<a class="code" href="structSym.html#a7">draw</a>(p);
01441       }
01442 
01443 <span class="comment">//---------------------------------------------------------</span>
01444 <span class="comment">//   setSym</span>
01445 <span class="comment">//---------------------------------------------------------</span>
01446 
<a name="l01447"></a><a class="code" href="classRest.html#a11">01447</a> <span class="keywordtype">void</span> <a class="code" href="classRest.html#a11">Rest::setSym</a>(<span class="keyword">const</span> <a class="code" href="structSym.html">Sym</a>&amp; s)
01448       {
01449       <a class="code" href="classRest.html#r0">_sym</a> = s;
01450       setbbox(<a class="code" href="classRest.html#r0">_sym</a>.<a class="code" href="structSym.html#a9">bbox</a>());
01451       }
01452 
01453 <span class="comment">//---------------------------------------------------------</span>
01454 <span class="comment">//   setLen</span>
01455 <span class="comment">//---------------------------------------------------------</span>
01456 
<a name="l01457"></a><a class="code" href="classRest.html#a4">01457</a> <span class="keywordtype">void</span> <a class="code" href="classRest.html#a4">Rest::setTickLen</a>(<span class="keywordtype">int</span> i)
01458       {
01459       Element::setTickLen(i);
01460       <span class="comment">// if rest spans measure:</span>
01461 <span class="preprocessor">#if 0 // TODO</span>
01462 <span class="preprocessor"></span>      <a class="code" href="classMeasure.html">Measure</a>* m = <a class="code" href="classChordRest.html#a11">measure</a>();
01463       <span class="keywordtype">int</span> ticksMeasure = m-&gt;<a class="code" href="classElement.html#a4">score</a>()-&gt;<a class="code" href="classScore.html#o9">sigmap</a>-&gt;<a class="code" href="classSigList.html#a9">ticksMeasure</a>(<a class="code" href="classElement.html#a74">tick</a>());
01464       <span class="keywordflow">if</span> (ticksMeasure == <a class="code" href="classElement.html#a76">tickLen</a>()) {
01465             <a class="code" href="classRest.html#a11">setSym</a>(<a class="code" href="symbols_8cpp.html#a1">wholerestSym</a>);
01466             <span class="keywordflow">return</span>;
01467             }
01468 <span class="preprocessor">#endif</span>
01469 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (i &lt;= <a class="code" href="mtime_8h.html#a0">division</a>/32)
01470             <a class="code" href="classRest.html#a11">setSym</a>(<a class="code" href="symbols_8cpp.html#a13">hundredtwentyeighthrestSym</a>);
01471       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i &lt;= <a class="code" href="mtime_8h.html#a0">division</a>/16)
01472             <a class="code" href="classRest.html#a11">setSym</a>(<a class="code" href="symbols_8cpp.html#a12">sixtyfourthrestSym</a>);
01473       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i &lt;= <a class="code" href="mtime_8h.html#a0">division</a>/8)
01474             <a class="code" href="classRest.html#a11">setSym</a>(<a class="code" href="symbols_8cpp.html#a11">thirtysecondrestSym</a>);
01475       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i &lt;= <a class="code" href="mtime_8h.html#a0">division</a>/4)
01476             <a class="code" href="classRest.html#a11">setSym</a>(<a class="code" href="symbols_8cpp.html#a10">sixteenthrestSym</a>);
01477       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i &lt;= <a class="code" href="mtime_8h.html#a0">division</a>/2)
01478             <a class="code" href="classRest.html#a11">setSym</a>(<a class="code" href="symbols_8cpp.html#a8">eighthrestSym</a>);
01479       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i &lt;= <a class="code" href="mtime_8h.html#a0">division</a>)
01480             <a class="code" href="classRest.html#a11">setSym</a>(<a class="code" href="symbols_8cpp.html#a7">quartrestSym</a>);
01481       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i &lt;= <a class="code" href="mtime_8h.html#a0">division</a>*2)
01482             <a class="code" href="classRest.html#a11">setSym</a>(<a class="code" href="symbols_8cpp.html#a2">halfrestSym</a>);
01483       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i &lt;= <a class="code" href="mtime_8h.html#a0">division</a>*4)
01484             <a class="code" href="classRest.html#a11">setSym</a>(<a class="code" href="symbols_8cpp.html#a1">wholerestSym</a>);
01485       <span class="keywordflow">else</span>
01486             <a class="code" href="classRest.html#a11">setSym</a>(<a class="code" href="symbols_8cpp.html#a1">wholerestSym</a>);
01487             <span class="comment">// printf("Rest::setTickLen: unknown %d %d\n", i, division*4);</span>
01488       }
01489 
01490 <span class="comment">//---------------------------------------------------------</span>
01491 <span class="comment">//   Chord::write</span>
01492 <span class="comment">//---------------------------------------------------------</span>
01493 
<a name="l01494"></a><a class="code" href="classChord.html#a5">01494</a> <span class="keywordtype">void</span> <a class="code" href="classChord.html#a5">Chord::write</a>(<a class="code" href="classXml.html">Xml</a>&amp; xml)<span class="keyword"> const</span>
01495 <span class="keyword">      </span>{
01496       xml.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"Chord"</span>);
01497       ChordRest::writeProperties(xml);
01498       <span class="keywordflow">if</span> (<a class="code" href="classChord.html#r6">_grace</a>)
01499             xml.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"GraceNote"</span>, <a class="code" href="classChord.html#r6">_grace</a>);
01500       <span class="keywordflow">if</span> (<a class="code" href="classChord.html#r5">_stemDirection</a> != <a class="code" href="globals_8h.html#a24a7">AUTO</a>)
01501             xml.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"StemDirection"</span>, <span class="keywordtype">int</span>(<a class="code" href="classChord.html#r5">_stemDirection</a>));
01502       <span class="keywordflow">for</span> (<a class="code" href="note_8h.html#a3">ciNote</a> in = <a class="code" href="classChord.html#r0">notes</a>.begin(); in != <a class="code" href="classChord.html#r0">notes</a>.end(); ++in)
01503             in-&gt;second-&gt;write(xml);
01504       <span class="keywordflow">for</span> (<a class="code" href="classpstl_1_1plist.html">ciAttribute</a> ia = <a class="code" href="classChord.html#r1">attributes</a>.<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); ia != <a class="code" href="classChord.html#r1">attributes</a>.<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++ia)
01505             (*ia)-&gt;write(xml);
01506       xml.<a class="code" href="classXml.html#a9">etag</a>(<span class="stringliteral">"Chord"</span>);
01507       }
01508 
01509 <span class="comment">//---------------------------------------------------------</span>
01510 <span class="comment">//   Chord::read</span>
01511 <span class="comment">//---------------------------------------------------------</span>
01512 
<a name="l01513"></a><a class="code" href="classChord.html#a6">01513</a> <span class="keywordtype">void</span> <a class="code" href="classChord.html#a6">Chord::read</a>(QDomNode node, <span class="keywordtype">int</span> staffIdx)
01514       {
01515       QDomElement e = node.toElement();
01516       setTick(e.attribute(<span class="stringliteral">"tick"</span>, <span class="stringliteral">"0"</span>).toInt());
01517 
01518       node = node.firstChild();
01519       <span class="keywordflow">while</span> (!node.isNull()) {
01520             QDomElement e = node.toElement();
01521             QString tag(e.tagName());
01522             QString val(e.text());
01523             <span class="keywordtype">int</span> i = val.toInt();
01524 
01525             <span class="keywordflow">if</span> (tag == <span class="stringliteral">"Note"</span>) {
01526                   <a class="code" href="classNote.html">Note</a>* note = <span class="keyword">new</span> <a class="code" href="classNote.html">Note</a>(<a class="code" href="classElement.html#a4">score</a>());
01527                   note-&gt;<a class="code" href="classElement.html#a11">setParent</a>(<span class="keyword">this</span>);
01528                   note-&gt;<a class="code" href="classNote.html#a7">setGrace</a>(<a class="code" href="classChord.html#r6">_grace</a>);
01529                   note-&gt;<a class="code" href="classElement.html#a61">setStaff</a>(<a class="code" href="classElement.html#a59">staff</a>());
01530                   note-&gt;<a class="code" href="classElement.html#a63">setVoice</a>(<a class="code" href="classElement.html#a62">voice</a>());
01531                   note-&gt;<a class="code" href="classNote.html#a8">setTicks</a>(<a class="code" href="classElement.html#a76">tickLen</a>());
01532                   note-&gt;<a class="code" href="classNote.html#a40">read</a>(node);
01533                   <a class="code" href="classChord.html#r0">notes</a>.<a class="code" href="classNoteList.html#a0">add</a>(note);
01534                   }
01535             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tag == <span class="stringliteral">"GraceNote"</span>)
01536                   <a class="code" href="classChord.html#r6">_grace</a> = i;
01537             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tag == <span class="stringliteral">"StemDirection"</span>)
01538                   <a class="code" href="classChord.html#r5">_stemDirection</a> = <a class="code" href="globals_8h.html#a24">Direction</a>(i);
01539             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tag == <span class="stringliteral">"Attribute"</span>) {
01540                   <a class="code" href="classNoteAttribute.html">NoteAttribute</a>* atr = <span class="keyword">new</span> <a class="code" href="classNoteAttribute.html">NoteAttribute</a>(<a class="code" href="classElement.html#a4">score</a>());
01541                   atr-&gt;<a class="code" href="classNoteAttribute.html#a6">read</a>(node);
01542                   <a class="code" href="classChord.html#a28">add</a>(atr);
01543                   }
01544             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ChordRest::readProperties(node))
01545                   ;
01546             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tag == <span class="stringliteral">"Slur"</span>) {
01547                   <a class="code" href="classChord.html#d2">readSlur</a>(node, staffIdx);
01548                   }
01549             <span class="keywordflow">else</span>
01550                   <a class="code" href="utils_8h.html#a4">domError</a>(node);
01551             node = node.nextSibling();
01552             }
01553       }
01554 
01555 <span class="comment">//---------------------------------------------------------</span>
01556 <span class="comment">//   dump</span>
01557 <span class="comment">//---------------------------------------------------------</span>
01558 
<a name="l01559"></a><a class="code" href="classChord.html#a8">01559</a> <span class="keywordtype">void</span> <a class="code" href="classChord.html#a8">Chord::dump</a>()<span class="keyword"> const</span>
01560 <span class="keyword">      </span>{
01561       printf(<span class="stringliteral">"Chord tick %d  len %d\n"</span>, <a class="code" href="classElement.html#a74">tick</a>(), <a class="code" href="classElement.html#a76">tickLen</a>());
01562       }
01563 
<a name="l01564"></a><a class="code" href="classRest.html#a5">01564</a> <span class="keywordtype">void</span> <a class="code" href="classRest.html#a5">Rest::dump</a>()<span class="keyword"> const</span>
01565 <span class="keyword">      </span>{
01566       printf(<span class="stringliteral">"Rest tick %d  len %d\n"</span>, <a class="code" href="classElement.html#a74">tick</a>(), <a class="code" href="classElement.html#a76">tickLen</a>());
01567       }
01568 
01569 <span class="comment">//---------------------------------------------------------</span>
01570 <span class="comment">//   startDrag</span>
01571 <span class="comment">//---------------------------------------------------------</span>
01572 
<a name="l01573"></a><a class="code" href="classNote.html#d0">01573</a> <span class="keywordtype">bool</span> <a class="code" href="classNote.html#d0">Note::startDrag</a>(<span class="keyword">const</span> QPointF&amp;)
01574       {
01575       <span class="keywordflow">return</span> <span class="keyword">true</span>;
01576       }
01577 
01578 <span class="comment">//---------------------------------------------------------</span>
01579 <span class="comment">//   drag</span>
01580 <span class="comment">//---------------------------------------------------------</span>
01581 
<a name="l01582"></a><a class="code" href="classNote.html#d1">01582</a> QRectF <a class="code" href="classNote.html#d1">Note::drag</a>(<span class="keyword">const</span> QPointF&amp; s)
01583       {
01584       QRectF bb(<a class="code" href="classNote.html#a37">chord</a>()-&gt;<a class="code" href="classElement.html#a33">bbox</a>());
01585       <a class="code" href="classNote.html#r13">_lineOffset</a> = lrint(s.y() * 2 / <a class="code" href="spatium_8h.html#a0">_spatium</a>);
01586       <a class="code" href="classNote.html#a5">bboxUpdate</a>();
01587       <a class="code" href="classNote.html#a37">chord</a>()-&gt;<a class="code" href="classChord.html#a32">layout</a>(-1);
01588       <a class="code" href="classNote.html#a37">chord</a>()-&gt;<a class="code" href="classChordRest.html#a11">measure</a>()-&gt;<a class="code" href="classMeasure.html#a58">layoutBeams</a>();
01589       bb |= <a class="code" href="classNote.html#a37">chord</a>()-&gt;<a class="code" href="classElement.html#a33">bbox</a>();
01590       <span class="keywordflow">return</span> bb.translated(<a class="code" href="classNote.html#a37">chord</a>()-&gt;<a class="code" href="classElement.html#a27">aref</a>());
01591       }
01592 
01593 <span class="comment">//---------------------------------------------------------</span>
01594 <span class="comment">//   endDrag</span>
01595 <span class="comment">//---------------------------------------------------------</span>
01596 
<a name="l01597"></a><a class="code" href="classNote.html#d2">01597</a> <span class="keywordtype">void</span> <a class="code" href="classNote.html#d2">Note::endDrag</a>()
01598       {
01599       <span class="keywordflow">if</span> (<a class="code" href="classNote.html#r13">_lineOffset</a> == 0)
01600             <span class="keywordflow">return</span>;
01601 
01602       <a class="code" href="classNote.html#r2">_line</a>      += <a class="code" href="classNote.html#r13">_lineOffset</a>;
01603       _lineOffset = 0;
01604 <span class="comment">//      int staff = chord()-&gt;staffIdx();</span>
01605 <span class="comment">//TODO      _pitch    = cs-&gt;line2pitch(_line, staff, chord()-&gt;tick());</span>
01606       }
01607 
01608 <span class="comment">//---------------------------------------------------------</span>
01609 <span class="comment">//   startDrag</span>
01610 <span class="comment">//---------------------------------------------------------</span>
01611 
<a name="l01612"></a><a class="code" href="classRest.html#d0">01612</a> <span class="keywordtype">bool</span> <a class="code" href="classRest.html#d0">Rest::startDrag</a>(<span class="keyword">const</span> QPointF&amp;)
01613       {
01614 <span class="comment">//      _userOff = Pos(0, _userOff.y);</span>
01615       <span class="keywordflow">return</span> <span class="keyword">true</span>;
01616       }
01617 
01618 <span class="comment">//---------------------------------------------------------</span>
01619 <span class="comment">//   drag</span>
01620 <span class="comment">//---------------------------------------------------------</span>
01621 
<a name="l01622"></a><a class="code" href="classRest.html#d1">01622</a> QRectF <a class="code" href="classRest.html#d1">Rest::drag</a>(<span class="keyword">const</span> QPointF&amp; s)
01623       {
01624       QRectF r(<a class="code" href="classElement.html#a34">abbox</a>());
01625       setUserOff(QPointF(0, s.y()) / <a class="code" href="spatium_8h.html#a0">_spatium</a>);  <span class="comment">// only move vertical</span>
01626       <span class="keywordflow">return</span> <a class="code" href="classElement.html#a34">abbox</a>() | r;
01627       }
01628 
01629 <span class="comment">//---------------------------------------------------------</span>
01630 <span class="comment">//   endDrag</span>
01631 <span class="comment">//---------------------------------------------------------</span>
01632 
<a name="l01633"></a><a class="code" href="classRest.html#d2">01633</a> <span class="keywordtype">void</span> <a class="code" href="classRest.html#d2">Rest::endDrag</a>()
01634       {
01635       }
01636 
01637 <span class="comment">//---------------------------------------------------------</span>
01638 <span class="comment">//   space</span>
01639 <span class="comment">//---------------------------------------------------------</span>
01640 
<a name="l01641"></a><a class="code" href="classChord.html#a36">01641</a> <span class="keywordtype">void</span> <a class="code" href="classChord.html#a36">Chord::space</a>(<span class="keywordtype">double</span>&amp; min, <span class="keywordtype">double</span>&amp; extra)<span class="keyword"> const</span>
01642 <span class="keyword">      </span>{
01643       extra = 0.0; <span class="comment">// point(::style-&gt;minNoteDistance);</span>
01644       <span class="keywordtype">double</span> mirror = 0.0;
01645       <span class="keywordtype">double</span> hw     = 0.0;
01646 
01647       <span class="keywordflow">for</span> (<a class="code" href="note_8h.html#a3">ciNote</a> i = <a class="code" href="classChord.html#r0">notes</a>.begin(); i != <a class="code" href="classChord.html#r0">notes</a>.end(); ++i) {
01648             <a class="code" href="classNote.html">Note</a>* note  = i-&gt;second;
01649             <span class="keywordtype">double</span> lhw = note-&gt;<a class="code" href="classNote.html#a13">headWidth</a>();
01650             <span class="keywordflow">if</span> (lhw &gt; hw)
01651                   hw = lhw;
01652             <span class="keywordtype">double</span> prefixWidth  = 0.0;
01653             <span class="keywordflow">if</span> (note-&gt;<a class="code" href="classNote.html#a23">accidental</a>()) {
01654                   prefixWidth = note-&gt;<a class="code" href="classNote.html#a23">accidental</a>()-&gt;<a class="code" href="classElement.html#a37">width</a>();
01655                   <span class="keywordflow">if</span> (<a class="code" href="classChord.html#r6">_grace</a>)
01656                        prefixWidth += point(::<a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o29">prefixNoteDistance</a>)/2.0;
01657                   <span class="keywordflow">else</span>
01658                        prefixWidth += 2.0 * point(::<a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o29">prefixNoteDistance</a>);
01659                   <span class="keywordflow">if</span> (prefixWidth &gt; extra)
01660                         extra = prefixWidth;
01661                   }
01662             <span class="keywordflow">if</span> (note-&gt;<a class="code" href="classNote.html#a31">mirror</a>()) {
01663                   <span class="keywordflow">if</span> (<a class="code" href="classChordRest.html#a19">isUp</a>()) {
01664                         <span class="comment">// Notenkopf auf der rechten Seite des</span>
01665                         <span class="comment">// Notenhalses</span>
01666                         mirror = lhw;
01667                         }
01668                   <span class="keywordflow">else</span> {
01669                         <span class="comment">// Notenkopf auf der linken Seite des</span>
01670                         <span class="comment">// Notenhalses</span>
01671                         <span class="keywordflow">if</span> ((lhw + prefixWidth) &gt; extra)
01672                               extra = lhw + prefixWidth;
01673                         }
01674                   }
01675             }
01676       min = mirror + hw;
01677       <span class="keywordflow">if</span> (<a class="code" href="classChordRest.html#a19">isUp</a>() &amp;&amp; <a class="code" href="classChord.html#r4">_flag</a>)
01678             min += <a class="code" href="classChord.html#r4">_flag</a>-&gt;<a class="code" href="classSymbol.html#a6">width</a>();
01679       }
01680 
01681 <span class="comment">//---------------------------------------------------------</span>
01682 <span class="comment">//   find</span>
01683 <span class="comment">//---------------------------------------------------------</span>
01684 
<a name="l01685"></a><a class="code" href="classNoteList.html#a3">01685</a> <a class="code" href="classNote.html">Note</a>* <a class="code" href="classNoteList.html#a3">NoteList::find</a>(<span class="keywordtype">int</span> pitch)<span class="keyword"> const</span>
01686 <span class="keyword">      </span>{
01687       <a class="code" href="note_8h.html#a3">ciNote</a> i = std::multimap&lt;const int, Note*&gt;::find(pitch);
01688       <span class="keywordflow">if</span> (i != end())
01689             <span class="keywordflow">return</span> i-&gt;second;
01690       <span class="keywordflow">return</span> 0;
01691       }
01692 
01693 <span class="comment">//---------------------------------------------------------</span>
01694 <span class="comment">//   space</span>
01695 <span class="comment">//---------------------------------------------------------</span>
01696 
<a name="l01697"></a><a class="code" href="classRest.html#a12">01697</a> <span class="keywordtype">void</span> <a class="code" href="classRest.html#a12">Rest::space</a>(<span class="keywordtype">double</span>&amp; min, <span class="keywordtype">double</span>&amp; extra)<span class="keyword"> const</span>
01698 <span class="keyword">      </span>{
01699       min   = <a class="code" href="classElement.html#a37">width</a>();
01700       extra = 0.0;
01701       }
01702 
01703 <span class="comment">//---------------------------------------------------------</span>
01704 <span class="comment">//   writeProperties</span>
01705 <span class="comment">//---------------------------------------------------------</span>
01706 
<a name="l01707"></a><a class="code" href="classChordRest.html#a2">01707</a> <span class="keywordtype">void</span> <a class="code" href="classChordRest.html#a2">ChordRest::writeProperties</a>(<a class="code" href="classXml.html">Xml</a>&amp; xml)<span class="keyword"> const</span>
01708 <span class="keyword">      </span>{
01709       Element::writeProperties(xml);
01710       <span class="keywordflow">if</span> (<a class="code" href="classChordRest.html#p1">_beamMode</a> != <a class="code" href="note_8h.html#a36a29">BEAM_AUTO</a>)
01711             xml.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"BeamMode"</span>, <span class="keywordtype">int</span>(<a class="code" href="classChordRest.html#p1">_beamMode</a>));
01712       }
01713 
01714 <span class="comment">//---------------------------------------------------------</span>
01715 <span class="comment">//   readProperties</span>
01716 <span class="comment">//---------------------------------------------------------</span>
01717 
<a name="l01718"></a><a class="code" href="classChordRest.html#a3">01718</a> <span class="keywordtype">bool</span> <a class="code" href="classChordRest.html#a3">ChordRest::readProperties</a>(QDomNode node)
01719       {
01720       <span class="keywordflow">if</span> (Element::readProperties(node))
01721             <span class="keywordflow">return</span> <span class="keyword">true</span>;
01722       QDomElement e = node.toElement();
01723       QString tag(e.tagName());
01724       QString val(e.text());
01725       <span class="keywordtype">int</span> i = val.toInt();
01726 
01727       <span class="keywordflow">if</span> (tag == <span class="stringliteral">"BeamMode"</span>)
01728             <a class="code" href="classChordRest.html#p1">_beamMode</a> = <a class="code" href="note_8h.html#a36">BeamMode</a>(i);
01729       <span class="keywordflow">else</span>
01730             <span class="keywordflow">return</span> <span class="keyword">false</span>;
01731       <span class="keywordflow">return</span> <span class="keyword">true</span>;
01732       }
01733 
01734 <span class="comment">//---------------------------------------------------------</span>
01735 <span class="comment">//   ShadowNote</span>
01736 <span class="comment">//---------------------------------------------------------</span>
01737 
<a name="l01738"></a><a class="code" href="classShadowNote.html#a0">01738</a> <a class="code" href="classShadowNote.html#a0">ShadowNote::ShadowNote</a>(<a class="code" href="classScore.html">Score</a>* s)
01739    : <a class="code" href="classElement.html">Element</a>(s, <a class="code" href="element_8h.html#a65a46">SHADOW_NOTE</a>)
01740       {
01741       <a class="code" href="classShadowNote.html#r0">_sym</a>  = <a class="code" href="symbols_8cpp.html#a35">quartheadSym</a>;
01742       _bbox = <a class="code" href="classShadowNote.html#r0">_sym</a>.<a class="code" href="structSym.html#a9">bbox</a>();
01743       <a class="code" href="classShadowNote.html#r1">_line</a> = 1000;
01744       }
01745 
01746 <span class="comment">//---------------------------------------------------------</span>
01747 <span class="comment">//   draw</span>
01748 <span class="comment">//---------------------------------------------------------</span>
01749 
<a name="l01750"></a><a class="code" href="classShadowNote.html#a6">01750</a> <span class="keywordtype">void</span> <a class="code" href="classShadowNote.html#a6">ShadowNote::draw</a>(<a class="code" href="classPainter.html">Painter</a>&amp; p)<span class="keyword"> const</span>
01751 <span class="keyword">      </span>{
01752       <span class="keywordflow">if</span> (!<a class="code" href="classElement.html#a16">visible</a>())
01753             <span class="keywordflow">return</span>;
01754 
01755       p.save();
01756       p.translate(<a class="code" href="classElement.html#a35">apos</a>());
01757       <span class="keywordflow">if</span> (p.clipRegion().boundingRect().intersects(<a class="code" href="classElement.html#a34">abbox</a>().toRect())) {
01758             qreal lw = point(<a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o25">helpLineWidth</a>);
01759             QPen pen(<a class="code" href="preferences_8cpp.html#a0">preferences</a>.<a class="code" href="structPreferences.html#o9">selectColor</a>[<a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o5">voice</a>].light(160));
01760             pen.setWidthF(lw);
01761             p.setPen(pen);
01762 
01763             <a class="code" href="classShadowNote.html#r0">_sym</a>.<a class="code" href="structSym.html#a7">draw</a>(p);
01764 
01765             <span class="keywordtype">double</span> x1 = <a class="code" href="classShadowNote.html#r0">_sym</a>.<a class="code" href="structSym.html#a4">width</a>()/2 - <a class="code" href="spatium_8h.html#a0">_spatium</a>;
01766             <span class="keywordtype">double</span> x2 = x1 + 2 * <a class="code" href="spatium_8h.html#a0">_spatium</a>;
01767 
01768             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = -2; i &gt;= <a class="code" href="classShadowNote.html#r1">_line</a>; i -= 2) {
01769                   <span class="keywordtype">double</span> y = <a class="code" href="spatium_8h.html#a0">_spatium</a> * .5 * (i - _line);
01770                   p.drawLine(QLineF(x1, y, x2, y));
01771                   }
01772             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 10; i &lt;= _line; i += 2) {
01773                   <span class="keywordtype">double</span> y = <a class="code" href="spatium_8h.html#a0">_spatium</a> * .5 * (i - _line);
01774                   p.drawLine(QLineF(x1, y, x2, y));
01775                   }
01776             }
01777       p.restore();
01778       }
01779 
01780 <span class="comment">//---------------------------------------------------------</span>
01781 <span class="comment">//   layout</span>
01782 <span class="comment">//---------------------------------------------------------</span>
01783 
<a name="l01784"></a><a class="code" href="classShadowNote.html#a5">01784</a> <span class="keywordtype">void</span> <a class="code" href="classShadowNote.html#a5">ShadowNote::layout</a>()
01785       {
01786       _bbox     = <a class="code" href="classShadowNote.html#r0">_sym</a>.<a class="code" href="structSym.html#a9">bbox</a>();
01787       <span class="keywordtype">double</span> x  = <a class="code" href="classShadowNote.html#r0">_sym</a>.<a class="code" href="structSym.html#a4">width</a>()/2 - <a class="code" href="spatium_8h.html#a0">_spatium</a>;
01788       <span class="keywordtype">double</span> lw = point(<a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o25">helpLineWidth</a>);
01789 
01790       QRectF r(0, -lw/2.0, 2 * <a class="code" href="spatium_8h.html#a0">_spatium</a>, lw);
01791 
01792       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = -2; i &gt;= <a class="code" href="classShadowNote.html#r1">_line</a>; i -= 2)
01793             _bbox |= r.translated(QPointF(x, <a class="code" href="spatium_8h.html#a0">_spatium</a> * .5 * (i - _line)));
01794       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 10; i &lt;= _line; i += 2)
01795             _bbox |= r.translated(QPointF(x, <a class="code" href="spatium_8h.html#a0">_spatium</a> * .5 * (i - _line)));
01796       }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Mon Jun 27 22:28:29 2005 for MuseScore by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
