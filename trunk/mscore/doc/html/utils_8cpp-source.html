<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>MuseScore: utils.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>utils.cpp</h1><a href="utils_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">//=========================================================</span>
00002 <span class="comment">//  MuseScore</span>
00003 <span class="comment">//  Linux Music Score Editor</span>
00004 <span class="comment">//  $Id: utils.cpp,v 1.14 2005/06/22 07:57:08 wschweer Exp $</span>
00005 <span class="comment">//</span>
00006 <span class="comment">//  (C) Copyright 2002-2004 Werner Schweer (ws@seh.de)</span>
00007 <span class="comment">//=========================================================</span>
00008 
00009 <span class="preprocessor">#include "<a class="code" href="element_8h.html">element.h</a>"</span>
00010 <span class="preprocessor">#include "<a class="code" href="utils_8h.html">utils.h</a>"</span>
00011 <span class="preprocessor">#include "<a class="code" href="project_8h.html">project.h</a>"</span>
00012 <span class="preprocessor">#include "<a class="code" href="page_8h.html">page.h</a>"</span>
00013 <span class="preprocessor">#include "<a class="code" href="segment_8h.html">segment.h</a>"</span>
00014 <span class="preprocessor">#include "<a class="code" href="painter_8h.html">painter.h</a>"</span>
00015 <span class="preprocessor">#include "<a class="code" href="measure_8h.html">measure.h</a>"</span>
00016 
00017 <span class="comment">//---------------------------------------------------------</span>
00018 <span class="comment">//   domError</span>
00019 <span class="comment">//---------------------------------------------------------</span>
00020 
<a name="l00021"></a><a class="code" href="utils_8h.html#a4">00021</a> <span class="keywordtype">void</span> <a class="code" href="utils_8h.html#a4">domError</a>(QDomNode&amp; node)
00022       {
00023       QDomElement e = node.toElement();
00024       QString tag(e.tagName());
00025       QString s;
00026       <span class="keywordflow">while</span> (!node.parentNode().isNull()) {
00027             node = node.parentNode();
00028             <span class="keyword">const</span> QDomElement e = node.toElement();
00029             <span class="keyword">const</span> QString k(e.tagName());
00030             <span class="keywordflow">if</span> (!s.isEmpty())
00031                   s += <span class="stringliteral">":"</span>;
00032             s += k;
00033             }
00034       printf(<span class="stringliteral">"%s: Unknown Node &lt;%s&gt;\n"</span>, s.latin1(), tag.latin1());
00035       }
00036 
00037 <span class="comment">//---------------------------------------------------------</span>
00038 <span class="comment">//   drawHandle</span>
00039 <span class="comment">//---------------------------------------------------------</span>
00040 
<a name="l00041"></a><a class="code" href="utils_8h.html#a0">00041</a> QRectF <a class="code" href="utils_8h.html#a0">drawHandle</a>(<a class="code" href="classPainter.html">Painter</a>&amp; p, <span class="keyword">const</span> QPointF&amp; pos, <span class="keywordtype">bool</span> active)
00042       {
00043       p.save();
00044       p.setPen(QPen(QColor(Qt::blue), 2.0/p.matrix().m11()));
00045       <span class="keywordflow">if</span> (active)
00046             p.setBrush(Qt::blue);
00047       <span class="keywordflow">else</span>
00048             p.setBrush(Qt::NoBrush);
00049       qreal w = 8.0 / p.matrix().m11();
00050       qreal h = 8.0 / p.matrix().m22();
00051 
00052       QRectF r(-w/2, -h/2, w, h);
00053       r.translate(pos);
00054 printf(<span class="stringliteral">"drawHAndle\n"</span>);
00055       p.drawRect(r);
00056       p.restore();
00057       <span class="keywordflow">return</span> r;
00058       }
00059 
00060 <span class="comment">//---------------------------------------------------------</span>
00061 <span class="comment">//   handleRect</span>
00062 <span class="comment">//---------------------------------------------------------</span>
00063 
<a name="l00064"></a><a class="code" href="utils_8h.html#a1">00064</a> QRectF <a class="code" href="utils_8h.html#a1">handleRect</a>(<span class="keyword">const</span> QPointF&amp; pos)
00065       {
00066       <span class="keywordflow">return</span> QRectF(pos.x()-4, pos.y()-4, 8, 8);
00067       }
00068 
00069 <span class="comment">//---------------------------------------------------------</span>
00070 <span class="comment">//   tick2measure</span>
00071 <span class="comment">//---------------------------------------------------------</span>
00072 
<a name="l00073"></a><a class="code" href="classScore.html#a128">00073</a> <a class="code" href="classMeasure.html">Measure</a>* <a class="code" href="undo_8cpp.html#a3">Score::tick2measure</a>(<span class="keywordtype">int</span> tick)
00074       {
00075       <span class="keywordflow">for</span> (<a class="code" href="classMeasure.html">Measure</a>* m = <a class="code" href="classScore.html#a100">first</a>(); m; m = m-&gt;<a class="code" href="classMeasure.html#a64">next</a>()) {
00076             <span class="keywordtype">int</span> st = m-&gt;<a class="code" href="classElement.html#a74">tick</a>();
00077             <span class="keywordtype">int</span> l  = m-&gt;<a class="code" href="classMeasure.html#a26">tickLen</a>();
00078             <span class="keywordflow">if</span> (tick &gt;= st &amp;&amp; tick &lt; (st+l))
00079                   <span class="keywordflow">return</span> m;
00080             }
00081       printf(<span class="stringliteral">"tick2measure %d not found\n"</span>, tick);
00082       <span class="keywordflow">return</span> 0;
00083       }
00084 
00085 <span class="comment">//---------------------------------------------------------</span>
00086 <span class="comment">//   tick2segment</span>
00087 <span class="comment">//---------------------------------------------------------</span>
00088 
<a name="l00089"></a><a class="code" href="classScore.html#a129">00089</a> <a class="code" href="classSegment.html">Segment</a>* <a class="code" href="classScore.html#a129">Score::tick2segment</a>(<span class="keywordtype">int</span> tick)
00090       {
00091       <a class="code" href="classMeasure.html">Measure</a>* m = <a class="code" href="undo_8cpp.html#a3">tick2measure</a>(tick);
00092       <span class="keywordflow">if</span> (m == 0) {
00093             printf(<span class="stringliteral">"   no segment for tick %d\n"</span>, tick);
00094             <span class="keywordflow">return</span> 0;
00095             }
00096       <span class="keywordflow">for</span> (<a class="code" href="classSegment.html">Segment</a>* segment = m-&gt;<a class="code" href="classMeasure.html#a28">first</a>(); segment;) {
00097             <a class="code" href="classSegment.html">Segment</a>* nsegment = segment-&gt;<a class="code" href="classSegment.html#a4">next</a>();
00098             <span class="keywordtype">int</span> t1 = segment-&gt;<a class="code" href="classElement.html#a74">tick</a>();
00099             <span class="keywordtype">int</span> t2 = nsegment ? nsegment-&gt;<a class="code" href="classElement.html#a74">tick</a>() : MAXINT;
00100             <span class="keywordflow">if</span> (tick &gt;= t1 &amp;&amp; tick &lt; t2)
00101                   <span class="keywordflow">return</span> segment;
00102             segment = nsegment;
00103             }
00104       <span class="keywordflow">return</span> 0;
00105       }
00106 
00107 <span class="comment">//---------------------------------------------------------</span>
00108 <span class="comment">//   tick2pos</span>
00109 <span class="comment">//    returned QPointF is relative to measure</span>
00110 <span class="comment">//---------------------------------------------------------</span>
00111 
<a name="l00112"></a><a class="code" href="classScore.html#a130">00112</a> QPointF <a class="code" href="classScore.html#a130">Score::tick2pos</a>(<span class="keywordtype">int</span> tick, <span class="keywordtype">int</span> <span class="comment">/*staff*/</span>)
00113       {
00114       <a class="code" href="classSegment.html">Segment</a>* seg = <a class="code" href="classScore.html#a129">tick2segment</a>(tick);
00115       <span class="keywordflow">if</span> (seg) {
00116             <span class="keywordflow">return</span> QPointF(seg-&gt;<a class="code" href="classSegment.html#a15">x</a>(), 0);
00117             }
00118       <span class="keywordflow">else</span>
00119             <span class="keywordflow">return</span> QPointF();
00120       }
00121 
00122 <span class="comment">//---------------------------------------------------------</span>
00123 <span class="comment">//   getStaff</span>
00124 <span class="comment">//---------------------------------------------------------</span>
00125 
<a name="l00126"></a><a class="code" href="utils_8h.html#a2">00126</a> <span class="keywordtype">int</span> <a class="code" href="utils_8h.html#a2">getStaff</a>(<a class="code" href="classSystem.html">System</a>* system, <span class="keyword">const</span> QPointF&amp; p)
00127       {
00128       QPointF pp = p - system-&gt;<a class="code" href="classSystem.html#a5">page</a>()-&gt;<a class="code" href="classElement.html#a20">pos</a>() - system-&gt;<a class="code" href="classElement.html#a20">pos</a>();
00129       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; system-&gt;<a class="code" href="classSystem.html#a5">page</a>()-&gt;<a class="code" href="classElement.html#a4">score</a>()-&gt;<a class="code" href="classScore.html#a6">nstaves</a>(); ++i) {
00130             <span class="keywordflow">if</span> (system-&gt;<a class="code" href="classSystem.html#a11">bboxStaff</a>(i).contains(pp))
00131                   <span class="keywordflow">return</span> i;
00132             }
00133       <span class="keywordflow">return</span> -1;
00134       }
00135 
00136 <span class="comment">//---------------------------------------------------------</span>
00137 <span class="comment">//   listFontFamilies</span>
00138 <span class="comment">//---------------------------------------------------------</span>
00139 
<a name="l00140"></a><a class="code" href="utils_8h.html#a3">00140</a> <span class="keywordtype">void</span> <a class="code" href="utils_8cpp.html#a4">listFontFamilies</a>()
00141       {
00142       QFontDatabase fdb;
00143       QStringList families = fdb.families();
00144 
00145       <span class="keywordflow">for</span> (QStringList::Iterator f = families.begin(); f != families.end(); ++f) {
00146             QString family = *f;
00147 printf(<span class="stringliteral">"family &lt;%s&gt;\n"</span>, family.latin1());
00148             <span class="keywordflow">if</span> (family == <span class="stringliteral">"mscore20"</span>) {
00149                   QStringList styles = fdb.styles(family);
00150                   <span class="keywordflow">for</span> (QStringList::Iterator s = styles.begin(); s != styles.end(); ++s) {
00151                         QString <a class="code" href="style_8cpp.html#a1">style</a> = *s;
00152                         QString dstyle = <span class="stringliteral">"\t"</span> + <a class="code" href="style_8cpp.html#a1">style</a> + <span class="stringliteral">" ("</span>;
00153                         Q3ValueList&lt;int&gt; smoothies = fdb.smoothSizes(family, <a class="code" href="style_8cpp.html#a1">style</a>);
00154                         <span class="keywordflow">for</span> (Q3ValueList&lt;int&gt;::Iterator points = smoothies.begin();
00155                            points != smoothies.end(); ++points) {
00156                               dstyle += QString::number(*points) + <span class="stringliteral">" "</span>;
00157                               }
00158                         dstyle = dstyle.left(dstyle.length() - 1) + <span class="stringliteral">")"</span>;
00159                         printf(<span class="stringliteral">"%s style %s\n"</span>, family.latin1(), dstyle.latin1());
00160                         }
00161                   }
00162             }
00163       }
00164 
00165 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Mon Jun 27 22:28:30 2005 for MuseScore by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
