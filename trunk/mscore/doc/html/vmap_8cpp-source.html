<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>MuseScore: vmap.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>vmap.cpp</h1><a href="vmap_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">//=========================================================</span>
00002 <span class="comment">//  MuseScore</span>
00003 <span class="comment">//  Linux Music Score Editor</span>
00004 <span class="comment">//  $Id: vmap.cpp,v 1.1.1.1 2004/05/18 09:22:20 wschweer Exp $</span>
00005 <span class="comment">//</span>
00006 <span class="comment">//  (C) Copyright 2002-2004 Werner Schweer (ws@seh.de)</span>
00007 <span class="comment">//=========================================================</span>
00008 
00009 <span class="preprocessor">#include "<a class="code" href="xml_8h.html">xml.h</a>"</span>
00010 <span class="preprocessor">#include "<a class="code" href="vmap_8h.html">vmap.h</a>"</span>
00011 
00012 <span class="comment">//---------------------------------------------------------</span>
00013 <span class="comment">//   clear</span>
00014 <span class="comment">//---------------------------------------------------------</span>
00015 
<a name="l00016"></a><a class="code" href="classValMap.html#a3">00016</a> <span class="keywordtype">void</span> <a class="code" href="classValMap.html#a3">ValMap::clear</a>()
00017       {
00018       <span class="keywordflow">for</span> (<a class="code" href="vmap_8h.html#a2">iValMap</a> i = begin(); i != end(); ++i)
00019             <span class="keyword">delete</span> i-&gt;second;
00020       viMap::clear();
00021       insert(std::pair&lt;const int, MapVal*&gt; (<a class="code" href="tempo_8h.html#a0">MAX_TICK</a>, <a class="code" href="classValMap.html#a2">initVal</a>()));
00022       }
00023 
00024 <span class="comment">//---------------------------------------------------------</span>
00025 <span class="comment">//   add</span>
00026 <span class="comment">//---------------------------------------------------------</span>
00027 
<a name="l00028"></a><a class="code" href="classValMap.html#a4">00028</a> <span class="keywordtype">bool</span> <a class="code" href="classValMap.html#a4">ValMap::add</a>(<a class="code" href="classMapVal.html">MapVal</a>* val)
00029       {
00030       <span class="keywordtype">int</span> tick = val-&gt;<a class="code" href="classMapVal.html#a4">tick</a>();
00031       <a class="code" href="vmap_8h.html#a2">iValMap</a> e = upper_bound(tick);
00032 
00033       <span class="keywordtype">bool</span> modified;
00034       <span class="keywordflow">if</span> (tick == e-&gt;second-&gt;tick()) {
00035             e-&gt;second = val;
00036             modified = <span class="keyword">true</span>;
00037             }
00038       <span class="keywordflow">else</span> {
00039             <a class="code" href="classMapVal.html">MapVal</a>* ne = e-&gt;second;
00040             <a class="code" href="classMapVal.html">MapVal</a>* ev = ne-&gt;<a class="code" href="classMapVal.html#a3">clone</a>();
00041             *ne = *val;
00042             insert(std::pair&lt;const int, MapVal*&gt; (tick, ev));
00043             modified = <span class="keyword">false</span>;
00044             }
00045       <a class="code" href="classValMap.html#d0">normalize</a>();
00046       <span class="keywordflow">return</span> modified;
00047       }
00048 
00049 <span class="comment">//---------------------------------------------------------</span>
00050 <span class="comment">//   del</span>
00051 <span class="comment">//---------------------------------------------------------</span>
00052 
<a name="l00053"></a><a class="code" href="classValMap.html#a5">00053</a> <span class="keywordtype">void</span> <a class="code" href="classValMap.html#a5">ValMap::del</a>(<span class="keywordtype">int</span> tick)
00054       {
00055       <a class="code" href="vmap_8h.html#a2">iValMap</a> e = find(tick);
00056       <span class="keywordflow">if</span> (e == end()) {
00057             printf(<span class="stringliteral">"ValMap::del(%d): not found\n"</span>, tick);
00058             <span class="keywordflow">return</span>;
00059             }
00060       <a class="code" href="vmap_8h.html#a2">iValMap</a> ne = e;
00061       ++ne;
00062       <span class="keywordflow">if</span> (ne == end()) {
00063             printf(<span class="stringliteral">"ValMap::del() HALLO!\n"</span>);
00064             <span class="keywordflow">return</span>;
00065             }
00066       *(ne-&gt;second) = *(e-&gt;second);
00067       erase(e);
00068       <a class="code" href="classValMap.html#d0">normalize</a>();
00069       }
00070 
00071 <span class="comment">//---------------------------------------------------------</span>
00072 <span class="comment">//   ValMap::normalize</span>
00073 <span class="comment">//---------------------------------------------------------</span>
00074 
<a name="l00075"></a><a class="code" href="classValMap.html#d0">00075</a> <span class="keywordtype">void</span> <a class="code" href="classValMap.html#d0">ValMap::normalize</a>()
00076       {
00077       <a class="code" href="classMapVal.html">MapVal</a>* <a class="code" href="classValMap.html#a6">val</a> = 0;
00078       <span class="keywordtype">int</span> tick    = 0;
00079       <a class="code" href="vmap_8h.html#a2">iValMap</a> ee;
00080 
00081       <span class="keywordflow">for</span> (<a class="code" href="vmap_8h.html#a2">iValMap</a> e = begin(); e != end();) {
00082             <span class="keywordflow">if</span> (*val == *(e-&gt;second)) {
00083                   e-&gt;second-&gt;setTick(tick);
00084                   erase(ee);
00085                   }
00086             val  = e-&gt;second;
00087             ee   = e;
00088             tick = e-&gt;second-&gt;<a class="code" href="classMapVal.html#a4">tick</a>();
00089             ++e;
00090             }
00091       }
00092 
00093 <span class="comment">//---------------------------------------------------------</span>
00094 <span class="comment">//   val</span>
00095 <span class="comment">//---------------------------------------------------------</span>
00096 
<a name="l00097"></a><a class="code" href="classValMap.html#a6">00097</a> <a class="code" href="classMapVal.html">MapVal</a>* <a class="code" href="classValMap.html#a6">ValMap::val</a>(<span class="keywordtype">int</span> tick)<span class="keyword"> const</span>
00098 <span class="keyword">      </span>{
00099       <a class="code" href="vmap_8h.html#a3">ciValMap</a> i = upper_bound(tick);
00100       <span class="keywordflow">if</span> (i == end()) {
00101             printf(<span class="stringliteral">"val at tick %d: not found\n"</span>, tick);
00102             abort();
00103             }
00104       <span class="keywordflow">return</span> i-&gt;second;
00105       }
00106 
00107 <span class="comment">//---------------------------------------------------------</span>
00108 <span class="comment">//   ValMap::write</span>
00109 <span class="comment">//---------------------------------------------------------</span>
00110 
00111 <span class="keywordtype">void</span> ValMap::write(<span class="keywordtype">int</span> level, <a class="code" href="classXml.html">Xml</a>&amp; xml, <span class="keyword">const</span> <span class="keywordtype">char</span>* name)<span class="keyword"> const</span>
00112 <span class="keyword">      </span>{
00113       xml.<a class="code" href="classXml.html#a8">tag</a>(level++, name);
00114       <span class="keywordflow">for</span> (<a class="code" href="vmap_8h.html#a3">ciValMap</a> i = begin(); i != end(); ++i)
00115             i-&gt;second-&gt;write(level, xml, i-&gt;first);
00116       xml.<a class="code" href="classXml.html#a9">etag</a>(level, name);
00117       }
00118 
00119 <span class="comment">//---------------------------------------------------------</span>
00120 <span class="comment">//   ValMap::read</span>
00121 <span class="comment">//---------------------------------------------------------</span>
00122 
00123 <span class="keywordtype">void</span> <a class="code" href="classValMap.html#a7">ValMap::read</a>(<a class="code" href="classXml.html">Xml</a>&amp; xml, <span class="keyword">const</span> <span class="keywordtype">char</span>* name)
00124       {
00125       }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Mon Jun 27 22:28:30 2005 for MuseScore by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
