<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>MuseScore: exportxml.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>exportxml.cpp</h1><a href="exportxml_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">//=========================================================</span>
00002 <span class="comment">//  MusE Score</span>
00003 <span class="comment">//  Linux Music Score Editor</span>
00004 <span class="comment">//  $Id: exportxml.cpp,v 1.36 2005/06/20 13:54:53 wschweer Exp $</span>
00005 <span class="comment">//</span>
00006 <span class="comment">//  (C) Copyright 2002-2004 Werner Schweer (ws@seh.de)</span>
00007 <span class="comment">//=========================================================</span>
00008 
00009 <span class="preprocessor">#include "<a class="code" href="config_8h.html">config.h</a>"</span>
00010 <span class="preprocessor">#include "<a class="code" href="mscore_8h.html">mscore.h</a>"</span>
00011 <span class="preprocessor">#include "<a class="code" href="file_8h.html">file.h</a>"</span>
00012 <span class="preprocessor">#include "<a class="code" href="project_8h.html">project.h</a>"</span>
00013 <span class="preprocessor">#include "<a class="code" href="sig_8h.html">sig.h</a>"</span>
00014 <span class="preprocessor">#include "<a class="code" href="key_8h.html">key.h</a>"</span>
00015 <span class="preprocessor">#include "<a class="code" href="clef_8h.html">clef.h</a>"</span>
00016 <span class="preprocessor">#include "<a class="code" href="note_8h.html">note.h</a>"</span>
00017 <span class="preprocessor">#include "<a class="code" href="segment_8h.html">segment.h</a>"</span>
00018 <span class="preprocessor">#include "<a class="code" href="text_8h.html">text.h</a>"</span>
00019 <span class="preprocessor">#include "<a class="code" href="xml_8h.html">xml.h</a>"</span>
00020 <span class="preprocessor">#include "<a class="code" href="beam_8h.html">beam.h</a>"</span>
00021 <span class="preprocessor">#include "<a class="code" href="staff_8h.html">staff.h</a>"</span>
00022 <span class="preprocessor">#include "<a class="code" href="part_8h.html">part.h</a>"</span>
00023 <span class="preprocessor">#include "<a class="code" href="measure_8h.html">measure.h</a>"</span>
00024 <span class="preprocessor">#include "<a class="code" href="bar_8h.html">bar.h</a>"</span>
00025 <span class="preprocessor">#include "<a class="code" href="style_8h.html">style.h</a>"</span>
00026 
00027 <span class="comment">//---------------------------------------------------------</span>
00028 <span class="comment">//   exportMusicXml</span>
00029 <span class="comment">//---------------------------------------------------------</span>
00030 
<a name="l00031"></a><a class="code" href="classExportMusicXml.html">00031</a> <span class="keyword">class </span><a class="code" href="classExportMusicXml.html">ExportMusicXml</a> : <span class="keyword">public</span> <a class="code" href="classSaveFile.html">SaveFile</a> {
<a name="l00032"></a><a class="code" href="classExportMusicXml.html#r0">00032</a>       <a class="code" href="classScore.html">Score</a>* <a class="code" href="classExportMusicXml.html#r0">score</a>;
<a name="l00033"></a><a class="code" href="classExportMusicXml.html#r1">00033</a>       <a class="code" href="classXml.html">Xml</a> <a class="code" href="classExportMusicXml.html#r1">xml</a>;
00034       <span class="keywordtype">void</span> <a class="code" href="classExportMusicXml.html#d0">chord</a>(<a class="code" href="classChord.html">Chord</a>* chord, <span class="keywordtype">int</span> staff);
00035       <span class="keywordtype">void</span> <a class="code" href="classExportMusicXml.html#d1">rest</a>(<a class="code" href="classRest.html">Rest</a>* chord, <span class="keywordtype">int</span> staff);
00036       <span class="keywordtype">void</span> <a class="code" href="classExportMusicXml.html#d2">clef</a>(<span class="keywordtype">int</span> staff, <span class="keywordtype">int</span> clef);
00037       <span class="keywordtype">void</span> <a class="code" href="classExportMusicXml.html#d3">timesig</a>(<span class="keywordtype">int</span> z, <span class="keywordtype">int</span> n);
00038       <span class="keywordtype">void</span> <a class="code" href="classExportMusicXml.html#d4">keysig</a>(<span class="keywordtype">int</span> key);
00039       <span class="keywordtype">void</span> <a class="code" href="classExportMusicXml.html#d5">bar</a>(<span class="keyword">const</span> <a class="code" href="classBar.html">Bar</a>* bar);
00040       <span class="keywordtype">void</span> <a class="code" href="classExportMusicXml.html#d6">pitch2xml</a>(<a class="code" href="classNote.html">Note</a>* note, <span class="keywordtype">char</span>&amp; c, <span class="keywordtype">int</span>&amp; alter, <span class="keywordtype">int</span>&amp; octave, <span class="keywordtype">int</span> staff);
00041 
00042    <span class="keyword">public</span>:
<a name="l00043"></a><a class="code" href="classExportMusicXml.html#a0">00043</a>       <a class="code" href="classExportMusicXml.html">ExportMusicXml</a>(<a class="code" href="classScore.html">Score</a>* s) { <a class="code" href="classExportMusicXml.html#r0">score</a> = s;}
00044       <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classExportMusicXml.html#a1">saver</a>();
00045       };
00046 
00047 <span class="comment">//---------------------------------------------------------</span>
00048 <span class="comment">//   pitch2xml</span>
00049 <span class="comment">//---------------------------------------------------------</span>
00050 
<a name="l00051"></a><a class="code" href="classExportMusicXml.html#d6">00051</a> <span class="keywordtype">void</span> <a class="code" href="classExportMusicXml.html#d6">ExportMusicXml::pitch2xml</a>(<a class="code" href="classNote.html">Note</a>* note, <span class="keywordtype">char</span>&amp; c, <span class="keywordtype">int</span>&amp; alter, <span class="keywordtype">int</span>&amp; octave, <span class="keywordtype">int</span> staff)
00052       {
00053       <span class="keyword">static</span> <span class="keywordtype">char</span>* table1  = <span class="stringliteral">"FEDCBAG"</span>;
00054 
00055       <span class="keywordtype">int</span> tick   = note-&gt;<a class="code" href="classNote.html#a37">chord</a>()-&gt;<a class="code" href="classElement.html#a74">tick</a>();
00056       <a class="code" href="classStaff.html">Staff</a>* i   = <a class="code" href="classExportMusicXml.html#r0">score</a>-&gt;<a class="code" href="classScore.html#a7">staff</a>(staff);
00057       <span class="keywordtype">int</span> offset = <a class="code" href="clef_8h.html#a0">clefTable</a>[i-&gt;<a class="code" href="classStaff.html#a2">clef</a>()-&gt;<a class="code" href="classClefList.html#a1">clef</a>(tick)].<a class="code" href="structClefInfo.html#o2">yOffset</a>;
00058 
00059       <span class="keywordtype">int</span> step   = (note-&gt;<a class="code" href="classNote.html#a26">line</a>() - offset + 700) % 7;
00060       c          = table1[step];
00061 
00062       <span class="keywordtype">int</span> pitch  = note-&gt;<a class="code" href="classNote.html#a15">pitch</a>() - 12;
00063       octave     = pitch / 12;
00064 
00065       <span class="keyword">static</span> <span class="keywordtype">int</span> table2[7] = { 5, 4, 2, 0, 11, 9, 7 };
00066       <span class="keywordtype">int</span> npitch = table2[step] + (octave + 1) * 12;
00067       alter      = note-&gt;<a class="code" href="classNote.html#a15">pitch</a>() - npitch;
00068       }
00069 
00070 <span class="comment">//---------------------------------------------------------</span>
00071 <span class="comment">//   tick2xml</span>
00072 <span class="comment">//    set type + dots depending on tick len</span>
00073 <span class="comment">//---------------------------------------------------------</span>
00074 
<a name="l00075"></a><a class="code" href="exportxml_8cpp.html#a0">00075</a> <span class="keyword">static</span> QString <a class="code" href="exportxml_8cpp.html#a0">tick2xml</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> ticks, <span class="keywordtype">int</span>&amp; dots)
00076       {
00077       QString type(<span class="stringliteral">""</span>);
00078       dots = 0;
00079       <span class="keywordflow">switch</span> (ticks) {
00080             <span class="keywordflow">case</span> 16*<a class="code" href="mtime_8h.html#a0">division</a>:       <span class="comment">// 4/1</span>
00081                   type = <span class="stringliteral">"long"</span>;
00082                   <span class="keywordflow">break</span>;
00083             <span class="keywordflow">case</span> 8*<a class="code" href="mtime_8h.html#a0">division</a>:        <span class="comment">// 2/1</span>
00084                   type = <span class="stringliteral">"breve"</span>;
00085                   <span class="keywordflow">break</span>;
00086             <span class="keywordflow">case</span> 6*<a class="code" href="mtime_8h.html#a0">division</a>:        <span class="comment">// 1/1 + 1/2  (gibt's das???)</span>
00087                   type = <span class="stringliteral">"whole"</span>;
00088                   dots  = 1;
00089                   <span class="keywordflow">break</span>;
00090             <span class="keywordflow">case</span> 5*<a class="code" href="mtime_8h.html#a0">division</a>:        <span class="comment">// HACK</span>
00091                   type = <span class="stringliteral">"whole"</span>;
00092                   <span class="keywordflow">break</span>;
00093             <span class="keywordflow">case</span> 4*<a class="code" href="mtime_8h.html#a0">division</a>:        <span class="comment">// 1/1</span>
00094                   type = <span class="stringliteral">"whole"</span>;
00095                   <span class="keywordflow">break</span>;
00096             <span class="keywordflow">case</span> 3*<a class="code" href="mtime_8h.html#a0">division</a>:        <span class="comment">// 1/2</span>
00097                   dots = 1;
00098             <span class="keywordflow">case</span> 2*<a class="code" href="mtime_8h.html#a0">division</a>:        <span class="comment">// 1/2</span>
00099                   type = <span class="stringliteral">"half"</span>;
00100                   <span class="keywordflow">break</span>;
00101             <span class="keywordflow">case</span> <a class="code" href="mtime_8h.html#a0">division</a> + <a class="code" href="mtime_8h.html#a0">division</a>/2:
00102                   dots = 1;
00103             <span class="keywordflow">case</span> <a class="code" href="mtime_8h.html#a0">division</a>:          <span class="comment">// quarternote</span>
00104                   type = <span class="stringliteral">"quarter"</span>;
00105                   <span class="keywordflow">break</span>;
00106             <span class="keywordflow">case</span> <a class="code" href="mtime_8h.html#a0">division</a>/2 + <a class="code" href="mtime_8h.html#a0">division</a>/4:
00107                   dots = 1;
00108             <span class="keywordflow">case</span> <a class="code" href="mtime_8h.html#a0">division</a>/2:        <span class="comment">// 1/8</span>
00109                   type = <span class="stringliteral">"eighth"</span>;
00110                   <span class="keywordflow">break</span>;
00111             <span class="keywordflow">case</span> <a class="code" href="mtime_8h.html#a0">division</a>/4 + <a class="code" href="mtime_8h.html#a0">division</a>/8:
00112                   dots = 1;
00113             <span class="keywordflow">case</span> <a class="code" href="mtime_8h.html#a0">division</a>/4:        <span class="comment">// 1/16</span>
00114                   type = <span class="stringliteral">"16th"</span>;
00115                   <span class="keywordflow">break</span>;
00116             <span class="keywordflow">case</span> <a class="code" href="mtime_8h.html#a0">division</a>/8 + <a class="code" href="mtime_8h.html#a0">division</a>/16:
00117                   dots = 1;
00118             <span class="keywordflow">case</span> <a class="code" href="mtime_8h.html#a0">division</a>/8:        <span class="comment">// 1/32</span>
00119                   type = <span class="stringliteral">"32nd"</span>;
00120                   <span class="keywordflow">break</span>;
00121             <span class="keywordflow">case</span> <a class="code" href="mtime_8h.html#a0">division</a>/16 + <a class="code" href="mtime_8h.html#a0">division</a>/32:
00122                   dots = 1;
00123             <span class="keywordflow">case</span> <a class="code" href="mtime_8h.html#a0">division</a>/16:       <span class="comment">// 1/64</span>
00124                   type = <span class="stringliteral">"64th"</span>;
00125                   <span class="keywordflow">break</span>;
00126             <span class="keywordflow">case</span> <a class="code" href="mtime_8h.html#a0">division</a>/32 + <a class="code" href="mtime_8h.html#a0">division</a>/64:
00127                   dots = 1;
00128             <span class="keywordflow">case</span> <a class="code" href="mtime_8h.html#a0">division</a>/32:       <span class="comment">// 1/128</span>
00129                   type = <span class="stringliteral">"128th"</span>;
00130                   <span class="keywordflow">break</span>;
00131             <span class="keywordflow">case</span> <a class="code" href="mtime_8h.html#a0">division</a>/64 + <a class="code" href="mtime_8h.html#a0">division</a>/128:
00132                   dots = 1;
00133             <span class="keywordflow">case</span> <a class="code" href="mtime_8h.html#a0">division</a>/64:       <span class="comment">// 1/128</span>
00134                   type = <span class="stringliteral">"256th"</span>;
00135                   <span class="keywordflow">break</span>;
00136             <span class="keywordflow">default</span>:
00137                   fprintf(stderr, <span class="stringliteral">"tick2xml: invalid note len %d (%d, %d)\n"</span>,
00138                      ticks, ticks/<a class="code" href="mtime_8h.html#a0">division</a>, ticks%<a class="code" href="mtime_8h.html#a0">division</a>);
00139                   <span class="keywordflow">break</span>;
00140             }
00141       <span class="keywordflow">return</span> type;
00142       }
00143 
00144 <span class="comment">//---------------------------------------------------------</span>
00145 <span class="comment">//   exportMusicXml::export</span>
00146 <span class="comment">//---------------------------------------------------------</span>
00147 
<a name="l00148"></a><a class="code" href="classMuseScore.html#k23">00148</a> <span class="keywordtype">void</span> <a class="code" href="classMuseScore.html#k23">MuseScore::exportMusicXml</a>()
00149       {
00150       <a class="code" href="classExportMusicXml.html">ExportMusicXml</a> em(<a class="code" href="classMuseScore.html#r0">cs</a>);
00151       em.<a class="code" href="classSaveFile.html#a3">save</a>(<span class="keyword">this</span>, QString(<span class="stringliteral">"."</span>), QString(<span class="stringliteral">".xml"</span>), tr(<span class="stringliteral">"MuseScore: Export as MusicXml"</span>));
00152       }
00153 
00154 <span class="comment">//---------------------------------------------------------</span>
00155 <span class="comment">//   bar</span>
00156 <span class="comment">//---------------------------------------------------------</span>
00157 
<a name="l00158"></a><a class="code" href="classExportMusicXml.html#d5">00158</a> <span class="keywordtype">void</span> <a class="code" href="classExportMusicXml.html#d5">ExportMusicXml::bar</a>(<span class="keyword">const</span> <a class="code" href="classBar.html">Bar</a>* bar)
00159       {
00160       <span class="keywordflow">if</span> (bar-&gt;<a class="code" href="classBar.html#a3">barType</a>() == Bar::NORMAL_BAR)
00161             <span class="keywordflow">return</span>;
00162       <span class="keywordflow">switch</span>(bar-&gt;<a class="code" href="classBar.html#a3">barType</a>()) {
00163             <span class="keywordflow">case</span> Bar::NORMAL_BAR:
00164                   <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"barline location=\"right\""</span>);
00165                   <span class="keywordflow">break</span>;
00166             <span class="keywordflow">case</span> Bar::DOUBLE_BAR:
00167                   <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"barline location=\"right\""</span>);
00168                   <span class="keywordflow">break</span>;
00169             <span class="keywordflow">case</span> Bar::START_REPEAT:
00170                   <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"barline location=\"left\""</span>);
00171                   <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a16">strTag</a>(<span class="stringliteral">"bar-style"</span>, <span class="stringliteral">"light-heavy"</span>);
00172                   <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a10">tagE</a>(<span class="stringliteral">"repeat direction=\"forward\""</span>);
00173                   <span class="keywordflow">break</span>;
00174             <span class="keywordflow">case</span> Bar::END_REPEAT:
00175                   <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"barline location=\"right\""</span>);
00176                   <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a16">strTag</a>(<span class="stringliteral">"bar-style"</span>, <span class="stringliteral">"light-heavy"</span>);
00177                   <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a10">tagE</a>(<span class="stringliteral">"repeat direction=\"backward\""</span>);
00178                   <span class="keywordflow">break</span>;
00179             <span class="keywordflow">case</span> Bar::BROKEN_BAR:
00180                   <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"barline location=\"right\""</span>);
00181                   <span class="keywordflow">break</span>;
00182             <span class="keywordflow">case</span> Bar::END_BAR:
00183                   <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"barline location=\"right\""</span>);
00184                   <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a16">strTag</a>(<span class="stringliteral">"bar-style"</span>, <span class="stringliteral">"light-heavy"</span>);
00185                   <span class="keywordflow">break</span>;
00186             <span class="keywordflow">case</span> Bar::INVISIBLE_BAR:
00187                   <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"barline location=\"right\""</span>);
00188                   <span class="keywordflow">break</span>;
00189             }
00190       <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a9">etag</a>(<span class="stringliteral">"barline"</span>);
00191       }
00192 
00193 <span class="comment">//---------------------------------------------------------</span>
00194 <span class="comment">//  saver</span>
00195 <span class="comment">//    export midi file</span>
00196 <span class="comment">//    return true on error</span>
00197 <span class="comment">//---------------------------------------------------------</span>
00198 
<a name="l00199"></a><a class="code" href="classExportMusicXml.html#a1">00199</a> <span class="keywordtype">bool</span> <a class="code" href="classExportMusicXml.html#a1">ExportMusicXml::saver</a>()
00200       {
00201       <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a3">setFile</a>(f);
00202       fprintf(f, <span class="stringliteral">"&lt;?xml version=\"1.0\" encoding=\"ISO-8859-1\"?&gt;\n"</span>);
00203       fprintf(f, <span class="stringliteral">"&lt;!DOCTYPE score-partwise PUBLIC \"-//Recordare//DTD MusicXML 1.0 Partwise//EN\" \"http://www.musicxml.org/dtds/partwise.dtd\"&gt;\n"</span>);
00204       <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"score-partwise"</span>);
00205       <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"work"</span>);
00206 
00207       <a class="code" href="classMeasure.html">Measure</a>* measure = <a class="code" href="classExportMusicXml.html#r0">score</a>-&gt;<a class="code" href="classScore.html#a100">first</a>();
00208       <a class="code" href="classElementList.html">ElementList</a>* el = measure-&gt;<a class="code" href="classMeasure.html#a13">pel</a>();
00209       <span class="keywordflow">for</span> (<a class="code" href="element_8h.html#a1">iElement</a> ie = el-&gt;<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); ie != el-&gt;<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++ie) {
00210             <span class="keywordflow">if</span> ((*ie)-&gt;type() == <a class="code" href="element_8h.html#a65a8">TEXT</a>) {
00211                   <a class="code" href="classSText.html">SText</a>* text = (<a class="code" href="classSText.html">SText</a>*)(*ie);
00212                   <span class="keywordflow">switch</span> (text-&gt;<a class="code" href="classSText.html#a13">style</a>()) {
00213                         <span class="keywordflow">case</span> <a class="code" href="style_8h.html#a45a21">TEXT_STYLE_TITLE</a>:
00214                               <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a16">strTag</a>(<span class="stringliteral">"work-title"</span>, text-&gt;<a class="code" href="classSText.html#a11">text</a>());
00215                               <span class="keywordflow">break</span>;
00216                         <span class="keywordflow">case</span> <a class="code" href="style_8h.html#a45a22">TEXT_STYLE_SUBTITLE</a>:
00217                               <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a16">strTag</a>(<span class="stringliteral">"work-number"</span>, text-&gt;<a class="code" href="classSText.html#a11">text</a>());
00218                               <span class="keywordflow">break</span>;
00219                         }
00220                   }
00221             }
00222       <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a9">etag</a>(<span class="stringliteral">"work"</span>);
00223 
00224       <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"identification"</span>);
00225       <span class="keywordflow">for</span> (<a class="code" href="element_8h.html#a1">iElement</a> ie = el-&gt;<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); ie != el-&gt;<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++ie) {
00226             <span class="keywordflow">if</span> ((*ie)-&gt;type() == <a class="code" href="element_8h.html#a65a8">TEXT</a>) {
00227                   <a class="code" href="classSText.html">SText</a>* text = (<a class="code" href="classSText.html">SText</a>*)(*ie);
00228                   <span class="keywordflow">switch</span> (text-&gt;<a class="code" href="classSText.html#a13">style</a>()) {
00229                         <span class="keywordflow">case</span> <a class="code" href="style_8h.html#a45a23">TEXT_STYLE_COMPOSER</a>:
00230                               <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a6">put</a>(<span class="stringliteral">"&lt;creator type=\"composer\"&gt;%s&lt;/creator&gt;"</span>,
00231                                  text-&gt;<a class="code" href="classSText.html#a11">text</a>().latin1());
00232                               <span class="keywordflow">break</span>;
00233                         <span class="keywordflow">case</span> <a class="code" href="style_8h.html#a45a24">TEXT_STYLE_POET</a>:
00234                               <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a6">put</a>(<span class="stringliteral">"&lt;creator type=\"poet\"&gt;%s&lt;/creator&gt;"</span>,
00235                                  text-&gt;<a class="code" href="classSText.html#a11">text</a>().latin1());
00236                               <span class="keywordflow">break</span>;
00237                         <span class="keywordflow">case</span> <a class="code" href="style_8h.html#a45a37">TEXT_STYLE_TRANSLATOR</a>:
00238                               <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a6">put</a>(<span class="stringliteral">"&lt;creator type=\"creator\"&gt;%s&lt;/creator&gt;"</span>,
00239                                  text-&gt;<a class="code" href="classSText.html#a11">text</a>().latin1());
00240                               <span class="keywordflow">break</span>;
00241                         }
00242                   }
00243             }
00244 
00245       <span class="keywordflow">if</span> (!<a class="code" href="classExportMusicXml.html#r0">score</a>-&gt;<a class="code" href="classScore.html#o7">rights</a>.isEmpty())
00246             <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a16">strTag</a>(<span class="stringliteral">"rights"</span>, <a class="code" href="classExportMusicXml.html#r0">score</a>-&gt;<a class="code" href="classScore.html#o7">rights</a>);
00247       <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"encoding"</span>);
00248       <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a16">strTag</a>(<span class="stringliteral">"software"</span>, QString(<span class="stringliteral">"MuseScore "</span>) + QString(<a class="code" href="config_8h.html#a20">VERSION</a>));
00249       <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a16">strTag</a>(<span class="stringliteral">"encoding-date"</span>, QDate::currentDate().toString(Qt::ISODate));
00250       <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a9">etag</a>(<span class="stringliteral">"encoding"</span>);
00251       <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a9">etag</a>(<span class="stringliteral">"identification"</span>);
00252 
00253       <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"part-list"</span>);
00254       <span class="keywordtype">int</span> idx = 1;
00255       <a class="code" href="classPartList.html">PartList</a>* il = <a class="code" href="classExportMusicXml.html#r0">score</a>-&gt;<a class="code" href="classScore.html#a109">parts</a>();
00256       <span class="keywordflow">for</span> (<a class="code" href="part_8h.html#a0">iPart</a> i = il-&gt;<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); i != il-&gt;<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++i, ++idx) {
00257             <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"score-part id=\"P%d\""</span>, idx);
00258             <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a16">strTag</a>(<span class="stringliteral">"part-name"</span>, (*i)-&gt;longName());
00259 
00260             <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"score-instrument"</span>, <span class="stringliteral">"id=\"P%d-I%d\""</span>, idx, 3);
00261             <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a16">strTag</a>(<span class="stringliteral">"instrument-name"</span>, (*i)-&gt;longName());
00262             <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a9">etag</a>(<span class="stringliteral">"score-instrument"</span>);
00263 
00264             <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"midi-instrument"</span>, <span class="stringliteral">"id=\"P%d-I%d\""</span>, idx, 3);
00265             <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"midi-channel"</span>, (*i)-&gt;midiChannel()+1);
00266             <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"midi-program"</span>, (*i)-&gt;midiProgram()+1);
00267             <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a9">etag</a>(<span class="stringliteral">"midi-instrument"</span>);
00268 
00269             <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a9">etag</a>(<span class="stringliteral">"score-part"</span>);
00270             }
00271       <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a9">etag</a>(<span class="stringliteral">"part-list"</span>);
00272 
00273       idx = 1;
00274       il = <a class="code" href="classExportMusicXml.html#r0">score</a>-&gt;<a class="code" href="classScore.html#a109">parts</a>();
00275       <span class="keywordflow">for</span> (<a class="code" href="part_8h.html#a0">iPart</a> i = il-&gt;<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); i != il-&gt;<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++i, ++idx) {
00276             <span class="keywordtype">int</span> tick = 0;
00277             <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"part id=\"P%d\""</span>, idx);
00278 
00279             <span class="keywordtype">int</span> staves = (*i)-&gt;nstaves();
00280             <span class="keywordtype">int</span> strack = <a class="code" href="classExportMusicXml.html#r0">score</a>-&gt;<a class="code" href="classScore.html#a7">staff</a>(*i) * <a class="code" href="globals_8h.html#a3">VOICES</a>;
00281             <span class="keywordtype">int</span> etrack = strack + staves * <a class="code" href="globals_8h.html#a3">VOICES</a>;
00282 
00283             <span class="keywordtype">int</span> measureNo = 1;
00284             <span class="keywordflow">for</span> (<a class="code" href="classMeasure.html">Measure</a>* m = <a class="code" href="classExportMusicXml.html#r0">score</a>-&gt;<a class="code" href="classScore.html#a100">first</a>(); m; m = m-&gt;<a class="code" href="classMeasure.html#a64">next</a>(), ++measureNo) {
00285                   <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"measure number=\"%d\""</span>, measureNo);
00286 
00287                   <span class="keywordtype">bool</span> validAttribute = <span class="keyword">false</span>;
00288                   <span class="keywordflow">if</span> (measureNo == 1) {
00289                         <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"attributes"</span>);
00290                         validAttribute = <span class="keyword">true</span>;
00291                         <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"divisions"</span>, <a class="code" href="mtime_8h.html#a0">division</a>);
00292                         <span class="keywordflow">if</span> (staves)
00293                               <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"staves"</span>, staves);
00294                         }
00295                   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> st = strack; st &lt; etrack; ++st) {
00296                         <span class="comment">// sstaff - xml staff number, counting from 1 for this</span>
00297                         <span class="comment">// instrument</span>
00298                         <span class="comment">// special number 0 -&gt; dont show staff number in</span>
00299                         <span class="comment">// xml output (because there is only one staff)</span>
00300 
00301                         <span class="keywordtype">int</span> sstaff = (staves &gt; 1) ? st - strack + <a class="code" href="globals_8h.html#a3">VOICES</a> : 0;
00302                         sstaff /= <a class="code" href="globals_8h.html#a3">VOICES</a>;
00303 
00304 <span class="comment">//                        if (!validAttribute) {</span>
00305 <span class="comment">//                              xml.tag("attributes");</span>
00306 <span class="comment">//                              validAttribute = true;</span>
00307 <span class="comment">//                              }</span>
00308 <span class="comment">//                        int curClef = -1;</span>
00309 
00310                         <span class="keywordflow">for</span> (<a class="code" href="classSegment.html">Segment</a>* seg = m-&gt;<a class="code" href="classMeasure.html#a28">first</a>(); seg; seg = seg-&gt;<a class="code" href="classSegment.html#a4">next</a>()) {
00311                               <a class="code" href="classElement.html">Element</a>* el = seg-&gt;<a class="code" href="classSegment.html#a8">element</a>(st);
00312                               <span class="keywordflow">if</span> (!el)
00313                                     <span class="keywordflow">continue</span>;
00314                               <span class="keywordflow">if</span> (tick != el-&gt;<a class="code" href="classElement.html#a74">tick</a>()) {
00315                                     <span class="keywordflow">if</span> (validAttribute) {
00316                                           <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a9">etag</a>(<span class="stringliteral">"attributes"</span>);
00317                                           validAttribute = <span class="keyword">false</span>;
00318                                           }
00319                                     <span class="keywordflow">if</span> (tick &gt; el-&gt;<a class="code" href="classElement.html#a74">tick</a>()) {
00320                                           <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"backup"</span>);
00321                                           <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"duration"</span>, tick - el-&gt;<a class="code" href="classElement.html#a74">tick</a>());
00322                                           <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a9">etag</a>(<span class="stringliteral">"backup"</span>);
00323                                           }
00324                                     <span class="keywordflow">else</span> {
00325                                           <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"forward"</span>);
00326                                           <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"duration"</span>, el-&gt;<a class="code" href="classElement.html#a74">tick</a>() - tick);
00327                                           <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a9">etag</a>(<span class="stringliteral">"forward"</span>);
00328                                           }
00329                                     }
00330                               tick = el-&gt;<a class="code" href="classElement.html#a74">tick</a>() + el-&gt;<a class="code" href="classElement.html#a76">tickLen</a>();
00331                               <span class="keywordflow">switch</span> (el-&gt;<a class="code" href="classElement.html#a40">type</a>()) {
00332                                     <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a22">CLEF</a>:
00333                                           {
00334                                           <span class="comment">// output only clef changes, not generated clefs</span>
00335                                           <span class="comment">// at line beginning</span>
00336                                           <span class="keywordtype">int</span> ti = el-&gt;<a class="code" href="classElement.html#a74">tick</a>();
00337                                           <span class="keywordtype">int</span> ct = ((<a class="code" href="classClef.html">Clef</a>*)el)-&gt;idx();
00338                                           <a class="code" href="classClefList.html">ClefList</a>* cl = <a class="code" href="classExportMusicXml.html#r0">score</a>-&gt;<a class="code" href="classScore.html#a7">staff</a>(st/<a class="code" href="globals_8h.html#a3">VOICES</a>)-&gt;clef();
00339                                           <a class="code" href="clef_8h.html#a2">ciClefEvent</a> ci = cl-&gt;find(ti);
00340                                           <span class="keywordflow">if</span> (ci != cl-&gt;end()) {
00341                                                 <span class="keywordflow">if</span> (!validAttribute) {
00342                                                       <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"attributes"</span>);
00343                                                       validAttribute = <span class="keyword">true</span>;
00344                                                       }
00345                                                 <a class="code" href="classExportMusicXml.html#d2">clef</a>(sstaff, ct);
00346                                                 }
00347                                           }
00348                                           <span class="keywordflow">break</span>;
00349                                     <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a23">KEYSIG</a>:
00350                                           {
00351                                           <span class="keywordflow">if</span> (!validAttribute) {
00352                                                 <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"attributes"</span>);
00353                                                 validAttribute = <span class="keyword">true</span>;
00354                                                 }
00355                                           <span class="keywordtype">int</span> key = <a class="code" href="classExportMusicXml.html#r0">score</a>-&gt;<a class="code" href="classScore.html#o10">keymap</a>-&gt;<a class="code" href="classKeyList.html#a1">key</a>(el-&gt;<a class="code" href="classElement.html#a74">tick</a>());
00356                                           <a class="code" href="classExportMusicXml.html#d4">keysig</a>(key);
00357                                           }
00358                                           <span class="keywordflow">break</span>;
00359                                     <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a24">TIMESIG</a>:
00360                                           {
00361                                           <span class="comment">// output only for staff 0</span>
00362                                           <span class="keywordflow">if</span> (st == 0) {
00363                                                 <span class="keywordflow">if</span> (!validAttribute) {
00364                                                       <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"attributes"</span>);
00365                                                       validAttribute = <span class="keyword">true</span>;
00366                                                       }
00367                                                 <span class="keywordtype">int</span> z, n;
00368                                                 <a class="code" href="classExportMusicXml.html#r0">score</a>-&gt;<a class="code" href="classScore.html#o9">sigmap</a>-&gt;<a class="code" href="classSigList.html#a6">timesig</a>(el-&gt;<a class="code" href="classElement.html#a74">tick</a>(), z, n);
00369                                                 <a class="code" href="classExportMusicXml.html#d3">timesig</a>(z, n);
00370                                                 }
00371                                           }
00372                                           <span class="keywordflow">break</span>;
00373                                     <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a25">CHORD</a>:
00374                                           <span class="keywordflow">if</span> (validAttribute) {
00375                                                 <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a9">etag</a>(<span class="stringliteral">"attributes"</span>);
00376                                                 validAttribute = <span class="keyword">false</span>;
00377                                                 }
00378                                           <a class="code" href="classExportMusicXml.html#d0">chord</a>((<a class="code" href="classChord.html">Chord</a>*)el, sstaff);
00379                                           <span class="keywordflow">break</span>;
00380                                     <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a26">REST</a>:
00381                                           <span class="keywordflow">if</span> (validAttribute) {
00382                                                 <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a9">etag</a>(<span class="stringliteral">"attributes"</span>);
00383                                                 validAttribute = <span class="keyword">false</span>;
00384                                                 }
00385                                           <a class="code" href="classExportMusicXml.html#d1">rest</a>((<a class="code" href="classRest.html">Rest</a>*)el, sstaff);
00386                                           <span class="keywordflow">break</span>;
00387                                     <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a13">BAR</a>:
00388                                           <a class="code" href="classExportMusicXml.html#d5">bar</a>((<a class="code" href="classBar.html">Bar</a>*) el);
00389                                           <span class="keywordflow">break</span>;
00390 
00391                                     <span class="keywordflow">default</span>:
00392                                           printf(<span class="stringliteral">"unknown type %s\n"</span>, el-&gt;<a class="code" href="classElement.html#a69">name</a>());
00393                                           <span class="keywordflow">break</span>;
00394                                     }
00395                               }
00396                         <span class="keywordflow">if</span> (validAttribute) {
00397                               <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a9">etag</a>(<span class="stringliteral">"attributes"</span>);
00398                               validAttribute = <span class="keyword">false</span>;
00399                               }
00400                         }
00401                   <a class="code" href="classExportMusicXml.html#d5">bar</a>(m-&gt;<a class="code" href="classMeasure.html#a44">bar</a>(<a class="code" href="classExportMusicXml.html#r0">score</a>-&gt;<a class="code" href="classScore.html#a7">staff</a>(*i)));
00402                   <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a9">etag</a>(<span class="stringliteral">"measure"</span>);
00403                   }
00404             <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a9">etag</a>(<span class="stringliteral">"part"</span>);
00405             }
00406 
00407       <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a9">etag</a>(<span class="stringliteral">"score-partwise"</span>);
00408 
00409       <span class="keywordflow">if</span> (ferror(f))
00410             <span class="keywordflow">return</span> <span class="keyword">true</span>;
00411       <span class="keywordflow">return</span> <span class="keyword">false</span>;
00412       }
00413 
00414 <span class="comment">//---------------------------------------------------------</span>
00415 <span class="comment">//   timesig</span>
00416 <span class="comment">//---------------------------------------------------------</span>
00417 
<a name="l00418"></a><a class="code" href="classExportMusicXml.html#d3">00418</a> <span class="keywordtype">void</span> <a class="code" href="classExportMusicXml.html#d3">ExportMusicXml::timesig</a>(<span class="keywordtype">int</span> z, <span class="keywordtype">int</span> n)
00419       {
00420       <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"time"</span>);
00421       <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"beats"</span>, z);
00422       <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"beat-type"</span>, n);
00423       <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a9">etag</a>(<span class="stringliteral">"time"</span>);
00424       }
00425 
00426 <span class="comment">//---------------------------------------------------------</span>
00427 <span class="comment">//   keysig</span>
00428 <span class="comment">//---------------------------------------------------------</span>
00429 
<a name="l00430"></a><a class="code" href="classExportMusicXml.html#d4">00430</a> <span class="keywordtype">void</span> <a class="code" href="classExportMusicXml.html#d4">ExportMusicXml::keysig</a>(<span class="keywordtype">int</span> key)
00431       {
00432       <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"key"</span>);
00433       <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"fifths"</span>, key);
00434       <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a16">strTag</a>(<span class="stringliteral">"mode"</span>, <span class="stringliteral">"major"</span>);
00435       <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a9">etag</a>(<span class="stringliteral">"key"</span>);
00436       }
00437 
00438 <span class="comment">//---------------------------------------------------------</span>
00439 <span class="comment">//   clef</span>
00440 <span class="comment">//---------------------------------------------------------</span>
00441 
<a name="l00442"></a><a class="code" href="classExportMusicXml.html#d2">00442</a> <span class="keywordtype">void</span> <a class="code" href="classExportMusicXml.html#d2">ExportMusicXml::clef</a>(<span class="keywordtype">int</span> staff, <span class="keywordtype">int</span> clef)
00443       {
00444       <span class="keywordflow">if</span> (staff)
00445             <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"clef number=\"%d\""</span>, staff);
00446       <span class="keywordflow">else</span>
00447             <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"clef"</span>);
00448       <span class="keywordtype">char</span>* sign = <a class="code" href="clef_8h.html#a0">clefTable</a>[clef].<a class="code" href="structClefInfo.html#o0">sign</a>;
00449       <span class="keywordtype">int</span> line   = <a class="code" href="clef_8h.html#a0">clefTable</a>[clef].<a class="code" href="structClefInfo.html#o1">line</a>;
00450       <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a16">strTag</a>(<span class="stringliteral">"sign"</span>, sign);
00451       <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"line"</span>, line);
00452       <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a9">etag</a>(<span class="stringliteral">"clef"</span>);
00453       }
00454 
00455 <span class="comment">//---------------------------------------------------------</span>
00456 <span class="comment">//   chord</span>
00457 <span class="comment">//---------------------------------------------------------</span>
00458 
<a name="l00459"></a><a class="code" href="classExportMusicXml.html#d0">00459</a> <span class="keywordtype">void</span> <a class="code" href="classExportMusicXml.html#d0">ExportMusicXml::chord</a>(<a class="code" href="classChord.html">Chord</a>* chord, <span class="keywordtype">int</span> staff)
00460       {
00461       <a class="code" href="classNoteList.html">NoteList</a>* nl = chord-&gt;<a class="code" href="classChord.html#a15">noteList</a>();
00462 
00463       <span class="keywordflow">for</span> (<a class="code" href="note_8h.html#a1">iNote</a> i = nl-&gt;begin(); i != nl-&gt;end(); ++i) {
00464             QString val;
00465             <a class="code" href="classNote.html">Note</a>* note = i-&gt;second;
00466 
00467             <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"note"</span>);
00468 
00469             <span class="keywordflow">if</span> (i != nl-&gt;begin())
00470                   <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a10">tagE</a>(<span class="stringliteral">"chord"</span>);
00471             <span class="keywordflow">else</span>
00472                   <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a16">strTag</a>(<span class="stringliteral">"stem"</span>, note-&gt;<a class="code" href="classNote.html#a37">chord</a>()-&gt;<a class="code" href="classChordRest.html#a19">isUp</a>() ? <span class="stringliteral">"up"</span> : <span class="stringliteral">"down"</span>);
00473             <span class="keywordtype">char</span> c;
00474             <span class="keywordtype">int</span> alter;
00475             <span class="keywordtype">int</span> octave;
00476             <a class="code" href="classExportMusicXml.html#d6">pitch2xml</a>(note, c, alter, octave, chord-&gt;<a class="code" href="classElement.html#a60">staffIdx</a>());
00477 
00478             <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"pitch"</span>);
00479             <span class="keywordtype">char</span> buffer[2];
00480             buffer[0] = c;
00481             buffer[1] = 0;
00482             <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a16">strTag</a>(<span class="stringliteral">"step"</span>, QString(buffer));
00483             <span class="keywordflow">if</span> (alter)
00484                   <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"alter"</span>, alter);
00485             <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"octave"</span>, octave);
00486             <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a9">etag</a>(<span class="stringliteral">"pitch"</span>);
00487 
00488             <span class="keywordtype">int</span> acc = <a class="code" href="element_8h.html#a66a47">ACC_NONE</a>;
00489             <span class="keywordflow">if</span> (note-&gt;<a class="code" href="classNote.html#a20">userAccidental</a>() != -1)
00490                   acc = note-&gt;<a class="code" href="classNote.html#a20">userAccidental</a>();
00491             <span class="keywordflow">else</span>
00492                   acc = note-&gt;<a class="code" href="classNote.html#a22">accidentalIdx</a>();
00493             <span class="keywordflow">if</span> (acc != <a class="code" href="element_8h.html#a66a47">ACC_NONE</a>) {
00494                   QString s;
00495                   <span class="keywordflow">switch</span>(acc) {
00496                         <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a66a48">ACC_SHARP</a>:   s = <span class="stringliteral">"sharp"</span>;        <span class="keywordflow">break</span>;
00497                         <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a66a49">ACC_FLAT</a>:    s = <span class="stringliteral">"flat"</span>;         <span class="keywordflow">break</span>;
00498                         <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a66a50">ACC_SHARP2</a>:  s = <span class="stringliteral">"double-sharp"</span>; <span class="keywordflow">break</span>;
00499                         <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a66a51">ACC_FLAT2</a>:   s = <span class="stringliteral">"double-flat"</span>;  <span class="keywordflow">break</span>;
00500                         <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a66a52">ACC_NATURAL</a>: s = <span class="stringliteral">"natural"</span>;      <span class="keywordflow">break</span>;
00501                         <span class="keywordflow">default</span>:
00502                               printf(<span class="stringliteral">"unknown accidental %d\n"</span>, acc);
00503                         }
00504                   <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a16">strTag</a>(<span class="stringliteral">"accidental"</span>, s);
00505                   }
00506 
00507             <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"duration"</span>, note-&gt;<a class="code" href="classNote.html#a37">chord</a>()-&gt;<a class="code" href="classElement.html#a76">tickLen</a>());
00508             <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"voice"</span>, staff * <a class="code" href="globals_8h.html#a3">VOICES</a> + note-&gt;<a class="code" href="classNote.html#a37">chord</a>()-&gt;<a class="code" href="classElement.html#a62">voice</a>() + 1);
00509 
00510             <span class="keywordtype">int</span> dots = 0;
00511             QString s = <a class="code" href="exportxml_8cpp.html#a0">tick2xml</a>(note-&gt;<a class="code" href="classNote.html#a37">chord</a>()-&gt;<a class="code" href="classElement.html#a76">tickLen</a>(), dots);
00512             <span class="keywordflow">if</span> (s.isEmpty()) {
00513                   printf(<span class="stringliteral">"no note type found for ticks %d\n"</span>,
00514                      note-&gt;<a class="code" href="classNote.html#a37">chord</a>()-&gt;<a class="code" href="classElement.html#a76">tickLen</a>());
00515                   }
00516             <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a16">strTag</a>(<span class="stringliteral">"type"</span>, s);
00517             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ni = dots; ni &gt; 0; ni--)
00518                   <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a10">tagE</a>(<span class="stringliteral">"dot"</span>);
00519 
00520             <span class="keywordflow">if</span> (note-&gt;<a class="code" href="classNote.html#a34">tieBack</a>())
00521                   <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a10">tagE</a>(<span class="stringliteral">"tie type=\"stop\""</span>);
00522             <span class="keywordflow">if</span> (note-&gt;<a class="code" href="classNote.html#a33">tieFor</a>())
00523                   <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a10">tagE</a>(<span class="stringliteral">"tie type=\"start\""</span>);
00524 
00525             <span class="comment">//  beaming</span>
00526             <span class="comment">//    &lt;beam number="1"&gt;start&lt;/beam&gt;</span>
00527             <span class="comment">//    &lt;beam number="1"&gt;end&lt;/beam&gt;</span>
00528             <span class="comment">//    &lt;beam number="1"&gt;continue&lt;/beam&gt;</span>
00529             <span class="comment">//    &lt;beam number="1"&gt;backward hook&lt;/beam&gt;</span>
00530             <span class="comment">//    &lt;beam number="1"&gt;forward hook&lt;/beam&gt;</span>
00531 
00532             <span class="keywordflow">if</span> (i == nl-&gt;begin() &amp;&amp; chord-&gt;<a class="code" href="classChordRest.html#a8">beam</a>()) {
00533                   QString s = chord-&gt;<a class="code" href="classChordRest.html#a8">beam</a>()-&gt;<a class="code" href="classBeam.html#a7">xmlType</a>(chord);
00534                   <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a6">put</a>(<span class="stringliteral">"&lt;beam number=\"1\"&gt;%s&lt;/beam&gt;"</span>, s.latin1());
00535                   }
00536 
00537 <span class="comment">/*            tag3 = doc.createElement("lyric");</span>
00538 <span class="comment">            tag2.appendChild(tag3);</span>
00539 <span class="comment">            tag4 = doc.createElement("syllabic");</span>
00540 <span class="comment">            tag3.appendChild(tag4);</span>
00541 <span class="comment">            tag4 = doc.createElement("text");</span>
00542 <span class="comment">            tag3.appendChild(tag4);</span>
00543 <span class="comment"> */</span>
00544             <span class="keywordflow">if</span> (staff + note-&gt;<a class="code" href="classNote.html#a18">move</a>())
00545                   <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"staff"</span>, staff + note-&gt;<a class="code" href="classNote.html#a18">move</a>());
00546             <span class="keywordflow">if</span> (note-&gt;<a class="code" href="classNote.html#a28">fingering</a>())
00547                   <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a16">strTag</a>(<span class="stringliteral">"fingering"</span>, note-&gt;<a class="code" href="classNote.html#a28">fingering</a>()-&gt;<a class="code" href="classSText.html#a11">text</a>());
00548 
00549             <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a9">etag</a>(<span class="stringliteral">"note"</span>);
00550             }
00551       }
00552 
00553 <span class="comment">//---------------------------------------------------------</span>
00554 <span class="comment">//   rest</span>
00555 <span class="comment">//---------------------------------------------------------</span>
00556 
<a name="l00557"></a><a class="code" href="classExportMusicXml.html#d1">00557</a> <span class="keywordtype">void</span> <a class="code" href="classExportMusicXml.html#d1">ExportMusicXml::rest</a>(<a class="code" href="classRest.html">Rest</a>* rest, <span class="keywordtype">int</span> staff)
00558       {
00559       <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"note"</span>);
00560       <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a10">tagE</a>(<span class="stringliteral">"rest"</span>);
00561 
00562       <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"duration"</span>, rest-&gt;<a class="code" href="classElement.html#a76">tickLen</a>());
00563       <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"voice"</span>, rest-&gt;<a class="code" href="classElement.html#a62">voice</a>() + 1);
00564       <span class="keywordtype">int</span> dots = 0;
00565       QString s = <a class="code" href="exportxml_8cpp.html#a0">tick2xml</a>(rest-&gt;<a class="code" href="classElement.html#a76">tickLen</a>(), dots);
00566       <span class="keywordflow">if</span> (s.isEmpty()) {
00567             printf(<span class="stringliteral">"no rest type found for ticks %d\n"</span>,
00568                rest-&gt;<a class="code" href="classElement.html#a76">tickLen</a>());
00569             }
00570       <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a16">strTag</a>(<span class="stringliteral">"type"</span>, s);
00571 
00572       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = dots; i &gt; 0; i--)
00573             <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a10">tagE</a>(<span class="stringliteral">"dot"</span>);
00574       <span class="keywordflow">if</span> (staff)
00575             <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"staff"</span>, staff);
00576       <a class="code" href="classExportMusicXml.html#r1">xml</a>.<a class="code" href="classXml.html#a9">etag</a>(<span class="stringliteral">"note"</span>);
00577       }
00578 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Mon Jun 27 22:28:28 2005 for MuseScore by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
