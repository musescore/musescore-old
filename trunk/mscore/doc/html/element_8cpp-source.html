<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>MuseScore: element.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>element.cpp</h1><a href="element_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">//=========================================================</span>
00002 <span class="comment">//  MuseScore</span>
00003 <span class="comment">//  Linux Music Score Editor</span>
00004 <span class="comment">//  $Id: element.cpp,v 1.43 2005/06/27 19:50:17 wschweer Exp $</span>
00005 <span class="comment">//</span>
00006 <span class="comment">//  (C) Copyright 2002-2004 Werner Schweer (ws@seh.de)</span>
00007 <span class="comment">//=========================================================</span>
00008 
00009 <span class="preprocessor">#include "<a class="code" href="element_8h.html">element.h</a>"</span>
00010 <span class="preprocessor">#include "<a class="code" href="style_8h.html">style.h</a>"</span>
00011 <span class="preprocessor">#include "<a class="code" href="xml_8h.html">xml.h</a>"</span>
00012 <span class="preprocessor">#include "<a class="code" href="project_8h.html">project.h</a>"</span>
00013 <span class="preprocessor">#include "<a class="code" href="preferences_8h.html">preferences.h</a>"</span>
00014 <span class="preprocessor">#include "<a class="code" href="text_8h.html">text.h</a>"</span>
00015 <span class="preprocessor">#include "<a class="code" href="staff_8h.html">staff.h</a>"</span>
00016 <span class="preprocessor">#include "<a class="code" href="utils_8h.html">utils.h</a>"</span>
00017 <span class="preprocessor">#include "<a class="code" href="painter_8h.html">painter.h</a>"</span>
00018 
<a name="l00019"></a><a class="code" href="element_8cpp.html#a0">00019</a> <span class="keyword">extern</span> <span class="keywordtype">bool</span> <a class="code" href="element_8cpp.html#a0">debugMode</a>;
<a name="l00020"></a><a class="code" href="element_8cpp.html#a1">00020</a> <span class="keyword">extern</span> <span class="keywordtype">bool</span> <a class="code" href="element_8cpp.html#a1">showInvisible</a>;
00021 
00022 <span class="comment">// for debugging:</span>
<a name="l00023"></a><a class="code" href="element_8cpp.html#a2">00023</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="element_8cpp.html#a2">elementNames</a>[] = {
00024       <span class="stringliteral">"Symbol"</span>, <span class="stringliteral">"Text"</span>, <span class="stringliteral">"Staff"</span>, <span class="stringliteral">"Gabel"</span>, <span class="stringliteral">"SlurSegment"</span>, <span class="stringliteral">"Note"</span>, <span class="stringliteral">"Bar"</span>,
00025       <span class="stringliteral">"Stem"</span>, <span class="stringliteral">"Compound"</span>, <span class="stringliteral">"Line"</span>, <span class="stringliteral">"Akkolade"</span>,
00026       <span class="stringliteral">"Accidental"</span>,
00027       <span class="stringliteral">"Cursor"</span>, <span class="stringliteral">"Selection"</span>, <span class="stringliteral">"Lasso"</span>, <span class="stringliteral">"Clef"</span>, <span class="stringliteral">"Keysig"</span>, <span class="stringliteral">"Timesig"</span>, <span class="stringliteral">"Chord"</span>, <span class="stringliteral">"Rest"</span>,
00028       <span class="stringliteral">"Tie"</span>, <span class="stringliteral">"Slur"</span>, <span class="stringliteral">"Measure"</span>,
00029       <span class="stringliteral">"Attribute"</span>, <span class="stringliteral">"Dynamic"</span>, <span class="stringliteral">"Page"</span>, <span class="stringliteral">"Beam"</span>, <span class="stringliteral">"Flag"</span>, <span class="stringliteral">"Lyrics"</span>,
00030       <span class="stringliteral">"InstrumentLong"</span>, <span class="stringliteral">"InstrumentShort"</span>, <span class="stringliteral">"Fingering"</span>, <span class="stringliteral">"System"</span>,
00031       <span class="stringliteral">"Haipin"</span>, <span class="stringliteral">"Tuplet"</span>, <span class="stringliteral">"RubberBand"</span>, <span class="stringliteral">"VSpacer"</span>,
00032       <span class="stringliteral">"Segment"</span>, <span class="stringliteral">"TempoText"</span>,
00033       <span class="stringliteral">"ShadowNote"</span>
00034       };
00035 
00036 <span class="comment">//---------------------------------------------------------</span>
00037 <span class="comment">//   operator &gt;</span>
00038 <span class="comment">//---------------------------------------------------------</span>
00039 
<a name="l00040"></a><a class="code" href="classElement.html#a71">00040</a> <span class="keywordtype">bool</span> <a class="code" href="classElement.html#a71">Element::operator&gt;</a>(<span class="keyword">const</span> <a class="code" href="classElement.html">Element</a>&amp; el)<span class="keyword"> const</span>
00041 <span class="keyword">      </span>{
00042       <span class="keywordflow">if</span> (<a class="code" href="classElement.html#a74">tick</a>() == el.<a class="code" href="classElement.html#a74">tick</a>())
00043             <span class="keywordflow">return</span> <a class="code" href="classElement.html#a40">type</a>() &gt; el.<a class="code" href="classElement.html#a40">type</a>();
00044       <span class="keywordflow">return</span> <a class="code" href="classElement.html#a74">tick</a>() &gt; el.<a class="code" href="classElement.html#a74">tick</a>();
00045       }
00046 
00047 <span class="comment">//---------------------------------------------------------</span>
00048 <span class="comment">//   init</span>
00049 <span class="comment">//---------------------------------------------------------</span>
00050 
<a name="l00051"></a><a class="code" href="classElement.html#d0">00051</a> <span class="keywordtype">void</span> <a class="code" href="classElement.html#d0">Element::init</a>()
00052       {
00053       <a class="code" href="classElement.html#r1">_prev</a>      = 0;
00054       <a class="code" href="classElement.html#r0">_next</a>      = 0;
00055       <a class="code" href="classElement.html#r2">_parent</a>    = 0;
00056       <a class="code" href="classElement.html#r3">_anchor</a>    = 0;
00057       <a class="code" href="classElement.html#r4">_selected</a>  = <span class="keyword">false</span>;
00058       <a class="code" href="classElement.html#r6">_visible</a>   = <span class="keyword">true</span>;
00059       <a class="code" href="classElement.html#r5">_generated</a> = <span class="keyword">false</span>;
00060       <a class="code" href="classElement.html#r8">_voice</a>     = 0;
00061       <a class="code" href="classElement.html#r9">_staff</a>     = 0;
00062       <a class="code" href="classElement.html#r11">_color</a>     = Qt::black;
00063       <a class="code" href="classElement.html#p1">_pos</a>       = QPointF(0.0, 0.0);
00064       <a class="code" href="classElement.html#p2">_userOff</a>   = QPointF(0.0, 0.0);
00065       }
00066 
00067 <span class="comment">//---------------------------------------------------------</span>
00068 <span class="comment">//   Element</span>
00069 <span class="comment">//---------------------------------------------------------</span>
00070 
<a name="l00071"></a><a class="code" href="classElement.html#a0">00071</a> <a class="code" href="classElement.html#a0">Element::Element</a>(<a class="code" href="classScore.html">Score</a>* s, ElementType t)
00072    : _bbox(0.0, 0.0, 0.0, 0.0)
00073       {
00074       <a class="code" href="classElement.html#p0">_score</a> = s;
00075       <a class="code" href="classElement.html#r7">_type</a>  = t;
00076       <a class="code" href="classElement.html#d0">init</a>();
00077       }
00078 
<a name="l00079"></a><a class="code" href="classElement.html#a2">00079</a> <a class="code" href="classElement.html#a0">Element::Element</a>(<span class="keyword">const</span> <a class="code" href="classElement.html">Element</a>&amp; s)
00080    : _time(s._time), _pos(s._pos), _userOff(s._userOff), _bbox(s._bbox), _duration(s._duration)
00081       {
00082       <a class="code" href="classElement.html#p0">_score</a>     = s.<a class="code" href="classElement.html#p0">_score</a>;
00083       <a class="code" href="classElement.html#r1">_prev</a>      = s.<a class="code" href="classElement.html#r1">_prev</a>;
00084       <a class="code" href="classElement.html#r0">_next</a>      = s.<a class="code" href="classElement.html#r0">_next</a>;
00085       <a class="code" href="classElement.html#r2">_parent</a>    = s.<a class="code" href="classElement.html#r2">_parent</a>;
00086       <a class="code" href="classElement.html#r3">_anchor</a>    = s.<a class="code" href="classElement.html#r3">_anchor</a>;
00087       <a class="code" href="classElement.html#r4">_selected</a>  = s.<a class="code" href="classElement.html#r4">_selected</a>;
00088       <a class="code" href="classElement.html#r6">_visible</a>   = s.<a class="code" href="classElement.html#r6">_visible</a>;
00089       <a class="code" href="classElement.html#r5">_generated</a> = s.<a class="code" href="classElement.html#r5">_generated</a>;
00090       <a class="code" href="classElement.html#r4">_selected</a>  = s.<a class="code" href="classElement.html#r4">_selected</a>;
00091       <a class="code" href="classElement.html#r7">_type</a>      = s.<a class="code" href="classElement.html#r7">_type</a>;
00092       <a class="code" href="classElement.html#r8">_voice</a>     = s.<a class="code" href="classElement.html#r8">_voice</a>;
00093       <a class="code" href="classElement.html#r9">_staff</a>     = s.<a class="code" href="classElement.html#r9">_staff</a>;
00094       <a class="code" href="classElement.html#r11">_color</a>     = s.<a class="code" href="classElement.html#r11">_color</a>;
00095       }
00096 
00097 <span class="comment">//---------------------------------------------------------</span>
00098 <span class="comment">//   staffIdx</span>
00099 <span class="comment">//---------------------------------------------------------</span>
00100 
<a name="l00101"></a><a class="code" href="classElement.html#a60">00101</a> <span class="keywordtype">int</span> <a class="code" href="classElement.html#a60">Element::staffIdx</a>()<span class="keyword"> const</span>
00102 <span class="keyword">      </span>{
00103       <span class="keywordflow">if</span> (<a class="code" href="classElement.html#r9">_staff</a>)
00104             <span class="keywordflow">return</span> <a class="code" href="classElement.html#r9">_staff</a>-&gt;<a class="code" href="classStaff.html#a15">idx</a>();
00105       <span class="keywordflow">return</span> -1;
00106       }
00107 
00108 <span class="comment">//---------------------------------------------------------</span>
00109 <span class="comment">//   drag</span>
00110 <span class="comment">//    return update Rect relative to canvas</span>
00111 <span class="comment">//---------------------------------------------------------</span>
00112 
<a name="l00113"></a><a class="code" href="classElement.html#a50">00113</a> QRectF <a class="code" href="classElement.html#a50">Element::drag</a>(<span class="keyword">const</span> QPointF&amp; s)
00114       {
00115       QRectF r(<a class="code" href="classElement.html#a34">abbox</a>());
00116       <a class="code" href="classElement.html#a29">setUserOff</a>(s / <a class="code" href="spatium_8h.html#a0">_spatium</a>);
00117       <span class="keywordflow">return</span> <a class="code" href="classElement.html#a34">abbox</a>() | r;
00118       }
00119 
00120 <span class="comment">//---------------------------------------------------------</span>
00121 <span class="comment">//   aref</span>
00122 <span class="comment">//---------------------------------------------------------</span>
00123 
<a name="l00124"></a><a class="code" href="classElement.html#a27">00124</a> QPointF <a class="code" href="classElement.html#a27">Element::aref</a>()<span class="keyword"> const</span>
00125 <span class="keyword">      </span>{
00126       QPointF p(<a class="code" href="classElement.html#a20">pos</a>());     <span class="comment">// war _pos</span>
00127       <span class="keywordflow">for</span> (<a class="code" href="classElement.html">Element</a>* e = <a class="code" href="classElement.html#r2">_parent</a>; e; e = e-&gt;<a class="code" href="classElement.html#a10">parent</a>())
00128             p += e-&gt;<a class="code" href="classElement.html#a20">pos</a>();
00129       <span class="keywordflow">return</span> p;
00130       }
00131 
00132 <span class="comment">//---------------------------------------------------------</span>
00133 <span class="comment">//   contains</span>
00134 <span class="comment">//    return true if p is inside of bounding box of object</span>
00135 <span class="comment">//    p is relative to the coordinate system of parent()</span>
00136 <span class="comment">//---------------------------------------------------------</span>
00137 
<a name="l00138"></a><a class="code" href="classElement.html#a30">00138</a> <span class="keywordtype">bool</span> <a class="code" href="classElement.html#a30">Element::contains</a>(<span class="keyword">const</span> QPointF&amp; p)<span class="keyword"> const</span>
00139 <span class="keyword">      </span>{
00140       <span class="keywordflow">return</span> <a class="code" href="classElement.html#p3">_bbox</a>.contains(p - <a class="code" href="classElement.html#a20">pos</a>());
00141       }
00142 
00143 <span class="comment">//---------------------------------------------------------</span>
00144 <span class="comment">//   intersects</span>
00145 <span class="comment">//    return true if r intersects bounding box of object</span>
00146 <span class="comment">//    r is relative to the coordinate system of parent()</span>
00147 <span class="comment">//---------------------------------------------------------</span>
00148 
<a name="l00149"></a><a class="code" href="classElement.html#a31">00149</a> <span class="keywordtype">bool</span> <a class="code" href="classElement.html#a31">Element::intersects</a>(<span class="keyword">const</span> QRectF&amp; rr)<span class="keyword"> const</span>
00150 <span class="keyword">      </span>{
00151       QRectF r(rr);
00152       r.translate(<a class="code" href="classElement.html#a20">pos</a>());
00153       <span class="keywordflow">return</span> <a class="code" href="classElement.html#p3">_bbox</a>.intersects(r);
00154       }
00155 
00156 <span class="comment">//---------------------------------------------------------</span>
00157 <span class="comment">//   writeProperties</span>
00158 <span class="comment">//---------------------------------------------------------</span>
00159 
<a name="l00160"></a><a class="code" href="classElement.html#a45">00160</a> <span class="keywordtype">void</span> <a class="code" href="classElement.html#a45">Element::writeProperties</a>(<a class="code" href="classXml.html">Xml</a>&amp; xml)<span class="keyword"> const</span>
00161 <span class="keyword">      </span>{
00162       <span class="keywordflow">if</span> (!<a class="code" href="classElement.html#p2">_userOff</a>.isNull())
00163             xml.<a class="code" href="classXml.html#a20">writePoint</a>(<a class="code" href="classElement.html#p2">_userOff</a>, <span class="stringliteral">"offset"</span>);
00164       <span class="keywordflow">if</span> (<a class="code" href="classElement.html#a62">voice</a>())
00165             xml.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"voice"</span>, <a class="code" href="classElement.html#a62">voice</a>());
00166       <span class="keywordflow">if</span> (<a class="code" href="classElement.html#a14">isSelected</a>())
00167             xml.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"selected"</span>, <a class="code" href="classElement.html#a14">isSelected</a>());
00168       <span class="keywordflow">if</span> (!<a class="code" href="classElement.html#a16">visible</a>())
00169             xml.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"visible"</span>, <a class="code" href="classElement.html#a16">visible</a>());
00170       <span class="keywordflow">if</span> (<a class="code" href="classElement.html#r10">_time</a>.<a class="code" href="classMTime.html#a3">tick</a>())
00171             xml.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"tick"</span>, <a class="code" href="classElement.html#r10">_time</a>.<a class="code" href="classMTime.html#a3">tick</a>());
00172       <span class="keywordflow">if</span> (<a class="code" href="classElement.html#p4">_duration</a>.<a class="code" href="classMTime.html#a3">tick</a>())
00173             xml.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"ticklen"</span>, <a class="code" href="classElement.html#p4">_duration</a>.<a class="code" href="classMTime.html#a3">tick</a>());
00174       <span class="keywordflow">if</span> (<a class="code" href="classElement.html#r11">_color</a> != Qt::black)
00175             xml.<a class="code" href="classXml.html#a10">tagE</a>(<span class="stringliteral">"color r=\"%d\" g=\"%d\" b=\"%d\""</span>,
00176                <a class="code" href="classElement.html#r11">_color</a>.red(), <a class="code" href="classElement.html#r11">_color</a>.green(), <a class="code" href="classElement.html#r11">_color</a>.blue());
00177       }
00178 
00179 <span class="comment">//---------------------------------------------------------</span>
00180 <span class="comment">//   readProperties</span>
00181 <span class="comment">//---------------------------------------------------------</span>
00182 
<a name="l00183"></a><a class="code" href="classElement.html#a46">00183</a> <span class="keywordtype">bool</span> <a class="code" href="classElement.html#a46">Element::readProperties</a>(QDomNode node)
00184       {
00185       QDomElement e = node.toElement();
00186       QString tag(e.tagName());
00187       QString val(e.text());
00188       <span class="keywordtype">int</span> i = val.toInt();
00189 
00190       <span class="keywordflow">if</span> (tag == <span class="stringliteral">"tick"</span>)
00191             <a class="code" href="classElement.html#r10">_time</a>.<a class="code" href="classMTime.html#a4">setTick</a>(i);
00192       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tag == <span class="stringliteral">"ticklen"</span>)
00193             <a class="code" href="classElement.html#a77">setTickLen</a>(i);
00194       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tag == <span class="stringliteral">"offset"</span>)
00195             <a class="code" href="classElement.html#a29">setUserOff</a>(<a class="code" href="xml_8h.html#a2">readPoint</a>(node));
00196       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tag == <span class="stringliteral">"visible"</span>)
00197             <a class="code" href="classElement.html#a17">setVisible</a>(i);
00198       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tag == <span class="stringliteral">"voice"</span>)
00199             <a class="code" href="classElement.html#a63">setVoice</a>(i);
00200       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tag == <span class="stringliteral">"selected"</span>)
00201             <a class="code" href="classElement.html#a15">setSelected</a>(i);
00202       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tag == <span class="stringliteral">"color"</span>) {
00203             <span class="keywordtype">int</span> r = e.attribute(<span class="stringliteral">"r"</span>, <span class="stringliteral">"0"</span>).toInt();
00204             <span class="keywordtype">int</span> g = e.attribute(<span class="stringliteral">"g"</span>, <span class="stringliteral">"0"</span>).toInt();
00205             <span class="keywordtype">int</span> b = e.attribute(<span class="stringliteral">"b"</span>, <span class="stringliteral">"0"</span>).toInt();
00206             <a class="code" href="classElement.html#r11">_color</a>.setRgb(r, g, b);
00207             }
00208       <span class="keywordflow">else</span>
00209             <span class="keywordflow">return</span> <span class="keyword">false</span>;
00210       <span class="keywordflow">return</span> <span class="keyword">true</span>;
00211       }
00212 
00213 <span class="comment">//---------------------------------------------------------</span>
00214 <span class="comment">//   Element::draw</span>
00215 <span class="comment">//---------------------------------------------------------</span>
00216 
<a name="l00217"></a><a class="code" href="classElement.html#a43">00217</a> <span class="keywordtype">void</span> <a class="code" href="classElement.html#a43">Element::draw</a>(<a class="code" href="classPainter.html">Painter</a>&amp; p)<span class="keyword"> const</span>
00218 <span class="keyword">      </span>{
00219       <span class="keywordflow">if</span> (!<a class="code" href="classElement.html#a16">visible</a>() &amp;&amp; !<a class="code" href="element_8cpp.html#a1">showInvisible</a>)
00220             <span class="keywordflow">return</span>;
00221 
00222       p.translate(<a class="code" href="classElement.html#a20">pos</a>());
00223       <span class="keywordflow">if</span> (p.<a class="code" href="classPainter.html#a3">clipRect</a>().intersects(<a class="code" href="classElement.html#a33">bbox</a>().toRect())) {
00224             QPen pen; <span class="comment">// (_color, 0, Qt::SolidLine, Qt::FlatCap, Qt::MiterJoin);</span>
00225             <span class="keywordflow">if</span> (<a class="code" href="classElement.html#a14">isSelected</a>())
00226                   pen.setColor(<a class="code" href="preferences_8cpp.html#a0">preferences</a>.<a class="code" href="structPreferences.html#o9">selectColor</a>[<a class="code" href="classElement.html#a62">voice</a>()]);
00227             <span class="keywordflow">else</span>
00228                   pen.setColor(<a class="code" href="classElement.html#a16">visible</a>() ? <a class="code" href="classElement.html#r11">_color</a> : Qt::gray);
00229             p.setPen(pen);
00230 
00231             <a class="code" href="classElement.html#a44">draw1</a>(p);
00232             <span class="keywordflow">if</span> (<a class="code" href="element_8cpp.html#a0">debugMode</a> &amp;&amp; <a class="code" href="classElement.html#a14">isSelected</a>()) {
00233                   <span class="comment">//</span>
00234                   <span class="comment">//  draw bounding box rectangle for all</span>
00235                   <span class="comment">//  selected Elements</span>
00236                   <span class="comment">//</span>
00237                   p.setBrush(Qt::NoBrush);
00238                   p.setPen(QPen(Qt::blue, 0, Qt::SolidLine));
00239                   p.drawRect(<a class="code" href="classElement.html#a33">bbox</a>());
00240                   }
00241             }
00242       p.translate(-<a class="code" href="classElement.html#a20">pos</a>());
00243       }
00244 
00245 <span class="comment">//---------------------------------------------------------</span>
00246 <span class="comment">//   draw</span>
00247 <span class="comment">//---------------------------------------------------------</span>
00248 
<a name="l00249"></a><a class="code" href="classElementList.html#a4">00249</a> <span class="keywordtype">void</span> <a class="code" href="classElementList.html#a4">ElementList::draw</a>(<a class="code" href="classPainter.html">Painter</a>&amp; p)<span class="keyword"> const</span>
00250 <span class="keyword">      </span>{
00251       <span class="keywordflow">for</span> (<a class="code" href="element_8h.html#a2">ciElement</a> i = <a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); i != <a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++i)
00252             (*i)-&gt;draw(p);
00253       }
00254 
00255 <span class="comment">//---------------------------------------------------------</span>
00256 <span class="comment">//   remove</span>
00257 <span class="comment">//    return true on success</span>
00258 <span class="comment">//---------------------------------------------------------</span>
00259 
<a name="l00260"></a><a class="code" href="classElementList.html#a1">00260</a> <span class="keywordtype">bool</span> <a class="code" href="classElementList.html#a1">ElementList::remove</a>(<a class="code" href="classElement.html">Element</a>* el)
00261       {
00262       <span class="keywordflow">for</span> (<a class="code" href="element_8h.html#a1">iElement</a> i = <a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); i != <a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++i) {
00263             <span class="keywordflow">if</span> ((*i) == el) {
00264                   erase(i);
00265                   <span class="keywordflow">return</span> <span class="keyword">true</span>;
00266                   }
00267             }
00268       <span class="keywordflow">return</span> <span class="keyword">false</span>;
00269       }
00270 
00271 <span class="comment">//---------------------------------------------------------</span>
00272 <span class="comment">//   replace</span>
00273 <span class="comment">//---------------------------------------------------------</span>
00274 
<a name="l00275"></a><a class="code" href="classElementList.html#a2">00275</a> <span class="keywordtype">void</span> <a class="code" href="classElementList.html#a2">ElementList::replace</a>(<a class="code" href="classElement.html">Element</a>* o, <a class="code" href="classElement.html">Element</a>* n)
00276       {
00277       <span class="keywordflow">for</span> (<a class="code" href="element_8h.html#a1">iElement</a> i = <a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); i != <a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++i) {
00278             <span class="keywordflow">if</span> ((*i) == o) {
00279                   <a class="code" href="element_8h.html#a1">iElement</a> in = erase(i);
00280                   insert(in, n);
00281                   <span class="keywordflow">break</span>;
00282                   }
00283             }
00284       }
00285 
00286 <span class="comment">//---------------------------------------------------------</span>
00287 <span class="comment">//   move</span>
00288 <span class="comment">//---------------------------------------------------------</span>
00289 
<a name="l00290"></a><a class="code" href="classElementList.html#a6">00290</a> <span class="keywordtype">void</span> <a class="code" href="classElementList.html#a6">ElementList::move</a>(<a class="code" href="classElement.html">Element</a>* el, <span class="keywordtype">int</span> tick)
00291       {
00292       <span class="keywordflow">for</span> (<a class="code" href="element_8h.html#a1">iElement</a> i = <a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); i != <a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++i) {
00293             <span class="keywordflow">if</span> ((*i) == el) {
00294                   erase(i);
00295                   el-&gt;<a class="code" href="classElement.html#a75">setTick</a>(tick);
00296                   <a class="code" href="classElementList.html#a5">add</a>(el);
00297                   <span class="keywordflow">break</span>;
00298                   }
00299             }
00300       }
00301 
00302 <span class="comment">//---------------------------------------------------------</span>
00303 <span class="comment">//   add</span>
00304 <span class="comment">//---------------------------------------------------------</span>
00305 
<a name="l00306"></a><a class="code" href="classElementList.html#a5">00306</a> <span class="keywordtype">void</span> <a class="code" href="classElementList.html#a5">ElementList::add</a>(<a class="code" href="classElement.html">Element</a>* e)
00307       {
00308       <span class="keywordtype">int</span> tick = e-&gt;<a class="code" href="classElement.html#a74">tick</a>();
00309       <span class="keywordflow">for</span> (<a class="code" href="element_8h.html#a1">iElement</a> ie = <a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); ie != <a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++ie) {
00310             <span class="keywordflow">if</span> ((*ie)-&gt;tick() &gt; tick) {
00311                   insert(ie, e);
00312                   <span class="keywordflow">return</span>;
00313                   }
00314             }
00315       push_back(e);
00316       }
00317 
00318 <span class="comment">//---------------------------------------------------------</span>
00319 <span class="comment">//   Symbol</span>
00320 <span class="comment">//---------------------------------------------------------</span>
00321 
<a name="l00322"></a><a class="code" href="classSymbol.html#a0">00322</a> <a class="code" href="classSymbol.html#a0">Symbol::Symbol</a>(<a class="code" href="classScore.html">Score</a>* s)
00323    : <a class="code" href="classElement.html">Element</a>(s, <a class="code" href="element_8h.html#a65a7">SYMBOL</a>)
00324       {
00325       }
00326 
<a name="l00327"></a><a class="code" href="classSymbol.html#a2">00327</a> <a class="code" href="classSymbol.html#a0">Symbol::Symbol</a>(<span class="keyword">const</span> <a class="code" href="classSymbol.html">Symbol</a>&amp; s)
00328    : <a class="code" href="classElement.html">Element</a>(s)
00329       {
00330       <a class="code" href="classSymbol.html#p0">_sym</a> = s.<a class="code" href="classSymbol.html#p0">_sym</a>;
00331       setbbox(<a class="code" href="classSymbol.html#p0">_sym</a>.<a class="code" href="structSym.html#a9">bbox</a>());
00332       }
00333 
00334 <span class="comment">//---------------------------------------------------------</span>
00335 <span class="comment">//   setSym</span>
00336 <span class="comment">//---------------------------------------------------------</span>
00337 
<a name="l00338"></a><a class="code" href="classSymbol.html#a4">00338</a> <span class="keywordtype">void</span> <a class="code" href="classSymbol.html#a4">Symbol::setSym</a>(<span class="keyword">const</span> <a class="code" href="structSym.html">Sym</a>&amp; s)
00339       {
00340       <a class="code" href="classSymbol.html#p0">_sym</a>  = s;
00341       setbbox(<a class="code" href="classSymbol.html#p0">_sym</a>.<a class="code" href="structSym.html#a9">bbox</a>());
00342       }
00343 
00344 <span class="comment">//---------------------------------------------------------</span>
00345 <span class="comment">//   width</span>
00346 <span class="comment">//---------------------------------------------------------</span>
00347 
<a name="l00348"></a><a class="code" href="classSymbol.html#a6">00348</a> <span class="keywordtype">double</span> <a class="code" href="classSymbol.html#a6">Symbol::width</a>()<span class="keyword"> const</span>
00349 <span class="keyword">      </span>{
00350       <span class="keywordflow">return</span> <a class="code" href="classSymbol.html#p0">_sym</a>.<a class="code" href="structSym.html#a4">width</a>();
00351       }
00352 
00353 <span class="comment">//---------------------------------------------------------</span>
00354 <span class="comment">//   height</span>
00355 <span class="comment">//---------------------------------------------------------</span>
00356 
<a name="l00357"></a><a class="code" href="classSymbol.html#a7">00357</a> <span class="keywordtype">double</span> <a class="code" href="classSymbol.html#a7">Symbol::height</a>()<span class="keyword"> const</span>
00358 <span class="keyword">      </span>{
00359       <span class="keywordflow">return</span> <a class="code" href="classSymbol.html#p0">_sym</a>.<a class="code" href="structSym.html#a5">height</a>();
00360       }
00361 
00362 <span class="comment">//---------------------------------------------------------</span>
00363 <span class="comment">//   baseline</span>
00364 <span class="comment">//---------------------------------------------------------</span>
00365 
<a name="l00366"></a><a class="code" href="classSymbol.html#a8">00366</a> <span class="keywordtype">double</span> <a class="code" href="classSymbol.html#a8">Symbol::baseline</a>()<span class="keyword"> const</span>
00367 <span class="keyword">      </span>{
00368       <span class="keywordflow">return</span> <a class="code" href="classSymbol.html#p0">_sym</a>.<a class="code" href="structSym.html#a6">baseline</a>();
00369       }
00370 
00371 <span class="comment">//---------------------------------------------------------</span>
00372 <span class="comment">//   Symbol::draw</span>
00373 <span class="comment">//---------------------------------------------------------</span>
00374 
<a name="l00375"></a><a class="code" href="classSymbol.html#a9">00375</a> <span class="keywordtype">void</span> <a class="code" href="classSymbol.html#a9">Symbol::draw1</a>(<a class="code" href="classPainter.html">Painter</a>&amp; p)<span class="keyword"> const</span>
00376 <span class="keyword">      </span>{
00377       <a class="code" href="classSymbol.html#p0">_sym</a>.<a class="code" href="structSym.html#a7">draw</a>(p);
00378       }
00379 
00380 <span class="comment">//---------------------------------------------------------</span>
00381 <span class="comment">//   SStaff</span>
00382 <span class="comment">//---------------------------------------------------------</span>
00383 
<a name="l00384"></a><a class="code" href="classSStaff.html#a0">00384</a> <a class="code" href="classSStaff.html#a0">SStaff::SStaff</a>(<a class="code" href="classScore.html">Score</a>* s)
00385    : <a class="code" href="classElement.html">Element</a>(s, <a class="code" href="element_8h.html#a65a9">STAFF</a>)
00386       {
00387       <a class="code" href="classSStaff.html#r0">lineWidth</a> = <a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o24">staffLineWidth</a>;
00388       <a class="code" href="classSStaff.html#r1">lines</a>     = 5;
00389       setHeight((<a class="code" href="classSStaff.html#r1">lines</a>-1) * <a class="code" href="spatium_8h.html#a0">_spatium</a> + point(<a class="code" href="classSStaff.html#r0">lineWidth</a>/2.0));
00390       }
00391 
<a name="l00392"></a><a class="code" href="classSStaff.html#a1">00392</a> <a class="code" href="classSStaff.html#a0">SStaff::SStaff</a>(<span class="keyword">const</span> <a class="code" href="classSStaff.html">SStaff</a>&amp; s)
00393    : <a class="code" href="classElement.html">Element</a>(s)
00394       {
00395       <a class="code" href="classSStaff.html#r0">lineWidth</a> = s.<a class="code" href="classSStaff.html#r0">lineWidth</a>;
00396       <a class="code" href="classSStaff.html#r1">lines</a>     = s.<a class="code" href="classSStaff.html#r1">lines</a>;
00397       }
00398 
00399 <span class="comment">//---------------------------------------------------------</span>
00400 <span class="comment">//   draw</span>
00401 <span class="comment">//---------------------------------------------------------</span>
00402 
<a name="l00403"></a><a class="code" href="classSStaff.html#a2">00403</a> <span class="keywordtype">void</span> <a class="code" href="classSStaff.html#a2">SStaff::draw1</a>(<a class="code" href="classPainter.html">Painter</a>&amp; p)<span class="keyword"> const</span>
00404 <span class="keyword">      </span>{
00405       QPointF _pos(0.0, 0.0);
00406 
00407       QPen pen(QColor(<a class="code" href="classElement.html#a14">isSelected</a>() ? <a class="code" href="preferences_8cpp.html#a0">preferences</a>.<a class="code" href="structPreferences.html#o9">selectColor</a>[0] : Qt::black));
00408       pen.setWidthF(point(<a class="code" href="classSStaff.html#r0">lineWidth</a>));
00409       p.setPen(pen);
00410 
00411       qreal x1 = _pos.x();
00412       qreal x2 = x1 + <a class="code" href="classElement.html#a37">width</a>();
00413       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classSStaff.html#r1">lines</a>; ++i) {
00414             qreal y = _pos.y() + i * <a class="code" href="spatium_8h.html#a0">_spatium</a>;
00415             p.drawLine(QLineF(x1, y, x2, y));
00416             }
00417       }
00418 
00419 <span class="comment">//---------------------------------------------------------</span>
00420 <span class="comment">//   Akkolade</span>
00421 <span class="comment">//---------------------------------------------------------</span>
00422 
<a name="l00423"></a><a class="code" href="classAkkolade.html#a0">00423</a> <a class="code" href="classAkkolade.html#a0">Akkolade::Akkolade</a>(<a class="code" href="classScore.html">Score</a>* s)
00424    : <a class="code" href="classElement.html">Element</a>(s, <a class="code" href="element_8h.html#a65a17">AKKOLADE</a>)
00425       {
00426       <a class="code" href="classAkkolade.html#r2">path</a> = 0;
00427       <a class="code" href="classAkkolade.html#r0">h2</a>   = 0.0;
00428       <a class="code" href="classAkkolade.html#r1">w</a>    = point(<a class="code" href="style_8cpp.html#a1">style</a>-&gt;<a class="code" href="structStyle.html#o26">akkoladeWidth</a>);
00429       }
00430 
00431 <span class="comment">//---------------------------------------------------------</span>
00432 <span class="comment">//   setHeight</span>
00433 <span class="comment">//---------------------------------------------------------</span>
00434 
<a name="l00435"></a><a class="code" href="classAkkolade.html#a3">00435</a> <span class="keywordtype">void</span> <a class="code" href="classAkkolade.html#a3">Akkolade::setHeight</a>(<span class="keywordtype">double</span> h)
00436       {
00437       <a class="code" href="classAkkolade.html#r0">h2</a> = h/2.0;
00438       <a class="code" href="classAkkolade.html#d0">updateValues</a>();
00439       }
00440 
00441 <span class="comment">//---------------------------------------------------------</span>
00442 <span class="comment">//   setWidth</span>
00443 <span class="comment">//---------------------------------------------------------</span>
00444 
<a name="l00445"></a><a class="code" href="classAkkolade.html#a4">00445</a> <span class="keywordtype">void</span> <a class="code" href="classAkkolade.html#a4">Akkolade::setWidth</a>(<span class="keywordtype">double</span> val)
00446       {
00447       <a class="code" href="classAkkolade.html#r1">w</a> = val;
00448       <a class="code" href="classAkkolade.html#d0">updateValues</a>();
00449       }
00450 
00451 <span class="comment">//---------------------------------------------------------</span>
00452 <span class="comment">//   updateValues</span>
00453 <span class="comment">//---------------------------------------------------------</span>
00454 
<a name="l00455"></a><a class="code" href="classAkkolade.html#d0">00455</a> <span class="keywordtype">void</span> <a class="code" href="classAkkolade.html#d0">Akkolade::updateValues</a>()
00456       {
00457       <span class="keywordflow">if</span> (<a class="code" href="classAkkolade.html#r0">h2</a> == 0.0)
00458             <span class="keywordflow">return</span>;
00459       <span class="keywordflow">if</span> (<a class="code" href="classAkkolade.html#r2">path</a>)
00460             <span class="keyword">delete</span> <a class="code" href="classAkkolade.html#r2">path</a>;
00461       <a class="code" href="classAkkolade.html#r2">path</a> = <span class="keyword">new</span> QPainterPath;
00462 
00463       <span class="keyword">const</span> <span class="keywordtype">double</span> X1 = 2.0;
00464       <span class="keyword">const</span> <span class="keywordtype">double</span> X2 = -0.7096;
00465       <span class="keyword">const</span> <span class="keywordtype">double</span> X3 = -1.234;
00466       <span class="keyword">const</span> <span class="keywordtype">double</span> X4 =  1.734;
00467 
00468       <a class="code" href="classAkkolade.html#r2">path</a>-&gt;moveTo(0, 0);
00469       <a class="code" href="classAkkolade.html#r2">path</a>-&gt;cubicTo(<a class="code" href="classAkkolade.html#r1">w</a> * X1, <a class="code" href="classAkkolade.html#r0">h2</a> *.3359, <a class="code" href="classAkkolade.html#r1">w</a> * X2, <a class="code" href="classAkkolade.html#r0">h2</a> *.5089, <a class="code" href="classAkkolade.html#r1">w</a>, <a class="code" href="classAkkolade.html#r0">h2</a>);
00470 
00471       <a class="code" href="classAkkolade.html#r2">path</a>-&gt;moveTo(<a class="code" href="classAkkolade.html#r1">w</a>, <a class="code" href="classAkkolade.html#r0">h2</a>);
00472       <a class="code" href="classAkkolade.html#r2">path</a>-&gt;cubicTo(<a class="code" href="classAkkolade.html#r1">w</a> * X3, <a class="code" href="classAkkolade.html#r0">h2</a> * .5025, <a class="code" href="classAkkolade.html#r1">w</a> * X4, <a class="code" href="classAkkolade.html#r0">h2</a> * .2413, 0, 0);
00473 
00474       <a class="code" href="classAkkolade.html#r2">path</a>-&gt;moveTo(0, 0);
00475       <a class="code" href="classAkkolade.html#r2">path</a>-&gt;cubicTo(<a class="code" href="classAkkolade.html#r1">w</a> * X1, -<a class="code" href="classAkkolade.html#r0">h2</a> *.3359, <a class="code" href="classAkkolade.html#r1">w</a> * X2, -<a class="code" href="classAkkolade.html#r0">h2</a> *.5089, <a class="code" href="classAkkolade.html#r1">w</a>, -<a class="code" href="classAkkolade.html#r0">h2</a>);
00476 
00477       <a class="code" href="classAkkolade.html#r2">path</a>-&gt;moveTo(<a class="code" href="classAkkolade.html#r1">w</a>, -<a class="code" href="classAkkolade.html#r0">h2</a>);
00478       <a class="code" href="classAkkolade.html#r2">path</a>-&gt;cubicTo(<a class="code" href="classAkkolade.html#r1">w</a> * X3, -<a class="code" href="classAkkolade.html#r0">h2</a> * .5025, <a class="code" href="classAkkolade.html#r1">w</a> * X4, -<a class="code" href="classAkkolade.html#r0">h2</a> * .2413, 0, 0);
00479 
00480       setbbox(<a class="code" href="classAkkolade.html#r2">path</a>-&gt;boundingRect());
00481       }
00482 
00483 <span class="comment">//---------------------------------------------------------</span>
00484 <span class="comment">//   draw</span>
00485 <span class="comment">//---------------------------------------------------------</span>
00486 
<a name="l00487"></a><a class="code" href="classAkkolade.html#a7">00487</a> <span class="keywordtype">void</span> <a class="code" href="classAkkolade.html#a7">Akkolade::draw1</a>(<a class="code" href="classPainter.html">Painter</a>&amp; p)<span class="keyword"> const</span>
00488 <span class="keyword">      </span>{
00489       p.setBrush(<a class="code" href="classElement.html#a14">isSelected</a>() ? <a class="code" href="preferences_8cpp.html#a0">preferences</a>.<a class="code" href="structPreferences.html#o9">selectColor</a>[0] : Qt::black);
00490       p.drawPath(*<a class="code" href="classAkkolade.html#r2">path</a>);
00491       }
00492 
00493 <span class="comment">//---------------------------------------------------------</span>
00494 <span class="comment">//   Akkolade::write</span>
00495 <span class="comment">//---------------------------------------------------------</span>
00496 
<a name="l00497"></a><a class="code" href="classAkkolade.html#a8">00497</a> <span class="keywordtype">void</span> <a class="code" href="classAkkolade.html#a8">Akkolade::write</a>(<a class="code" href="classXml.html">Xml</a>&amp; xml)<span class="keyword"> const</span>
00498 <span class="keyword">      </span>{
00499       xml.<a class="code" href="classXml.html#a8">tag</a>(<span class="stringliteral">"Akkolade"</span>);
00500       Element::writeProperties(xml);
00501       xml.<a class="code" href="classXml.html#a9">etag</a>(<span class="stringliteral">"Akkolade"</span>);
00502       }
00503 
00504 <span class="comment">//---------------------------------------------------------</span>
00505 <span class="comment">//   Akkolade::read</span>
00506 <span class="comment">//---------------------------------------------------------</span>
00507 
<a name="l00508"></a><a class="code" href="classAkkolade.html#a9">00508</a> <span class="keywordtype">void</span> <a class="code" href="classAkkolade.html#a9">Akkolade::read</a>(QDomNode node)
00509       {
00510       node = node.firstChild();
00511       <span class="keywordflow">while</span> (!node.isNull()) {
00512             QDomElement e = node.toElement();
00513             QString tag(e.tagName());
00514             <span class="keywordflow">if</span> (Element::readProperties(node))
00515                   ;
00516             <span class="keywordflow">else</span>
00517                   <a class="code" href="utils_8h.html#a4">domError</a>(node);
00518             node = node.nextSibling();
00519             }
00520       }
00521 
00522 <span class="comment">//---------------------------------------------------------</span>
00523 <span class="comment">//   Clef</span>
00524 <span class="comment">//---------------------------------------------------------</span>
00525 
<a name="l00526"></a><a class="code" href="classClef.html#a0">00526</a> <a class="code" href="classClef.html#a0">Clef::Clef</a>(<a class="code" href="classScore.html">Score</a>* s)
00527   : <a class="code" href="classSymbol.html">Symbol</a>(s)
00528       {
00529       setType(<a class="code" href="element_8h.html#a65a22">CLEF</a>);
00530       }
00531 
<a name="l00532"></a><a class="code" href="classClef.html#a1">00532</a> <a class="code" href="classClef.html#a0">Clef::Clef</a>(<a class="code" href="classScore.html">Score</a>* s, <span class="keywordtype">int</span> i, <span class="keywordtype">bool</span> sm)
00533   : <a class="code" href="classSymbol.html">Symbol</a>(s)
00534       {
00535       setType(<a class="code" href="element_8h.html#a65a22">CLEF</a>);
00536       <a class="code" href="classClef.html#a4">setIdx</a>(i, sm);
00537       }
00538 
<a name="l00539"></a><a class="code" href="classClef.html#a2">00539</a> <a class="code" href="classClef.html#a0">Clef::Clef</a>(<span class="keyword">const</span> <a class="code" href="classClef.html">Clef</a>&amp; r)
00540    : <a class="code" href="classSymbol.html">Symbol</a>(r)
00541       {
00542       <a class="code" href="classClef.html#r0">val</a>    = r.<a class="code" href="classClef.html#r0">val</a>;
00543       <a class="code" href="classClef.html#r1">_small</a> = r.<a class="code" href="classClef.html#r1">_small</a>;
00544       }
00545 
00546 <span class="comment">//---------------------------------------------------------</span>
00547 <span class="comment">//   setIdx</span>
00548 <span class="comment">//---------------------------------------------------------</span>
00549 
<a name="l00550"></a><a class="code" href="classClef.html#a4">00550</a> <span class="keywordtype">void</span> <a class="code" href="classClef.html#a4">Clef::setIdx</a>(<span class="keywordtype">int</span> i, <span class="keywordtype">bool</span> s)
00551       {
00552       <a class="code" href="classClef.html#r0">val</a>         = i;
00553       <span class="keywordtype">double</span> yoff = 0.0;
00554       <span class="keywordtype">double</span> xoff = 0.0;
00555       <a class="code" href="classClef.html#r1">_small</a>      = s;
00556 
00557       <span class="keywordflow">switch</span>(i) {
00558             <span class="keywordflow">case</span> 0:
00559                   setSym(<a class="code" href="classClef.html#r1">_small</a> ? <a class="code" href="symbols_8cpp.html#a111">ctrebleclefSym</a> : <a class="code" href="symbols_8cpp.html#a110">trebleclefSym</a>);
00560                   yoff = 3.0;
00561                   <span class="keywordflow">break</span>;
00562             <span class="keywordflow">case</span> 1:
00563                   setSym(<a class="code" href="classClef.html#r1">_small</a> ? <a class="code" href="symbols_8cpp.html#a111">ctrebleclefSym</a> : <a class="code" href="symbols_8cpp.html#a110">trebleclefSym</a>);
00564                   yoff = 3.0;
00565                   <span class="keywordflow">break</span>;
00566             <span class="keywordflow">case</span> 2:
00567                   setSym(<a class="code" href="classClef.html#r1">_small</a> ? <a class="code" href="symbols_8cpp.html#a111">ctrebleclefSym</a> : <a class="code" href="symbols_8cpp.html#a110">trebleclefSym</a>);
00568                   yoff = 3.0;
00569                   <span class="keywordflow">break</span>;
00570             <span class="keywordflow">case</span> 3:
00571                   setSym(<a class="code" href="classClef.html#r1">_small</a> ? <a class="code" href="symbols_8cpp.html#a111">ctrebleclefSym</a> : <a class="code" href="symbols_8cpp.html#a110">trebleclefSym</a>);
00572                   yoff = 3.0;
00573                   <span class="keywordflow">break</span>;
00574             <span class="keywordflow">case</span> 4:
00575             <span class="keywordflow">case</span> 5:
00576             <span class="keywordflow">case</span> 6:
00577             <span class="keywordflow">case</span> 7:
00578             <span class="keywordflow">case</span> 8:
00579                   setSym(<a class="code" href="classClef.html#r1">_small</a> ? <a class="code" href="symbols_8cpp.html#a109">cbassclefSym</a> : <a class="code" href="symbols_8cpp.html#a108">bassclefSym</a>);
00580                   yoff = 1.0;
00581                   <span class="keywordflow">break</span>;
00582             <span class="keywordflow">case</span> 9:
00583                   setSym(<a class="code" href="classClef.html#r1">_small</a> ? <a class="code" href="symbols_8cpp.html#a107">caltoclefSym</a> : <a class="code" href="symbols_8cpp.html#a106">altoclefSym</a>);
00584                   yoff = 1.0;
00585                   <span class="keywordflow">break</span>;
00586             <span class="keywordflow">case</span> 10:
00587                   setSym(<a class="code" href="classClef.html#r1">_small</a> ? <a class="code" href="symbols_8cpp.html#a107">caltoclefSym</a> : <a class="code" href="symbols_8cpp.html#a106">altoclefSym</a>);
00588                   yoff = 2.0;
00589                   <span class="keywordflow">break</span>;
00590             <span class="keywordflow">case</span> 11:
00591                   setSym(<a class="code" href="classClef.html#r1">_small</a> ? <a class="code" href="symbols_8cpp.html#a107">caltoclefSym</a> : <a class="code" href="symbols_8cpp.html#a106">altoclefSym</a>);
00592                   yoff = 3.0;
00593                   <span class="keywordflow">break</span>;
00594             <span class="keywordflow">case</span> 12:
00595                   setSym(<a class="code" href="classClef.html#r1">_small</a> ? <a class="code" href="symbols_8cpp.html#a107">caltoclefSym</a> : <a class="code" href="symbols_8cpp.html#a106">altoclefSym</a>);
00596                   yoff = 4.0;
00597                   <span class="keywordflow">break</span>;
00598             <span class="keywordflow">case</span> 13:
00599             <span class="keywordflow">default</span>:
00600                   <span class="keywordflow">break</span>;
00601             }
00602       setUserOff(QPointF(xoff, yoff));
00603       }
00604 
00605 <span class="comment">//---------------------------------------------------------</span>
00606 <span class="comment">//   setSmall</span>
00607 <span class="comment">//---------------------------------------------------------</span>
00608 
<a name="l00609"></a><a class="code" href="classClef.html#a7">00609</a> <span class="keywordtype">void</span> <a class="code" href="classClef.html#a7">Clef::setSmall</a>(<span class="keywordtype">bool</span> s)
00610       {
00611       <a class="code" href="classClef.html#a4">setIdx</a>(<a class="code" href="classClef.html#r0">val</a>, s);
00612       }
00613 
00614 <span class="comment">//---------------------------------------------------------</span>
00615 <span class="comment">//   space</span>
00616 <span class="comment">//---------------------------------------------------------</span>
00617 
<a name="l00618"></a><a class="code" href="classClef.html#a10">00618</a> <span class="keywordtype">void</span> <a class="code" href="classClef.html#a10">Clef::space</a>(<span class="keywordtype">double</span>&amp; min, <span class="keywordtype">double</span>&amp; extra)<span class="keyword"> const</span>
00619 <span class="keyword">      </span>{
00620 <span class="preprocessor">#if 1</span>
00621 <span class="preprocessor"></span>      min   = 0.0;
00622       extra = <a class="code" href="classSymbol.html#a6">width</a>(); <span class="comment">// + 0.5 * _spatium;</span>
00623 <span class="preprocessor">#else</span>
00624 <span class="preprocessor"></span>      min   = <a class="code" href="classSymbol.html#a6">width</a>();
00625       extra = 0.0;
00626 <span class="preprocessor">#endif</span>
00627 <span class="preprocessor"></span>      }
00628 
00629 <span class="comment">//---------------------------------------------------------</span>
00630 <span class="comment">//   Accidental</span>
00631 <span class="comment">//    0 - no accidental</span>
00632 <span class="comment">//    1 - sharp</span>
00633 <span class="comment">//    2 - flat</span>
00634 <span class="comment">//    3 - double sharp</span>
00635 <span class="comment">//    4 - double flat</span>
00636 <span class="comment">//    5 - natural</span>
00637 <span class="comment">//    6 - (sharp)          11 - [sharp]</span>
00638 <span class="comment">//    7 - (flat)           12 - [flat]</span>
00639 <span class="comment">//    8 - (double sharp)   13 - [double sharp]</span>
00640 <span class="comment">//    9 - (double flat)    14 - [double flat]</span>
00641 <span class="comment">//    10 - (natural)       15 - [natural]</span>
00642 <span class="comment">//---------------------------------------------------------</span>
00643 
<a name="l00644"></a><a class="code" href="classPrefix.html#a0">00644</a> <a class="code" href="classPrefix.html#a0">Prefix::Prefix</a>(<a class="code" href="classScore.html">Score</a>* sc, <span class="keywordtype">int</span> i, <span class="keywordtype">bool</span> s)
00645   : <a class="code" href="classCompound.html">Compound</a>(sc, <a class="code" href="element_8h.html#a65a18">ACCIDENTAL</a>)
00646       {
00647       <a class="code" href="classPrefix.html#r1">small</a> = s;
00648       <a class="code" href="classPrefix.html#r0">val</a>   = -1;
00649       <a class="code" href="classPrefix.html#a3">setIdx</a>(i);
00650       }
00651 
00652 <span class="comment">//---------------------------------------------------------</span>
00653 <span class="comment">//   setIdx</span>
00654 <span class="comment">//---------------------------------------------------------</span>
00655 
<a name="l00656"></a><a class="code" href="classPrefix.html#a3">00656</a> <span class="keywordtype">void</span> <a class="code" href="classPrefix.html#a3">Prefix::setIdx</a>(<span class="keywordtype">int</span> i)
00657       {
00658       <span class="keywordflow">if</span> (<a class="code" href="classPrefix.html#r0">val</a> == i)
00659             <span class="keywordflow">return</span>;
00660       <a class="code" href="classPrefix.html#r0">val</a> = i;
00661       <a class="code" href="classCompound.html#a5">clear</a>();
00662       <span class="keywordflow">if</span> (<a class="code" href="classPrefix.html#r1">small</a>) {
00663             <a class="code" href="classSymbol.html">Symbol</a>* s = <span class="keyword">new</span> <a class="code" href="classSymbol.html">Symbol</a>(<a class="code" href="classElement.html#a4">score</a>());
00664             <span class="keywordflow">switch</span>(i) {
00665                   <span class="keywordflow">default</span>:
00666                   <span class="keywordflow">case</span>  0: <span class="keyword">delete</span> s; <span class="keywordflow">return</span>;
00667                   <span class="keywordflow">case</span>  1: s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="symbols_8cpp.html#a173">s_sharpSym</a>);      <span class="keywordflow">break</span>;
00668                   <span class="keywordflow">case</span>  2: s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="symbols_8cpp.html#a175">s_flatSym</a>);       <span class="keywordflow">break</span>;
00669                   <span class="keywordflow">case</span>  3: s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="symbols_8cpp.html#a177">s_sharpsharpSym</a>); <span class="keywordflow">break</span>;
00670                   <span class="keywordflow">case</span>  4: s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="symbols_8cpp.html#a176">s_flatflatSym</a>);   <span class="keywordflow">break</span>;
00671                   <span class="keywordflow">case</span>  5: s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="symbols_8cpp.html#a174">s_naturalSym</a>);    <span class="keywordflow">break</span>;
00672                   <span class="keywordflow">case</span>  6: s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="symbols_8cpp.html#a173">s_sharpSym</a>);      <span class="keywordflow">break</span>;
00673                   <span class="keywordflow">case</span>  7: s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="symbols_8cpp.html#a175">s_flatSym</a>);       <span class="keywordflow">break</span>;
00674                   <span class="keywordflow">case</span>  8: s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="symbols_8cpp.html#a177">s_sharpsharpSym</a>); <span class="keywordflow">break</span>;
00675                   <span class="keywordflow">case</span>  9: s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="symbols_8cpp.html#a176">s_flatflatSym</a>);   <span class="keywordflow">break</span>;
00676                   <span class="keywordflow">case</span> 10: s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="symbols_8cpp.html#a174">s_naturalSym</a>);    <span class="keywordflow">break</span>;
00677                   <span class="keywordflow">case</span> 11: s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="symbols_8cpp.html#a173">s_sharpSym</a>);      <span class="keywordflow">break</span>;
00678                   <span class="keywordflow">case</span> 12: s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="symbols_8cpp.html#a175">s_flatSym</a>);       <span class="keywordflow">break</span>;
00679                   <span class="keywordflow">case</span> 13: s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="symbols_8cpp.html#a177">s_sharpsharpSym</a>); <span class="keywordflow">break</span>;
00680                   <span class="keywordflow">case</span> 14: s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="symbols_8cpp.html#a176">s_flatflatSym</a>);   <span class="keywordflow">break</span>;
00681                   <span class="keywordflow">case</span> 15: s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="symbols_8cpp.html#a174">s_naturalSym</a>);    <span class="keywordflow">break</span>;
00682                   }
00683             addElement(s, 0.0, 0.0);
00684             }
00685       <span class="keywordflow">else</span> {
00686             <a class="code" href="classSymbol.html">Symbol</a>* s = <span class="keyword">new</span> <a class="code" href="classSymbol.html">Symbol</a>(<a class="code" href="classElement.html#a4">score</a>());
00687             <span class="keywordflow">switch</span>(i) {
00688                   <span class="keywordflow">default</span>:
00689                   <span class="keywordflow">case</span>  0: <span class="keyword">delete</span> s; <span class="keywordflow">return</span>;
00690                   <span class="keywordflow">case</span>  1: s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="symbols_8cpp.html#a24">sharpSym</a>);      <span class="keywordflow">break</span>;
00691                   <span class="keywordflow">case</span>  2: s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="symbols_8cpp.html#a26">flatSym</a>);       <span class="keywordflow">break</span>;
00692                   <span class="keywordflow">case</span>  3: s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="symbols_8cpp.html#a28">sharpsharpSym</a>); <span class="keywordflow">break</span>;
00693                   <span class="keywordflow">case</span>  4: s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="symbols_8cpp.html#a27">flatflatSym</a>);   <span class="keywordflow">break</span>;
00694                   <span class="keywordflow">case</span>  5: s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="symbols_8cpp.html#a25">naturalSym</a>);    <span class="keywordflow">break</span>;
00695 
00696                   <span class="keywordflow">case</span>  6:
00697                         {
00698                         s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="symbols_8cpp.html#a30">leftparenSym</a>);
00699                         addElement(s, 0.0, 0.0);
00700                         <span class="keywordtype">double</span> x = <a class="code" href="symbols_8cpp.html#a30">leftparenSym</a>.<a class="code" href="structSym.html#a4">width</a>() / <a class="code" href="spatium_8h.html#a0">_spatium</a>;
00701 
00702                         s = <span class="keyword">new</span> Symbol(<a class="code" href="classElement.html#a4">score</a>());
00703                         s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="symbols_8cpp.html#a173">s_sharpSym</a>);
00704                         addElement(s, x, 0.0);
00705                         x += (<a class="code" href="symbols_8cpp.html#a173">s_sharpSym</a>.<a class="code" href="structSym.html#a4">width</a>() / <a class="code" href="spatium_8h.html#a0">_spatium</a>);
00706 
00707                         s = <span class="keyword">new</span> Symbol(<a class="code" href="classElement.html#a4">score</a>());
00708                         s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="symbols_8cpp.html#a29">rightparenSym</a>);
00709                         addElement(s, x, 0.0);
00710                         }
00711                         <span class="keywordflow">return</span>;
00712 
00713                   <span class="keywordflow">case</span>  7: s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="symbols_8cpp.html#a26">flatSym</a>);       <span class="keywordflow">break</span>;
00714                   <span class="keywordflow">case</span>  8: s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="symbols_8cpp.html#a28">sharpsharpSym</a>); <span class="keywordflow">break</span>;
00715                   <span class="keywordflow">case</span>  9: s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="symbols_8cpp.html#a27">flatflatSym</a>);   <span class="keywordflow">break</span>;
00716                   <span class="keywordflow">case</span> 10: s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="symbols_8cpp.html#a25">naturalSym</a>);    <span class="keywordflow">break</span>;
00717                   <span class="keywordflow">case</span> 11: s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="symbols_8cpp.html#a24">sharpSym</a>);      <span class="keywordflow">break</span>;
00718                   <span class="keywordflow">case</span> 12: s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="symbols_8cpp.html#a26">flatSym</a>);       <span class="keywordflow">break</span>;
00719                   <span class="keywordflow">case</span> 13: s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="symbols_8cpp.html#a28">sharpsharpSym</a>); <span class="keywordflow">break</span>;
00720                   <span class="keywordflow">case</span> 14: s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="symbols_8cpp.html#a27">flatflatSym</a>);   <span class="keywordflow">break</span>;
00721                   <span class="keywordflow">case</span> 15: s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="symbols_8cpp.html#a25">naturalSym</a>);    <span class="keywordflow">break</span>;
00722                   }
00723             addElement(s, 0.0, 0.0);
00724             }
00725       }
00726 
<a name="l00727"></a><a class="code" href="classPrefix.html#a1">00727</a> <a class="code" href="classPrefix.html#a0">Prefix::Prefix</a>(<span class="keyword">const</span> <a class="code" href="classPrefix.html">Prefix</a>&amp; r)
00728    : <a class="code" href="classCompound.html">Compound</a>(r)
00729       {
00730       <a class="code" href="classPrefix.html#r0">val</a> = r.<a class="code" href="classPrefix.html#r0">val</a>;
00731       <a class="code" href="classPrefix.html#r1">small</a> = r.<a class="code" href="classPrefix.html#r1">small</a>;
00732       }
00733 
00734 <span class="comment">//---------------------------------------------------------</span>
00735 <span class="comment">//   Flag</span>
00736 <span class="comment">//---------------------------------------------------------</span>
00737 
<a name="l00738"></a><a class="code" href="classFlag.html#a0">00738</a> <a class="code" href="classFlag.html#a0">Flag::Flag</a>(<a class="code" href="classScore.html">Score</a>* s)
00739   : <a class="code" href="classSymbol.html">Symbol</a>(s)
00740       {
00741       setType(<a class="code" href="element_8h.html#a65a34">FLAG</a>);
00742       }
00743 
<a name="l00744"></a><a class="code" href="classFlag.html#a1">00744</a> <a class="code" href="classFlag.html#a0">Flag::Flag</a>(<span class="keyword">const</span> <a class="code" href="classFlag.html">Flag</a>&amp; r)
00745    : <a class="code" href="classSymbol.html">Symbol</a>(r)
00746       {
00747       <a class="code" href="classFlag.html#r0">val</a> = r.<a class="code" href="classFlag.html#r0">val</a>;
00748       }
00749 
00750 <span class="comment">//---------------------------------------------------------</span>
00751 <span class="comment">//   setIdx</span>
00752 <span class="comment">//---------------------------------------------------------</span>
00753 
<a name="l00754"></a><a class="code" href="classFlag.html#a4">00754</a> <span class="keywordtype">void</span> <a class="code" href="classFlag.html#a4">Flag::setIdx</a>(<span class="keywordtype">int</span> i, <span class="keywordtype">bool</span> s)
00755       {
00756       <a class="code" href="classFlag.html#r0">val</a> = i;
00757       <a class="code" href="classFlag.html#r1">_small</a> = s;
00758 
00759       <span class="keywordflow">if</span> (<a class="code" href="classFlag.html#r1">_small</a>) {
00760             <span class="keywordflow">switch</span>(i) {
00761                   <span class="keywordflow">case</span> 0:    <span class="keywordflow">break</span>;
00762                   <span class="keywordflow">case</span> 1:    setSym(<a class="code" href="symbols_8cpp.html#a165">s_eighthflagSym</a>); <span class="keywordflow">break</span>;
00763                   <span class="keywordflow">case</span> 2:    setSym(<a class="code" href="symbols_8cpp.html#a166">s_sixteenthflagSym</a>); <span class="keywordflow">break</span>;
00764                   <span class="keywordflow">case</span> 3:    setSym(<a class="code" href="symbols_8cpp.html#a167">s_thirtysecondflagSym</a>); <span class="keywordflow">break</span>;
00765                   <span class="keywordflow">case</span> 4:    setSym(<a class="code" href="symbols_8cpp.html#a168">s_sixtyfourthflagSym</a>); <span class="keywordflow">break</span>;
00766                   <span class="keywordflow">case</span> 5:    <span class="keywordflow">break</span>;
00767                   <span class="keywordflow">case</span> -1:   setSym(<a class="code" href="symbols_8cpp.html#a169">s_deighthflagSym</a>); <span class="keywordflow">break</span>;
00768                   <span class="keywordflow">case</span> -2:   setSym(<a class="code" href="symbols_8cpp.html#a170">s_dsixteenthflagSym</a>); <span class="keywordflow">break</span>;
00769                   <span class="keywordflow">case</span> -3:   setSym(<a class="code" href="symbols_8cpp.html#a171">s_dthirtysecondflagSym</a>); <span class="keywordflow">break</span>;
00770                   <span class="keywordflow">case</span> -4:   setSym(<a class="code" href="symbols_8cpp.html#a172">s_dsixtyfourthflagSym</a>); <span class="keywordflow">break</span>;
00771                   <span class="keywordflow">case</span> -5:   <span class="keywordflow">break</span>;
00772                   }
00773             }
00774       <span class="keywordflow">else</span> {
00775             <span class="keywordflow">switch</span>(i) {
00776                   <span class="keywordflow">case</span> 0:    <span class="keywordflow">break</span>;
00777                   <span class="keywordflow">case</span> 1:    setSym(<a class="code" href="symbols_8cpp.html#a94">eighthflagSym</a>); <span class="keywordflow">break</span>;
00778                   <span class="keywordflow">case</span> 2:    setSym(<a class="code" href="symbols_8cpp.html#a95">sixteenthflagSym</a>); <span class="keywordflow">break</span>;
00779                   <span class="keywordflow">case</span> 3:    setSym(<a class="code" href="symbols_8cpp.html#a96">thirtysecondflagSym</a>); <span class="keywordflow">break</span>;
00780                   <span class="keywordflow">case</span> 4:    setSym(<a class="code" href="symbols_8cpp.html#a97">sixtyfourthflagSym</a>); <span class="keywordflow">break</span>;
00781                   <span class="keywordflow">case</span> 5:    <span class="keywordflow">break</span>;
00782                   <span class="keywordflow">case</span> -1:   setSym(<a class="code" href="symbols_8cpp.html#a98">deighthflagSym</a>); <span class="keywordflow">break</span>;
00783                   <span class="keywordflow">case</span> -2:   setSym(<a class="code" href="symbols_8cpp.html#a101">dsixteenthflagSym</a>); <span class="keywordflow">break</span>;
00784                   <span class="keywordflow">case</span> -3:   setSym(<a class="code" href="symbols_8cpp.html#a102">dthirtysecondflagSym</a>); <span class="keywordflow">break</span>;
00785                   <span class="keywordflow">case</span> -4:   setSym(<a class="code" href="symbols_8cpp.html#a103">dsixtyfourthflagSym</a>); <span class="keywordflow">break</span>;
00786                   <span class="keywordflow">case</span> -5:   <span class="keywordflow">break</span>;
00787                   }
00788             }
00789       }
00790 
00791 <span class="comment">//---------------------------------------------------------</span>
00792 <span class="comment">//   Line</span>
00793 <span class="comment">//---------------------------------------------------------</span>
00794 
<a name="l00795"></a><a class="code" href="classLine.html#a1">00795</a> <a class="code" href="classLine.html#a0">Line::Line</a>(<a class="code" href="classScore.html">Score</a>* s, <span class="keywordtype">bool</span> v)
00796    : <a class="code" href="classElement.html">Element</a>(s, <a class="code" href="element_8h.html#a65a16">LINE</a>)
00797       {
00798       <a class="code" href="classLine.html#p0">vertical</a> = v;
00799       }
00800 
<a name="l00801"></a><a class="code" href="classLine.html#a2">00801</a> <a class="code" href="classLine.html#a0">Line::Line</a>(<span class="keyword">const</span> <a class="code" href="classLine.html">Line</a>&amp; b)
00802    : <a class="code" href="classElement.html">Element</a>(b)
00803       {
00804       <a class="code" href="classLine.html#r0">_width</a>   = b.<a class="code" href="classLine.html#r0">_width</a>;
00805       <a class="code" href="classLine.html#r1">_len</a>     = b.<a class="code" href="classLine.html#r1">_len</a>;
00806       <a class="code" href="classLine.html#p0">vertical</a> = b.<a class="code" href="classLine.html#p0">vertical</a>;
00807       }
00808 
00809 <span class="comment">//---------------------------------------------------------</span>
00810 <span class="comment">//   dump</span>
00811 <span class="comment">//---------------------------------------------------------</span>
00812 
<a name="l00813"></a><a class="code" href="classLine.html#a7">00813</a> <span class="keywordtype">void</span> <a class="code" href="classLine.html#a7">Line::dump</a>()<span class="keyword"> const</span>
00814 <span class="keyword">      </span>{
00815       printf(<span class="stringliteral">"  width:%g height:%g vert:%d\n"</span>,
00816          point(<a class="code" href="classLine.html#r0">_width</a>), point(<a class="code" href="classLine.html#r1">_len</a>), <a class="code" href="classLine.html#p0">vertical</a>);
00817       }
00818 
00819 <span class="comment">//---------------------------------------------------------</span>
00820 <span class="comment">//   setLen</span>
00821 <span class="comment">//---------------------------------------------------------</span>
00822 
<a name="l00823"></a><a class="code" href="classLine.html#a10">00823</a> <span class="keywordtype">void</span> <a class="code" href="classLine.html#a10">Line::setLen</a>(<a class="code" href="classSpatium.html">Spatium</a> l)
00824       {
00825       <a class="code" href="classLine.html#r1">_len</a> = l;
00826       <a class="code" href="classLine.html#d0">bboxUpdate</a>();
00827       }
00828 
00829 <span class="comment">//---------------------------------------------------------</span>
00830 <span class="comment">//   setLineWidth</span>
00831 <span class="comment">//---------------------------------------------------------</span>
00832 
<a name="l00833"></a><a class="code" href="classLine.html#a11">00833</a> <span class="keywordtype">void</span> <a class="code" href="classLine.html#a11">Line::setLineWidth</a>(<a class="code" href="classSpatium.html">Spatium</a> w)
00834       {
00835       <a class="code" href="classLine.html#r0">_width</a> = w;
00836       <a class="code" href="classLine.html#d0">bboxUpdate</a>();
00837       }
00838 
00839 <span class="comment">//---------------------------------------------------------</span>
00840 <span class="comment">//   bboxUpdate</span>
00841 <span class="comment">//---------------------------------------------------------</span>
00842 
<a name="l00843"></a><a class="code" href="classLine.html#d0">00843</a> <span class="keywordtype">void</span> <a class="code" href="classLine.html#d0">Line::bboxUpdate</a>()
00844       {
00845       <span class="keywordtype">double</span> w = point(<a class="code" href="classLine.html#r0">_width</a>);
00846       <span class="keywordtype">double</span> l = point(<a class="code" href="classLine.html#r1">_len</a>);
00847       <span class="keywordflow">if</span> (<a class="code" href="classLine.html#p0">vertical</a>)
00848             _bbox = QRectF(0, 0, w, l);
00849       <span class="keywordflow">else</span>
00850             _bbox = QRectF(0, 0, l, w);
00851 <span class="comment">//??      _bbox = _bbox.expand(.2 * _spatium);</span>
00852       }
00853 
00854 <span class="comment">//---------------------------------------------------------</span>
00855 <span class="comment">//   draw</span>
00856 <span class="comment">//---------------------------------------------------------</span>
00857 
<a name="l00858"></a><a class="code" href="classLine.html#a4">00858</a> <span class="keywordtype">void</span> <a class="code" href="classLine.html#a4">Line::draw1</a>(<a class="code" href="classPainter.html">Painter</a>&amp; p)<span class="keyword"> const</span>
00859 <span class="keyword">      </span>{
00860       QPointF <a class="code" href="classElement.html#a20">pos</a>(0.0, 0.0);
00861       qreal x   = pos.x();
00862       qreal y   = pos.y();
00863 
00864       QPen pen(QColor(<a class="code" href="classElement.html#a14">isSelected</a>() ? <a class="code" href="preferences_8cpp.html#a0">preferences</a>.<a class="code" href="structPreferences.html#o9">selectColor</a>[0] : Qt::black));
00865       pen.setWidthF(point(<a class="code" href="classLine.html#r0">_width</a>));
00866       p.setPen(pen);
00867       <span class="keywordflow">if</span> (<a class="code" href="classLine.html#p0">vertical</a>)
00868             p.drawLine(QLineF(x, y, x, y + point(<a class="code" href="classLine.html#r1">_len</a>)));
00869       <span class="keywordflow">else</span>
00870             p.drawLine(QLineF(x, y, x + point(_len), y));
00871       }
00872 
00873 <span class="comment">//---------------------------------------------------------</span>
00874 <span class="comment">//   writeProperties</span>
00875 <span class="comment">//---------------------------------------------------------</span>
00876 
<a name="l00877"></a><a class="code" href="classLine.html#a5">00877</a> <span class="keywordtype">void</span> <a class="code" href="classLine.html#a5">Line::writeProperties</a>(<a class="code" href="classXml.html">Xml</a>&amp; xml)<span class="keyword"> const</span>
00878 <span class="keyword">      </span>{
00879       xml.<a class="code" href="classXml.html#a14">doubleTag</a>(<span class="stringliteral">"lineWidth"</span>, <a class="code" href="classLine.html#r0">_width</a>.<a class="code" href="classSpatium.html#a3">val</a>());
00880       xml.<a class="code" href="classXml.html#a14">doubleTag</a>(<span class="stringliteral">"lineLen"</span>, <a class="code" href="classLine.html#r1">_len</a>.<a class="code" href="classSpatium.html#a3">val</a>());
00881       <span class="keywordflow">if</span> (!<a class="code" href="classLine.html#p0">vertical</a>)
00882             xml.<a class="code" href="classXml.html#a12">intTag</a>(<span class="stringliteral">"vertical"</span>, <a class="code" href="classLine.html#p0">vertical</a>);
00883       }
00884 
00885 <span class="comment">//---------------------------------------------------------</span>
00886 <span class="comment">//   readProperties</span>
00887 <span class="comment">//---------------------------------------------------------</span>
00888 
<a name="l00889"></a><a class="code" href="classLine.html#a6">00889</a> <span class="keywordtype">bool</span> <a class="code" href="classLine.html#a6">Line::readProperties</a>(QDomNode node)
00890       {
00891       QDomElement e = node.toElement();
00892       QString tag(e.tagName());
00893       QString val(e.text());
00894 
00895       <span class="keywordflow">if</span> (tag == <span class="stringliteral">"lineWidth"</span>)
00896             <a class="code" href="classLine.html#r0">_width</a> = <a class="code" href="classSpatium.html">Spatium</a>(val.toDouble());
00897       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tag == <span class="stringliteral">"lineLen"</span>)
00898             <a class="code" href="classLine.html#r1">_len</a> = Spatium(val.toDouble());
00899       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tag == <span class="stringliteral">"vertical"</span>)
00900             <a class="code" href="classLine.html#p0">vertical</a> = val.toInt();
00901       <span class="keywordflow">else</span>
00902             <span class="keywordflow">return</span> <span class="keyword">false</span>;
00903       <span class="keywordflow">return</span> <span class="keyword">true</span>;
00904       }
00905 
00906 <span class="comment">//---------------------------------------------------------</span>
00907 <span class="comment">//   Compound</span>
00908 <span class="comment">//---------------------------------------------------------</span>
00909 
<a name="l00910"></a><a class="code" href="classCompound.html#a0">00910</a> <a class="code" href="classCompound.html#a0">Compound::Compound</a>(<a class="code" href="classScore.html">Score</a>* s, ElementType t)
00911    : <a class="code" href="classElement.html">Element</a>(s, t)
00912       {
00913       }
00914 
<a name="l00915"></a><a class="code" href="classCompound.html#a1">00915</a> <a class="code" href="classCompound.html#a0">Compound::Compound</a>(<span class="keyword">const</span> <a class="code" href="classCompound.html">Compound</a>&amp; c)
00916    : <a class="code" href="classElement.html">Element</a>(c)
00917       {
00918       <span class="keywordflow">for</span> (<a class="code" href="element_8h.html#a6">ciSymbol</a> i = c.<a class="code" href="classCompound.html#r0">elemente</a>.<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); i != c.<a class="code" href="classCompound.html#r0">elemente</a>.<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++i)
00919             <a class="code" href="classCompound.html#r0">elemente</a>.<a class="code" href="classpstl_1_1plist.html#a2">push_back</a>(*i);
00920       }
00921 
00922 <span class="comment">//---------------------------------------------------------</span>
00923 <span class="comment">//   draw</span>
00924 <span class="comment">//---------------------------------------------------------</span>
00925 
<a name="l00926"></a><a class="code" href="classCompound.html#a3">00926</a> <span class="keywordtype">void</span> <a class="code" href="classCompound.html#a3">Compound::draw1</a>(<a class="code" href="classPainter.html">Painter</a>&amp; p)<span class="keyword"> const</span>
00927 <span class="keyword">      </span>{
00928       <span class="keywordflow">for</span> (<a class="code" href="element_8h.html#a6">ciSymbol</a> i = <a class="code" href="classCompound.html#r0">elemente</a>.<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); i != <a class="code" href="classCompound.html#r0">elemente</a>.<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++i)
00929             (*i)-&gt;draw(p);
00930 
00931       <span class="keywordflow">if</span> (!(<a class="code" href="classElement.html#a16">visible</a>() || <a class="code" href="element_8cpp.html#a1">showInvisible</a>) &amp;&amp; <a class="code" href="element_8cpp.html#a0">debugMode</a> &amp;&amp; <a class="code" href="classElement.html#a14">isSelected</a>()) {
00932             <span class="comment">//</span>
00933             <span class="comment">//  draw bounding box rectangle for all</span>
00934             <span class="comment">//  selected Elements</span>
00935             <span class="comment">//</span>
00936             p.setPen(QColor(Qt::green));
00937             p.setBrush(Qt::NoBrush);
00938             p.drawRect(<a class="code" href="classElement.html#a34">abbox</a>());
00939             }
00940       }
00941 
00942 <span class="comment">//---------------------------------------------------------</span>
00943 <span class="comment">//   addElement</span>
00944 <span class="comment">//---------------------------------------------------------</span>
00945 
<a name="l00946"></a><a class="code" href="classCompound.html#a4">00946</a> <span class="keywordtype">void</span> <a class="code" href="classCompound.html#a4">Compound::addElement</a>(<a class="code" href="classElement.html">Element</a>* e, <span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y)
00947       {
00948       e-&gt;<a class="code" href="classElement.html#a29">setUserOff</a>(QPointF(x, y));
00949       e-&gt;<a class="code" href="classElement.html#a11">setParent</a>(<span class="keyword">this</span>);
00950       <a class="code" href="classCompound.html#r0">elemente</a>.<a class="code" href="classpstl_1_1plist.html#a2">push_back</a>(e);
00951       _bbox |= e-&gt;<a class="code" href="classElement.html#a33">bbox</a>().translated(e-&gt;<a class="code" href="classElement.html#a20">pos</a>());;
00952       }
00953 
00954 <span class="comment">//---------------------------------------------------------</span>
00955 <span class="comment">//   setSelected</span>
00956 <span class="comment">//---------------------------------------------------------</span>
00957 
<a name="l00958"></a><a class="code" href="classCompound.html#a6">00958</a> <span class="keywordtype">void</span> <a class="code" href="classCompound.html#a6">Compound::setSelected</a>(<span class="keywordtype">bool</span> f)
00959       {
00960       Element::setSelected(f);
00961       <span class="keywordflow">for</span> (<a class="code" href="element_8h.html#a6">ciSymbol</a> i = <a class="code" href="classCompound.html#r0">elemente</a>.<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); i != <a class="code" href="classCompound.html#r0">elemente</a>.<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++i)
00962             (*i)-&gt;setSelected(f);
00963       }
00964 
00965 <span class="comment">//---------------------------------------------------------</span>
00966 <span class="comment">//   setVisible</span>
00967 <span class="comment">//---------------------------------------------------------</span>
00968 
<a name="l00969"></a><a class="code" href="classCompound.html#a7">00969</a> <span class="keywordtype">void</span> <a class="code" href="classCompound.html#a7">Compound::setVisible</a>(<span class="keywordtype">bool</span> f)
00970       {
00971       Element::setVisible(f);
00972       <span class="keywordflow">for</span> (<a class="code" href="element_8h.html#a6">ciSymbol</a> i = <a class="code" href="classCompound.html#r0">elemente</a>.<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); i != <a class="code" href="classCompound.html#r0">elemente</a>.<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++i)
00973             (*i)-&gt;setVisible(f);
00974       }
00975 
00976 <span class="comment">//---------------------------------------------------------</span>
00977 <span class="comment">//   clear</span>
00978 <span class="comment">//---------------------------------------------------------</span>
00979 
<a name="l00980"></a><a class="code" href="classCompound.html#a5">00980</a> <span class="keywordtype">void</span> <a class="code" href="classCompound.html#a5">Compound::clear</a>()
00981       {
00982       <span class="keywordflow">for</span> (<a class="code" href="element_8h.html#a6">ciSymbol</a> i = <a class="code" href="classCompound.html#r0">elemente</a>.<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); i != <a class="code" href="classCompound.html#r0">elemente</a>.<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++i)
00983             <span class="keyword">delete</span> *i;
00984       <a class="code" href="classCompound.html#r0">elemente</a>.clear();
00985       _bbox = QRectF(0.0, 0.0, 0.0, 0.0);
00986       }
00987 
00988 <span class="comment">//---------------------------------------------------------</span>
00989 <span class="comment">//   TimeSig</span>
00990 <span class="comment">//---------------------------------------------------------</span>
00991 
<a name="l00992"></a><a class="code" href="classTimeSig.html#a0">00992</a> <a class="code" href="classTimeSig.html#a0">TimeSig::TimeSig</a>(<a class="code" href="classScore.html">Score</a>* s)
00993   : <a class="code" href="classCompound.html">Compound</a>(s, <a class="code" href="element_8h.html#a65a24">TIMESIG</a>)
00994       {
00995       }
00996 
<a name="l00997"></a><a class="code" href="classTimeSig.html#a1">00997</a> <a class="code" href="classTimeSig.html#a0">TimeSig::TimeSig</a>(<a class="code" href="classScore.html">Score</a>* s, <span class="keywordtype">int</span> i)
00998   : <a class="code" href="classCompound.html">Compound</a>(s, <a class="code" href="element_8h.html#a65a24">TIMESIG</a>)
00999       {
01000       <a class="code" href="classTimeSig.html#a4">setIdx</a>(i);
01001       }
01002 
<a name="l01003"></a><a class="code" href="classTimeSig.html#a2">01003</a> <a class="code" href="classTimeSig.html#a0">TimeSig::TimeSig</a>(<span class="keyword">const</span> <a class="code" href="classTimeSig.html">TimeSig</a>&amp; t)
01004   : <a class="code" href="classCompound.html">Compound</a>(t)
01005       {
01006       <a class="code" href="classTimeSig.html#r0">val</a> = t.<a class="code" href="classTimeSig.html#r0">val</a>;
01007       <a class="code" href="classTimeSig.html#r1">_z</a>  = t.<a class="code" href="classTimeSig.html#r1">_z</a>;
01008       <a class="code" href="classTimeSig.html#r2">_n</a>  = t.<a class="code" href="classTimeSig.html#r2">_n</a>;
01009       }
01010 
01011 <span class="comment">//---------------------------------------------------------</span>
01012 <span class="comment">//   setIdx</span>
01013 <span class="comment">//---------------------------------------------------------</span>
01014 
<a name="l01015"></a><a class="code" href="classTimeSig.html#a4">01015</a> <span class="keywordtype">void</span> <a class="code" href="classTimeSig.html#a4">TimeSig::setIdx</a>(<span class="keywordtype">int</span> v)
01016       {
01017       <a class="code" href="classTimeSig.html#r0">val</a> = v;
01018       <a class="code" href="classSymbol.html">Symbol</a>* s;
01019       <span class="keywordflow">switch</span> (v) {
01020             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a67a53">TSIG_2_2</a>: <a class="code" href="classTimeSig.html#a9">setSig</a>(2,2); <span class="keywordflow">break</span>;
01021             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a67a54">TSIG_2_4</a>: <a class="code" href="classTimeSig.html#a9">setSig</a>(2,4); <span class="keywordflow">break</span>;
01022             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a67a55">TSIG_3_4</a>: <a class="code" href="classTimeSig.html#a9">setSig</a>(3,4); <span class="keywordflow">break</span>;
01023             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a67a56">TSIG_4_4</a>: <a class="code" href="classTimeSig.html#a9">setSig</a>(4,4); <span class="keywordflow">break</span>;
01024             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a67a57">TSIG_5_4</a>: <a class="code" href="classTimeSig.html#a9">setSig</a>(5,4); <span class="keywordflow">break</span>;
01025             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a67a58">TSIG_6_4</a>: <a class="code" href="classTimeSig.html#a9">setSig</a>(6,4); <span class="keywordflow">break</span>;
01026             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a67a59">TSIG_3_8</a>: <a class="code" href="classTimeSig.html#a9">setSig</a>(3,8); <span class="keywordflow">break</span>;
01027             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a67a60">TSIG_6_8</a>: <a class="code" href="classTimeSig.html#a9">setSig</a>(6,8); <span class="keywordflow">break</span>;
01028             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a67a62">TSIG_44</a>:
01029                   s = <span class="keyword">new</span> <a class="code" href="classSymbol.html">Symbol</a>(<a class="code" href="classElement.html#a4">score</a>());
01030                   s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="symbols_8cpp.html#a116">fourfourmeterSym</a>);
01031                   addElement(s, 0, 2);
01032                   <a class="code" href="classTimeSig.html#r1">_z</a> = 4;
01033                   <a class="code" href="classTimeSig.html#r2">_n</a> = 4;
01034                   <span class="keywordflow">break</span>;
01035             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a67a63">TSIG_34</a>:
01036                   s = <span class="keyword">new</span> Symbol(<a class="code" href="classElement.html#a4">score</a>());
01037                   s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="symbols_8cpp.html#a117">allabreveSym</a>);
01038                   addElement(s, 0, 2);
01039                   <a class="code" href="classTimeSig.html#r1">_z</a> = 3;
01040                   <a class="code" href="classTimeSig.html#r2">_n</a> = 4;
01041                   <span class="keywordflow">break</span>;
01042             <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a67a61">TSIG_12_8</a>:
01043                   <a class="code" href="classTimeSig.html#a9">setSig</a>(12,8); <span class="keywordflow">break</span>;
01044             <span class="keywordflow">default</span>:
01045                   <span class="keywordflow">break</span>;
01046             }
01047       }
01048 
01049 <span class="comment">//---------------------------------------------------------</span>
01050 <span class="comment">//   zn</span>
01051 <span class="comment">//---------------------------------------------------------</span>
01052 
<a name="l01053"></a><a class="code" href="classTimeSig.html#a8">01053</a> <span class="keywordtype">void</span> <a class="code" href="classTimeSig.html#a8">TimeSig::zn</a>(<span class="keywordtype">int</span>&amp; z, <span class="keywordtype">int</span>&amp; n)<span class="keyword"> const</span>
01054 <span class="keyword">      </span>{
01055       z = <a class="code" href="classTimeSig.html#r1">_z</a>;
01056       n = <a class="code" href="classTimeSig.html#r2">_n</a>;
01057       }
01058 
01059 <span class="comment">//---------------------------------------------------------</span>
01060 <span class="comment">//   setSig</span>
01061 <span class="comment">//---------------------------------------------------------</span>
01062 
<a name="l01063"></a><a class="code" href="classTimeSig.html#a9">01063</a> <span class="keywordtype">void</span> <a class="code" href="classTimeSig.html#a9">TimeSig::setSig</a>(<span class="keywordtype">int</span> z, <span class="keywordtype">int</span> n)
01064       {
01065       <a class="code" href="classTimeSig.html#r1">_z</a> = z;
01066       <a class="code" href="classTimeSig.html#r2">_n</a> = n;
01067       <a class="code" href="classSymbol.html">Symbol</a>* s  = <span class="keyword">new</span> <a class="code" href="classSymbol.html">Symbol</a>(<a class="code" href="classElement.html#a4">score</a>());
01068       <span class="keywordflow">if</span> (z &gt;= 10) {
01069             s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="structSym.html">Sym</a>(<span class="stringliteral">""</span>, <a class="code" href="style_8h.html#a45a19">TEXT_STYLE_SYMBOL1</a>, (z/10) + 0xe030));
01070             addElement(s, 0, 2.0);
01071             s  = <span class="keyword">new</span> Symbol(<a class="code" href="classElement.html#a4">score</a>());
01072             s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="structSym.html">Sym</a>(<span class="stringliteral">""</span>, <a class="code" href="style_8h.html#a45a19">TEXT_STYLE_SYMBOL1</a>, (z%10) + 0xe030));
01073             addElement(s, 1.5, 2.0);
01074             }
01075       <span class="keywordflow">else</span> {
01076             s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="structSym.html">Sym</a>(<span class="stringliteral">""</span>, <a class="code" href="style_8h.html#a45a19">TEXT_STYLE_SYMBOL1</a>, z + 0xe030));
01077             addElement(s, 0, 2.0);
01078             }
01079       s  = <span class="keyword">new</span> Symbol(<a class="code" href="classElement.html#a4">score</a>());
01080       s-&gt;<a class="code" href="classSymbol.html#a4">setSym</a>(<a class="code" href="structSym.html">Sym</a>(<span class="stringliteral">""</span>, <a class="code" href="style_8h.html#a45a19">TEXT_STYLE_SYMBOL1</a>, n + 0xe030));
01081       addElement(s, z &gt;= 10 ? 0.75 : 0, 4.0);
01082       }
01083 
01084 <span class="comment">//---------------------------------------------------------</span>
01085 <span class="comment">//   KeySig</span>
01086 <span class="comment">//---------------------------------------------------------</span>
01087 
<a name="l01088"></a><a class="code" href="classKeySig.html#a0">01088</a> <a class="code" href="classKeySig.html#a0">KeySig::KeySig</a>(<a class="code" href="classScore.html">Score</a>* s)
01089   : <a class="code" href="classCompound.html">Compound</a>(s, <a class="code" href="element_8h.html#a65a23">KEYSIG</a>)
01090       {
01091       }
01092 
<a name="l01093"></a><a class="code" href="classKeySig.html#a1">01093</a> <a class="code" href="classKeySig.html#a0">KeySig::KeySig</a>(<a class="code" href="classScore.html">Score</a>* s, <span class="keywordtype">int</span> i, <span class="keywordtype">int</span> yoffset)
01094   : <a class="code" href="classCompound.html">Compound</a>(s, <a class="code" href="element_8h.html#a65a23">KEYSIG</a>)
01095       {
01096       <a class="code" href="classKeySig.html#a4">setIdx</a>(i, yoffset);
01097       }
01098 
<a name="l01099"></a><a class="code" href="classKeySig.html#a2">01099</a> <a class="code" href="classKeySig.html#a0">KeySig::KeySig</a>(<span class="keyword">const</span> <a class="code" href="classKeySig.html">KeySig</a>&amp; t)
01100   : <a class="code" href="classCompound.html">Compound</a>(t)
01101       {
01102       <a class="code" href="classKeySig.html#r0">val</a> = t.<a class="code" href="classKeySig.html#r0">val</a>;
01103       <a class="code" href="classKeySig.html#r1">off</a> = t.<a class="code" href="classKeySig.html#r1">off</a>;
01104       }
01105 
01106 <span class="comment">//---------------------------------------------------------</span>
01107 <span class="comment">//   setIdx</span>
01108 <span class="comment">//---------------------------------------------------------</span>
01109 
<a name="l01110"></a><a class="code" href="classKeySig.html#a4">01110</a> <span class="keywordtype">void</span> <a class="code" href="classKeySig.html#a4">KeySig::setIdx</a>(<span class="keywordtype">int</span> v, <span class="keywordtype">int</span> offset)
01111       {
01112       <a class="code" href="classCompound.html#a5">clear</a>();
01113       <a class="code" href="classKeySig.html#r0">val</a> = v;
01114       <a class="code" href="classKeySig.html#r1">off</a> = offset % 10;
01115 
01116       <a class="code" href="classPrefix.html">Prefix</a>* p;
01117       <span class="keywordtype">double</span> yoff = -(<a class="code" href="classKeySig.html#r1">off</a> / 2.0);
01118       <span class="keywordflow">switch</span>(v) {
01119             <span class="keywordflow">case</span> 7:
01120                   p = <span class="keyword">new</span> <a class="code" href="classPrefix.html">Prefix</a>(<a class="code" href="classElement.html#a4">score</a>(), 1, <span class="keyword">false</span>);
01121                   addElement(p, 6.0, yoff + 2);
01122             <span class="keywordflow">case</span> 6:
01123                   p = <span class="keyword">new</span> Prefix(<a class="code" href="classElement.html#a4">score</a>(), 1, <span class="keyword">false</span>);
01124                   addElement(p, 5.0, yoff + .5);
01125             <span class="keywordflow">case</span> 5:
01126                   p = <span class="keyword">new</span> Prefix(<a class="code" href="classElement.html#a4">score</a>(), 1, <span class="keyword">false</span>);
01127                   addElement(p, 4.0, yoff + 2.5);
01128             <span class="keywordflow">case</span> 4:
01129                   p = <span class="keyword">new</span> Prefix(<a class="code" href="classElement.html#a4">score</a>(), 1, <span class="keyword">false</span>);
01130                   addElement(p, 3.0, yoff + 1);
01131             <span class="keywordflow">case</span> 3:
01132                   p = <span class="keyword">new</span> Prefix(<a class="code" href="classElement.html#a4">score</a>(), 1, <span class="keyword">false</span>);
01133                   addElement(p, 2.0, yoff - .5);
01134             <span class="keywordflow">case</span> 2:
01135                   p = <span class="keyword">new</span> Prefix(<a class="code" href="classElement.html#a4">score</a>(), 1, <span class="keyword">false</span>);
01136                   addElement(p, 1.0, yoff + 1.5);
01137             <span class="keywordflow">case</span> 1:
01138                   p = <span class="keyword">new</span> Prefix(<a class="code" href="classElement.html#a4">score</a>(), 1, <span class="keyword">false</span>);
01139                   addElement(p, 0.0, yoff);
01140                   <span class="keywordflow">break</span>;
01141             <span class="keywordflow">default</span>:
01142             <span class="keywordflow">case</span> 0:
01143                   <span class="keywordflow">return</span>;
01144             <span class="keywordflow">case</span> -7:
01145                   p = <span class="keyword">new</span> Prefix(<a class="code" href="classElement.html#a4">score</a>(), 2, <span class="keyword">false</span>);
01146                   addElement(p, 6, yoff + 3.5);
01147             <span class="keywordflow">case</span> -6:
01148                   p = <span class="keyword">new</span> Prefix(<a class="code" href="classElement.html#a4">score</a>(), 2, <span class="keyword">false</span>);
01149                   addElement(p, 5, yoff + 1.5);
01150             <span class="keywordflow">case</span> -5:
01151                   p = <span class="keyword">new</span> Prefix(<a class="code" href="classElement.html#a4">score</a>(), 2, <span class="keyword">false</span>);
01152                   addElement(p, 4, yoff + 3);
01153             <span class="keywordflow">case</span> -4:
01154                   p = <span class="keyword">new</span> Prefix(<a class="code" href="classElement.html#a4">score</a>(), 2, <span class="keyword">false</span>);
01155                   addElement(p, 3, yoff + 1);
01156             <span class="keywordflow">case</span> -3:
01157                   p = <span class="keyword">new</span> Prefix(<a class="code" href="classElement.html#a4">score</a>(), 2, <span class="keyword">false</span>);
01158                   addElement(p, 2, yoff + 2.5);
01159             <span class="keywordflow">case</span> -2:
01160                   p = <span class="keyword">new</span> Prefix(<a class="code" href="classElement.html#a4">score</a>(), 2, <span class="keyword">false</span>);
01161                   addElement(p, 1, yoff + .5);
01162             <span class="keywordflow">case</span> -1:
01163                   p = <span class="keyword">new</span> Prefix(<a class="code" href="classElement.html#a4">score</a>(), 2, <span class="keyword">false</span>);
01164                   addElement(p, 0, yoff + 2);
01165                   <span class="keywordflow">break</span>;
01166             }
01167       }
01168 
01169 <span class="comment">//---------------------------------------------------------</span>
01170 <span class="comment">//   Cursor</span>
01171 <span class="comment">//---------------------------------------------------------</span>
01172 
<a name="l01173"></a><a class="code" href="classCursor.html#a0">01173</a> <a class="code" href="classCursor.html#a0">Cursor::Cursor</a>(<a class="code" href="classScore.html">Score</a>* s, <span class="keywordtype">double</span> l)
01174    : <a class="code" href="classElement.html">Element</a>(s, <a class="code" href="element_8h.html#a65a19">CURSOR</a>)
01175       {
01176       <a class="code" href="classCursor.html#p0">dlen</a>      = l;
01177       <a class="code" href="classCursor.html#p1">lineWidth</a> = .4;
01178       <a class="code" href="classCursor.html#p2">_off</a>      = <span class="keyword">false</span>;
01179       <span class="keywordtype">double</span> w  = <a class="code" href="classCursor.html#p1">lineWidth</a> * <a class="code" href="spatium_8h.html#a0">_spatium</a>;
01180       _bbox = QRectF(-w/2, 0, <a class="code" href="classCursor.html#p1">lineWidth</a> * <a class="code" href="spatium_8h.html#a0">_spatium</a>, <a class="code" href="classCursor.html#p0">dlen</a> * <a class="code" href="spatium_8h.html#a0">_spatium</a> * 1.1);
01181       }
01182 
<a name="l01183"></a><a class="code" href="classCursor.html#a1">01183</a> <a class="code" href="classCursor.html#a0">Cursor::Cursor</a>(<span class="keyword">const</span> <a class="code" href="classCursor.html">Cursor</a>&amp; c)
01184    : <a class="code" href="classElement.html">Element</a>(c)
01185       {
01186       <a class="code" href="classCursor.html#p0">dlen</a>      = c.<a class="code" href="classCursor.html#p0">dlen</a>;
01187       <a class="code" href="classCursor.html#p1">lineWidth</a> = c.<a class="code" href="classCursor.html#p1">lineWidth</a>;
01188       <a class="code" href="classCursor.html#p2">_off</a>      = c.<a class="code" href="classCursor.html#p2">_off</a>;
01189       }
01190 
01191 <span class="comment">//---------------------------------------------------------</span>
01192 <span class="comment">//   draw</span>
01193 <span class="comment">//---------------------------------------------------------</span>
01194 
<a name="l01195"></a><a class="code" href="classCursor.html#a3">01195</a> <span class="keywordtype">void</span> <a class="code" href="classCursor.html#a3">Cursor::draw1</a>(<a class="code" href="classPainter.html">Painter</a>&amp; p)<span class="keyword"> const</span>
01196 <span class="keyword">      </span>{
01197       <span class="keywordflow">if</span> (<a class="code" href="classCursor.html#p2">_off</a>)
01198             <span class="keywordflow">return</span>;
01199 
01200       QPen pen(<a class="code" href="preferences_8cpp.html#a0">preferences</a>.<a class="code" href="structPreferences.html#o9">selectColor</a>[voice()]);
01201       pen.setWidthF(<a class="code" href="classCursor.html#p1">lineWidth</a> * <a class="code" href="spatium_8h.html#a0">_spatium</a>);
01202       p.setPen(pen);
01203 
01204       p.drawLine(QLineF(0.0, 0.0, 0.0, <a class="code" href="classCursor.html#p0">dlen</a> * <a class="code" href="spatium_8h.html#a0">_spatium</a>));
01205       }
01206 
01207 <span class="comment">//---------------------------------------------------------</span>
01208 <span class="comment">//   Lasso</span>
01209 <span class="comment">//---------------------------------------------------------</span>
01210 
<a name="l01211"></a><a class="code" href="classLasso.html#a0">01211</a> <a class="code" href="classLasso.html#a0">Lasso::Lasso</a>(<a class="code" href="classScore.html">Score</a>* s)
01212    : <a class="code" href="classElement.html">Element</a>(s, <a class="code" href="element_8h.html#a65a21">LASSO</a>)
01213       {
01214       setVisible(<span class="keyword">false</span>);
01215       }
01216 
01217 <span class="comment">//---------------------------------------------------------</span>
01218 <span class="comment">//   draw</span>
01219 <span class="comment">//---------------------------------------------------------</span>
01220 
<a name="l01221"></a><a class="code" href="classLasso.html#a3">01221</a> <span class="keywordtype">void</span> <a class="code" href="classLasso.html#a3">Lasso::draw1</a>(<a class="code" href="classPainter.html">Painter</a>&amp; p)<span class="keyword"> const</span>
01222 <span class="keyword">      </span>{
01223       p.setBrush(Qt::NoBrush);
01224       QPen pen(QColor(<a class="code" href="preferences_8cpp.html#a0">preferences</a>.<a class="code" href="structPreferences.html#o9">selectColor</a>[0]));
01225       qreal a, b;
01226       <span class="comment">// always 2 pixel width</span>
01227       p.matrix().map(2.0, 2.0, &amp;a, &amp;b);
01228       pen.setWidthF(a);
01229       p.setPen(pen);
01230       p.drawRect(_bbox);
01231       }
01232 
01233 <span class="comment">//---------------------------------------------------------</span>
01234 <span class="comment">//   dump</span>
01235 <span class="comment">//---------------------------------------------------------</span>
01236 
<a name="l01237"></a><a class="code" href="classElement.html#a68">01237</a> <span class="keywordtype">void</span> <a class="code" href="classElement.html#a68">Element::dump</a>()<span class="keyword"> const</span>
01238 <span class="keyword">      </span>{
01239       printf(<span class="stringliteral">"---Element type %s, pos(%4.2f,%4.2f)\n"</span>
01240          <span class="stringliteral">"   bbox(%g,%g,%g,%g)\n"</span>
01241          <span class="stringliteral">"   abox(%g,%g,%g,%g)\n"</span>
01242          <span class="stringliteral">"  parent: %p\n"</span>,
01243          <a class="code" href="element_8cpp.html#a2">elementNames</a>[<a class="code" href="classElement.html#r7">_type</a>], <a class="code" href="classElement.html#p1">_pos</a>.x(), <a class="code" href="classElement.html#p1">_pos</a>.y(),
01244          <a class="code" href="classElement.html#p3">_bbox</a>.x(), <a class="code" href="classElement.html#p3">_bbox</a>.y(), <a class="code" href="classElement.html#p3">_bbox</a>.width(), <a class="code" href="classElement.html#p3">_bbox</a>.height(),
01245          <a class="code" href="classElement.html#a34">abbox</a>().x(), <a class="code" href="classElement.html#a34">abbox</a>().y(), <a class="code" href="classElement.html#a34">abbox</a>().width(), <a class="code" href="classElement.html#a34">abbox</a>().height(),
01246          <a class="code" href="classElement.html#a10">parent</a>());
01247       }
01248 
01249 <span class="comment">//---------------------------------------------------------</span>
01250 <span class="comment">//   dumpPos</span>
01251 <span class="comment">//---------------------------------------------------------</span>
01252 
01253 <span class="preprocessor">#if 0</span>
01254 <span class="preprocessor"></span><span class="keywordtype">void</span> Element::dumpPos(<span class="keyword">const</span> <span class="keywordtype">char</span>* s)<span class="keyword"> const</span>
01255 <span class="keyword">      </span>{
01256       printf(<span class="stringliteral">"%s: dumpPos %s %4.1f-%4.1f  apos %4.1f-%4.1f\n"</span>
01257              <span class="stringliteral">"  abbox %g %g %g %g\n"</span>
01258              <span class="stringliteral">"  bbox  %g %g %g %g\n"</span>,
01259          s, <a class="code" href="classElement.html#a69">name</a>(), <a class="code" href="classElement.html#a20">pos</a>().<a class="code" href="classElement.html#a21">x</a>(), <a class="code" href="classElement.html#a20">pos</a>().<a class="code" href="classElement.html#a22">y</a>(), <a class="code" href="classElement.html#a35">apos</a>().<a class="code" href="classElement.html#a21">x</a>(), <a class="code" href="classElement.html#a35">apos</a>().<a class="code" href="classElement.html#a22">y</a>(),
01260             <a class="code" href="classElement.html#a34">abbox</a>().<a class="code" href="classElement.html#a21">x</a>(), <a class="code" href="classElement.html#a34">abbox</a>().<a class="code" href="classElement.html#a22">y</a>(), <a class="code" href="classElement.html#a34">abbox</a>().<a class="code" href="classElement.html#a37">width</a>(), <a class="code" href="classElement.html#a34">abbox</a>().<a class="code" href="classElement.html#a36">height</a>(),
01261             <a class="code" href="classElement.html#a33">bbox</a>().<a class="code" href="classElement.html#a21">x</a>(), <a class="code" href="classElement.html#a33">bbox</a>().<a class="code" href="classElement.html#a22">y</a>(), <a class="code" href="classElement.html#a33">bbox</a>().<a class="code" href="classElement.html#a37">width</a>(), <a class="code" href="classElement.html#a33">bbox</a>().<a class="code" href="classElement.html#a36">height</a>()
01262       );
01263 
01264       <span class="keywordflow">for</span> (<a class="code" href="classElement.html">Element</a>* e = _parent; e; e = e-&gt;<a class="code" href="classElement.html#a10">parent</a>()) {
01265             QPointF <a class="code" href="dynamics_8cpp.html#a0">pp</a>(e-&gt;<a class="code" href="classElement.html#a20">pos</a>());
01266             QPointF pa(e-&gt;<a class="code" href="classElement.html#a35">apos</a>());
01267             printf(<span class="stringliteral">"   %s %4.1f-%4.1f  apos %4.1f:%4.1f\n"</span>,
01268                e-&gt;<a class="code" href="classElement.html#a69">name</a>(), pp.x(), pp.y(), pa.x(), pa.y());
01269             }
01270       }
01271 <span class="preprocessor">#endif</span>
01272 <span class="preprocessor"></span>
01273 <span class="comment">//---------------------------------------------------------</span>
01274 <span class="comment">//   RubberBand::draw</span>
01275 <span class="comment">//---------------------------------------------------------</span>
01276 
<a name="l01277"></a><a class="code" href="classRubberBand.html#a3">01277</a> <span class="keywordtype">void</span> <a class="code" href="classRubberBand.html#a3">RubberBand::draw</a>(<a class="code" href="classPainter.html">Painter</a>&amp; p)<span class="keyword"> const</span>
01278 <span class="keyword">      </span>{
01279       <span class="keywordflow">if</span> (!<a class="code" href="project_8cpp.html#a8">showRubberBand</a>)
01280             <span class="keywordflow">return</span>;
01281       p.setPen(Qt::red);
01282       p.drawLine(QLineF(<a class="code" href="classRubberBand.html#r0">_p1</a>, <a class="code" href="classRubberBand.html#r1">_p2</a>));
01283       }
01284 
01285 <span class="comment">//---------------------------------------------------------</span>
01286 <span class="comment">//   VSpacer</span>
01287 <span class="comment">//---------------------------------------------------------</span>
01288 
<a name="l01289"></a><a class="code" href="classVSpacer.html#a0">01289</a> <a class="code" href="classVSpacer.html#a0">VSpacer::VSpacer</a>(<a class="code" href="classScore.html">Score</a>* s, <span class="keywordtype">double</span> h)
01290    : <a class="code" href="classElement.html">Element</a>(s, <a class="code" href="element_8h.html#a65a43">VSPACER</a>)
01291       {
01292       <a class="code" href="classVSpacer.html#p0">height</a> = h;
01293       <span class="keywordtype">double</span> w = .5 * <a class="code" href="spatium_8h.html#a0">_spatium</a>;
01294       _bbox = QRectF(-w, 0, 2*w, <a class="code" href="classVSpacer.html#p0">height</a>);
01295       }
01296 
<a name="l01297"></a><a class="code" href="classVSpacer.html#a1">01297</a> <a class="code" href="classVSpacer.html#a0">VSpacer::VSpacer</a>(<span class="keyword">const</span> <a class="code" href="classVSpacer.html">VSpacer</a>&amp; c)
01298    : <a class="code" href="classElement.html">Element</a>(c)
01299       {
01300       <a class="code" href="classVSpacer.html#p0">height</a> = c.<a class="code" href="classVSpacer.html#p0">height</a>;
01301       }
01302 
01303 <span class="comment">//---------------------------------------------------------</span>
01304 <span class="comment">//   draw</span>
01305 <span class="comment">//---------------------------------------------------------</span>
01306 
<a name="l01307"></a><a class="code" href="classVSpacer.html#a3">01307</a> <span class="keywordtype">void</span> <a class="code" href="classVSpacer.html#a3">VSpacer::draw1</a>(<a class="code" href="classPainter.html">Painter</a>&amp;)<span class="keyword"> const</span>
01308 <span class="keyword">      </span>{
01309 <span class="comment">//      int lw       = lrint(.5 * tf-&gt;mag() * _spatium);</span>
01310 <span class="comment">//      int len      = lrint(height * tf-&gt;mag() * _spatium);</span>
01311 <span class="comment">//      QPoint _pos  = tf-&gt;fpos2ipoint(QPointF(0, 0));</span>
01312 
01313 <span class="comment">//      p.setPen(QPen(QColor(Qt::blue), lw));</span>
01314 <span class="comment">//TODO      p.drawLine(_pos.x(), _pos.y(), _pos.x(), _pos.y() + height);</span>
01315       }
01316 
01317 <span class="comment">//---------------------------------------------------------</span>
01318 <span class="comment">//   space</span>
01319 <span class="comment">//---------------------------------------------------------</span>
01320 
<a name="l01321"></a><a class="code" href="classElement.html#a78">01321</a> <span class="keywordtype">void</span> <a class="code" href="classElement.html#a78">Element::space</a>(<span class="keywordtype">double</span>&amp; min, <span class="keywordtype">double</span>&amp; extra)<span class="keyword"> const</span>
01322 <span class="keyword">      </span>{
01323       min   = 0.0;
01324       extra = <a class="code" href="classElement.html#a37">width</a>();
01325       }
01326 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Mon Jun 27 22:28:28 2005 for MuseScore by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
