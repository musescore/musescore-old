<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>MuseScore: cmd.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>cmd.cpp</h1><a href="cmd_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">//=========================================================</span>
00002 <span class="comment">//  MuseScore</span>
00003 <span class="comment">//  Linux Music Score Editor</span>
00004 <span class="comment">//  $Id: cmd.cpp,v 1.44 2005/06/26 19:00:30 wschweer Exp $</span>
00005 <span class="comment">//</span>
00006 <span class="comment">//  (C) Copyright 2002-2004 Werner Schweer (ws@seh.de)</span>
00007 <span class="comment">//=========================================================</span>
00008 
00009 <span class="preprocessor">#include "<a class="code" href="project_8h.html">project.h</a>"</span>
00010 <span class="preprocessor">#include "<a class="code" href="utils_8h.html">utils.h</a>"</span>
00011 <span class="preprocessor">#include "<a class="code" href="key_8h.html">key.h</a>"</span>
00012 <span class="preprocessor">#include "<a class="code" href="clef_8h.html">clef.h</a>"</span>
00013 <span class="preprocessor">#include "<a class="code" href="navigate_8h.html">navigate.h</a>"</span>
00014 <span class="preprocessor">#include "<a class="code" href="canvas_8h.html">canvas.h</a>"</span>
00015 <span class="comment">// #include "undo.h"</span>
00016 <span class="comment">// #include "element.h"</span>
00017 <span class="preprocessor">#include "<a class="code" href="slur_8h.html">slur.h</a>"</span>
00018 <span class="preprocessor">#include "<a class="code" href="note_8h.html">note.h</a>"</span>
00019 <span class="preprocessor">#include "<a class="code" href="segment_8h.html">segment.h</a>"</span>
00020 <span class="comment">// #include "input.h"</span>
00021 <span class="preprocessor">#include "<a class="code" href="text_8h.html">text.h</a>"</span>
00022 <span class="preprocessor">#include "<a class="code" href="sig_8h.html">sig.h</a>"</span>
00023 <span class="preprocessor">#include "<a class="code" href="padstate_8h.html">padstate.h</a>"</span>
00024 <span class="preprocessor">#include "<a class="code" href="staff_8h.html">staff.h</a>"</span>
00025 <span class="preprocessor">#include "<a class="code" href="part_8h.html">part.h</a>"</span>
00026 <span class="preprocessor">#include "<a class="code" href="style_8h.html">style.h</a>"</span>
00027 
00028 <span class="comment">//---------------------------------------------------------</span>
00029 <span class="comment">//   startCmd</span>
00030 <span class="comment">//---------------------------------------------------------</span>
00031 
<a name="l00032"></a><a class="code" href="classScore.html#a83">00032</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#a83">Score::startCmd</a>()
00033       {
00034 <span class="comment">// printf("startCmd\n");</span>
00035       <a class="code" href="classScore.html#r1">refresh</a> = QRectF(0.0,0.0,0.0,0.0);
00036       <a class="code" href="classScore.html#r3">updateAll</a> = <span class="keyword">false</span>;
00037       <a class="code" href="classScore.html#a31">startUndo</a>();
00038       }
00039 
00040 <span class="comment">//---------------------------------------------------------</span>
00041 <span class="comment">//   endCmd</span>
00042 <span class="comment">//---------------------------------------------------------</span>
00043 
<a name="l00044"></a><a class="code" href="classScore.html#a84">00044</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#a84">Score::endCmd</a>(<span class="keywordtype">bool</span> undo)
00045       {
00046       <span class="keywordflow">if</span> (undo)
00047             <a class="code" href="classScore.html#a32">endUndo</a>();
00048       <span class="keywordflow">if</span> (<a class="code" href="classScore.html#r3">updateAll</a>) {
00049 <span class="comment">// printf("updateAll\n");</span>
00050             <span class="keywordflow">for</span> (std::list&lt;Viewer*&gt;::iterator i = <a class="code" href="classScore.html#r5">viewer</a>.begin(); i != <a class="code" href="classScore.html#r5">viewer</a>.end(); ++i) {
00051                   (*i)-&gt;updateAll(<span class="keyword">this</span>);
00052                   }
00053             <a class="code" href="classScore.html#r3">updateAll</a> = <span class="keyword">false</span>;
00054             }
00055       <span class="keywordflow">else</span> {
00056             <span class="keywordflow">for</span> (std::list&lt;Viewer*&gt;::iterator i = <a class="code" href="classScore.html#r5">viewer</a>.begin(); i != <a class="code" href="classScore.html#r5">viewer</a>.end(); ++i)
00057                   (*i)-&gt;dataChanged(<span class="keyword">this</span>, <a class="code" href="classScore.html#r1">refresh</a>);
00058             }
00059       <a class="code" href="classScore.html#a82">setPadState</a>();
00060 <span class="comment">// printf("endCmd %d\n", undo);</span>
00061       }
00062 
00063 <span class="comment">//---------------------------------------------------------</span>
00064 <span class="comment">//   cmdAddPitch</span>
00065 <span class="comment">//---------------------------------------------------------</span>
00066 
<a name="l00067"></a><a class="code" href="classScore.html#i16">00067</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#i16">Score::cmdAddPitch</a>(<span class="keywordtype">int</span> val)
00068       {
00069       <span class="comment">//                        a   b   c   d   e   f   g</span>
00070       <span class="keyword">static</span> <span class="keywordtype">int</span> offsets[] = {  9, 11,  0,  2,  4,  5,  7 };
00071 
00072       <a class="code" href="classNote.html">Note</a>* on = <a class="code" href="classScore.html#d9">getSelectedNote</a>();
00073       <span class="keywordflow">if</span> (on == 0)
00074             <span class="keywordflow">return</span>;
00075 
00076       <a class="code" href="classScore.html#a83">startCmd</a>();
00077       <a class="code" href="classScore.html#a98">setNoteEntry</a>(<span class="keyword">true</span>, <span class="keyword">true</span>);
00078       <span class="keywordtype">int</span> pitch  = on-&gt;<a class="code" href="classNote.html#a15">pitch</a>();
00079       <span class="keywordtype">int</span> octave = pitch / 12;
00080       <span class="keywordtype">int</span> ooff   = pitch % 12;
00081       <span class="keywordtype">int</span> noff   = offsets[val];
00082       <span class="keywordtype">int</span> diff   = noff - ooff;
00083       <span class="keywordflow">if</span> (diff &gt; 6)
00084             --octave;
00085       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (diff &lt; -6)
00086             ++octave;
00087       pitch  = octave * 12 + noff;
00088       <span class="keywordflow">if</span> (pitch &gt; 127)
00089             pitch = 127;
00090       <span class="keywordflow">if</span> (pitch &lt; 0)
00091             pitch = 0;
00092       <a class="code" href="classNote.html">Note</a>* n    = <a class="code" href="classScore.html#a68">addNote</a>(on-&gt;<a class="code" href="classNote.html#a37">chord</a>(), pitch);
00093       <a class="code" href="classScore.html#a47">select</a>(n, 0, 0);
00094       <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o6">pitch</a> = n-&gt;<a class="code" href="classNote.html#a15">pitch</a>();
00095       <a class="code" href="classScore.html#a84">endCmd</a>(<span class="keyword">true</span>);
00096       }
00097 
00098 <span class="comment">//---------------------------------------------------------</span>
00099 <span class="comment">//   cmdAddIntervall</span>
00100 <span class="comment">//---------------------------------------------------------</span>
00101 
<a name="l00102"></a><a class="code" href="classScore.html#i17">00102</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#i17">Score::cmdAddIntervall</a>(<span class="keywordtype">int</span> val)
00103       {
00104       <a class="code" href="classNote.html">Note</a>* on = <a class="code" href="classScore.html#d9">getSelectedNote</a>();
00105       <span class="keywordflow">if</span> (on == 0)
00106             <span class="keywordflow">return</span>;
00107 
00108       <a class="code" href="classScore.html#a83">startCmd</a>();
00109       <a class="code" href="classScore.html#a98">setNoteEntry</a>(<span class="keyword">true</span>, <span class="keyword">true</span>);
00110       <span class="keywordtype">int</span> pitch = on-&gt;<a class="code" href="classNote.html#a15">pitch</a>();
00111       <span class="keywordflow">switch</span>(val) {
00112             <span class="keywordflow">case</span> 1:   <span class="keywordflow">break</span>;
00113             <span class="keywordflow">case</span> 2:   pitch += 2;  <span class="keywordflow">break</span>;
00114             <span class="keywordflow">case</span> 3:   pitch += 4;  <span class="keywordflow">break</span>;
00115             <span class="keywordflow">case</span> 4:   pitch += 5;  <span class="keywordflow">break</span>;
00116             <span class="keywordflow">case</span> 5:   pitch += 7;  <span class="keywordflow">break</span>;
00117             <span class="keywordflow">case</span> 6:   pitch += 9;  <span class="keywordflow">break</span>;
00118             <span class="keywordflow">case</span> 7:   pitch += 11; <span class="keywordflow">break</span>;
00119             <span class="keywordflow">case</span> 8:   pitch += 12; <span class="keywordflow">break</span>;
00120             <span class="keywordflow">case</span> 9:   pitch += 14; <span class="keywordflow">break</span>;
00121             <span class="keywordflow">case</span> 12:  pitch -= 2;  <span class="keywordflow">break</span>;
00122             <span class="keywordflow">case</span> 13:  pitch -= 4;  <span class="keywordflow">break</span>;
00123             <span class="keywordflow">case</span> 14:  pitch -= 5;  <span class="keywordflow">break</span>;
00124             <span class="keywordflow">case</span> 15:  pitch -= 7;  <span class="keywordflow">break</span>;
00125             <span class="keywordflow">case</span> 16:  pitch -= 9;  <span class="keywordflow">break</span>;
00126             <span class="keywordflow">case</span> 17:  pitch -= 11; <span class="keywordflow">break</span>;
00127             <span class="keywordflow">case</span> 18:  pitch -= 12; <span class="keywordflow">break</span>;
00128             <span class="keywordflow">case</span> 19:  pitch -= 14; <span class="keywordflow">break</span>;
00129             <span class="keywordflow">default</span>:
00130                   printf(<span class="stringliteral">"cmdAddIntervall: unknown idx %d\n"</span>, val);
00131                   abort();
00132             }
00133       <span class="keywordflow">if</span> (pitch &gt; 127)
00134             pitch = 127;
00135       <span class="keywordflow">if</span> (pitch &lt; 0)
00136             pitch = 0;
00137       <a class="code" href="classNote.html">Note</a>* n = <a class="code" href="classScore.html#a68">addNote</a>(on-&gt;<a class="code" href="classNote.html#a37">chord</a>(), pitch);
00138       <a class="code" href="classScore.html#a47">select</a>(n, 0, 0);
00139       <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o6">pitch</a> = n-&gt;<a class="code" href="classNote.html#a15">pitch</a>();
00140       <a class="code" href="classScore.html#a84">endCmd</a>(<span class="keyword">true</span>);
00141       }
00142 
00143 <span class="comment">//---------------------------------------------------------</span>
00144 <span class="comment">//   setNote</span>
00145 <span class="comment">//    set note (pitch, len) at position tick/staff/voice</span>
00146 <span class="comment">//---------------------------------------------------------</span>
00147 
<a name="l00148"></a><a class="code" href="classScore.html#a41">00148</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#a41">Score::setNote</a>(<span class="keywordtype">int</span> tick, <a class="code" href="classStaff.html">Staff</a>* staff, <span class="keywordtype">int</span> voice, <span class="keywordtype">int</span> pitch, <span class="keywordtype">int</span> len)
00149       {
00150       <span class="keywordtype">bool</span> addTie = <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o8">tie</a>;
00151 
00152       <span class="keywordtype">int</span> staffIdx = <a class="code" href="classScore.html#r17">_staves</a>-&gt;<a class="code" href="classStaffList.html#a1">idx</a>(staff);
00153       <span class="keywordtype">int</span> track = staffIdx * <a class="code" href="globals_8h.html#a3">VOICES</a> + voice;
00154       <a class="code" href="classTie.html">Tie</a>* tie  = 0;
00155       <a class="code" href="classNote.html">Note</a>* note = 0;
00156       <span class="keywordflow">while</span> (len) {
00157             <span class="keywordtype">int</span> stick = tick;
00158             <a class="code" href="classMeasure.html">Measure</a>* measure = <a class="code" href="undo_8cpp.html#a3">tick2measure</a>(stick);
00159             <span class="keywordflow">if</span> (measure == 0) {
00160                   printf(<span class="stringliteral">"setNote:  ...measure not found\n"</span>);
00161                   <span class="keywordflow">return</span>;
00162                   }
00163             <a class="code" href="classSegment.html">Segment</a>* segment = measure-&gt;<a class="code" href="classMeasure.html#a28">first</a>();
00164             <span class="keywordtype">int</span> noteLen      = 0;
00165             <span class="keywordflow">while</span> (segment) {
00166                   <span class="keywordflow">for</span> (; segment; segment = segment-&gt;<a class="code" href="classSegment.html#a4">next</a>()) {
00167                         <span class="keywordflow">if</span> (segment-&gt;<a class="code" href="classElement.html#a74">tick</a>() &gt;= stick)
00168                               <span class="keywordflow">break</span>;
00169                         }
00170                   <span class="keywordflow">if</span> (segment == 0 || segment-&gt;<a class="code" href="classElement.html#a74">tick</a>() != stick) {
00171                         <a class="code" href="classSegment.html">Segment</a>* newSegment = <span class="keyword">new</span> <a class="code" href="classSegment.html">Segment</a>(measure, stick);
00172                         newSegment-&gt;<a class="code" href="classSegment.html#a19">setType</a>(Segment::SegChordRest);
00173                         measure-&gt;<a class="code" href="classMeasure.html#a61">insert</a>(newSegment, segment);
00174                         segment = newSegment;
00175                         }
00176                   <a class="code" href="classElement.html">Element</a>* element = segment-&gt;<a class="code" href="classSegment.html#a8">element</a>(track);
00177                   <span class="keywordtype">int</span> l = 0;
00178                   <span class="keywordflow">if</span> (element &amp;&amp; element-&gt;<a class="code" href="classElement.html#a42">isChordRest</a>()) {
00179                         l = ((<a class="code" href="classChordRest.html">ChordRest</a>*)element)-&gt;tickLen();
00180                         segment-&gt;<a class="code" href="classSegment.html#a10">setElement</a>(track, 0);
00181                         <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::RemoveObject, element);
00182                         }
00183                   segment = segment-&gt;<a class="code" href="classSegment.html#a4">next</a>();
00184                   <span class="keywordflow">if</span> (l == 0) {
00185                         <span class="keywordflow">if</span> (segment == 0)
00186                               l = measure-&gt;<a class="code" href="classElement.html#a74">tick</a>() + measure-&gt;<a class="code" href="classMeasure.html#a26">tickLen</a>() - stick;
00187                         <span class="keywordflow">else</span>
00188                               l = segment-&gt;<a class="code" href="classElement.html#a74">tick</a>() - stick;
00189                         }
00190                   len     -= l;
00191                   noteLen += l;
00192                   stick   += l;
00193                   <span class="keywordflow">if</span> (len &lt;= 0)
00194                         <span class="keywordflow">break</span>;
00195                   }
00196             <span class="keywordflow">if</span> (len &lt; 0)
00197                   noteLen += len;
00198 
00199             note = <span class="keyword">new</span> <a class="code" href="classNote.html">Note</a>(<span class="keyword">this</span>, pitch, <span class="keyword">false</span>);
00200             note-&gt;<a class="code" href="classElement.html#a61">setStaff</a>(staff);
00201 
00202             <span class="keywordflow">if</span> (tie) {
00203                   tie-&gt;<a class="code" href="classTie.html#a4">setEndNote</a>(note);
00204                   note-&gt;<a class="code" href="classNote.html#a36">setTieBack</a>(tie);
00205                   }
00206             <a class="code" href="classChord.html">Chord</a>* chord = <span class="keyword">new</span> <a class="code" href="classChord.html">Chord</a>(<span class="keyword">this</span>, tick);
00207             chord-&gt;<a class="code" href="classElement.html#a63">setVoice</a>(voice);
00208             chord-&gt;<a class="code" href="classElement.html#a61">setStaff</a>(staff);
00209             chord-&gt;<a class="code" href="classChord.html#a28">add</a>(note);
00210             chord-&gt;<a class="code" href="classElement.html#a77">setTickLen</a>(noteLen);
00211             note-&gt;<a class="code" href="classNote.html#a8">setTicks</a>(noteLen);
00212             measure-&gt;<a class="code" href="classMeasure.html#a8">add</a>(chord);
00213             measure-&gt;<a class="code" href="classMeasure.html#a59">layoutNoteHeads</a>(staffIdx);
00214             <a class="code" href="classScore.html#a47">select</a>(note, 0, 0);
00215 
00216             <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::AddObject, chord);
00217             tick += noteLen;
00218 
00219             <span class="keywordflow">if</span> (len &lt; 0) {
00220                   <span class="keywordflow">if</span> (voice == 0) {
00221                         <span class="comment">// only for first voice: fill with rest</span>
00222                         <a class="code" href="classScore.html#a44">setRest</a>(tick, -len, staffIdx, voice, measure);
00223                         }
00224                   }
00225             <span class="keywordflow">if</span> (len &lt;= 0)
00226                   <span class="keywordflow">break</span>;
00227             <span class="comment">//</span>
00228             <span class="comment">//  Note does not fit on current measure, create Tie to</span>
00229             <span class="comment">//  next part of note</span>
00230             tie = <span class="keyword">new</span> <a class="code" href="classTie.html">Tie</a>(<span class="keyword">this</span>);
00231             tie-&gt;<a class="code" href="classTie.html#a3">setStartNote</a>(note);
00232             tie-&gt;<a class="code" href="classElement.html#a61">setStaff</a>(note-&gt;<a class="code" href="classElement.html#a59">staff</a>());
00233             note-&gt;<a class="code" href="classNote.html#a35">setTieFor</a>(tie);
00234             }
00235       <span class="keywordflow">if</span> (note &amp;&amp; addTie) {
00236             tie = <span class="keyword">new</span> <a class="code" href="classTie.html">Tie</a>(<span class="keyword">this</span>);
00237             tie-&gt;<a class="code" href="classTie.html#a3">setStartNote</a>(note);
00238             tie-&gt;<a class="code" href="classElement.html#a61">setStaff</a>(note-&gt;<a class="code" href="classElement.html#a59">staff</a>());
00239             note-&gt;<a class="code" href="classNote.html#a35">setTieFor</a>(tie);
00240             }
00241       <a class="code" href="classScore.html#a99">connectTies</a>();
00242       <a class="code" href="classScore.html#a49">layout</a>();
00243       }
00244 
00245 <span class="comment">//---------------------------------------------------------</span>
00246 <span class="comment">//   setRest</span>
00247 <span class="comment">//    set rest(len) at position tick/staff</span>
00248 <span class="comment">//---------------------------------------------------------</span>
00249 
<a name="l00250"></a><a class="code" href="classScore.html#a45">00250</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#a44">Score::setRest</a>(<span class="keywordtype">int</span> tick, <span class="keywordtype">int</span> staff, <span class="keywordtype">int</span> voice, <span class="keywordtype">int</span> len)
00251       {
00252       <span class="keywordtype">int</span> track = staff * <a class="code" href="globals_8h.html#a3">VOICES</a> + voice;
00253       <span class="keywordtype">int</span> stick = tick;
00254       <a class="code" href="classMeasure.html">Measure</a>* measure = <a class="code" href="undo_8cpp.html#a3">tick2measure</a>(stick);
00255       <span class="keywordflow">if</span> (measure == 0) {
00256             printf(<span class="stringliteral">"setRest:  ...measure not found\n"</span>);
00257             <span class="keywordflow">return</span>;
00258             }
00259       <a class="code" href="classSegment.html">Segment</a>* segment = measure-&gt;<a class="code" href="classMeasure.html#a28">first</a>();
00260       <span class="keywordtype">int</span> noteLen      = 0;
00261       <span class="keywordflow">while</span> (segment) {
00262             <span class="keywordflow">for</span> (; segment; segment = segment-&gt;<a class="code" href="classSegment.html#a4">next</a>()) {
00263                   <span class="keywordflow">if</span> (segment-&gt;<a class="code" href="classElement.html#a74">tick</a>() &gt;= stick)
00264                         <span class="keywordflow">break</span>;
00265                   }
00266             <span class="keywordflow">if</span> (segment == 0 || segment-&gt;<a class="code" href="classElement.html#a74">tick</a>() != stick) {
00267                   printf(<span class="stringliteral">"setRest: ..no segment at tick %d found\n"</span>, stick);
00268                   <span class="keywordflow">return</span>;
00269                   }
00270             <a class="code" href="classElement.html">Element</a>* element = segment-&gt;<a class="code" href="classSegment.html#a8">element</a>(track);
00271             <span class="keywordtype">int</span> l = 0;
00272             <span class="keywordflow">if</span> (element &amp;&amp; element-&gt;<a class="code" href="classElement.html#a42">isChordRest</a>()) {
00273                   l = ((<a class="code" href="classChordRest.html">ChordRest</a>*)element)-&gt;tickLen();
00274                   segment-&gt;<a class="code" href="classSegment.html#a10">setElement</a>(track, 0);
00275                   <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::RemoveObject, element);
00276                   }
00277             segment = segment-&gt;<a class="code" href="classSegment.html#a4">next</a>();
00278             <span class="keywordflow">if</span> (l == 0) {
00279                   <span class="keywordflow">if</span> (segment == 0)
00280                         l = measure-&gt;<a class="code" href="classElement.html#a74">tick</a>() + measure-&gt;<a class="code" href="classMeasure.html#a26">tickLen</a>() - stick;
00281                   <span class="keywordflow">else</span>
00282                         l = segment-&gt;<a class="code" href="classElement.html#a74">tick</a>() - stick;
00283                   }
00284             noteLen += l;
00285             stick   += l;
00286             <span class="keywordflow">if</span> (noteLen &gt;= len)     <span class="comment">// collected enough time?</span>
00287                   <span class="keywordflow">break</span>;
00288             }
00289       <span class="keywordflow">if</span> (noteLen &lt; len)
00290             printf(<span class="stringliteral">"setRest: cannot find segment! rest: %d\n"</span>, len - noteLen);
00291 
00292       <a class="code" href="classRest.html">Rest</a>* rest = <a class="code" href="classScore.html#a44">setRest</a>(tick, len, staff, voice, measure);
00293       <a class="code" href="classScore.html#a47">select</a>(rest, 0, 0);
00294       <span class="keywordflow">if</span> (noteLen - len &gt; 0) {
00295             setRest(tick + len, noteLen - len, staff, voice, measure);
00296             }
00297       <a class="code" href="classScore.html#a49">layout</a>();
00298       }
00299 
00300 <span class="comment">//---------------------------------------------------------</span>
00301 <span class="comment">//   cmdAddText</span>
00302 <span class="comment">//---------------------------------------------------------</span>
00303 
<a name="l00304"></a><a class="code" href="classScore.html#a55">00304</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#a55">Score::cmdAddText</a>(<span class="keywordtype">int</span> style)
00305       {
00306       <a class="code" href="classPage.html">Page</a>* page = <a class="code" href="classScore.html#o12">pages</a>-&gt;<a class="code" href="classpstl_1_1plist.html#a12">front</a>();
00307       <a class="code" href="classSystemList.html">SystemList</a>* sl = page-&gt;<a class="code" href="classPage.html#a4">systems</a>();
00308       <span class="keywordflow">if</span> (sl == 0 || sl-&gt;empty()) {
00309             printf(<span class="stringliteral">"first create measure, then repeat operation\n"</span>);
00310             <span class="keywordflow">return</span>;
00311             }
00312       <a class="code" href="classMeasureList.html">MeasureList</a>* ml = sl-&gt;<a class="code" href="classpstl_1_1plist.html#a12">front</a>()-&gt;<a class="code" href="classSystem.html#a10">measures</a>();
00313       <span class="keywordflow">if</span> (ml == 0 || ml-&gt;empty()) {
00314             printf(<span class="stringliteral">"first create measure, then repeat operation\n"</span>);
00315             <span class="keywordflow">return</span>;
00316             }
00317       <a class="code" href="classMeasure.html">Measure</a>* measure = ml-&gt;<a class="code" href="classpstl_1_1plist.html#a12">front</a>();
00318 
00319       <a class="code" href="classSText.html">SText</a>* s = <span class="keyword">new</span> <a class="code" href="classSText.html">SText</a>(<span class="keyword">this</span>, <a class="code" href="element_8h.html#a65a8">TEXT</a>, <a class="code" href="style_8cpp.html#a1">style</a>);
00320       s-&gt;<a class="code" href="classSText.html#a5">setText</a>(<a class="code" href="style_8cpp.html#a3">textStyles</a>[<a class="code" href="style_8cpp.html#a1">style</a>].name);
00321 
00322       <a class="code" href="classScore.html#a83">startCmd</a>();
00323       <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::AddObject, s);
00324       measure-&gt;<a class="code" href="classMeasure.html#a8">add</a>(s);
00325       page-&gt;<a class="code" href="classPage.html#a16">add</a>(s);
00326       <a class="code" href="classScore.html#a49">layout</a>();
00327 
00328       <a class="code" href="classScore.html#a47">select</a>(s, 0, 0);
00329       <a class="code" href="classScore.html#a46">canvas</a>()-&gt;<a class="code" href="classCanvas.html#a15">startEdit</a>(s);
00330       }
00331 
00332 <span class="comment">//---------------------------------------------------------</span>
00333 <span class="comment">//   cmdAddTitle</span>
00334 <span class="comment">//---------------------------------------------------------</span>
00335 
<a name="l00336"></a><a class="code" href="classScore.html#i1">00336</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#i1">Score::cmdAddTitle</a>()
00337       {
00338       <a class="code" href="classScore.html#a55">cmdAddText</a>(<a class="code" href="style_8h.html#a45a21">TEXT_STYLE_TITLE</a>);
00339       }
00340 
00341 <span class="comment">//---------------------------------------------------------</span>
00342 <span class="comment">//   cmdAddSubtitle</span>
00343 <span class="comment">//---------------------------------------------------------</span>
00344 
<a name="l00345"></a><a class="code" href="classScore.html#i2">00345</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#i2">Score::cmdAddSubTitle</a>()
00346       {
00347       <a class="code" href="classScore.html#a55">cmdAddText</a>(<a class="code" href="style_8h.html#a45a22">TEXT_STYLE_SUBTITLE</a>);
00348       }
00349 
00350 <span class="comment">//---------------------------------------------------------</span>
00351 <span class="comment">//   cmdAddComposer</span>
00352 <span class="comment">//---------------------------------------------------------</span>
00353 
<a name="l00354"></a><a class="code" href="classScore.html#i3">00354</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#i3">Score::cmdAddComposer</a>()
00355       {
00356       <a class="code" href="classScore.html#a55">cmdAddText</a>(<a class="code" href="style_8h.html#a45a23">TEXT_STYLE_COMPOSER</a>);
00357       }
00358 
00359 <span class="comment">//---------------------------------------------------------</span>
00360 <span class="comment">//   cmdAddPoet</span>
00361 <span class="comment">//---------------------------------------------------------</span>
00362 
<a name="l00363"></a><a class="code" href="classScore.html#i4">00363</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#i4">Score::cmdAddPoet</a>()
00364       {
00365       <a class="code" href="classScore.html#a55">cmdAddText</a>(<a class="code" href="style_8h.html#a45a24">TEXT_STYLE_POET</a>);
00366       }
00367 
00368 <span class="comment">//---------------------------------------------------------</span>
00369 <span class="comment">//   upDown</span>
00370 <span class="comment">//    increment/decrement pitch of note</span>
00371 <span class="comment">//---------------------------------------------------------</span>
00372 
<a name="l00373"></a><a class="code" href="classScore.html#a56">00373</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#a56">Score::cmdUpDown</a>(<span class="keywordtype">bool</span> up, <span class="keywordtype">bool</span> octave)
00374       {
00375       <a class="code" href="classElementList.html">ElementList</a> ns;
00376       <a class="code" href="classElementList.html">ElementList</a> el;
00377 
00378       <span class="keywordflow">for</span> (<a class="code" href="element_8h.html#a1">iElement</a> i = <a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#a0">elements</a>()-&gt;<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); i != <a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#a0">elements</a>()-&gt;<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++i) {
00379             <a class="code" href="classElement.html">Element</a>* e = *i;
00380             <span class="keywordflow">if</span> (e-&gt;<a class="code" href="classElement.html#a40">type</a>() != <a class="code" href="element_8h.html#a65a12">NOTE</a>)
00381                   <span class="keywordflow">continue</span>;
00382             <a class="code" href="classNote.html">Note</a>* note = (<a class="code" href="classNote.html">Note</a>*)e;
00383             <span class="keywordflow">while</span> (note-&gt;<a class="code" href="classNote.html#a34">tieBack</a>())
00384                   note = note-&gt;<a class="code" href="classNote.html#a34">tieBack</a>()-&gt;<a class="code" href="classTie.html#a5">startNote</a>();
00385             <span class="keywordflow">for</span> (; note; note = note-&gt;<a class="code" href="classNote.html#a33">tieFor</a>() ? note-&gt;<a class="code" href="classNote.html#a33">tieFor</a>()-&gt;<a class="code" href="classTie.html#a6">endNote</a>() : 0) {
00386                   <a class="code" href="element_8h.html#a1">iElement</a> ii;
00387                   <span class="keywordflow">for</span> (ii = el.<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); ii != el.<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++ii) {
00388                         <span class="keywordflow">if</span> (*ii == note)
00389                               <span class="keywordflow">break</span>;
00390                         }
00391                   <span class="keywordflow">if</span> (ii == el.<a class="code" href="classpstl_1_1plist.html#a4">end</a>())
00392                         el.<a class="code" href="classpstl_1_1plist.html#a2">push_back</a>(note);
00393                   }
00394             }
00395       <span class="keywordflow">if</span> (el.empty())
00396             <span class="keywordflow">return</span>;
00397 
00398       <span class="keywordtype">int</span> newPitch = <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o6">pitch</a>;
00399       <span class="keywordflow">for</span> (<a class="code" href="element_8h.html#a1">iElement</a> i = el.<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); i != el.<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++i) {
00400             <a class="code" href="classNote.html">Note</a>* oNote = (<a class="code" href="classNote.html">Note</a>*)(*i);
00401             <span class="keywordtype">int</span> pitch   = oNote-&gt;<a class="code" href="classNote.html#a15">pitch</a>();
00402             <span class="keywordflow">if</span> (octave)
00403                   newPitch = pitch + (up ? 12 : -12);
00404             <span class="keywordflow">else</span>
00405                   newPitch = up ? pitch+1 : pitch-1;
00406             <span class="keywordflow">if</span> (newPitch &lt; 0)
00407                   newPitch = 0;
00408             <span class="keywordflow">if</span> (newPitch &gt; 127)
00409                   newPitch = 127;
00410             <a class="code" href="classNote.html">Note</a>* nNote = <span class="keyword">new</span> <a class="code" href="classNote.html">Note</a>(*oNote);
00411             <a class="code" href="classScore.html#a61">removeObject</a>(oNote);
00412             <a class="code" href="classScore.html#a60">addObject</a>(nNote);
00413 <span class="comment">//            changeObject(nNote, oNote);</span>
00414             nNote-&gt;<a class="code" href="classNote.html#a17">changePitch</a>(newPitch);
00415             <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::RemoveObject, oNote);
00416             <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::AddObject, nNote);
00417             ns.<a class="code" href="classpstl_1_1plist.html#a2">push_back</a>(nNote);
00418             }
00419 
00420       <a class="code" href="canvas_8cpp.html#a0">padState</a>.<a class="code" href="structPadState.html#o6">pitch</a> = newPitch;
00421       <span class="keywordflow">if</span> (!ns.empty()) {
00422             <a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#a5">clear</a>();
00423             <a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#a1">add</a>(ns);
00424             <a class="code" href="classScore.html#a49">layout</a>();
00425             }
00426       }
00427 
00428 <span class="comment">//---------------------------------------------------------</span>
00429 <span class="comment">//   cmdAppendMeasure</span>
00430 <span class="comment">//    - keyboard callback</span>
00431 <span class="comment">//    - called from pulldown menu</span>
00432 <span class="comment">//---------------------------------------------------------</span>
00433 
<a name="l00434"></a><a class="code" href="classScore.html#i5">00434</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#i5">Score::cmdAppendMeasure</a>()
00435       {
00436       <span class="keywordflow">if</span> (<a class="code" href="classScore.html#a10">noStaves</a>()) {
00437             printf(<span class="stringliteral">"---no staves\n"</span>);
00438             <span class="keywordflow">return</span>;
00439             }
00440 
00441       <a class="code" href="classScore.html#a83">startCmd</a>();
00442 
00443       <span class="keywordtype">int</span> tick = <a class="code" href="classScore.html#a101">last</a>() ? <a class="code" href="classScore.html#a101">last</a>()-&gt;<a class="code" href="classElement.html#a74">tick</a>() + <a class="code" href="classScore.html#a101">last</a>()-&gt;<a class="code" href="classMeasure.html#a26">tickLen</a>() : 0;
00444       <a class="code" href="classMeasure.html">Measure</a>* measure  = <span class="keyword">new</span> <a class="code" href="classMeasure.html">Measure</a>(<span class="keyword">this</span>);
00445       measure-&gt;<a class="code" href="classElement.html#a75">setTick</a>(tick);
00446 
00447       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> idx = 0; idx &lt; <a class="code" href="classScore.html#a6">nstaves</a>(); ++idx) {
00448             <a class="code" href="classRest.html">Rest</a>* rest = <span class="keyword">new</span> <a class="code" href="classRest.html">Rest</a>(<span class="keyword">this</span>, tick, <a class="code" href="classScore.html#o9">sigmap</a>-&gt;<a class="code" href="classSigList.html#a9">ticksMeasure</a>(tick));
00449             <a class="code" href="classStaff.html">Staff</a>* staffp = <a class="code" href="classScore.html#a7">staff</a>(idx);
00450             rest-&gt;<a class="code" href="classElement.html#a61">setStaff</a>(staffp);
00451             measure-&gt;<a class="code" href="classMeasure.html#a8">add</a>(rest);
00452             <a class="code" href="classBar.html">Bar</a>* bar = 0;
00453             <span class="keywordflow">if</span> (staffp-&gt;<a class="code" href="classStaff.html#a4">isTop</a>()) {
00454                   bar = <span class="keyword">new</span> <a class="code" href="classBar.html">Bar</a>(<span class="keyword">this</span>);
00455                   bar-&gt;<a class="code" href="classElement.html#a61">setStaff</a>(staffp);
00456                   measure-&gt;<a class="code" href="classMeasure.html#a8">add</a>(bar);
00457                   }
00458             }
00459       <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::InsertMeasure, measure);
00460 
00461       <a class="code" href="classScore.html#a102">push_back</a>(measure);
00462       <a class="code" href="classScore.html#a49">layout</a>();
00463       <a class="code" href="classScore.html#a84">endCmd</a>(<span class="keyword">true</span>);
00464       }
00465 
00466 <span class="comment">//---------------------------------------------------------</span>
00467 <span class="comment">//   addObject</span>
00468 <span class="comment">//    add object to selected objects</span>
00469 <span class="comment">//</span>
00470 <span class="comment">//    called from padToggle() to add note prefix/accent</span>
00471 <span class="comment">//---------------------------------------------------------</span>
00472 
<a name="l00473"></a><a class="code" href="classScore.html#a59">00473</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#a59">Score::addObjectToSelected</a>(<a class="code" href="classElement.html">Element</a>* o)
00474       {
00475       <span class="comment">//</span>
00476       <span class="comment">// we need a local copy of sel-&gt;elements()</span>
00477       <span class="comment">// because "addAccidental()" modifies sel-&gt;elements()</span>
00478       <span class="comment">//</span>
00479       <a class="code" href="classElementList.html">ElementList</a> el(*<a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#a0">elements</a>());
00480 
00481       <span class="keywordflow">for</span> (<a class="code" href="element_8h.html#a1">iElement</a> ie = el.<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); ie != el.<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++ie) {
00482             <a class="code" href="classElement.html">Element</a>* el = *ie;
00483             <span class="keywordflow">if</span> (el-&gt;<a class="code" href="classElement.html#a40">type</a>() != <a class="code" href="element_8h.html#a65a12">NOTE</a>)
00484                   <span class="keywordflow">continue</span>;
00485 
00486             <span class="keywordflow">switch</span>(o-&gt;<a class="code" href="classElement.html#a40">type</a>()) {
00487                   <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a30">ATTRIBUTE</a>:
00488                         <a class="code" href="classScore.html#d11">addAttribute</a>((<a class="code" href="classNote.html">Note</a>*)el, <span class="keyword">new</span> <a class="code" href="classNoteAttribute.html">NoteAttribute</a>(*(<a class="code" href="classNoteAttribute.html">NoteAttribute</a>*)o));
00489                         <span class="keywordflow">break</span>;
00490                   <span class="keywordflow">case</span> <a class="code" href="element_8h.html#a65a18">ACCIDENTAL</a>:
00491                         <a class="code" href="classScore.html#d12">addAccidental</a>((<a class="code" href="classNote.html">Note</a>*)el, ((<a class="code" href="classPrefix.html">Prefix</a>*)o)-&gt;idx());
00492                         <span class="keywordflow">break</span>;
00493                   <span class="keywordflow">default</span>:
00494                         <span class="keywordflow">break</span>;
00495                   }
00496             }
00497       <span class="keyword">delete</span> o;
00498       }
00499 
00500 <span class="comment">//---------------------------------------------------------</span>
00501 <span class="comment">//   addAccidental</span>
00502 <span class="comment">//---------------------------------------------------------</span>
00503 
<a name="l00504"></a><a class="code" href="classScore.html#d12">00504</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#d12">Score::addAccidental</a>(<a class="code" href="classNote.html">Note</a>* oNote, <span class="keywordtype">int</span> accidental)
00505       {
00506       <a class="code" href="classNote.html">Note</a>* nNote  = <span class="keyword">new</span> <a class="code" href="classNote.html">Note</a>(*oNote);
00507 
00508       <a class="code" href="classScore.html#a61">removeObject</a>(oNote);
00509       <a class="code" href="classScore.html#a60">addObject</a>(nNote);
00510 
00511       <span class="comment">// changeObject(nNote, oNote);</span>
00512       nNote-&gt;<a class="code" href="classNote.html#a25">changeAccidental</a>(<span class="keyword">this</span>, accidental);
00513       <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::RemoveObject, oNote);
00514       <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::AddObject, nNote);
00515 
00516       <span class="keywordflow">if</span> (oNote-&gt;<a class="code" href="classElement.html#a14">isSelected</a>())
00517             <a class="code" href="classScore.html#a47">select</a>(nNote, 0, 0);
00518       <a class="code" href="classScore.html#a49">layout</a>();
00519       }
00520 
00521 <span class="comment">//---------------------------------------------------------</span>
00522 <span class="comment">//   addAttribute</span>
00523 <span class="comment">//---------------------------------------------------------</span>
00524 
<a name="l00525"></a><a class="code" href="classScore.html#d11">00525</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#d11">Score::addAttribute</a>(<a class="code" href="classNote.html">Note</a>* note, <a class="code" href="classNoteAttribute.html">NoteAttribute</a>* atr)
00526       {
00527       <a class="code" href="classChord.html">Chord</a>* chord     = note-&gt;<a class="code" href="classNote.html#a37">chord</a>();
00528 <span class="comment">//      Measure* measure = chord-&gt;measure();</span>
00529 <span class="comment">//      int staff        = chord-&gt;staff();</span>
00530 
00531       atr-&gt;<a class="code" href="classElement.html#a11">setParent</a>(chord);
00532       <a class="code" href="classNoteAttribute.html">NoteAttribute</a>* oa = chord-&gt;<a class="code" href="classChord.html#a30">hasAttribute</a>(atr);
00533       <span class="keywordflow">if</span> (oa) {
00534             <span class="keyword">delete</span> atr;
00535             atr = 0;
00536             <a class="code" href="classScore.html#a61">removeObject</a>(oa);
00537             <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::RemoveObject, oa);
00538             }
00539       <span class="keywordflow">else</span> {
00540             <a class="code" href="classScore.html#a60">addObject</a>(atr);
00541             <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::AddObject, atr);
00542             }
00543       <a class="code" href="classScore.html#a49">layout</a>();
00544       }
00545 
00546 <span class="comment">//---------------------------------------------------------</span>
00547 <span class="comment">//   toggleInvisible</span>
00548 <span class="comment">//---------------------------------------------------------</span>
00549 
<a name="l00550"></a><a class="code" href="classScore.html#a77">00550</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#a77">Score::toggleInvisible</a>(<a class="code" href="classElement.html">Element</a>* obj)
00551       {
00552       <a class="code" href="classElement.html">Element</a>* ne = obj-&gt;<a class="code" href="classElement.html#a3">clone</a>();
00553       ne-&gt;<a class="code" href="classElement.html#a19">setGenerated</a>(<span class="keyword">false</span>);
00554       ne-&gt;<a class="code" href="classElement.html#a17">setVisible</a>(!ne-&gt;<a class="code" href="classElement.html#a16">visible</a>());
00555       <a class="code" href="classScore.html#a61">removeObject</a>(obj);
00556       <a class="code" href="classScore.html#a60">addObject</a>(ne);
00557 <span class="comment">//      changeObject(ne, obj);</span>
00558       <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::RemoveObject, obj);
00559       <a class="code" href="classScore.html#a33">undoOp</a>(UndoOp::AddObject, ne);
00560       <a class="code" href="classScore.html#a49">layout</a>();
00561       }
00562 
00563 <span class="comment">//---------------------------------------------------------</span>
00564 <span class="comment">//   resetUserOffsets</span>
00565 <span class="comment">//    called from pulldown menu</span>
00566 <span class="comment">//---------------------------------------------------------</span>
00567 
<a name="l00568"></a><a class="code" href="classScore.html#i20">00568</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#i20">Score::resetUserOffsets</a>()
00569       {
00570       <a class="code" href="classScore.html#a83">startCmd</a>();
00571       <a class="code" href="classElementList.html">ElementList</a>* el = <a class="code" href="classScore.html#o14">sel</a>-&gt;<a class="code" href="classSelection.html#a0">elements</a>();
00572       <span class="keywordflow">for</span> (<a class="code" href="element_8h.html#a1">iElement</a> i = el-&gt;<a class="code" href="classpstl_1_1plist.html#a3">begin</a>(); i != el-&gt;<a class="code" href="classpstl_1_1plist.html#a4">end</a>(); ++i)
00573             (*i)-&gt;setUserOff(QPointF(0.0, 0.0));
00574       <a class="code" href="classScore.html#a49">layout</a>();
00575       <a class="code" href="classScore.html#a84">endCmd</a>(<span class="keyword">true</span>);
00576       }
00577 
00578 <span class="comment">//---------------------------------------------------------</span>
00579 <span class="comment">//   resetUserStretch</span>
00580 <span class="comment">//---------------------------------------------------------</span>
00581 
<a name="l00582"></a><a class="code" href="classScore.html#i21">00582</a> <span class="keywordtype">void</span> <a class="code" href="classScore.html#i21">Score::resetUserStretch</a>()
00583       {
00584       <span class="keywordflow">for</span> (<a class="code" href="classMeasure.html">Measure</a>* m = <a class="code" href="classScore.html#a100">first</a>(); m; m = m-&gt;<a class="code" href="classMeasure.html#a64">next</a>())
00585             m-&gt;<a class="code" href="classMeasure.html#a35">setUserStretch</a>(1.0);
00586       <a class="code" href="classScore.html#o2">dirty</a> = <span class="keyword">true</span>;
00587       <a class="code" href="classScore.html#a49">layout</a>();
00588       }
00589 
00590 <span class="comment">//---------------------------------------------------------</span>
00591 <span class="comment">//   moveUp</span>
00592 <span class="comment">//---------------------------------------------------------</span>
00593 
<a name="l00594"></a><a class="code" href="classScore.html#d21">00594</a> <a class="code" href="classElement.html">Element</a>* <a class="code" href="classScore.html#d21">Score::moveUp</a>(<a class="code" href="classNote.html">Note</a>* note)
00595       {
00596       <span class="keywordtype">int</span> rstaff   = note-&gt;<a class="code" href="classElement.html#a59">staff</a>()-&gt;<a class="code" href="classStaff.html#a14">rstaff</a>();
00597 
00598       <span class="keywordflow">if</span> (note-&gt;<a class="code" href="classNote.html#a18">move</a>() == -1) {
00599             <span class="keywordflow">return</span> 0;
00600             }
00601       <span class="keywordflow">if</span> (rstaff + note-&gt;<a class="code" href="classNote.html#a18">move</a>() &lt;= 0) {
00602             <span class="keywordflow">return</span> 0;
00603             }
00604 
00605       note-&gt;<a class="code" href="classNote.html#a19">setMove</a>(note-&gt;<a class="code" href="classNote.html#a18">move</a>() - 1);
00606       note-&gt;<a class="code" href="classNote.html#a37">chord</a>()-&gt;<a class="code" href="classChordRest.html#a4">segment</a>()-&gt;<a class="code" href="classSegment.html#a14">measure</a>()-&gt;<a class="code" href="classMeasure.html#a59">layoutNoteHeads</a>(<a class="code" href="classScore.html#a7">staff</a>(note-&gt;<a class="code" href="classElement.html#a59">staff</a>()));
00607       <a class="code" href="classScore.html#a49">layout</a>();
00608       <span class="keywordflow">return</span> 0;
00609       }
00610 
00611 <span class="comment">//---------------------------------------------------------</span>
00612 <span class="comment">//   moveDown</span>
00613 <span class="comment">//---------------------------------------------------------</span>
00614 
<a name="l00615"></a><a class="code" href="classScore.html#d22">00615</a> <a class="code" href="classElement.html">Element</a>* <a class="code" href="classScore.html#d22">Score::moveDown</a>(<a class="code" href="classNote.html">Note</a>* note)
00616       {
00617       <span class="keywordtype">int</span> staffIdx = <a class="code" href="classScore.html#a7">staff</a>(note-&gt;<a class="code" href="classElement.html#a59">staff</a>());
00618       <a class="code" href="classStaff.html">Staff</a>* staff = note-&gt;<a class="code" href="classElement.html#a59">staff</a>();
00619       <a class="code" href="classPart.html">Part</a>* <a class="code" href="classScore.html#a17">part</a>   = staff-&gt;<a class="code" href="classStaff.html#a20">part</a>();
00620       <span class="keywordtype">int</span> rstaff   = staff-&gt;<a class="code" href="classStaff.html#a14">rstaff</a>();
00621       <span class="keywordtype">int</span> rstaves  = part-&gt;<a class="code" href="classPart.html#a4">nstaves</a>();
00622 
00623       <span class="keywordflow">if</span> (note-&gt;<a class="code" href="classNote.html#a18">move</a>() == 1) {
00624             <span class="keywordflow">return</span> 0;
00625             }
00626       <span class="keywordflow">if</span> (rstaff + note-&gt;<a class="code" href="classNote.html#a18">move</a>() &gt;= rstaves-1) {
00627             <span class="keywordflow">return</span> 0;
00628             }
00629       note-&gt;<a class="code" href="classNote.html#a19">setMove</a>(note-&gt;<a class="code" href="classNote.html#a18">move</a>() + 1);
00630       note-&gt;<a class="code" href="classNote.html#a37">chord</a>()-&gt;<a class="code" href="classChordRest.html#a4">segment</a>()-&gt;<a class="code" href="classSegment.html#a14">measure</a>()-&gt;<a class="code" href="classMeasure.html#a59">layoutNoteHeads</a>(staffIdx);
00631       <a class="code" href="classScore.html#a49">layout</a>();
00632       <span class="keywordflow">return</span> 0;
00633       }
00634 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Mon Jun 27 22:28:28 2005 for MuseScore by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
