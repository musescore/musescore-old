<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>MuseScore: xml.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>xml.cpp</h1><a href="xml_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">//=========================================================</span>
00002 <span class="comment">//  MusE</span>
00003 <span class="comment">//  Linux Music Score Editor</span>
00004 <span class="comment">//  $Id: xml.cpp,v 1.5 2005/06/19 17:01:37 wschweer Exp $</span>
00005 <span class="comment">//</span>
00006 <span class="comment">//  (C) Copyright 2004 Werner Schweer (ws@seh.de)</span>
00007 <span class="comment">//=========================================================</span>
00008 
00009 <span class="preprocessor">#include "<a class="code" href="xml_8h.html">xml.h</a>"</span>
00010 
00011 <span class="comment">//---------------------------------------------------------</span>
00012 <span class="comment">//  Note:</span>
00013 <span class="comment">//    this code is a Q/D hack for writing XML-Files</span>
00014 <span class="comment">//    - can only handle the XML subset used by MusE</span>
00015 
00016 <span class="comment">//---------------------------------------------------------</span>
00017 <span class="comment">//   Xml</span>
00018 <span class="comment">//---------------------------------------------------------</span>
00019 
<a name="l00020"></a><a class="code" href="classXml.html#a0">00020</a> <a class="code" href="classXml.html#a1">Xml::Xml</a>(FILE* _f)
00021       {
00022       <a class="code" href="classXml.html#r0">f</a> = _f;
00023       <a class="code" href="classXml.html#r1">level</a> = 0;
00024       }
00025 
<a name="l00026"></a><a class="code" href="classXml.html#a1">00026</a> <a class="code" href="classXml.html#a1">Xml::Xml</a>()
00027       {
00028       <a class="code" href="classXml.html#r0">f</a>     = 0;
00029       <a class="code" href="classXml.html#r1">level</a> = 0;
00030       }
00031 
00032 <span class="comment">//---------------------------------------------------------</span>
00033 <span class="comment">//   header</span>
00034 <span class="comment">//---------------------------------------------------------</span>
00035 
<a name="l00036"></a><a class="code" href="classXml.html#a4">00036</a> <span class="keywordtype">void</span> <a class="code" href="classXml.html#a4">Xml::header</a>()
00037       {
00038       fprintf(<a class="code" href="classXml.html#r0">f</a>, <span class="stringliteral">"&lt;?xml version=\"1.0\" encoding=\"ISO-8859-1\"?&gt;\n"</span>);
00039       }
00040 
00041 <span class="comment">//---------------------------------------------------------</span>
00042 <span class="comment">//   put</span>
00043 <span class="comment">//---------------------------------------------------------</span>
00044 
<a name="l00045"></a><a class="code" href="classXml.html#a6">00045</a> <span class="keywordtype">void</span> <a class="code" href="classXml.html#a6">Xml::put</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* format, ...)
00046       {
00047       va_list args;
00048       va_start(args, format);
00049       <a class="code" href="classXml.html#a5">putLevel</a>();
00050       vfprintf(<a class="code" href="classXml.html#r0">f</a>, format, args);
00051       va_end(args);
00052       putc(<span class="charliteral">'\n'</span>, <a class="code" href="classXml.html#r0">f</a>);
00053       }
00054 
00055 <span class="comment">//---------------------------------------------------------</span>
00056 <span class="comment">//   nput</span>
00057 <span class="comment">//---------------------------------------------------------</span>
00058 
<a name="l00059"></a><a class="code" href="classXml.html#a7">00059</a> <span class="keywordtype">void</span> <a class="code" href="classXml.html#a7">Xml::nput</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* format, ...)
00060       {
00061       va_list args;
00062       va_start(args, format);
00063       vfprintf(<a class="code" href="classXml.html#r0">f</a>, format, args);
00064       va_end(args);
00065       }
00066 
00067 <span class="comment">//---------------------------------------------------------</span>
00068 <span class="comment">//   tdata</span>
00069 <span class="comment">//---------------------------------------------------------</span>
00070 
<a name="l00071"></a><a class="code" href="classXml.html#a11">00071</a> <span class="keywordtype">void</span> <a class="code" href="classXml.html#a11">Xml::tdata</a>(<span class="keyword">const</span> QString&amp; s)
00072       {
00073       <a class="code" href="classXml.html#a5">putLevel</a>();
00074       fprintf(<a class="code" href="classXml.html#r0">f</a>, <span class="stringliteral">"%s\n"</span>, s.latin1());
00075       }
00076 
00077 <span class="comment">//---------------------------------------------------------</span>
00078 <span class="comment">//   tag</span>
00079 <span class="comment">//---------------------------------------------------------</span>
00080 
<a name="l00081"></a><a class="code" href="classXml.html#a8">00081</a> <span class="keywordtype">void</span> <a class="code" href="classXml.html#a8">Xml::tag</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* format, ...)
00082       {
00083       va_list args;
00084       va_start(args, format);
00085       <a class="code" href="classXml.html#a5">putLevel</a>();
00086       putc(<span class="charliteral">'&lt;'</span>, <a class="code" href="classXml.html#r0">f</a>);
00087       vfprintf(<a class="code" href="classXml.html#r0">f</a>, format, args);
00088       va_end(args);
00089       putc(<span class="charliteral">'&gt;'</span>, <a class="code" href="classXml.html#r0">f</a>);
00090       putc(<span class="charliteral">'\n'</span>, <a class="code" href="classXml.html#r0">f</a>);
00091       ++<a class="code" href="classXml.html#r1">level</a>;
00092       }
00093 
<a name="l00094"></a><a class="code" href="classXml.html#a10">00094</a> <span class="keywordtype">void</span> <a class="code" href="classXml.html#a10">Xml::tagE</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* format, ...)
00095       {
00096       va_list args;
00097       va_start(args, format);
00098       <a class="code" href="classXml.html#a5">putLevel</a>();
00099       putc(<span class="charliteral">'&lt;'</span>, <a class="code" href="classXml.html#r0">f</a>);
00100       vfprintf(<a class="code" href="classXml.html#r0">f</a>, format, args);
00101       va_end(args);
00102       putc(<span class="charliteral">'/'</span>, <a class="code" href="classXml.html#r0">f</a>);
00103       putc(<span class="charliteral">'&gt;'</span>, <a class="code" href="classXml.html#r0">f</a>);
00104       putc(<span class="charliteral">'\n'</span>, <a class="code" href="classXml.html#r0">f</a>);
00105       }
00106 
00107 <span class="comment">//---------------------------------------------------------</span>
00108 <span class="comment">//   etag</span>
00109 <span class="comment">//---------------------------------------------------------</span>
00110 
<a name="l00111"></a><a class="code" href="classXml.html#a9">00111</a> <span class="keywordtype">void</span> <a class="code" href="classXml.html#a9">Xml::etag</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* format, ...)
00112       {
00113       va_list args;
00114       va_start(args, format);
00115       <a class="code" href="classXml.html#a5">putLevel</a>();
00116       putc(<span class="charliteral">'&lt;'</span>, <a class="code" href="classXml.html#r0">f</a>);
00117       putc(<span class="charliteral">'/'</span>, <a class="code" href="classXml.html#r0">f</a>);
00118       vfprintf(<a class="code" href="classXml.html#r0">f</a>, format, args);
00119       va_end(args);
00120       putc(<span class="charliteral">'&gt;'</span>, <a class="code" href="classXml.html#r0">f</a>);
00121       putc(<span class="charliteral">'\n'</span>, <a class="code" href="classXml.html#r0">f</a>);
00122       --<a class="code" href="classXml.html#r1">level</a>;
00123       }
00124 
<a name="l00125"></a><a class="code" href="classXml.html#a5">00125</a> <span class="keywordtype">void</span> <a class="code" href="classXml.html#a5">Xml::putLevel</a>()
00126       {
00127       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classXml.html#r1">level</a>*2; ++i)
00128             putc(<span class="charliteral">' '</span>, <a class="code" href="classXml.html#r0">f</a>);
00129       }
00130 
00131 <span class="keywordtype">void</span> Xml::intTag(<span class="keyword">const</span> <span class="keywordtype">char</span>* name, <span class="keywordtype">int</span> val)
00132       {
00133       <a class="code" href="classXml.html#a5">putLevel</a>();
00134       fprintf(f, <span class="stringliteral">"&lt;%s&gt;%d&lt;/%s&gt;\n"</span>, name, val, name);
00135       }
00136 
00137 <span class="keywordtype">void</span> <a class="code" href="classXml.html#a13">Xml::qcharTag</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* name, QChar val)
00138       {
00139       <a class="code" href="classXml.html#a5">putLevel</a>();
00140       fprintf(f, <span class="stringliteral">"&lt;%s&gt;%d&lt;/%s&gt;\n"</span>, name, val.unicode(), name);
00141       }
00142 
00143 <span class="keywordtype">void</span> <a class="code" href="classXml.html#a15">Xml::floatTag</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* name, <span class="keywordtype">float</span> val)
00144       {
00145       <a class="code" href="classXml.html#a5">putLevel</a>();
00146       QString s(<span class="stringliteral">"&lt;%1&gt;%2&lt;/%3&gt;\n"</span>);
00147       fprintf(f, <span class="stringliteral">"%s"</span>, s.arg(name).arg(val).arg(name).latin1());
00148       }
00149 
00150 <span class="keywordtype">void</span> <a class="code" href="classXml.html#a14">Xml::doubleTag</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* name, <span class="keywordtype">double</span> val)
00151       {
00152       <a class="code" href="classXml.html#a5">putLevel</a>();
00153       QString s(<span class="stringliteral">"&lt;%1&gt;%2&lt;/%3&gt;\n"</span>);
00154       fprintf(f, <span class="stringliteral">"%s"</span>, s.arg(name).arg(val).arg(name).latin1());
00155       }
00156 
00157 <span class="keywordtype">void</span> <a class="code" href="classXml.html#a16">Xml::strTag</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* name, QString s)
00158       {
00159       <a class="code" href="classXml.html#a5">putLevel</a>();
00160       fprintf(f, <span class="stringliteral">"&lt;%s&gt;"</span>, name);
00161       s.replace(<span class="charliteral">'&amp;'</span>, <span class="stringliteral">"&amp;amp;"</span>);
00162       s.replace(<span class="charliteral">'&lt;'</span>, <span class="stringliteral">"&amp;lt;"</span>);
00163       fprintf(f, <span class="stringliteral">"%s"</span>, s.latin1());
00164       fprintf(f, <span class="stringliteral">"&lt;/%s&gt;\n"</span>, name);
00165       }
00166 
00167 <span class="comment">//---------------------------------------------------------</span>
00168 <span class="comment">//   colorTag</span>
00169 <span class="comment">//---------------------------------------------------------</span>
00170 
<a name="l00171"></a><a class="code" href="classXml.html#a17">00171</a> <span class="keywordtype">void</span> <a class="code" href="classXml.html#a17">Xml::colorTag</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* name, <span class="keyword">const</span> QColor&amp; color)
00172       {
00173       <a class="code" href="classXml.html#a5">putLevel</a>();
00174       fprintf(<a class="code" href="classXml.html#r0">f</a>, <span class="stringliteral">"&lt;%s r=\"%d\" g=\"%d\" b=\"%d\"&gt;&lt;/%s&gt;\n"</span>,
00175             name, color.red(), color.green(), color.blue(), name);
00176       }
00177 
00178 <span class="comment">//---------------------------------------------------------</span>
00179 <span class="comment">//   geometryTag</span>
00180 <span class="comment">//---------------------------------------------------------</span>
00181 
<a name="l00182"></a><a class="code" href="classXml.html#a18">00182</a> <span class="keywordtype">void</span> <a class="code" href="classXml.html#a18">Xml::geometryTag</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* name, <span class="keyword">const</span> QWidget* g)
00183       {
00184       <a class="code" href="classXml.html#a19">qrectTag</a>(name, QRect(g-&gt;pos(), g-&gt;size()));
00185       }
00186 
00187 <span class="comment">//---------------------------------------------------------</span>
00188 <span class="comment">//   qrectTag</span>
00189 <span class="comment">//---------------------------------------------------------</span>
00190 
<a name="l00191"></a><a class="code" href="classXml.html#a19">00191</a> <span class="keywordtype">void</span> <a class="code" href="classXml.html#a19">Xml::qrectTag</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* name, <span class="keyword">const</span> QRect&amp; r)
00192       {
00193       <a class="code" href="classXml.html#a5">putLevel</a>();
00194       fprintf(<a class="code" href="classXml.html#r0">f</a>, <span class="stringliteral">"&lt;%s x=\"%d\" y=\"%d\" w=\"%d\" h=\"%d\"&gt;&lt;/%s&gt;\n"</span>,
00195          name, r.x(), r.y(), r.width(), r.height(), name);
00196       }
00197 
00198 <span class="comment">//---------------------------------------------------------</span>
00199 <span class="comment">//   writePoint</span>
00200 <span class="comment">//---------------------------------------------------------</span>
00201 
<a name="l00202"></a><a class="code" href="classXml.html#a20">00202</a> <span class="keywordtype">void</span> <a class="code" href="classXml.html#a20">Xml::writePoint</a>(QPointF p, <span class="keywordtype">char</span> <span class="keyword">const</span>* name)
00203       {
00204       <a class="code" href="classXml.html#a5">putLevel</a>();
00205       QString s(<span class="stringliteral">"&lt;%1 x=\"%2\" y=\"%3\"/&gt;\n"</span>);
00206       fprintf(<a class="code" href="classXml.html#r0">f</a>, <span class="stringliteral">"%s"</span>, s.arg(name).arg(p.x()).arg(p.y()).latin1());
00207       }
00208 
00209 <span class="comment">//---------------------------------------------------------</span>
00210 <span class="comment">//   readPoint</span>
00211 <span class="comment">//---------------------------------------------------------</span>
00212 
<a name="l00213"></a><a class="code" href="xml_8h.html#a2">00213</a> QPointF <a class="code" href="xml_8h.html#a2">readPoint</a>(QDomNode node)
00214       {
00215       QDomElement e = node.toElement();
00216       QPointF p;
00217       p.setX(e.attribute(<span class="stringliteral">"x"</span>, <span class="stringliteral">"0.0"</span>).toDouble());
00218       p.setY(e.attribute(<span class="stringliteral">"y"</span>, <span class="stringliteral">"0.0"</span>).toDouble());
00219       <span class="keywordflow">return</span> p;
00220       }
00221 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Mon Jun 27 22:28:30 2005 for MuseScore by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
