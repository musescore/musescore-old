<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>MuseScore: playpanel.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>playpanel.cpp</h1><a href="playpanel_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">//=========================================================</span>
00002 <span class="comment">//  MuseScore</span>
00003 <span class="comment">//  Linux Music Score Editor</span>
00004 <span class="comment">//  $Id: playpanel.cpp,v 1.8 2005/04/17 09:28:17 wschweer Exp $</span>
00005 <span class="comment">//</span>
00006 <span class="comment">//  (C) Copyright 2002-2004 Werner Schweer (ws@seh.de)</span>
00007 <span class="comment">//=========================================================</span>
00008 
00009 <span class="preprocessor">#include "<a class="code" href="playpanel_8h.html">playpanel.h</a>"</span>
00010 <span class="preprocessor">#include "<a class="code" href="tempo_8h.html">tempo.h</a>"</span>
00011 <span class="preprocessor">#include "<a class="code" href="sig_8h.html">sig.h</a>"</span>
00012 <span class="preprocessor">#include "<a class="code" href="project_8h.html">project.h</a>"</span>
00013 <span class="preprocessor">#include "<a class="code" href="seq_8h.html">seq.h</a>"</span>
00014 <span class="preprocessor">#include "<a class="code" href="mscore_8h.html">mscore.h</a>"</span>
00015 
<a name="l00016"></a><a class="code" href="playpanel_8cpp.html#a0">00016</a> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="playpanel_8cpp.html#a0">MIN_VOL</a> = -60;
<a name="l00017"></a><a class="code" href="playpanel_8cpp.html#a1">00017</a> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="playpanel_8cpp.html#a1">MAX_VOL</a> = 10;
00018 
00019 <span class="comment">//---------------------------------------------------------</span>
00020 <span class="comment">//   PlayPanel</span>
00021 <span class="comment">//---------------------------------------------------------</span>
00022 
<a name="l00023"></a><a class="code" href="classPlayPanel.html#a0">00023</a> <a class="code" href="classPlayPanel.html#a0">PlayPanel::PlayPanel</a>(QWidget* parent, <span class="keyword">const</span> <span class="keywordtype">char</span>* name)
00024    : <a class="code" href="classPlayPanelBase.html">PlayPanelBase</a>(parent, name)
00025       {
00026       volumeSlider-&gt;setRange(<a class="code" href="playpanel_8cpp.html#a0">MIN_VOL</a> * 1000, <a class="code" href="playpanel_8cpp.html#a1">MAX_VOL</a> * 1000);
00027       posSlider-&gt;setRange(0, <a class="code" href="seq_8cpp.html#a0">seq</a>-&gt;<a class="code" href="classSeq.html#a10">getEndTick</a>());
00028       tempoSlider-&gt;setValue(tempoSlider-&gt;maxValue() + tempoSlider-&gt;minValue() - 100);
00029 
00030       <span class="keywordtype">int</span> lineStep = (<a class="code" href="playpanel_8cpp.html#a1">MAX_VOL</a> - <a class="code" href="playpanel_8cpp.html#a0">MIN_VOL</a>) * 10;
00031       volumeSlider-&gt;setSteps(lineStep, lineStep * 10);
00032       connect(rewindButton, SIGNAL(clicked()), <a class="code" href="seq_8cpp.html#a0">seq</a>, SLOT(rewindStart()));
00033       connect(stopButton, SIGNAL(toggled(<span class="keywordtype">bool</span>)), <a class="code" href="project_8cpp.html#a2">mscore</a>, SLOT(<a class="code" href="classPlayPanel.html#a2">setStop</a>(<span class="keywordtype">bool</span>)));
00034       connect(playButton, SIGNAL(toggled(<span class="keywordtype">bool</span>)), <a class="code" href="project_8cpp.html#a2">mscore</a>, SLOT(<a class="code" href="classPlayPanel.html#a3">setPlay</a>(<span class="keywordtype">bool</span>)));
00035       connect(tempoSlider, SIGNAL(sliderMoved(<span class="keywordtype">int</span>)), <span class="keyword">this</span>, SLOT(<a class="code" href="classPlayPanel.html#k0">tempoChanged</a>(<span class="keywordtype">int</span>)));
00036       connect(volumeSlider, SIGNAL(sliderMoved(<span class="keywordtype">int</span>)), <span class="keyword">this</span>, SLOT(<a class="code" href="classPlayPanel.html#k1">volumeChanged</a>(<span class="keywordtype">int</span>)));
00037       connect(posSlider, SIGNAL(sliderMoved(<span class="keywordtype">int</span>)), <span class="keyword">this</span>, SLOT(<a class="code" href="classPlayPanel.html#k2">posChanged</a>(<span class="keywordtype">int</span>)));
00038       }
00039 
00040 <span class="comment">//---------------------------------------------------------</span>
00041 <span class="comment">//   closeEvent</span>
00042 <span class="comment">//---------------------------------------------------------</span>
00043 
<a name="l00044"></a><a class="code" href="classPlayPanel.html#d0">00044</a> <span class="keywordtype">void</span> <a class="code" href="classPlayPanel.html#d0">PlayPanel::closeEvent</a>(QCloseEvent* ev)
00045       {
00046       emit <a class="code" href="classPlayPanel.html#l3">close</a>();
00047       QWidget::closeEvent(ev);
00048       }
00049 
00050 <span class="comment">//---------------------------------------------------------</span>
00051 <span class="comment">//   setEndpos</span>
00052 <span class="comment">//---------------------------------------------------------</span>
00053 
<a name="l00054"></a><a class="code" href="classPlayPanel.html#a6">00054</a> <span class="keywordtype">void</span> <a class="code" href="classPlayPanel.html#a6">PlayPanel::setEndpos</a>(<span class="keywordtype">int</span> val)
00055       {
00056       posSlider-&gt;setRange(0, val);
00057       }
00058 
00059 <span class="comment">//---------------------------------------------------------</span>
00060 <span class="comment">//   tempoChanged</span>
00061 <span class="comment">//---------------------------------------------------------</span>
00062 
<a name="l00063"></a><a class="code" href="classPlayPanel.html#k0">00063</a> <span class="keywordtype">void</span> <a class="code" href="classPlayPanel.html#k0">PlayPanel::tempoChanged</a>(<span class="keywordtype">int</span> val)
00064       {
00065       val = tempoSlider-&gt;maxValue() + tempoSlider-&gt;minValue() - val;
00066       emit <a class="code" href="classPlayPanel.html#l0">tempoChange</a>(val);
00067       }
00068 
00069 <span class="comment">//---------------------------------------------------------</span>
00070 <span class="comment">//   setTempo</span>
00071 <span class="comment">//---------------------------------------------------------</span>
00072 
<a name="l00073"></a><a class="code" href="classPlayPanel.html#a4">00073</a> <span class="keywordtype">void</span> <a class="code" href="classPlayPanel.html#a4">PlayPanel::setTempo</a>(<span class="keywordtype">int</span> val)
00074       {
00075       <span class="keywordtype">int</span> tempo = int(60000000.0 / <span class="keywordtype">double</span>(val));
00076       tempoLabel-&gt;setText(QString(<span class="stringliteral">"%1"</span>).arg(tempo, 3));
00077       }
00078 
00079 <span class="comment">//---------------------------------------------------------</span>
00080 <span class="comment">//   setVolume</span>
00081 <span class="comment">//---------------------------------------------------------</span>
00082 
<a name="l00083"></a><a class="code" href="classPlayPanel.html#a5">00083</a> <span class="keywordtype">void</span> <a class="code" href="classPlayPanel.html#a5">PlayPanel::setVolume</a>(<span class="keywordtype">float</span> val)
00084       {
00085       <span class="keywordtype">int</span> vol = int(log10(val)*20000.0);
00086       volumeSlider-&gt;setValue((<a class="code" href="playpanel_8cpp.html#a1">MAX_VOL</a> + <a class="code" href="playpanel_8cpp.html#a0">MIN_VOL</a>)*1000 - vol);
00087       }
00088 
00089 <span class="comment">//---------------------------------------------------------</span>
00090 <span class="comment">//   volumeChanged</span>
00091 <span class="comment">//---------------------------------------------------------</span>
00092 
<a name="l00093"></a><a class="code" href="classPlayPanel.html#k1">00093</a> <span class="keywordtype">void</span> <a class="code" href="classPlayPanel.html#k1">PlayPanel::volumeChanged</a>(<span class="keywordtype">int</span> val)
00094       {
00095       <span class="keywordtype">float</span> volume;
00096       val = (<a class="code" href="playpanel_8cpp.html#a1">MAX_VOL</a> + <a class="code" href="playpanel_8cpp.html#a0">MIN_VOL</a>) * 1000 - val;
00097 
00098       <span class="keywordflow">if</span> (val &lt;= <a class="code" href="playpanel_8cpp.html#a0">MIN_VOL</a> * 1000)
00099             volume = 0.0;
00100       <span class="keywordflow">else</span> {
00101             <span class="keywordtype">float</span> fval = float(val)/20000.0;
00102             volume = pow(10.0, fval);
00103             }
00104       emit <a class="code" href="classPlayPanel.html#l2">volChange</a>(volume);
00105       }
00106 
00107 <span class="comment">//---------------------------------------------------------</span>
00108 <span class="comment">//   posChanged</span>
00109 <span class="comment">//---------------------------------------------------------</span>
00110 
<a name="l00111"></a><a class="code" href="classPlayPanel.html#k2">00111</a> <span class="keywordtype">void</span> <a class="code" href="classPlayPanel.html#k2">PlayPanel::posChanged</a>(<span class="keywordtype">int</span> val)
00112       {
00113       emit <a class="code" href="classPlayPanel.html#l1">posChange</a>(val);
00114       }
00115 
00116 <span class="comment">//---------------------------------------------------------</span>
00117 <span class="comment">//   setStop</span>
00118 <span class="comment">//---------------------------------------------------------</span>
00119 
<a name="l00120"></a><a class="code" href="classPlayPanel.html#a2">00120</a> <span class="keywordtype">void</span> <a class="code" href="classPlayPanel.html#a2">PlayPanel::setStop</a>(<span class="keywordtype">bool</span> val)
00121       {
00122       stopButton-&gt;blockSignals(<span class="keyword">true</span>);
00123       stopButton-&gt;setOn(val);
00124       stopButton-&gt;blockSignals(<span class="keyword">false</span>);
00125       }
00126 
00127 <span class="comment">//---------------------------------------------------------</span>
00128 <span class="comment">//   setPlay</span>
00129 <span class="comment">//---------------------------------------------------------</span>
00130 
<a name="l00131"></a><a class="code" href="classPlayPanel.html#a3">00131</a> <span class="keywordtype">void</span> <a class="code" href="classPlayPanel.html#a3">PlayPanel::setPlay</a>(<span class="keywordtype">bool</span> val)
00132       {
00133       playButton-&gt;blockSignals(<span class="keyword">true</span>);
00134       playButton-&gt;setOn(val);
00135       playButton-&gt;blockSignals(<span class="keyword">false</span>);
00136       }
00137 
00138 <span class="comment">//---------------------------------------------------------</span>
00139 <span class="comment">//   togglePlayPanel</span>
00140 <span class="comment">//---------------------------------------------------------</span>
00141 
<a name="l00142"></a><a class="code" href="classMuseScore.html#k35">00142</a> <span class="keywordtype">void</span> <a class="code" href="classMuseScore.html#k35">MuseScore::togglePlayPanel</a>()
00143       {
00144       <span class="keywordtype">bool</span> visible;
00145       <span class="keywordflow">if</span> (<a class="code" href="classMuseScore.html#r29">playPanel</a> == 0)
00146             visible = <span class="keyword">false</span>;
00147       <span class="keywordflow">else</span>
00148             visible = <a class="code" href="classMuseScore.html#r29">playPanel</a>-&gt;isVisible();
00149       <a class="code" href="classMuseScore.html#d4">showPlayPanel</a>(!visible);
00150       }
00151 
00152 <span class="comment">//---------------------------------------------------------</span>
00153 <span class="comment">//   showPlayPanel</span>
00154 <span class="comment">//---------------------------------------------------------</span>
00155 
<a name="l00156"></a><a class="code" href="classMuseScore.html#d4">00156</a> <span class="keywordtype">void</span> <a class="code" href="classMuseScore.html#d4">MuseScore::showPlayPanel</a>(<span class="keywordtype">bool</span> visible)
00157       {
00158       <span class="keywordflow">if</span> (<a class="code" href="project_8cpp.html#a5">noSeq</a>)
00159             <span class="keywordflow">return</span>;
00160       <span class="keywordflow">if</span> (<a class="code" href="classMuseScore.html#r29">playPanel</a> == 0) {
00161             <a class="code" href="classMuseScore.html#r29">playPanel</a> = <span class="keyword">new</span> <a class="code" href="classPlayPanel.html">PlayPanel</a>();
00162             connect(<a class="code" href="classMuseScore.html#r29">playPanel</a>, SIGNAL(volChange(<span class="keywordtype">float</span>)), <a class="code" href="seq_8cpp.html#a0">seq</a>, SLOT(setVolume(<span class="keywordtype">float</span>)));
00163             connect(<a class="code" href="classMuseScore.html#r29">playPanel</a>, SIGNAL(tempoChange(<span class="keywordtype">int</span>)), <a class="code" href="seq_8cpp.html#a0">seq</a>, SLOT(setTempo(<span class="keywordtype">int</span>)));
00164             connect(<a class="code" href="classMuseScore.html#r29">playPanel</a>, SIGNAL(posChange(<span class="keywordtype">int</span>)), <a class="code" href="seq_8cpp.html#a0">seq</a>, SLOT(setPos(<span class="keywordtype">int</span>)));
00165             connect(<a class="code" href="classMuseScore.html#r29">playPanel</a>, SIGNAL(close()), <a class="code" href="project_8cpp.html#a2">mscore</a>, SLOT(<a class="code" href="classMuseScore.html#k36">closePlayPanel</a>()));
00166             <span class="keywordtype">bool</span> playing = <a class="code" href="seq_8cpp.html#a0">seq</a>-&gt;<a class="code" href="classSeq.html#a5">isPlaying</a>();
00167             <a class="code" href="classMuseScore.html#r29">playPanel</a>-&gt;<a class="code" href="classPlayPanel.html#a2">setStop</a>(!playing);
00168             <a class="code" href="classMuseScore.html#r29">playPanel</a>-&gt;<a class="code" href="classPlayPanel.html#a3">setPlay</a>(playing);
00169             <a class="code" href="classMuseScore.html#r29">playPanel</a>-&gt;<a class="code" href="classPlayPanel.html#a5">setVolume</a>(<a class="code" href="seq_8cpp.html#a0">seq</a>-&gt;<a class="code" href="classSeq.html#a11">volume</a>());
00170             <a class="code" href="classMuseScore.html#r29">playPanel</a>-&gt;<a class="code" href="classPlayPanel.html#a4">setTempo</a>(<a class="code" href="classMuseScore.html#r0">cs</a>-&gt;<a class="code" href="classScore.html#o11">tempomap</a>-&gt;<a class="code" href="classTempoList.html#a5">tempo</a>(0));
00171             <a class="code" href="classMuseScore.html#r29">playPanel</a>-&gt;<a class="code" href="classPlayPanel.html#a7">enableSeek</a>(!<a class="code" href="seq_8cpp.html#a0">seq</a>-&gt;<a class="code" href="classSeq.html#a5">isPlaying</a>());
00172             <a class="code" href="classMuseScore.html#r29">playPanel</a>-&gt;<a class="code" href="classPlayPanel.html#a6">setEndpos</a>(<a class="code" href="seq_8cpp.html#a0">seq</a>-&gt;<a class="code" href="classSeq.html#a10">getEndTick</a>());
00173             }
00174       <a class="code" href="classMuseScore.html#r29">playPanel</a>-&gt;setShown(visible);
00175       <a class="code" href="classMuseScore.html#d2">playVisible</a>(visible);
00176       }
00177 
00178 <span class="comment">//---------------------------------------------------------</span>
00179 <span class="comment">//   closePlayPanel</span>
00180 <span class="comment">//---------------------------------------------------------</span>
00181 
<a name="l00182"></a><a class="code" href="classMuseScore.html#k36">00182</a> <span class="keywordtype">void</span> <a class="code" href="classMuseScore.html#k36">MuseScore::closePlayPanel</a>()
00183       {
00184       <a class="code" href="classMuseScore.html#d2">playVisible</a>(<span class="keyword">false</span>);
00185       }
00186 
00187 <span class="comment">//---------------------------------------------------------</span>
00188 <span class="comment">//   heartBeat</span>
00189 <span class="comment">//---------------------------------------------------------</span>
00190 
<a name="l00191"></a><a class="code" href="classPlayPanel.html#a1">00191</a> <span class="keywordtype">void</span> <a class="code" href="classPlayPanel.html#a1">PlayPanel::heartBeat</a>(<span class="keywordtype">int</span> tickpos)
00192       {
00193 <span class="preprocessor">#if 0 // TODO</span>
00194 <span class="preprocessor"></span>      <span class="keywordtype">int</span> bar, beat, tick;
00195       cs-&gt;sigmap-&gt;tickValues(tickpos, &amp;bar, &amp;beat, &amp;tick);
00196       <span class="keywordtype">char</span> buffer[32];
00197       sprintf(buffer, <span class="stringliteral">"%03d.%02d"</span>, bar+1, beat+1);
00198       posLabel-&gt;setText(QString(buffer));
00199       posSlider-&gt;setValue(tickpos);
00200 <span class="preprocessor">#endif</span>
00201 <span class="preprocessor"></span>      }
00202 
00203 <span class="comment">//---------------------------------------------------------</span>
00204 <span class="comment">//   enableSeek</span>
00205 <span class="comment">//---------------------------------------------------------</span>
00206 
<a name="l00207"></a><a class="code" href="classPlayPanel.html#a7">00207</a> <span class="keywordtype">void</span> <a class="code" href="classPlayPanel.html#a7">PlayPanel::enableSeek</a>(<span class="keywordtype">bool</span> val)
00208       {
00209       posSlider-&gt;setEnabled(val);
00210       }
00211 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Mon Jun 27 22:28:29 2005 for MuseScore by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
